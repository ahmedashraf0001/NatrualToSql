2025-08-27 00:00:00.049 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/setup/databases/SqlServer - null null
2025-08-27 00:00:00.055 +03:00 [DBG] No candidates found for the request path '/api/setup/databases/SqlServer'
2025-08-27 00:00:00.056 +03:00 [DBG] Request did not match any endpoints
2025-08-27 00:00:00.057 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/setup/databases/SqlServer - 404 0 null 8.2183ms
2025-08-27 00:00:00.059 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET https://localhost:7202/api/setup/databases/SqlServer, Response status code: 404
2025-08-27 00:00:17.047 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/setup/databases/0/DESKTOP-QCK8UI5//SQLEXPRESS - null null
2025-08-27 00:00:17.051 +03:00 [DBG] No candidates found for the request path '/api/setup/databases/0/DESKTOP-QCK8UI5//SQLEXPRESS'
2025-08-27 00:00:17.052 +03:00 [DBG] Request did not match any endpoints
2025-08-27 00:00:17.053 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/setup/databases/0/DESKTOP-QCK8UI5//SQLEXPRESS - 404 0 null 5.6039ms
2025-08-27 00:00:17.056 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET https://localhost:7202/api/setup/databases/0/DESKTOP-QCK8UI5//SQLEXPRESS, Response status code: 404
2025-08-27 00:00:48.343 +03:00 [DBG] Connection id "0HNF4SAC3MRMQ" received FIN.
2025-08-27 00:00:48.346 +03:00 [DBG] Connection id "0HNF4SAC3MRMQ" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:00:48.347 +03:00 [DBG] Connection id "0HNF4SAC3MRMQ" disconnecting.
2025-08-27 00:00:48.348 +03:00 [DBG] Connection id "0HNF4SAC3MRMQ" stopped.
2025-08-27 00:01:18.792 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/setup/databases/0/DESKTOP-QCK8UI5\SQLEXPRESS - null null
2025-08-27 00:01:18.795 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/databases/0/DESKTOP-QCK8UI5\SQLEXPRESS'
2025-08-27 00:01:18.797 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.GetAvailableDatabases (NaturalToQuery.Api)' with route pattern 'api/Setup/databases/{type}/{serverName}' is valid for the request path '/api/setup/databases/0/DESKTOP-QCK8UI5\SQLEXPRESS'
2025-08-27 00:01:18.799 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.GetAvailableDatabases (NaturalToQuery.Api)'
2025-08-27 00:01:18.800 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.SetupController.GetAvailableDatabases (NaturalToQuery.Api)'
2025-08-27 00:01:18.801 +03:00 [INF] Route matched with {action = "GetAvailableDatabases", controller = "Setup"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[NaturalToQuery.SharedKernal.DTOs.Providers.DatabaseInfo]]] GetAvailableDatabases(NaturalToQuery.Core.Contributers.Entities.ProviderType, System.String, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api).
2025-08-27 00:01:18.803 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:01:18.804 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:01:18.805 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:01:18.807 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:01:18.808 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:01:18.810 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:01:18.811 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:01:18.813 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:01:18.814 +03:00 [DBG] Attempting to bind parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType' ...
2025-08-27 00:01:18.816 +03:00 [DBG] Attempting to bind parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType' using the name 'type' in request data ...
2025-08-27 00:01:18.817 +03:00 [DBG] Done attempting to bind parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType'.
2025-08-27 00:01:18.818 +03:00 [DBG] Done attempting to bind parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType'.
2025-08-27 00:01:18.819 +03:00 [DBG] Attempting to validate the bound parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType' ...
2025-08-27 00:01:18.820 +03:00 [DBG] Done attempting to validate the bound parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType'.
2025-08-27 00:01:18.821 +03:00 [DBG] Attempting to bind parameter 'serverName' of type 'System.String' ...
2025-08-27 00:01:18.822 +03:00 [DBG] Attempting to bind parameter 'serverName' of type 'System.String' using the name 'serverName' in request data ...
2025-08-27 00:01:18.823 +03:00 [DBG] Done attempting to bind parameter 'serverName' of type 'System.String'.
2025-08-27 00:01:18.825 +03:00 [DBG] Done attempting to bind parameter 'serverName' of type 'System.String'.
2025-08-27 00:01:18.825 +03:00 [DBG] Attempting to validate the bound parameter 'serverName' of type 'System.String' ...
2025-08-27 00:01:18.826 +03:00 [DBG] Done attempting to validate the bound parameter 'serverName' of type 'System.String'.
2025-08-27 00:01:18.827 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:01:18.828 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:01:18.829 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:01:18.830 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:01:20.170 +03:00 [INF] Fetching databases for server DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 00:01:20.171 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=master)
2025-08-27 00:01:20.238 +03:00 [DBG] Connected to server DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 00:01:20.397 +03:00 [INF] Found 8 databases on DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 00:01:20.402 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:01:20.404 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:01:20.404 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 00:01:20.405 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 00:01:20.405 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 00:01:20.406 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[NaturalToQuery.SharedKernal.DTOs.Providers.DatabaseInfo, NaturalToQuery.SharedKernal, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-27 00:01:20.408 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.SetupController.GetAvailableDatabases (NaturalToQuery.Api) in 1598.019ms
2025-08-27 00:01:20.409 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.SetupController.GetAvailableDatabases (NaturalToQuery.Api)'
2025-08-27 00:01:20.410 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:01:20.411 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/setup/databases/0/DESKTOP-QCK8UI5\SQLEXPRESS - 200 null application/json; charset=utf-8 1618.8475ms
2025-08-27 00:01:23.782 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/setup/databases/0/DESKTOP-QCK8UI5\SQLEXPRESS - null null
2025-08-27 00:01:23.785 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/databases/0/DESKTOP-QCK8UI5\SQLEXPRESS'
2025-08-27 00:01:23.786 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.GetAvailableDatabases (NaturalToQuery.Api)' with route pattern 'api/Setup/databases/{type}/{serverName}' is valid for the request path '/api/setup/databases/0/DESKTOP-QCK8UI5\SQLEXPRESS'
2025-08-27 00:01:23.788 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.GetAvailableDatabases (NaturalToQuery.Api)'
2025-08-27 00:01:23.789 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.SetupController.GetAvailableDatabases (NaturalToQuery.Api)'
2025-08-27 00:01:23.789 +03:00 [INF] Route matched with {action = "GetAvailableDatabases", controller = "Setup"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[NaturalToQuery.SharedKernal.DTOs.Providers.DatabaseInfo]]] GetAvailableDatabases(NaturalToQuery.Core.Contributers.Entities.ProviderType, System.String, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api).
2025-08-27 00:01:23.791 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:01:23.791 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:01:23.792 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:01:23.794 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:01:23.795 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:01:23.796 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:01:23.797 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:01:23.799 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:01:23.801 +03:00 [DBG] Attempting to bind parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType' ...
2025-08-27 00:01:23.802 +03:00 [DBG] Attempting to bind parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType' using the name 'type' in request data ...
2025-08-27 00:01:23.803 +03:00 [DBG] Done attempting to bind parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType'.
2025-08-27 00:01:23.803 +03:00 [DBG] Done attempting to bind parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType'.
2025-08-27 00:01:23.804 +03:00 [DBG] Attempting to validate the bound parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType' ...
2025-08-27 00:01:23.805 +03:00 [DBG] Done attempting to validate the bound parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType'.
2025-08-27 00:01:23.806 +03:00 [DBG] Attempting to bind parameter 'serverName' of type 'System.String' ...
2025-08-27 00:01:23.808 +03:00 [DBG] Attempting to bind parameter 'serverName' of type 'System.String' using the name 'serverName' in request data ...
2025-08-27 00:01:23.809 +03:00 [DBG] Done attempting to bind parameter 'serverName' of type 'System.String'.
2025-08-27 00:01:23.811 +03:00 [DBG] Done attempting to bind parameter 'serverName' of type 'System.String'.
2025-08-27 00:01:23.812 +03:00 [DBG] Attempting to validate the bound parameter 'serverName' of type 'System.String' ...
2025-08-27 00:01:23.813 +03:00 [DBG] Done attempting to validate the bound parameter 'serverName' of type 'System.String'.
2025-08-27 00:01:23.814 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:01:23.815 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:01:23.816 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:01:23.816 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:01:26.928 +03:00 [DBG] Connection id "0HNF4SAC3MRMS" received FIN.
2025-08-27 00:01:26.932 +03:00 [DBG] Connection id "0HNF4SAC3MRMP" received FIN.
2025-08-27 00:01:26.929 +03:00 [INF] Fetching databases for server DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 00:01:26.959 +03:00 [DBG] Connection id "0HNF4SAC3MRMP" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:01:26.958 +03:00 [DBG] The connection queue processing loop for 0HNF4SAC3MRMS completed.
2025-08-27 00:01:26.958 +03:00 [DBG] Connection id "0HNF4SAC3MRMS" is closed. The last processed stream ID was 9.
2025-08-27 00:01:26.964 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=master)
2025-08-27 00:01:26.964 +03:00 [DBG] Connection id "0HNF4SAC3MRMP" disconnecting.
2025-08-27 00:01:26.967 +03:00 [DBG] Connected to server DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 00:01:26.966 +03:00 [DBG] Connection id "0HNF4SAC3MRMS" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:01:26.967 +03:00 [DBG] Connection id "0HNF4SAC3MRMP" stopped.
2025-08-27 00:01:26.969 +03:00 [DBG] Connection id "0HNF4SAC3MRMS" stopped.
2025-08-27 00:01:26.970 +03:00 [INF] Found 8 databases on DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 00:01:26.971 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:01:26.972 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:01:26.973 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 00:01:26.973 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 00:01:26.974 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 00:01:26.974 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[NaturalToQuery.SharedKernal.DTOs.Providers.DatabaseInfo, NaturalToQuery.SharedKernal, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-27 00:01:26.976 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.SetupController.GetAvailableDatabases (NaturalToQuery.Api) in 3179.9272ms
2025-08-27 00:01:26.977 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.SetupController.GetAvailableDatabases (NaturalToQuery.Api)'
2025-08-27 00:01:26.977 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:01:26.978 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/setup/databases/0/DESKTOP-QCK8UI5\SQLEXPRESS - 200 null application/json; charset=utf-8 3196.8205ms
2025-08-27 00:02:23.574 +03:00 [INF] This is a test log to file!
2025-08-27 00:02:23.753 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 00:02:23.761 +03:00 [INF] API configured successfully.
2025-08-27 00:02:23.762 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 00:02:23.763 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 00:02:23.807 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 00:02:23.850 +03:00 [DBG] Hosting starting
2025-08-27 00:02:23.862 +03:00 [DBG] Middleware loaded
2025-08-27 00:02:23.864 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 00:02:23.866 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 00:02:23.941 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 00:02:23.945 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 00:02:23.952 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 00:02:23.983 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 00:02:24.048 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 00:02:24.049 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 00:02:24.050 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 00:02:24.051 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 00:02:24.052 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 00:02:24.053 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 00:02:24.059 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 00:02:24.061 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 00:02:24.147 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 00:02:24.148 +03:00 [INF] Hosting environment: Development
2025-08-27 00:02:24.149 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 00:02:24.150 +03:00 [DBG] Hosting started
2025-08-27 00:02:26.004 +03:00 [DBG] Connection id "0HNF4SFE3LTJ2" accepted.
2025-08-27 00:02:26.006 +03:00 [DBG] Connection id "0HNF4SFE3LTJ2" started.
2025-08-27 00:02:26.032 +03:00 [DBG] Connection id "0HNF4SFE3LTJ2" received FIN.
2025-08-27 00:02:26.032 +03:00 [DBG] Connection id "0HNF4SFE3LTJ3" accepted.
2025-08-27 00:02:26.046 +03:00 [DBG] Connection id "0HNF4SFE3LTJ3" started.
2025-08-27 00:02:26.148 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.Security.Authentication.AuthenticationException: Authentication failed, see inner exception.
 ---> System.ComponentModel.Win32Exception (0x80090327): An unknown error occurred while processing the certificate.
   --- End of inner exception stack trace ---
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-08-27 00:02:26.156 +03:00 [DBG] Connection id "0HNF4SFE3LTJ2" stopped.
2025-08-27 00:02:26.158 +03:00 [DBG] Connection 0HNF4SFE3LTJ3 established using the following protocol: "Tls13"
2025-08-27 00:02:26.159 +03:00 [DBG] Connection id "0HNF4SFE3LTJ2" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:02:26.204 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/setup/databases/0/DESKTOP-QCK8UI5\SQLEXPRESS - null null
2025-08-27 00:02:26.296 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/databases/0/DESKTOP-QCK8UI5\SQLEXPRESS'
2025-08-27 00:02:26.298 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.GetAvailableDatabases (NaturalToQuery.Api)' with route pattern 'api/Setup/databases/{type}/{serverName}' is valid for the request path '/api/setup/databases/0/DESKTOP-QCK8UI5\SQLEXPRESS'
2025-08-27 00:02:26.300 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.GetAvailableDatabases (NaturalToQuery.Api)'
2025-08-27 00:02:26.323 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.SetupController.GetAvailableDatabases (NaturalToQuery.Api)'
2025-08-27 00:02:26.344 +03:00 [INF] Route matched with {action = "GetAvailableDatabases", controller = "Setup"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[NaturalToQuery.SharedKernal.DTOs.Providers.DatabaseInfo]]] GetAvailableDatabases(NaturalToQuery.Core.Contributers.Entities.ProviderType, System.String, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api).
2025-08-27 00:02:26.347 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:02:26.348 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:02:26.349 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:02:26.351 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:02:26.354 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:02:26.359 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:02:26.448 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 00:02:26.841 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:02:26.846 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:02:26.854 +03:00 [DBG] Attempting to bind parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType' ...
2025-08-27 00:02:26.856 +03:00 [DBG] Attempting to bind parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType' using the name 'type' in request data ...
2025-08-27 00:02:26.859 +03:00 [DBG] Done attempting to bind parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType'.
2025-08-27 00:02:26.861 +03:00 [DBG] Done attempting to bind parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType'.
2025-08-27 00:02:26.862 +03:00 [DBG] Attempting to validate the bound parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType' ...
2025-08-27 00:02:26.864 +03:00 [DBG] Done attempting to validate the bound parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType'.
2025-08-27 00:02:26.866 +03:00 [DBG] Attempting to bind parameter 'serverName' of type 'System.String' ...
2025-08-27 00:02:26.867 +03:00 [DBG] Attempting to bind parameter 'serverName' of type 'System.String' using the name 'serverName' in request data ...
2025-08-27 00:02:26.869 +03:00 [DBG] Done attempting to bind parameter 'serverName' of type 'System.String'.
2025-08-27 00:02:26.870 +03:00 [DBG] Done attempting to bind parameter 'serverName' of type 'System.String'.
2025-08-27 00:02:26.870 +03:00 [DBG] Attempting to validate the bound parameter 'serverName' of type 'System.String' ...
2025-08-27 00:02:26.874 +03:00 [DBG] Done attempting to validate the bound parameter 'serverName' of type 'System.String'.
2025-08-27 00:02:26.875 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:02:26.876 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:02:26.877 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:02:26.878 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:02:26.895 +03:00 [INF] Fetching databases for server DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 00:02:26.902 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=master)
2025-08-27 00:02:27.062 +03:00 [DBG] Connected to server DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 00:02:27.173 +03:00 [INF] Found 8 databases on DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 00:02:27.182 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:02:27.185 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:02:27.186 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 00:02:27.187 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 00:02:27.188 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 00:02:27.190 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[NaturalToQuery.SharedKernal.DTOs.Providers.DatabaseInfo, NaturalToQuery.SharedKernal, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-27 00:02:27.201 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.SetupController.GetAvailableDatabases (NaturalToQuery.Api) in 840.4811ms
2025-08-27 00:02:27.204 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.SetupController.GetAvailableDatabases (NaturalToQuery.Api)'
2025-08-27 00:02:27.209 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:02:27.213 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/setup/databases/0/DESKTOP-QCK8UI5\SQLEXPRESS - 200 null application/json; charset=utf-8 1013.0755ms
2025-08-27 00:03:51.356 +03:00 [DBG] Connection id "0HNF4SFE3LTJ4" accepted.
2025-08-27 00:03:51.357 +03:00 [DBG] Connection id "0HNF4SFE3LTJ4" started.
2025-08-27 00:03:51.358 +03:00 [DBG] Connection id "0HNF4SFE3LTJ5" accepted.
2025-08-27 00:03:51.368 +03:00 [DBG] Connection id "0HNF4SFE3LTJ4" received FIN.
2025-08-27 00:03:51.372 +03:00 [DBG] Connection id "0HNF4SFE3LTJ5" started.
2025-08-27 00:03:51.373 +03:00 [DBG] Connection id "0HNF4SFE3LTJ4" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:03:51.375 +03:00 [DBG] Connection id "0HNF4SFE3LTJ4" disconnecting.
2025-08-27 00:03:51.376 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/setup/profile - application/json 252
2025-08-27 00:03:51.376 +03:00 [DBG] Connection id "0HNF4SFE3LTJ4" stopped.
2025-08-27 00:03:51.380 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:03:51.380 +03:00 [DBG] Request matched endpoint '405 HTTP Method Not Supported'
2025-08-27 00:03:51.385 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-08-27 00:03:51.387 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/setup/profile'.
2025-08-27 00:03:51.388 +03:00 [DBG] Connection id "0HNF4SFE3LTJ5" completed keep alive response.
2025-08-27 00:03:51.389 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/setup/profile - 307 0 null 13.3107ms
2025-08-27 00:03:51.401 +03:00 [DBG] Connection id "0HNF4SFE3LTJ5", Request id "0HNF4SFE3LTJ5:00000001": started reading request body.
2025-08-27 00:03:51.401 +03:00 [DBG] Connection id "0HNF4SFE3LTJ6" received FIN.
2025-08-27 00:03:51.401 +03:00 [DBG] Connection id "0HNF4SFE3LTJ7" accepted.
2025-08-27 00:03:51.402 +03:00 [DBG] Connection id "0HNF4SFE3LTJ5", Request id "0HNF4SFE3LTJ5:00000001": done reading request body.
2025-08-27 00:03:51.403 +03:00 [DBG] Connection id "0HNF4SFE3LTJ6" accepted.
2025-08-27 00:03:51.404 +03:00 [DBG] Connection id "0HNF4SFE3LTJ7" started.
2025-08-27 00:03:51.406 +03:00 [DBG] Connection id "0HNF4SFE3LTJ6" started.
2025-08-27 00:03:51.407 +03:00 [DBG] Connection id "0HNF4SFE3LTJ6" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:03:51.408 +03:00 [DBG] Connection id "0HNF4SFE3LTJ6" disconnecting.
2025-08-27 00:03:51.409 +03:00 [DBG] Connection id "0HNF4SFE3LTJ6" stopped.
2025-08-27 00:03:51.410 +03:00 [DBG] Connection 0HNF4SFE3LTJ7 established using the following protocol: "Tls13"
2025-08-27 00:03:51.411 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7202/api/setup/profile - application/json 252
2025-08-27 00:03:51.413 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:03:51.413 +03:00 [DBG] Request matched endpoint '405 HTTP Method Not Supported'
2025-08-27 00:03:51.415 +03:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2025-08-27 00:03:51.416 +03:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2025-08-27 00:03:51.417 +03:00 [DBG] Connection id "0HNF4SFE3LTJ7" completed keep alive response.
2025-08-27 00:03:51.418 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7202/api/setup/profile - 405 0 null 6.4715ms
2025-08-27 00:03:51.420 +03:00 [DBG] Connection id "0HNF4SFE3LTJ7", Request id "0HNF4SFE3LTJ7:00000001": started reading request body.
2025-08-27 00:03:51.421 +03:00 [DBG] Connection id "0HNF4SFE3LTJ7", Request id "0HNF4SFE3LTJ7:00000001": done reading request body.
2025-08-27 00:04:02.293 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/setup/profile - application/json 252
2025-08-27 00:04:02.296 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:04:02.296 +03:00 [DBG] Request matched endpoint '405 HTTP Method Not Supported'
2025-08-27 00:04:02.297 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/setup/profile'.
2025-08-27 00:04:02.298 +03:00 [DBG] Connection id "0HNF4SFE3LTJ5" completed keep alive response.
2025-08-27 00:04:02.299 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/setup/profile - 307 0 null 5.6495ms
2025-08-27 00:04:02.300 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7202/api/setup/profile - application/json 252
2025-08-27 00:04:02.301 +03:00 [DBG] Connection id "0HNF4SFE3LTJ5", Request id "0HNF4SFE3LTJ5:00000002": started reading request body.
2025-08-27 00:04:02.303 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:04:02.303 +03:00 [DBG] Connection id "0HNF4SFE3LTJ5", Request id "0HNF4SFE3LTJ5:00000002": done reading request body.
2025-08-27 00:04:02.304 +03:00 [DBG] Request matched endpoint '405 HTTP Method Not Supported'
2025-08-27 00:04:02.307 +03:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2025-08-27 00:04:02.307 +03:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2025-08-27 00:04:02.308 +03:00 [DBG] Connection id "0HNF4SFE3LTJ7" completed keep alive response.
2025-08-27 00:04:02.309 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7202/api/setup/profile - 405 0 null 9.1011ms
2025-08-27 00:04:02.312 +03:00 [DBG] Connection id "0HNF4SFE3LTJ7", Request id "0HNF4SFE3LTJ7:00000002": started reading request body.
2025-08-27 00:04:02.313 +03:00 [DBG] Connection id "0HNF4SFE3LTJ7", Request id "0HNF4SFE3LTJ7:00000002": done reading request body.
2025-08-27 00:04:06.531 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/setup/profile - application/json 252
2025-08-27 00:04:06.534 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:04:06.536 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:04:06.537 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:04:06.538 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/setup/profile'.
2025-08-27 00:04:06.538 +03:00 [DBG] Connection id "0HNF4SFE3LTJ5" completed keep alive response.
2025-08-27 00:04:06.539 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/setup/profile - 307 0 null 8.2318ms
2025-08-27 00:04:06.540 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/setup/profile - application/json 252
2025-08-27 00:04:06.541 +03:00 [DBG] Connection id "0HNF4SFE3LTJ5", Request id "0HNF4SFE3LTJ5:00000003": started reading request body.
2025-08-27 00:04:06.543 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:04:06.543 +03:00 [DBG] Connection id "0HNF4SFE3LTJ5", Request id "0HNF4SFE3LTJ5:00000003": done reading request body.
2025-08-27 00:04:06.544 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:04:06.545 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:04:06.546 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:04:06.550 +03:00 [INF] Route matched with {action = "CreateProfile", controller = "Setup"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.UI.ProfileCreationResponse]] CreateProfile(NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api).
2025-08-27 00:04:06.551 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:04:06.552 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:04:06.553 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:04:06.555 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:04:06.555 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:04:06.556 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:04:06.598 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:04:06.600 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:04:06.601 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:04:06.604 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' using the name '' in request data ...
2025-08-27 00:04:06.606 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:04:06.624 +03:00 [DBG] Connection id "0HNF4SFE3LTJ7", Request id "0HNF4SFE3LTJ7:00000003": started reading request body.
2025-08-27 00:04:06.625 +03:00 [DBG] Connection id "0HNF4SFE3LTJ7", Request id "0HNF4SFE3LTJ7:00000003": done reading request body.
2025-08-27 00:04:06.756 +03:00 [DBG] JSON input formatter threw an exception: The JSON value could not be converted to NaturalToQuery.Core.Contributers.Entities.ProviderType. Path: $.providerType | LineNumber: 1 | BytePositionInLine: 29.
2025-08-27 00:04:06.758 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:04:06.759 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:04:06.760 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:04:06.762 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:04:06.763 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:04:06.764 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:04:06.765 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:04:06.765 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:04:06.766 +03:00 [DBG] The request has model state errors, returning an error response.
2025-08-27 00:04:06.768 +03:00 [DBG] Request was short circuited at action filter 'Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter'.
2025-08-27 00:04:06.769 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:04:06.770 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:04:06.771 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/problem+json","application/problem+xml","application/problem+json","application/problem+xml"]'.
2025-08-27 00:04:06.773 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/problem+json' to write the response.
2025-08-27 00:04:06.774 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-08-27 00:04:06.790 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api) in 233.6285ms
2025-08-27 00:04:06.791 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:04:06.792 +03:00 [DBG] Connection id "0HNF4SFE3LTJ7" completed keep alive response.
2025-08-27 00:04:06.792 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:04:06.794 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/setup/profile - 400 null application/problem+json; charset=utf-8 254.0087ms
2025-08-27 00:06:28.188 +03:00 [DBG] Connection id "0HNF4SFE3LTJ8" accepted.
2025-08-27 00:06:28.192 +03:00 [DBG] Connection id "0HNF4SFE3LTJ8" received FIN.
2025-08-27 00:06:28.237 +03:00 [DBG] Connection id "0HNF4SFE3LTJ9" accepted.
2025-08-27 00:06:28.237 +03:00 [DBG] Connection id "0HNF4SFE3LTJ8" started.
2025-08-27 00:06:28.242 +03:00 [DBG] Connection id "0HNF4SFE3LTJ9" started.
2025-08-27 00:06:28.243 +03:00 [DBG] Connection id "0HNF4SFE3LTJ8" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:06:28.244 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/setup/profile - application/json 163
2025-08-27 00:06:28.244 +03:00 [DBG] Connection id "0HNF4SFE3LTJ8" disconnecting.
2025-08-27 00:06:28.246 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:06:28.247 +03:00 [DBG] Connection id "0HNF4SFE3LTJ8" stopped.
2025-08-27 00:06:28.247 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:06:28.250 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:06:28.251 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/setup/profile'.
2025-08-27 00:06:28.252 +03:00 [DBG] Connection id "0HNF4SFE3LTJ9" completed keep alive response.
2025-08-27 00:06:28.253 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/setup/profile - 307 0 null 9.0715ms
2025-08-27 00:06:28.253 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/setup/profile - application/json 163
2025-08-27 00:06:28.255 +03:00 [DBG] Connection id "0HNF4SFE3LTJ9", Request id "0HNF4SFE3LTJ9:00000001": started reading request body.
2025-08-27 00:06:28.257 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:06:28.258 +03:00 [DBG] Connection id "0HNF4SFE3LTJ9", Request id "0HNF4SFE3LTJ9:00000001": done reading request body.
2025-08-27 00:06:28.259 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:06:28.261 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:06:28.262 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:06:28.263 +03:00 [INF] Route matched with {action = "CreateProfile", controller = "Setup"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.UI.ProfileCreationResponse]] CreateProfile(NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api).
2025-08-27 00:06:28.265 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:06:28.266 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:06:28.267 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:06:28.269 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:06:28.270 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:06:28.271 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:06:28.284 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:06:28.286 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:06:28.287 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:06:28.288 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' using the name '' in request data ...
2025-08-27 00:06:28.290 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:06:28.291 +03:00 [DBG] Connection id "0HNF4SFE3LTJ7", Request id "0HNF4SFE3LTJ7:00000004": started reading request body.
2025-08-27 00:06:28.293 +03:00 [DBG] Connection id "0HNF4SFE3LTJ7", Request id "0HNF4SFE3LTJ7:00000004": done reading request body.
2025-08-27 00:06:28.298 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'
2025-08-27 00:06:28.299 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:06:28.300 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:06:28.301 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:06:28.306 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:06:28.307 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:06:28.308 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:06:28.309 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:06:28.310 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:06:30.240 +03:00 [INF] Creating profile for provider "SqlServer"
2025-08-27 00:06:30.251 +03:00 [DBG] Saved secret profile-74057e69-6602-4ba4-95e3-e82614c041d4 for provider "SqlServer"
2025-08-27 00:06:30.252 +03:00 [DBG] Generated profile name SqlServer - ProductInventory with cache dir C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer
2025-08-27 00:06:30.307 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Any(p => (int)p.Provider == (int)__profile_Provider_0)'
2025-08-27 00:06:30.506 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 00:06:30.533 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:06:30.541 +03:00 [DBG] Created DbConnection. (9ms).
2025-08-27 00:06:30.544 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:06:30.555 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:06:30.558 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:06:30.564 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-08-27 00:06:30.568 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (10ms).
2025-08-27 00:06:30.575 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:06:30.592 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:06:30.600 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:06:30.606 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 7ms reading results.
2025-08-27 00:06:30.609 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:06:30.612 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-08-27 00:06:30.640 +03:00 [DBG] 'ProfilesDbContext' generated a value for the property 'Profile.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:06:30.694 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:06:30.700 +03:00 [DBG] DetectChanges starting for 'ProfilesDbContext'.
2025-08-27 00:06:30.712 +03:00 [DBG] DetectChanges completed for 'ProfilesDbContext'.
2025-08-27 00:06:30.717 +03:00 [DBG] SaveChanges starting for 'ProfilesDbContext'.
2025-08-27 00:06:30.719 +03:00 [DBG] DetectChanges starting for 'ProfilesDbContext'.
2025-08-27 00:06:30.719 +03:00 [DBG] DetectChanges completed for 'ProfilesDbContext'.
2025-08-27 00:06:30.774 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:06:30.775 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:06:30.779 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:06:30.780 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:06:30.782 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 00:06:30.783 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 49), @p2='?' (DbType = DateTimeOffset), @p3='?' (Size = 28), @p4='?' (DbType = Int32), @p5='?' (Size = 44)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Profiles" ("Id", "CacheFile", "CreatedUtc", "Name", "Provider", "SecretRef")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-08-27 00:06:30.865 +03:00 [ERR] Failed executing DbCommand (81ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 49), @p2='?' (DbType = DateTimeOffset), @p3='?' (Size = 28), @p4='?' (DbType = Int32), @p5='?' (Size = 44)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Profiles" ("Id", "CacheFile", "CreatedUtc", "Name", "Provider", "SecretRef")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-08-27 00:06:30.962 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:06:30.963 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:06:31.077 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.Sqlite.SqliteException (0x80004005): SQLite Error 19: 'NOT NULL constraint failed: Profiles.EmbeddingStatus'.
   at Microsoft.Data.Sqlite.SqliteException.ThrowExceptionForRC(Int32 rc, sqlite3 db)
   at Microsoft.Data.Sqlite.SqliteDataReader.NextResult()
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteReader(CommandBehavior behavior)
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.Sqlite.SqliteException (0x80004005): SQLite Error 19: 'NOT NULL constraint failed: Profiles.EmbeddingStatus'.
   at Microsoft.Data.Sqlite.SqliteException.ThrowExceptionForRC(Int32 rc, sqlite3 db)
   at Microsoft.Data.Sqlite.SqliteDataReader.NextResult()
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteReader(CommandBehavior behavior)
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-27 00:06:31.237 +03:00 [ERR] Failed to create profile
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.Sqlite.SqliteException (0x80004005): SQLite Error 19: 'NOT NULL constraint failed: Profiles.EmbeddingStatus'.
   at Microsoft.Data.Sqlite.SqliteException.ThrowExceptionForRC(Int32 rc, sqlite3 db)
   at Microsoft.Data.Sqlite.SqliteDataReader.NextResult()
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteReader(CommandBehavior behavior)
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Persistence\ProfilesDbContext.cs:line 70
   at ProfileRepository.SaveChangesAsync(CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Persistence\Repositories\ProfileRepository.cs:line 73
   at NaturalToQuery.Application.Services.ProfileService.CreateAsync(ProviderType provider, ProviderConnectionConfig config, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileService.cs:line 43
   at NaturalToQuery.Application.Services.SetupService.CreateProfileAsync(SetupRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\SetupService.cs:line 33
   at NaturalToQuery.Api.Controllers.SetupController.CreateProfile(SetupRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\SetupController.cs:line 96
2025-08-27 00:06:31.253 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:06:31.255 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:06:31.256 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 00:06:31.257 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 00:06:31.257 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 00:06:31.258 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType1`1[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-27 00:06:31.260 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api) in 2988.9704ms
2025-08-27 00:06:31.261 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:06:31.262 +03:00 [DBG] Connection id "0HNF4SFE3LTJ7" completed keep alive response.
2025-08-27 00:06:31.262 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:06:31.265 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:06:31.267 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:06:31.268 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/setup/profile - 500 null application/json; charset=utf-8 3014.6212ms
2025-08-27 00:06:34.803 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/setup/profile - application/json 163
2025-08-27 00:06:34.806 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:06:34.807 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:06:34.807 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:06:34.808 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/setup/profile'.
2025-08-27 00:06:34.809 +03:00 [DBG] Connection id "0HNF4SFE3LTJ9" completed keep alive response.
2025-08-27 00:06:34.810 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/setup/profile - 307 0 null 7.3474ms
2025-08-27 00:06:34.810 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/setup/profile - application/json 163
2025-08-27 00:06:34.812 +03:00 [DBG] Connection id "0HNF4SFE3LTJ9", Request id "0HNF4SFE3LTJ9:00000002": started reading request body.
2025-08-27 00:06:34.814 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:06:34.814 +03:00 [DBG] Connection id "0HNF4SFE3LTJ9", Request id "0HNF4SFE3LTJ9:00000002": done reading request body.
2025-08-27 00:06:34.815 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:06:34.817 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:06:34.818 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:06:34.819 +03:00 [INF] Route matched with {action = "CreateProfile", controller = "Setup"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.UI.ProfileCreationResponse]] CreateProfile(NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api).
2025-08-27 00:06:34.821 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:06:34.823 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:06:34.824 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:06:34.825 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:06:34.826 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:06:34.827 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:06:34.829 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:06:34.831 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:06:34.832 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:06:34.833 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' using the name '' in request data ...
2025-08-27 00:06:34.835 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:06:34.836 +03:00 [DBG] Connection id "0HNF4SFE3LTJ7", Request id "0HNF4SFE3LTJ7:00000005": started reading request body.
2025-08-27 00:06:34.837 +03:00 [DBG] Connection id "0HNF4SFE3LTJ7", Request id "0HNF4SFE3LTJ7:00000005": done reading request body.
2025-08-27 00:06:34.838 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'
2025-08-27 00:06:34.839 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:06:34.840 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:06:34.840 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:06:34.842 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:06:34.843 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:06:34.843 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:06:34.844 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:06:34.845 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:07:43.568 +03:00 [INF] Creating profile for provider "SqlServer"
2025-08-27 00:07:44.987 +03:00 [DBG] Saved secret profile-ee17a69b-480f-4d2a-bd6f-e96c05db9d73 for provider "SqlServer"
2025-08-27 00:07:47.434 +03:00 [DBG] Generated profile name SqlServer - ProductInventory with cache dir C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer
2025-08-27 00:07:55.670 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:07:55.671 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 00:07:55.672 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:07:55.674 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:07:55.675 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:07:55.676 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:07:55.677 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:07:55.678 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:07:55.680 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:07:55.681 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:07:55.682 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 00:07:55.683 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:07:55.684 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:07:55.686 +03:00 [DBG] 'ProfilesDbContext' generated a value for the property 'Profile.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:07:55.687 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:07:56.491 +03:00 [DBG] DetectChanges starting for 'ProfilesDbContext'.
2025-08-27 00:07:56.492 +03:00 [DBG] DetectChanges completed for 'ProfilesDbContext'.
2025-08-27 00:07:56.493 +03:00 [DBG] SaveChanges starting for 'ProfilesDbContext'.
2025-08-27 00:07:56.494 +03:00 [DBG] DetectChanges starting for 'ProfilesDbContext'.
2025-08-27 00:07:56.495 +03:00 [DBG] DetectChanges completed for 'ProfilesDbContext'.
2025-08-27 00:07:56.497 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:07:56.498 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:07:56.508 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:07:56.509 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:07:56.510 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 00:07:56.511 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 49), @p2='?' (DbType = DateTimeOffset), @p3='?' (Size = 28), @p4='?' (DbType = Int32), @p5='?' (Size = 44)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Profiles" ("Id", "CacheFile", "CreatedUtc", "Name", "Provider", "SecretRef")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-08-27 00:07:56.582 +03:00 [ERR] Failed executing DbCommand (71ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 49), @p2='?' (DbType = DateTimeOffset), @p3='?' (Size = 28), @p4='?' (DbType = Int32), @p5='?' (Size = 44)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Profiles" ("Id", "CacheFile", "CreatedUtc", "Name", "Provider", "SecretRef")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-08-27 00:07:56.686 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:07:56.687 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:07:56.803 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.Sqlite.SqliteException (0x80004005): SQLite Error 19: 'NOT NULL constraint failed: Profiles.EmbeddingStatus'.
   at Microsoft.Data.Sqlite.SqliteException.ThrowExceptionForRC(Int32 rc, sqlite3 db)
   at Microsoft.Data.Sqlite.SqliteDataReader.NextResult()
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteReader(CommandBehavior behavior)
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.Sqlite.SqliteException (0x80004005): SQLite Error 19: 'NOT NULL constraint failed: Profiles.EmbeddingStatus'.
   at Microsoft.Data.Sqlite.SqliteException.ThrowExceptionForRC(Int32 rc, sqlite3 db)
   at Microsoft.Data.Sqlite.SqliteDataReader.NextResult()
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteReader(CommandBehavior behavior)
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.Data.Sqlite.SqliteCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-27 00:08:23.254 +03:00 [INF] This is a test log to file!
2025-08-27 00:08:23.350 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 00:08:23.679 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:08:23.682 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:08:23.690 +03:00 [DBG] Created DbConnection. (6ms).
2025-08-27 00:08:23.693 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:08:23.696 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:08:23.699 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:08:25.922 +03:00 [INF] This is a test log to file!
2025-08-27 00:08:26.016 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 00:08:26.305 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:08:26.308 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:08:26.315 +03:00 [DBG] Created DbConnection. (6ms).
2025-08-27 00:08:26.318 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:08:26.320 +03:00 [DBG] Created DbConnection. (2ms).
2025-08-27 00:08:26.322 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:08:26.328 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:08:26.330 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:08:26.332 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:08:26.332 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:08:26.333 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:08:26.334 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:08:26.335 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:08:26.337 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:08:26.338 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:08:26.338 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:08:31.578 +03:00 [INF] This is a test log to file!
2025-08-27 00:08:31.673 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 00:08:31.962 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:08:31.965 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:08:31.973 +03:00 [DBG] Created DbConnection. (6ms).
2025-08-27 00:08:31.976 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:08:31.978 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:08:31.981 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:08:34.089 +03:00 [INF] This is a test log to file!
2025-08-27 00:08:34.202 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 00:08:34.566 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:08:34.572 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:08:34.581 +03:00 [DBG] Created DbConnection. (7ms).
2025-08-27 00:08:34.584 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:08:34.585 +03:00 [DBG] Created DbConnection. (1ms).
2025-08-27 00:08:34.588 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:08:34.593 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:08:34.596 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:08:34.598 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:08:34.599 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:08:34.600 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:08:34.600 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:08:34.602 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:08:34.604 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:08:34.605 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:08:34.605 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:09:00.087 +03:00 [INF] This is a test log to file!
2025-08-27 00:09:00.202 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 00:09:00.543 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:09:00.546 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:09:00.554 +03:00 [DBG] Created DbConnection. (6ms).
2025-08-27 00:09:00.557 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:09:00.560 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:09:00.562 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:09:02.870 +03:00 [INF] This is a test log to file!
2025-08-27 00:09:02.964 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 00:09:03.254 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:09:03.257 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:09:03.265 +03:00 [DBG] Created DbConnection. (6ms).
2025-08-27 00:09:03.267 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:09:03.269 +03:00 [DBG] Created DbConnection. (1ms).
2025-08-27 00:09:03.270 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:09:03.276 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:09:03.278 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:09:03.280 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:09:03.280 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:09:03.282 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:09:03.282 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:09:03.283 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:09:03.286 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:09:03.287 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:09:03.287 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:09:13.814 +03:00 [INF] This is a test log to file!
2025-08-27 00:09:13.934 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 00:09:14.298 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:09:14.674 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:09:20.959 +03:00 [INF] This is a test log to file!
2025-08-27 00:09:21.058 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 00:09:21.370 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:09:21.449 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:09:21.457 +03:00 [DBG] Created DbConnection. (6ms).
2025-08-27 00:09:21.459 +03:00 [DBG] Migrating using database 'main' on server 'schema_cache.db'.
2025-08-27 00:09:21.464 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:09:21.467 +03:00 [DBG] Created DbConnection. (2ms).
2025-08-27 00:09:21.468 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:09:21.475 +03:00 [DBG] An error occurred using the connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:09:21.475 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:09:21.478 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:09:21.478 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:09:21.484 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:09:21.487 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-08-27 00:09:21.491 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (2ms).
2025-08-27 00:09:21.492 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (5ms).
2025-08-27 00:09:21.496 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
PRAGMA journal_mode = 'wal';
2025-08-27 00:09:21.520 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
PRAGMA journal_mode = 'wal';
2025-08-27 00:09:21.521 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:09:21.523 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:09:21.523 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:09:21.523 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:09:21.523 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-08-27 00:09:21.525 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-08-27 00:09:21.525 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-08-27 00:09:21.525 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (0ms).
2025-08-27 00:09:21.525 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-08-27 00:09:21.528 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-08-27 00:09:21.529 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-08-27 00:09:21.529 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:21.529 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:21.529 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsLock" (
    "Id" INTEGER NOT NULL CONSTRAINT "PK___EFMigrationsLock" PRIMARY KEY,
    "Timestamp" TEXT NOT NULL
);
2025-08-27 00:09:21.537 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsLock" (
    "Id" INTEGER NOT NULL CONSTRAINT "PK___EFMigrationsLock" PRIMARY KEY,
    "Timestamp" TEXT NOT NULL
);
2025-08-27 00:09:21.538 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-08-27 00:09:21.538 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-08-27 00:09:21.538 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (0ms).
2025-08-27 00:09:21.538 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-08-26 21:09:21.5379611+00:00');
SELECT changes();
2025-08-27 00:09:21.540 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-08-26 21:09:21.5379611+00:00');
SELECT changes();
2025-08-27 00:09:21.576 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-08-27 00:09:21.578 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-08-27 00:09:21.578 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-08-27 00:09:21.578 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:21.578 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:21.578 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-08-27 00:09:21.579 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-08-27 00:09:21.579 +03:00 [DBG] Committing transaction.
2025-08-27 00:09:21.583 +03:00 [DBG] Committed transaction.
2025-08-27 00:09:21.584 +03:00 [DBG] Disposing transaction.
2025-08-27 00:09:21.586 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-08-27 00:09:21.586 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-08-27 00:09:21.587 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:09:21.587 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 00:09:21.588 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:09:21.588 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:09:21.589 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:09:21.589 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:09:21.589 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-08-27 00:09:21.589 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-08-27 00:09:21.589 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (0ms).
2025-08-27 00:09:21.589 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-08-27 00:09:21.589 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-08-27 00:09:22.287 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:09:22.287 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:09:22.287 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:09:22.287 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-08-27 00:09:22.287 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-08-27 00:09:22.288 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:09:22.289 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 00:09:22.292 +03:00 [INF] Applying migration '20250825154106_init'.
2025-08-27 00:09:22.302 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-08-27 00:09:22.302 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:22.302 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:22.303 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Profiles" (
    "Id" TEXT NOT NULL CONSTRAINT "PK_Profiles" PRIMARY KEY,
    "Name" TEXT NOT NULL,
    "Provider" INTEGER NOT NULL,
    "SecretRef" TEXT NOT NULL,
    "CacheFile" TEXT NULL,
    "EmbeddingStatus" INTEGER NOT NULL,
    "CreatedUtc" TEXT NOT NULL
);
2025-08-27 00:09:22.303 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Profiles" (
    "Id" TEXT NOT NULL CONSTRAINT "PK_Profiles" PRIMARY KEY,
    "Name" TEXT NOT NULL,
    "Provider" INTEGER NOT NULL,
    "SecretRef" TEXT NOT NULL,
    "CacheFile" TEXT NULL,
    "EmbeddingStatus" INTEGER NOT NULL,
    "CreatedUtc" TEXT NOT NULL
);
2025-08-27 00:09:22.303 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-08-27 00:09:22.303 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:22.303 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:22.303 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Queries" (
    "Id" TEXT NOT NULL CONSTRAINT "PK_Queries" PRIMARY KEY,
    "UserQuery" TEXT NOT NULL,
    "SqlQuery" TEXT NOT NULL,
    "ResultJson" TEXT NOT NULL,
    "TimestampUtc" TEXT NOT NULL,
    "ProfileId" TEXT NOT NULL,
    CONSTRAINT "FK_Queries_Profiles_ProfileId" FOREIGN KEY ("ProfileId") REFERENCES "Profiles" ("Id") ON DELETE CASCADE
);
2025-08-27 00:09:22.303 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Queries" (
    "Id" TEXT NOT NULL CONSTRAINT "PK_Queries" PRIMARY KEY,
    "UserQuery" TEXT NOT NULL,
    "SqlQuery" TEXT NOT NULL,
    "ResultJson" TEXT NOT NULL,
    "TimestampUtc" TEXT NOT NULL,
    "ProfileId" TEXT NOT NULL,
    CONSTRAINT "FK_Queries_Profiles_ProfileId" FOREIGN KEY ("ProfileId") REFERENCES "Profiles" ("Id") ON DELETE CASCADE
);
2025-08-27 00:09:22.303 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-08-27 00:09:22.303 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:22.304 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:22.304 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Queries_ProfileId" ON "Queries" ("ProfileId");
2025-08-27 00:09:22.304 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Queries_ProfileId" ON "Queries" ("ProfileId");
2025-08-27 00:09:22.304 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-08-27 00:09:22.304 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:22.304 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:22.304 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250825154106_init', '9.0.8');
2025-08-27 00:09:22.304 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250825154106_init', '9.0.8');
2025-08-27 00:09:24.445 +03:00 [INF] Applying migration '20250826210914_updatedsqlite'.
2025-08-27 00:09:24.450 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-08-27 00:09:24.450 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:24.451 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:24.451 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ef_temp_Profiles" (
    "Id" TEXT NOT NULL CONSTRAINT "PK_Profiles" PRIMARY KEY,
    "CacheFile" TEXT NULL,
    "CreatedUtc" TEXT NOT NULL,
    "Name" TEXT NOT NULL,
    "Provider" INTEGER NOT NULL,
    "SecretRef" TEXT NOT NULL
);
2025-08-27 00:09:24.451 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "ef_temp_Profiles" (
    "Id" TEXT NOT NULL CONSTRAINT "PK_Profiles" PRIMARY KEY,
    "CacheFile" TEXT NULL,
    "CreatedUtc" TEXT NOT NULL,
    "Name" TEXT NOT NULL,
    "Provider" INTEGER NOT NULL,
    "SecretRef" TEXT NOT NULL
);
2025-08-27 00:09:24.451 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-08-27 00:09:24.451 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:24.451 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:24.451 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "ef_temp_Profiles" ("Id", "CacheFile", "CreatedUtc", "Name", "Provider", "SecretRef")
SELECT "Id", "CacheFile", "CreatedUtc", "Name", "Provider", "SecretRef"
FROM "Profiles";
2025-08-27 00:09:24.451 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "ef_temp_Profiles" ("Id", "CacheFile", "CreatedUtc", "Name", "Provider", "SecretRef")
SELECT "Id", "CacheFile", "CreatedUtc", "Name", "Provider", "SecretRef"
FROM "Profiles";
2025-08-27 00:09:24.451 +03:00 [DBG] Committing transaction.
2025-08-27 00:09:24.460 +03:00 [DBG] Committed transaction.
2025-08-27 00:09:24.460 +03:00 [DBG] Disposing transaction.
2025-08-27 00:09:24.460 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-08-27 00:09:24.461 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:24.461 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:24.461 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
PRAGMA foreign_keys = 0;
2025-08-27 00:09:24.461 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
PRAGMA foreign_keys = 0;
2025-08-27 00:09:24.461 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-08-27 00:09:24.461 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-08-27 00:09:24.461 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-08-27 00:09:24.461 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:24.461 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:24.461 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Profiles";
2025-08-27 00:09:24.461 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE "Profiles";
2025-08-27 00:09:24.462 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-08-27 00:09:24.462 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:24.462 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:24.462 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "ef_temp_Profiles" RENAME TO "Profiles";
2025-08-27 00:09:24.462 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "ef_temp_Profiles" RENAME TO "Profiles";
2025-08-27 00:09:24.462 +03:00 [DBG] Committing transaction.
2025-08-27 00:09:24.465 +03:00 [DBG] Committed transaction.
2025-08-27 00:09:24.465 +03:00 [DBG] Disposing transaction.
2025-08-27 00:09:24.465 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-08-27 00:09:24.465 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:24.465 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (0ms).
2025-08-27 00:09:24.465 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
PRAGMA foreign_keys = 1;
2025-08-27 00:09:24.465 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
PRAGMA foreign_keys = 1;
2025-08-27 00:09:24.465 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-08-27 00:09:26.976 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (2510ms).
2025-08-27 00:09:26.976 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (2510ms).
2025-08-27 00:09:26.976 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250826210914_updatedsqlite', '9.0.8');
2025-08-27 00:09:26.979 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250826210914_updatedsqlite', '9.0.8');
2025-08-27 00:09:26.980 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-08-27 00:09:26.980 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-08-27 00:09:26.980 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (0ms).
2025-08-27 00:09:26.980 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-08-27 00:09:26.982 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-08-27 00:09:26.982 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:09:26.982 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:09:26.983 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:09:26.983 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:09:26.983 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:09:33.794 +03:00 [INF] This is a test log to file!
2025-08-27 00:09:33.956 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 00:09:33.965 +03:00 [INF] API configured successfully.
2025-08-27 00:09:33.966 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 00:09:33.967 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 00:09:34.052 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 00:09:34.147 +03:00 [DBG] Hosting starting
2025-08-27 00:09:34.183 +03:00 [DBG] Middleware loaded
2025-08-27 00:09:34.186 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 00:09:34.187 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 00:09:34.310 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 00:09:34.314 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 00:09:34.326 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 00:09:34.383 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 00:09:34.449 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 00:09:34.450 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 00:09:34.451 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 00:09:34.452 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 00:09:34.453 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 00:09:34.453 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 00:09:34.459 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 00:09:34.461 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 00:09:34.496 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 00:09:34.497 +03:00 [INF] Hosting environment: Development
2025-08-27 00:09:34.498 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 00:09:34.499 +03:00 [DBG] Hosting started
2025-08-27 00:09:40.291 +03:00 [DBG] Connection id "0HNF4SJFHC1TT" received FIN.
2025-08-27 00:09:40.297 +03:00 [DBG] Connection id "0HNF4SJFHC1TT" accepted.
2025-08-27 00:09:40.299 +03:00 [DBG] Connection id "0HNF4SJFHC1TT" started.
2025-08-27 00:09:40.300 +03:00 [DBG] Connection id "0HNF4SJFHC1TU" accepted.
2025-08-27 00:09:40.301 +03:00 [DBG] Connection id "0HNF4SJFHC1TU" started.
2025-08-27 00:09:40.306 +03:00 [DBG] Connection id "0HNF4SJFHC1TT" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:09:40.308 +03:00 [DBG] Connection id "0HNF4SJFHC1TT" disconnecting.
2025-08-27 00:09:40.310 +03:00 [DBG] Connection id "0HNF4SJFHC1TT" stopped.
2025-08-27 00:09:40.325 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/setup/profile - application/json 163
2025-08-27 00:09:40.351 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:09:40.353 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:09:40.355 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:09:40.376 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-08-27 00:09:40.378 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/setup/profile'.
2025-08-27 00:09:40.385 +03:00 [DBG] Connection id "0HNF4SJFHC1TU" completed keep alive response.
2025-08-27 00:09:40.387 +03:00 [DBG] Connection id "0HNF4SJFHC1TV" accepted.
2025-08-27 00:09:40.388 +03:00 [DBG] Connection id "0HNF4SJFHC1TV" received FIN.
2025-08-27 00:09:40.388 +03:00 [DBG] Connection id "0HNF4SJFHC1U0" accepted.
2025-08-27 00:09:40.387 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/setup/profile - 307 0 null 66.5572ms
2025-08-27 00:09:40.394 +03:00 [DBG] Connection id "0HNF4SJFHC1TV" started.
2025-08-27 00:09:40.395 +03:00 [DBG] Connection id "0HNF4SJFHC1U0" started.
2025-08-27 00:09:40.399 +03:00 [DBG] Connection id "0HNF4SJFHC1TV" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:09:40.399 +03:00 [DBG] Connection id "0HNF4SJFHC1TU", Request id "0HNF4SJFHC1TU:00000001": started reading request body.
2025-08-27 00:09:40.400 +03:00 [DBG] Connection id "0HNF4SJFHC1TV" disconnecting.
2025-08-27 00:09:40.401 +03:00 [DBG] Connection id "0HNF4SJFHC1TU", Request id "0HNF4SJFHC1TU:00000001": done reading request body.
2025-08-27 00:09:40.405 +03:00 [DBG] Connection id "0HNF4SJFHC1TV" stopped.
2025-08-27 00:09:40.429 +03:00 [DBG] Connection 0HNF4SJFHC1U0 established using the following protocol: "Tls13"
2025-08-27 00:09:40.432 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/setup/profile - application/json 163
2025-08-27 00:09:40.437 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:09:40.438 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:09:40.440 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:09:40.444 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:09:40.466 +03:00 [INF] Route matched with {action = "CreateProfile", controller = "Setup"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.UI.ProfileCreationResponse]] CreateProfile(NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api).
2025-08-27 00:09:40.476 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:09:40.480 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:09:40.482 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:09:40.483 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:09:40.484 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:09:40.487 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:09:40.594 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 00:09:41.198 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:09:41.203 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:09:41.209 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:09:41.212 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' using the name '' in request data ...
2025-08-27 00:09:41.214 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:09:41.232 +03:00 [DBG] Connection id "0HNF4SJFHC1U0", Request id "0HNF4SJFHC1U0:00000001": started reading request body.
2025-08-27 00:09:41.233 +03:00 [DBG] Connection id "0HNF4SJFHC1U0", Request id "0HNF4SJFHC1U0:00000001": done reading request body.
2025-08-27 00:09:41.252 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'
2025-08-27 00:09:41.253 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:09:41.254 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:09:41.255 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:09:41.266 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:09:41.269 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:09:41.270 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:09:41.272 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:09:41.273 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:09:42.825 +03:00 [INF] Creating profile for provider "SqlServer"
2025-08-27 00:09:42.844 +03:00 [DBG] Saved secret profile-ed2c7329-9b60-4757-8512-74c77d385557 for provider "SqlServer"
2025-08-27 00:09:42.851 +03:00 [DBG] Generated profile name SqlServer - ProductInventory with cache dir C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer
2025-08-27 00:09:42.903 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Any(p => (int)p.Provider == (int)__profile_Provider_0)'
2025-08-27 00:09:43.064 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 00:09:43.091 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:09:43.101 +03:00 [DBG] Created DbConnection. (9ms).
2025-08-27 00:09:43.104 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:09:43.114 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:09:43.118 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:09:43.123 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-08-27 00:09:43.127 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (10ms).
2025-08-27 00:09:43.134 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:09:43.150 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:09:43.159 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:09:43.164 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 7ms reading results.
2025-08-27 00:09:43.167 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:09:43.171 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (3ms).
2025-08-27 00:09:43.201 +03:00 [DBG] 'ProfilesDbContext' generated a value for the property 'Profile.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:09:43.252 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:09:43.258 +03:00 [DBG] DetectChanges starting for 'ProfilesDbContext'.
2025-08-27 00:09:43.269 +03:00 [DBG] DetectChanges completed for 'ProfilesDbContext'.
2025-08-27 00:09:43.274 +03:00 [DBG] SaveChanges starting for 'ProfilesDbContext'.
2025-08-27 00:09:43.276 +03:00 [DBG] DetectChanges starting for 'ProfilesDbContext'.
2025-08-27 00:09:43.277 +03:00 [DBG] DetectChanges completed for 'ProfilesDbContext'.
2025-08-27 00:09:43.319 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:09:43.320 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:09:43.322 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:09:43.323 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:09:43.324 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 00:09:43.325 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 49), @p2='?' (DbType = DateTimeOffset), @p3='?' (Size = 28), @p4='?' (DbType = Int32), @p5='?' (Size = 44)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Profiles" ("Id", "CacheFile", "CreatedUtc", "Name", "Provider", "SecretRef")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-08-27 00:09:43.340 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 49), @p2='?' (DbType = DateTimeOffset), @p3='?' (Size = 28), @p4='?' (DbType = Int32), @p5='?' (Size = 44)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Profiles" ("Id", "CacheFile", "CreatedUtc", "Name", "Provider", "SecretRef")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-08-27 00:09:43.343 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:09:43.344 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 00:09:43.345 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:09:43.347 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:09:43.353 +03:00 [DBG] An entity of type 'Profile' tracked by 'ProfilesDbContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:09:43.355 +03:00 [DBG] SaveChanges completed for 'ProfilesDbContext' with 1 entities written to the database.
2025-08-27 00:09:43.357 +03:00 [INF] Profile created successfully with Id "68c67fe8-408e-41fb-bedd-3d4a730c3348"
2025-08-27 00:09:43.369 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:09:43.372 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:09:43.373 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 00:09:43.377 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 00:09:43.380 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 00:09:43.381 +03:00 [INF] Executing OkObjectResult, writing value of type 'NaturalToQuery.SharedKernal.DTOs.UI.ProfileCreationResponse'.
2025-08-27 00:09:43.400 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api) in 2909.0068ms
2025-08-27 00:09:43.401 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:09:43.402 +03:00 [DBG] Connection id "0HNF4SJFHC1U0" completed keep alive response.
2025-08-27 00:09:43.405 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:09:43.411 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:09:43.413 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-08-27 00:09:43.415 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/setup/profile - 200 null application/json; charset=utf-8 2983.74ms
2025-08-27 00:10:08.786 +03:00 [INF] This is a test log to file!
2025-08-27 00:10:08.960 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 00:10:08.972 +03:00 [INF] API configured successfully.
2025-08-27 00:10:08.974 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 00:10:08.975 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 00:10:09.020 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 00:10:09.063 +03:00 [DBG] Hosting starting
2025-08-27 00:10:09.074 +03:00 [DBG] Middleware loaded
2025-08-27 00:10:09.077 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 00:10:09.079 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 00:10:09.172 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 00:10:09.177 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 00:10:09.189 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 00:10:09.238 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 00:10:09.288 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 00:10:09.289 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 00:10:09.291 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 00:10:09.297 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 00:10:09.297 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 00:10:09.298 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 00:10:09.304 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 00:10:09.306 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 00:10:09.355 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 00:10:09.356 +03:00 [INF] Hosting environment: Development
2025-08-27 00:10:09.357 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 00:10:09.358 +03:00 [DBG] Hosting started
2025-08-27 00:10:17.289 +03:00 [DBG] Connection id "0HNF4SJQI6L6L" received FIN.
2025-08-27 00:10:17.294 +03:00 [DBG] Connection id "0HNF4SJQI6L6L" accepted.
2025-08-27 00:10:17.296 +03:00 [DBG] Connection id "0HNF4SJQI6L6L" started.
2025-08-27 00:10:17.297 +03:00 [DBG] Connection id "0HNF4SJQI6L6M" accepted.
2025-08-27 00:10:17.297 +03:00 [DBG] Connection id "0HNF4SJQI6L6M" started.
2025-08-27 00:10:17.303 +03:00 [DBG] Connection id "0HNF4SJQI6L6L" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:10:17.305 +03:00 [DBG] Connection id "0HNF4SJQI6L6L" disconnecting.
2025-08-27 00:10:17.307 +03:00 [DBG] Connection id "0HNF4SJQI6L6L" stopped.
2025-08-27 00:10:17.320 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/setup/profile - application/json 163
2025-08-27 00:10:17.346 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:10:17.348 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:10:17.351 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:10:17.372 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-08-27 00:10:17.374 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/setup/profile'.
2025-08-27 00:10:17.380 +03:00 [DBG] Connection id "0HNF4SJQI6L6M" completed keep alive response.
2025-08-27 00:10:17.382 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/setup/profile - 307 0 null 66.3947ms
2025-08-27 00:10:17.382 +03:00 [DBG] Connection id "0HNF4SJQI6L6N" accepted.
2025-08-27 00:10:17.383 +03:00 [DBG] Connection id "0HNF4SJQI6L6N" received FIN.
2025-08-27 00:10:17.382 +03:00 [DBG] Connection id "0HNF4SJQI6L6O" accepted.
2025-08-27 00:10:17.390 +03:00 [DBG] Connection id "0HNF4SJQI6L6N" started.
2025-08-27 00:10:17.391 +03:00 [DBG] Connection id "0HNF4SJQI6L6M", Request id "0HNF4SJQI6L6M:00000001": started reading request body.
2025-08-27 00:10:17.392 +03:00 [DBG] Connection id "0HNF4SJQI6L6O" started.
2025-08-27 00:10:17.392 +03:00 [DBG] Connection id "0HNF4SJQI6L6N" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:10:17.393 +03:00 [DBG] Connection id "0HNF4SJQI6L6M", Request id "0HNF4SJQI6L6M:00000001": done reading request body.
2025-08-27 00:10:17.395 +03:00 [DBG] Connection id "0HNF4SJQI6L6N" disconnecting.
2025-08-27 00:10:17.399 +03:00 [DBG] Connection id "0HNF4SJQI6L6N" stopped.
2025-08-27 00:10:17.424 +03:00 [DBG] Connection 0HNF4SJQI6L6O established using the following protocol: "Tls13"
2025-08-27 00:10:17.428 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/setup/profile - application/json 163
2025-08-27 00:10:17.431 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:10:17.432 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:10:17.433 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:10:17.436 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:10:17.452 +03:00 [INF] Route matched with {action = "CreateProfile", controller = "Setup"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.UI.ProfileCreationResponse]] CreateProfile(NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api).
2025-08-27 00:10:17.456 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:10:17.457 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:10:17.458 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:10:17.459 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:10:17.460 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:10:17.463 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:10:17.542 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 00:10:17.982 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:10:17.987 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:10:17.992 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:10:17.994 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' using the name '' in request data ...
2025-08-27 00:10:17.996 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:10:18.010 +03:00 [DBG] Connection id "0HNF4SJQI6L6O", Request id "0HNF4SJQI6L6O:00000001": started reading request body.
2025-08-27 00:10:18.011 +03:00 [DBG] Connection id "0HNF4SJQI6L6O", Request id "0HNF4SJQI6L6O:00000001": done reading request body.
2025-08-27 00:10:18.019 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'
2025-08-27 00:10:18.020 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:10:18.021 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:10:18.022 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:10:18.030 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:10:18.031 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:10:18.033 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:10:18.034 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:10:18.035 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:10:20.536 +03:00 [INF] Creating profile for provider "SqlServer"
2025-08-27 00:10:20.552 +03:00 [DBG] Saved secret profile-c8d24e82-1d41-4177-a764-362ce03e8e7c for provider "SqlServer"
2025-08-27 00:10:20.558 +03:00 [DBG] Generated profile name SqlServer - ProductInventory with cache dir C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer
2025-08-27 00:10:20.607 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Any(p => (int)p.Provider == (int)__profile_Provider_0)'
2025-08-27 00:10:20.762 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 00:10:20.790 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:10:20.798 +03:00 [DBG] Created DbConnection. (8ms).
2025-08-27 00:10:20.802 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:10:20.813 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:10:20.817 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:10:20.822 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-08-27 00:10:20.827 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (10ms).
2025-08-27 00:10:20.834 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:10:20.859 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:10:20.871 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:10:20.882 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 15ms reading results.
2025-08-27 00:10:20.889 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:10:20.898 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (9ms).
2025-08-27 00:10:21.020 +03:00 [ERR] Failed to create profile
System.InvalidOperationException: A profile for SqlServer already exists.
   at ProfileRepository.AddAsync(Profile profile, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Persistence\Repositories\ProfileRepository.cs:line 26
   at NaturalToQuery.Application.Services.ProfileService.CreateAsync(ProviderType provider, ProviderConnectionConfig config, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileService.cs:line 42
   at NaturalToQuery.Application.Services.SetupService.CreateProfileAsync(SetupRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\SetupService.cs:line 33
   at NaturalToQuery.Api.Controllers.SetupController.CreateProfile(SetupRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\SetupController.cs:line 96
2025-08-27 00:10:21.028 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:10:21.031 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:10:21.032 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 00:10:21.033 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 00:10:21.034 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 00:10:21.035 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType1`1[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-27 00:10:21.043 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api) in 3579.4784ms
2025-08-27 00:10:21.044 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:10:21.045 +03:00 [DBG] Connection id "0HNF4SJQI6L6O" completed keep alive response.
2025-08-27 00:10:21.048 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:10:21.052 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:10:21.054 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:10:21.056 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/setup/profile - 500 null application/json; charset=utf-8 3627.9058ms
2025-08-27 00:10:25.978 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/setup/profile - application/json 163
2025-08-27 00:10:25.981 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:10:25.982 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:10:25.983 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:10:25.985 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/setup/profile'.
2025-08-27 00:10:25.986 +03:00 [DBG] Connection id "0HNF4SJQI6L6M" completed keep alive response.
2025-08-27 00:10:25.987 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/setup/profile - 307 0 null 8.7253ms
2025-08-27 00:10:25.988 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/setup/profile - application/json 163
2025-08-27 00:10:25.989 +03:00 [DBG] Connection id "0HNF4SJQI6L6M", Request id "0HNF4SJQI6L6M:00000002": started reading request body.
2025-08-27 00:10:25.991 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:10:25.992 +03:00 [DBG] Connection id "0HNF4SJQI6L6M", Request id "0HNF4SJQI6L6M:00000002": done reading request body.
2025-08-27 00:10:25.992 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:10:25.994 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:10:25.995 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:10:25.996 +03:00 [INF] Route matched with {action = "CreateProfile", controller = "Setup"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.UI.ProfileCreationResponse]] CreateProfile(NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api).
2025-08-27 00:10:25.997 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:10:25.998 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:10:25.999 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:10:26.000 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:10:26.001 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:10:26.003 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:10:26.052 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:10:26.054 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:10:26.055 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:10:26.056 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' using the name '' in request data ...
2025-08-27 00:10:26.057 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:10:26.060 +03:00 [DBG] Connection id "0HNF4SJQI6L6O", Request id "0HNF4SJQI6L6O:00000002": started reading request body.
2025-08-27 00:10:26.061 +03:00 [DBG] Connection id "0HNF4SJQI6L6O", Request id "0HNF4SJQI6L6O:00000002": done reading request body.
2025-08-27 00:10:26.062 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'
2025-08-27 00:10:26.063 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:10:26.064 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:10:26.065 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:10:26.066 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:10:26.067 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:10:26.068 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:10:26.069 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:10:26.070 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:10:26.071 +03:00 [INF] Creating profile for provider "SqlServer"
2025-08-27 00:10:26.079 +03:00 [DBG] Saved secret profile-39b4960f-5377-4699-8d4b-cea6e2009987 for provider "SqlServer"
2025-08-27 00:10:26.080 +03:00 [DBG] Generated profile name SqlServer - ProductInventory with cache dir C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer
2025-08-27 00:10:26.084 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:10:26.084 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 00:10:26.085 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:10:26.086 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:10:26.087 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:10:26.088 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:10:26.089 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:10:26.090 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:10:26.091 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:10:26.093 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:10:26.094 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 00:10:26.095 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:10:26.095 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:10:26.219 +03:00 [ERR] Failed to create profile
System.InvalidOperationException: A profile for SqlServer already exists.
   at ProfileRepository.AddAsync(Profile profile, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Persistence\Repositories\ProfileRepository.cs:line 26
   at NaturalToQuery.Application.Services.ProfileService.CreateAsync(ProviderType provider, ProviderConnectionConfig config, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileService.cs:line 42
   at NaturalToQuery.Application.Services.SetupService.CreateProfileAsync(SetupRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\SetupService.cs:line 33
   at NaturalToQuery.Api.Controllers.SetupController.CreateProfile(SetupRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\SetupController.cs:line 96
2025-08-27 00:10:26.221 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:10:26.223 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:10:26.224 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 00:10:26.224 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 00:10:26.225 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 00:10:26.226 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType1`1[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-27 00:10:26.227 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api) in 224.2428ms
2025-08-27 00:10:26.228 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:10:26.229 +03:00 [DBG] Connection id "0HNF4SJQI6L6O" completed keep alive response.
2025-08-27 00:10:26.230 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:10:26.231 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:10:26.231 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:10:26.232 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/setup/profile - 500 null application/json; charset=utf-8 244.9085ms
2025-08-27 00:10:32.589 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/setup/profile - application/json 163
2025-08-27 00:10:32.593 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:10:32.594 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:10:32.595 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:10:32.596 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/setup/profile'.
2025-08-27 00:10:32.596 +03:00 [DBG] Connection id "0HNF4SJQI6L6M" completed keep alive response.
2025-08-27 00:10:32.597 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/setup/profile - 307 0 null 7.9116ms
2025-08-27 00:10:32.598 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/setup/profile - application/json 163
2025-08-27 00:10:32.599 +03:00 [DBG] Connection id "0HNF4SJQI6L6M", Request id "0HNF4SJQI6L6M:00000003": started reading request body.
2025-08-27 00:10:32.601 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:10:32.601 +03:00 [DBG] Connection id "0HNF4SJQI6L6M", Request id "0HNF4SJQI6L6M:00000003": done reading request body.
2025-08-27 00:10:32.602 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:10:32.604 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:10:32.605 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:10:32.605 +03:00 [INF] Route matched with {action = "CreateProfile", controller = "Setup"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.UI.ProfileCreationResponse]] CreateProfile(NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api).
2025-08-27 00:10:32.606 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:10:32.607 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:10:32.608 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:10:32.610 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:10:32.611 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:10:32.612 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:10:32.623 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:10:32.624 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:10:32.625 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:10:32.626 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' using the name '' in request data ...
2025-08-27 00:10:32.627 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:10:32.628 +03:00 [DBG] Connection id "0HNF4SJQI6L6O", Request id "0HNF4SJQI6L6O:00000003": started reading request body.
2025-08-27 00:10:32.629 +03:00 [DBG] Connection id "0HNF4SJQI6L6O", Request id "0HNF4SJQI6L6O:00000003": done reading request body.
2025-08-27 00:10:32.630 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'
2025-08-27 00:10:32.630 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:10:32.631 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:10:32.632 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:10:32.633 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:10:32.633 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:10:32.634 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:10:32.635 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:10:32.636 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:11:12.947 +03:00 [INF] Creating profile for provider "SqlServer"
2025-08-27 00:11:14.302 +03:00 [DBG] Saved secret profile-dc64d14a-0f02-4818-ab67-04dee177973f for provider "SqlServer"
2025-08-27 00:11:15.339 +03:00 [DBG] Generated profile name SqlServer - ProductInventory with cache dir C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer
2025-08-27 00:11:21.911 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:11:21.936 +03:00 [DBG] Created DbConnection. (25ms).
2025-08-27 00:11:21.936 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:11:21.937 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:11:21.942 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:11:21.943 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:11:21.944 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:11:21.945 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:11:21.947 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:11:21.949 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:11:21.950 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 00:11:21.954 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:11:21.955 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:13:03.948 +03:00 [INF] This is a test log to file!
2025-08-27 00:13:04.109 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 00:13:04.119 +03:00 [INF] API configured successfully.
2025-08-27 00:13:04.120 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 00:13:04.121 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 00:13:04.170 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 00:13:04.216 +03:00 [DBG] Hosting starting
2025-08-27 00:13:04.232 +03:00 [DBG] Middleware loaded
2025-08-27 00:13:04.235 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 00:13:04.237 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 00:13:04.309 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 00:13:04.312 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 00:13:04.321 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 00:13:04.356 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 00:13:04.421 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 00:13:04.422 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 00:13:04.423 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 00:13:04.424 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 00:13:04.424 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 00:13:04.425 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 00:13:04.432 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 00:13:04.433 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 00:13:04.522 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 00:13:04.523 +03:00 [INF] Hosting environment: Development
2025-08-27 00:13:04.524 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 00:13:04.524 +03:00 [DBG] Hosting started
2025-08-27 00:13:07.571 +03:00 [DBG] Connection id "0HNF4SLDA4RD8" received FIN.
2025-08-27 00:13:07.577 +03:00 [DBG] Connection id "0HNF4SLDA4RD8" accepted.
2025-08-27 00:13:07.578 +03:00 [DBG] Connection id "0HNF4SLDA4RD8" started.
2025-08-27 00:13:07.579 +03:00 [DBG] Connection id "0HNF4SLDA4RD9" accepted.
2025-08-27 00:13:07.582 +03:00 [DBG] Connection id "0HNF4SLDA4RD9" started.
2025-08-27 00:13:07.587 +03:00 [DBG] Connection id "0HNF4SLDA4RD8" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:13:07.598 +03:00 [DBG] Connection id "0HNF4SLDA4RD8" disconnecting.
2025-08-27 00:13:07.604 +03:00 [DBG] Connection id "0HNF4SLDA4RD8" stopped.
2025-08-27 00:13:07.612 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/setup/profile - application/json 163
2025-08-27 00:13:07.642 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:13:07.643 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:13:07.645 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:13:07.667 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-08-27 00:13:07.669 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/setup/profile'.
2025-08-27 00:13:07.676 +03:00 [DBG] Connection id "0HNF4SLDA4RD9" completed keep alive response.
2025-08-27 00:13:07.679 +03:00 [DBG] Connection id "0HNF4SLDA4RDA" accepted.
2025-08-27 00:13:07.679 +03:00 [DBG] Connection id "0HNF4SLDA4RDA" received FIN.
2025-08-27 00:13:07.679 +03:00 [DBG] Connection id "0HNF4SLDA4RDB" accepted.
2025-08-27 00:13:07.679 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/setup/profile - 307 0 null 74.0866ms
2025-08-27 00:13:07.685 +03:00 [DBG] Connection id "0HNF4SLDA4RDA" started.
2025-08-27 00:13:07.687 +03:00 [DBG] Connection id "0HNF4SLDA4RDB" started.
2025-08-27 00:13:07.692 +03:00 [DBG] Connection id "0HNF4SLDA4RDA" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:13:07.692 +03:00 [DBG] Connection id "0HNF4SLDA4RD9", Request id "0HNF4SLDA4RD9:00000001": started reading request body.
2025-08-27 00:13:07.694 +03:00 [DBG] Connection id "0HNF4SLDA4RDA" disconnecting.
2025-08-27 00:13:07.720 +03:00 [DBG] Connection id "0HNF4SLDA4RD9", Request id "0HNF4SLDA4RD9:00000001": done reading request body.
2025-08-27 00:13:07.721 +03:00 [DBG] Connection id "0HNF4SLDA4RDA" stopped.
2025-08-27 00:13:07.749 +03:00 [DBG] Connection 0HNF4SLDA4RDB established using the following protocol: "Tls13"
2025-08-27 00:13:07.752 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/setup/profile - application/json 163
2025-08-27 00:13:07.756 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:13:07.757 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:13:07.759 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:13:07.762 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:13:07.780 +03:00 [INF] Route matched with {action = "CreateProfile", controller = "Setup"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.UI.ProfileCreationResponse]] CreateProfile(NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api).
2025-08-27 00:13:07.783 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:13:07.785 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:13:07.788 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:13:07.790 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:13:07.791 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:13:07.794 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:13:07.881 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 00:13:08.310 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:13:08.316 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:13:08.321 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:13:08.324 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' using the name '' in request data ...
2025-08-27 00:13:08.326 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:13:08.341 +03:00 [DBG] Connection id "0HNF4SLDA4RDB", Request id "0HNF4SLDA4RDB:00000001": started reading request body.
2025-08-27 00:13:08.342 +03:00 [DBG] Connection id "0HNF4SLDA4RDB", Request id "0HNF4SLDA4RDB:00000001": done reading request body.
2025-08-27 00:13:08.348 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'
2025-08-27 00:13:08.350 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:13:08.351 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:13:08.352 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:13:08.360 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:13:08.362 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:13:08.364 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:13:08.365 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:13:08.366 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:13:08.379 +03:00 [INF] Creating profile for provider "SqlServer"
2025-08-27 00:13:08.396 +03:00 [DBG] Saved secret profile-c5536580-5394-42cd-8c92-02cd062bbfc8 for provider "SqlServer"
2025-08-27 00:13:08.402 +03:00 [DBG] Generated profile name SqlServer - ProductInventory with cache dir C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer
2025-08-27 00:13:08.453 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Any(p => (int)p.Provider == (int)__profile_Provider_0)'
2025-08-27 00:13:08.606 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 00:13:08.633 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:13:08.641 +03:00 [DBG] Created DbConnection. (8ms).
2025-08-27 00:13:08.645 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:13:08.655 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:13:08.659 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:13:08.665 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-08-27 00:13:08.670 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (10ms).
2025-08-27 00:13:08.676 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:13:08.692 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:13:08.700 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:13:08.706 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 7ms reading results.
2025-08-27 00:13:08.709 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:13:08.713 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-08-27 00:13:09.030 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api) in 1234.7943ms
2025-08-27 00:13:09.066 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:13:09.116 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: A profile for SqlServer already exists.
   at ProfileRepository.AddAsync(Profile profile, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Persistence\Repositories\ProfileRepository.cs:line 26
   at NaturalToQuery.Application.Services.ProfileService.CreateAsync(ProviderType provider, ProviderConnectionConfig config, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileService.cs:line 42
   at NaturalToQuery.Application.Services.SetupService.CreateProfileAsync(SetupRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\SetupService.cs:line 33
   at NaturalToQuery.Api.Controllers.SetupController.CreateProfile(SetupRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\SetupController.cs:line 58
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 00:13:09.129 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 00:13:09.140 +03:00 [DBG] Connection id "0HNF4SLDA4RDB" completed keep alive response.
2025-08-27 00:13:09.143 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:13:09.149 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:13:09.152 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-08-27 00:13:09.154 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/setup/profile - 500 null application/json; charset=utf-8 1401.3598ms
2025-08-27 00:14:29.927 +03:00 [DBG] Connection id "0HNF4SLDA4RDC" accepted.
2025-08-27 00:14:29.934 +03:00 [DBG] Connection id "0HNF4SLDA4RDC" started.
2025-08-27 00:14:29.937 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - null null
2025-08-27 00:14:30.011 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:14:30.013 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/schema' is valid for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:14:30.015 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:14:30.019 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false'.
2025-08-27 00:14:30.021 +03:00 [DBG] Connection id "0HNF4SLDA4RDC" completed keep alive response.
2025-08-27 00:14:30.022 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - 307 0 null 85.1913ms
2025-08-27 00:14:30.023 +03:00 [DBG] Connection id "0HNF4SLDA4RDD" accepted.
2025-08-27 00:14:30.024 +03:00 [DBG] Connection id "0HNF4SLDA4RDD" started.
2025-08-27 00:14:30.028 +03:00 [DBG] Connection id "0HNF4SLDA4RDD" received FIN.
2025-08-27 00:14:30.028 +03:00 [DBG] Connection id "0HNF4SLDA4RDE" accepted.
2025-08-27 00:14:30.035 +03:00 [DBG] Connection id "0HNF4SLDA4RDE" started.
2025-08-27 00:14:30.134 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.Security.Authentication.AuthenticationException: Authentication failed, see inner exception.
 ---> System.ComponentModel.Win32Exception (0x80090327): An unknown error occurred while processing the certificate.
   --- End of inner exception stack trace ---
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-08-27 00:14:30.136 +03:00 [DBG] Connection 0HNF4SLDA4RDE established using the following protocol: "Tls13"
2025-08-27 00:14:30.139 +03:00 [DBG] Connection id "0HNF4SLDA4RDD" stopped.
2025-08-27 00:14:30.140 +03:00 [DBG] Connection id "0HNF4SLDA4RDD" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:14:30.173 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - null null
2025-08-27 00:14:30.178 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:14:30.179 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/schema' is valid for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:14:30.180 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:14:30.181 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:14:30.185 +03:00 [INF] Route matched with {action = "GetSchema", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.SchemaModel]] GetSchema(System.Guid, Boolean, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:14:30.186 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:14:30.187 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:14:30.188 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:14:30.189 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:14:30.190 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:14:30.191 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:14:30.232 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:14:30.241 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:14:30.243 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:14:30.247 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:14:30.248 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:14:30.250 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:14:30.251 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:14:30.252 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:14:30.253 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:14:30.254 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:14:30.256 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' using the name 'forceRefresh' in request data ...
2025-08-27 00:14:30.258 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:14:30.259 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:14:30.260 +03:00 [DBG] Attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:14:30.261 +03:00 [DBG] Done attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:14:30.262 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:14:30.263 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:14:30.264 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:14:30.265 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:14:30.272 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-08-27 00:14:30.282 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-08-27 00:14:30.355 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<Name>k__BackingField = dataReader.GetString(3);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(4));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(5);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(6) ? default(Guid?) : (Guid?)dataReader.GetGuid(6) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(6) ? default(object) : (object)dataReader.GetGuid(6) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(6) ? default(Guid) : dataReader.GetGuid(6);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(8) ? default(string) : dataReader.GetString(8);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(10) ? default(DateTime) : dataReader.GetDateTime(10);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 00:14:30.366 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:14:30.367 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 00:14:30.368 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:14:30.369 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:14:30.370 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:14:30.372 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:14:30.373 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 00:14:30.374 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:14:30.377 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:14:30.404 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:14:30.424 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:14:30.426 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 46ms reading results.
2025-08-27 00:14:30.428 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:14:30.429 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:14:30.626 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api) in 435.2233ms
2025-08-27 00:14:30.661 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:14:30.707 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Cannot resolve scoped service 'NaturalToQuery.Infrastructure.Interfaces.IProfileRepository' from root provider.
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteValidator.ValidateResolution(ServiceCallSite callSite, IServiceScope scope, IServiceScope rootScope)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.CreateWithProfile(Guid profileId, ProviderType Type) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 25
   at NaturalToQuery.Application.Services.ProfileDbService.CreateContext(Guid profileId, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 62
   at NaturalToQuery.Application.Services.ProfileDbService.GetSchemaAsync(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 45
   at NaturalToQuery.Api.Controllers.QueryController.GetSchema(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 71
   at lambda_method21(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 00:14:30.715 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 00:14:30.719 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:14:30.720 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:14:30.722 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:14:30.723 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - 500 null application/json; charset=utf-8 550.7894ms
2025-08-27 00:14:54.216 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - null null
2025-08-27 00:14:54.221 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:14:54.222 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/schema' is valid for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:14:54.224 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:14:54.226 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:14:54.227 +03:00 [INF] Route matched with {action = "GetSchema", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.SchemaModel]] GetSchema(System.Guid, Boolean, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:14:54.229 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:14:54.230 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:14:54.231 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:14:54.232 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:14:54.234 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:14:54.235 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:14:54.243 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:14:54.245 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:14:54.246 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:14:54.247 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:14:54.248 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:14:54.250 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:14:54.251 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:14:54.251 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:14:54.252 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:14:54.253 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:14:54.254 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' using the name 'forceRefresh' in request data ...
2025-08-27 00:14:54.255 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:14:54.256 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:14:54.257 +03:00 [DBG] Attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:14:54.257 +03:00 [DBG] Done attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:14:54.258 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:14:54.259 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:14:54.260 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:14:54.261 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:15:07.323 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:15:07.325 +03:00 [DBG] Created DbConnection. (1ms).
2025-08-27 00:15:07.326 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:15:07.327 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:15:07.328 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:15:07.329 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:15:07.330 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:15:07.331 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:15:07.333 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:15:07.335 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:15:07.336 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:15:07.337 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 00:15:07.338 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:15:07.338 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:15:14.799 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api) in 20563.9597ms
2025-08-27 00:15:14.844 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:15:14.917 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Cannot resolve scoped service 'NaturalToQuery.Infrastructure.Interfaces.IProfileRepository' from root provider.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.CreateWithProfile(Guid profileId, ProviderType Type) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 25
   at NaturalToQuery.Application.Services.ProfileDbService.CreateContext(Guid profileId, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 62
   at NaturalToQuery.Application.Services.ProfileDbService.GetSchemaAsync(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 45
   at NaturalToQuery.Api.Controllers.QueryController.GetSchema(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 71
   at lambda_method21(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 00:15:14.921 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 00:15:14.923 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:15:14.924 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:15:14.925 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:15:14.927 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - 500 null application/json; charset=utf-8 20710.3293ms
2025-08-27 00:15:17.339 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - null null
2025-08-27 00:15:17.344 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:15:17.345 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/schema' is valid for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:15:17.346 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:15:17.347 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:15:17.348 +03:00 [INF] Route matched with {action = "GetSchema", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.SchemaModel]] GetSchema(System.Guid, Boolean, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:15:17.349 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:15:17.350 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:15:17.351 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:15:17.352 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:15:17.353 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:15:17.354 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:15:17.357 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:15:17.360 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:15:17.360 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:15:17.361 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:15:17.362 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:15:17.363 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:15:17.364 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:15:17.364 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:15:17.365 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:15:17.366 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:15:17.367 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' using the name 'forceRefresh' in request data ...
2025-08-27 00:15:17.368 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:15:17.368 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:15:17.369 +03:00 [DBG] Attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:15:17.370 +03:00 [DBG] Done attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:15:17.371 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:15:17.372 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:15:17.373 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:15:17.373 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:16:32.473 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:16:32.502 +03:00 [DBG] Created DbConnection. (29ms).
2025-08-27 00:16:32.503 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - null null
2025-08-27 00:16:32.505 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:16:32.508 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:16:32.512 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:16:32.513 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:16:32.513 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:16:32.514 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/schema' is valid for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:16:32.515 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 00:16:32.516 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:16:32.516 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:16:32.517 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:16:32.518 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:16:32.519 +03:00 [INF] Route matched with {action = "GetSchema", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.SchemaModel]] GetSchema(System.Guid, Boolean, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:16:32.521 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:16:32.522 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:16:32.522 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:16:32.523 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:16:32.524 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 3ms reading results.
2025-08-27 00:16:32.525 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:16:32.526 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:16:32.527 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:16:32.528 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:16:32.528 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:16:38.655 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:16:38.738 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:16:43.648 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:16:47.773 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:16:47.818 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:16:47.873 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:16:49.397 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:16:49.515 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api) in 92161.3795ms
2025-08-27 00:16:49.517 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:16:49.548 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:16:49.551 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:16:49.594 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Cannot resolve scoped service 'NaturalToQuery.Infrastructure.Interfaces.IProfileRepository' from root provider.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.CreateWithProfile(Guid profileId, ProviderType Type) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 25
   at NaturalToQuery.Application.Services.ProfileDbService.CreateContext(Guid profileId, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 62
   at NaturalToQuery.Application.Services.ProfileDbService.GetSchemaAsync(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 45
   at NaturalToQuery.Api.Controllers.QueryController.GetSchema(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 71
   at lambda_method21(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 00:16:49.595 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:16:49.599 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 00:16:49.600 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:16:49.686 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' using the name 'forceRefresh' in request data ...
2025-08-27 00:16:49.721 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:16:49.752 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:16:49.752 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:16:49.754 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:16:49.754 +03:00 [DBG] Attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:16:49.755 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:16:49.756 +03:00 [DBG] Done attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:16:49.757 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:16:49.757 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - 499 null application/json; charset=utf-8 92417.5587ms
2025-08-27 00:16:49.758 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:16:49.760 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:16:49.761 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:17:30.733 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:17:30.759 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - null null
2025-08-27 00:17:30.760 +03:00 [DBG] Created DbConnection. (26ms).
2025-08-27 00:17:30.763 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:17:30.765 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/schema' is valid for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:17:30.764 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:17:30.766 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:17:30.767 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:17:30.767 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:17:30.768 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:17:30.769 +03:00 [INF] Route matched with {action = "GetSchema", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.SchemaModel]] GetSchema(System.Guid, Boolean, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:17:30.770 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:17:30.771 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:17:30.772 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2025-08-27 00:17:30.773 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:17:30.773 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:17:30.774 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:17:30.776 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:17:30.776 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:17:30.778 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:17:30.778 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:17:30.779 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:17:30.780 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:17:30.781 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 3ms reading results.
2025-08-27 00:17:30.782 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:17:30.782 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:17:30.784 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:17:30.784 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:17:30.785 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:17:44.008 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:17:47.264 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:17:47.305 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:17:49.955 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:17:50.007 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api) in 71352.6909ms
2025-08-27 00:17:50.008 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:17:50.041 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:17:50.042 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:17:50.084 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Cannot resolve scoped service 'NaturalToQuery.Infrastructure.Interfaces.IProfileRepository' from root provider.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.CreateWithProfile(Guid profileId, ProviderType Type) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 25
   at NaturalToQuery.Application.Services.ProfileDbService.CreateContext(Guid profileId, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 62
   at NaturalToQuery.Application.Services.ProfileDbService.GetSchemaAsync(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 45
   at NaturalToQuery.Api.Controllers.QueryController.GetSchema(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 71
   at lambda_method21(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 00:17:50.084 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:17:50.088 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 00:17:50.089 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' using the name 'forceRefresh' in request data ...
2025-08-27 00:17:50.167 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:17:50.223 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:17:50.224 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:17:50.226 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:17:50.227 +03:00 [DBG] Attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:17:50.228 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:17:50.228 +03:00 [DBG] Done attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:17:50.229 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - 499 null application/json; charset=utf-8 77726.3496ms
2025-08-27 00:17:50.230 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:17:50.232 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:17:50.233 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:17:50.234 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:19:09.384 +03:00 [INF] This is a test log to file!
2025-08-27 00:19:09.531 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 00:19:09.538 +03:00 [INF] API configured successfully.
2025-08-27 00:19:09.539 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 00:19:09.540 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 00:19:09.589 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 00:19:09.642 +03:00 [DBG] Hosting starting
2025-08-27 00:19:09.654 +03:00 [DBG] Middleware loaded
2025-08-27 00:19:09.656 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 00:19:09.657 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 00:19:09.724 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 00:19:09.727 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 00:19:09.735 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 00:19:09.765 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 00:19:09.828 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 00:19:09.829 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 00:19:09.829 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 00:19:09.830 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 00:19:09.831 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 00:19:09.831 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 00:19:09.837 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 00:19:09.839 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 00:19:09.935 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 00:19:09.937 +03:00 [INF] Hosting environment: Development
2025-08-27 00:19:09.937 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 00:19:09.938 +03:00 [DBG] Hosting started
2025-08-27 00:19:16.568 +03:00 [DBG] Connection id "0HNF4SOR95OPU" accepted.
2025-08-27 00:19:16.571 +03:00 [DBG] Connection id "0HNF4SOR95OPU" started.
2025-08-27 00:19:16.596 +03:00 [DBG] Connection id "0HNF4SOR95OPU" received FIN.
2025-08-27 00:19:16.597 +03:00 [DBG] Connection id "0HNF4SOR95OPV" accepted.
2025-08-27 00:19:16.635 +03:00 [DBG] Connection id "0HNF4SOR95OPV" started.
2025-08-27 00:19:16.715 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.Security.Authentication.AuthenticationException: Authentication failed, see inner exception.
 ---> System.ComponentModel.Win32Exception (0x80090327): An unknown error occurred while processing the certificate.
   --- End of inner exception stack trace ---
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-08-27 00:19:16.723 +03:00 [DBG] Connection id "0HNF4SOR95OPU" stopped.
2025-08-27 00:19:16.724 +03:00 [DBG] Connection 0HNF4SOR95OPV established using the following protocol: "Tls13"
2025-08-27 00:19:16.727 +03:00 [DBG] Connection id "0HNF4SOR95OPU" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:19:17.294 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - null null
2025-08-27 00:19:17.394 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:19:17.397 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/schema' is valid for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:19:17.399 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:19:17.425 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:19:17.452 +03:00 [INF] Route matched with {action = "GetSchema", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.SchemaModel]] GetSchema(System.Guid, Boolean, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:19:17.455 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:19:17.457 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:19:17.459 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:19:17.461 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:19:17.463 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:19:17.465 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:19:17.586 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 00:19:18.171 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:19:18.182 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:19:18.184 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:19:18.197 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:19:18.200 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:19:18.203 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:19:18.205 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:19:18.207 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:19:18.211 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:19:18.214 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:19:18.216 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' using the name 'forceRefresh' in request data ...
2025-08-27 00:19:18.218 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:19:18.220 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:19:18.221 +03:00 [DBG] Attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:19:18.224 +03:00 [DBG] Done attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:19:18.233 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:19:18.235 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:19:18.236 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:19:18.237 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:19:21.581 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-08-27 00:19:21.619 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-08-27 00:19:21.828 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<Name>k__BackingField = dataReader.GetString(3);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(4));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(5);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(6) ? default(Guid?) : (Guid?)dataReader.GetGuid(6) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(6) ? default(object) : (object)dataReader.GetGuid(6) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(6) ? default(Guid) : dataReader.GetGuid(6);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(8) ? default(string) : dataReader.GetString(8);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(10) ? default(DateTime) : dataReader.GetDateTime(10);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 00:19:21.854 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:19:21.864 +03:00 [DBG] Created DbConnection. (8ms).
2025-08-27 00:19:21.868 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:19:21.879 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:19:21.883 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:19:21.888 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-08-27 00:19:21.891 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-08-27 00:19:21.897 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:19:21.915 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:19:21.946 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:19:21.971 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:19:21.978 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 56ms reading results.
2025-08-27 00:19:21.982 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:19:21.986 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (3ms).
2025-08-27 00:19:24.451 +03:00 [INF] Fetching connection string for profile "68c67fe8-408e-41fb-bedd-3d4a730c3348"
2025-08-27 00:19:24.454 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:19:24.455 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:19:24.457 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:19:24.458 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:19:24.459 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 00:19:24.460 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:19:24.462 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:19:24.465 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:19:24.466 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 00:19:24.467 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:19:24.468 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:19:24.476 +03:00 [DBG] Fetched secret for profile "68c67fe8-408e-41fb-bedd-3d4a730c3348"
2025-08-27 00:19:24.487 +03:00 [DBG] Fetching schema for Profile "68c67fe8-408e-41fb-bedd-3d4a730c3348", ForceRefresh=false
2025-08-27 00:19:24.490 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5//SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 00:19:24.499 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5//SQLEXPRESS, Database=ProductInventory)
2025-08-27 00:19:39.850 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api) in 22384.2427ms
2025-08-27 00:19:39.939 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:19:40.093 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.Data.SqlClient.SqlException (0x80131904): A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)
 ---> System.ComponentModel.Win32Exception (67): The network name cannot be found.
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, SqlCommand command, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, TimeoutTimer timeout, SqlConnectionString connectionOptions, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, TimeoutTimer timeout, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString connectionOptions, SqlCredential credential, TimeoutTimer timeout)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(TimeoutTimer timeout, SqlConnectionString connectionOptions, SqlCredential credential, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling, String accessToken, IDbConnectionPool pool, Func`3 accessTokenCallback)
   at Microsoft.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionPoolGroupProviderInfo poolGroupProviderInfo, IDbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(IDbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.WaitForPendingOpen()
--- End of stack trace from previous location ---
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.LoadSchemaFromDatabase(ProviderConnectionConfig config, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 366
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.GetSchemaAsync(ProviderConnectionConfig config, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 143
   at NaturalToQuery.Application.Services.ProfileDbService.GetSchemaAsync(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 48
   at NaturalToQuery.Api.Controllers.QueryController.GetSchema(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 71
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
ClientConnectionId:00000000-0000-0000-0000-000000000000
Error Number:67,State:0,Class:20
2025-08-27 00:19:40.109 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 00:19:40.124 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:19:40.129 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:19:40.131 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (3ms).
2025-08-27 00:19:40.134 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - 500 null application/json; charset=utf-8 22844.8205ms
2025-08-27 00:19:50.481 +03:00 [DBG] Connection id "0HNF4SOR95OPV" received FIN.
2025-08-27 00:19:50.483 +03:00 [DBG] Connection id "0HNF4SOR95OPV" is closed. The last processed stream ID was 1.
2025-08-27 00:19:50.484 +03:00 [DBG] The connection queue processing loop for 0HNF4SOR95OPV completed.
2025-08-27 00:19:50.485 +03:00 [DBG] Connection id "0HNF4SOR95OPV" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:19:50.487 +03:00 [DBG] Connection id "0HNF4SOR95OPV" stopped.
2025-08-27 00:20:17.394 +03:00 [DBG] Connection id "0HNF4SOR95OQ0" accepted.
2025-08-27 00:20:17.400 +03:00 [DBG] Connection id "0HNF4SOR95OQ0" started.
2025-08-27 00:20:17.403 +03:00 [DBG] Connection id "0HNF4SOR95OQ0" received FIN.
2025-08-27 00:20:17.512 +03:00 [DBG] Connection id "0HNF4SOR95OQ1" accepted.
2025-08-27 00:20:17.528 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.Security.Authentication.AuthenticationException: Authentication failed, see inner exception.
 ---> System.ComponentModel.Win32Exception (0x80090327): An unknown error occurred while processing the certificate.
   --- End of inner exception stack trace ---
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-08-27 00:20:17.532 +03:00 [DBG] Connection id "0HNF4SOR95OQ1" started.
2025-08-27 00:20:17.534 +03:00 [DBG] Connection id "0HNF4SOR95OQ0" stopped.
2025-08-27 00:20:17.535 +03:00 [DBG] Connection id "0HNF4SOR95OQ0" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:20:17.536 +03:00 [DBG] Connection 0HNF4SOR95OQ1 established using the following protocol: "Tls13"
2025-08-27 00:20:17.538 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - null null
2025-08-27 00:20:17.544 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:20:17.545 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/schema' is valid for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:20:17.547 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:20:17.549 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:20:17.550 +03:00 [INF] Route matched with {action = "GetSchema", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.SchemaModel]] GetSchema(System.Guid, Boolean, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:20:17.551 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:20:17.552 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:20:17.554 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:20:17.556 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:20:17.557 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:20:17.558 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:20:17.598 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:20:17.601 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:20:17.602 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:20:17.603 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:20:17.604 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:20:17.605 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:20:17.606 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:20:17.608 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:20:17.609 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:20:17.610 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:20:17.611 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' using the name 'forceRefresh' in request data ...
2025-08-27 00:20:17.612 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:20:17.613 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:20:17.614 +03:00 [DBG] Attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:20:17.615 +03:00 [DBG] Done attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:20:17.615 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:20:17.616 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:20:17.617 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:20:17.618 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:20:33.060 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:20:33.072 +03:00 [DBG] Created DbConnection. (11ms).
2025-08-27 00:20:33.073 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:20:33.075 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:20:33.076 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:20:33.077 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:20:33.078 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 00:20:33.079 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:20:33.080 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:20:33.082 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:20:33.083 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:20:33.085 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 00:20:33.086 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:20:33.087 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:20:55.353 +03:00 [INF] Fetching connection string for profile "68c67fe8-408e-41fb-bedd-3d4a730c3348"
2025-08-27 00:20:55.355 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:20:55.356 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:20:55.357 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:20:55.358 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:20:55.360 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 00:20:55.361 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:20:55.363 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:20:55.365 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:20:55.366 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 00:20:55.367 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:20:55.368 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:20:55.370 +03:00 [DBG] Fetched secret for profile "68c67fe8-408e-41fb-bedd-3d4a730c3348"
2025-08-27 00:21:24.403 +03:00 [DBG] Fetching schema for Profile "68c67fe8-408e-41fb-bedd-3d4a730c3348", ForceRefresh=false
2025-08-27 00:21:24.405 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5//SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 00:21:24.407 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5//SQLEXPRESS, Database=ProductInventory)
2025-08-27 00:21:39.626 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api) in 82067.7813ms
2025-08-27 00:21:39.706 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:21:39.853 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.Data.SqlClient.SqlException (0x80131904): A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)
 ---> System.ComponentModel.Win32Exception (67): The network name cannot be found.
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, SqlCommand command, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, TimeoutTimer timeout, SqlConnectionString connectionOptions, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, TimeoutTimer timeout, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString connectionOptions, SqlCredential credential, TimeoutTimer timeout)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(TimeoutTimer timeout, SqlConnectionString connectionOptions, SqlCredential credential, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling, String accessToken, IDbConnectionPool pool, Func`3 accessTokenCallback)
   at Microsoft.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionPoolGroupProviderInfo poolGroupProviderInfo, IDbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(IDbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.WaitForPendingOpen()
--- End of stack trace from previous location ---
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.LoadSchemaFromDatabase(ProviderConnectionConfig config, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 366
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.GetSchemaAsync(ProviderConnectionConfig config, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 143
   at NaturalToQuery.Application.Services.ProfileDbService.GetSchemaAsync(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 48
   at NaturalToQuery.Api.Controllers.QueryController.GetSchema(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 71
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
ClientConnectionId:00000000-0000-0000-0000-000000000000
Error Number:67,State:0,Class:20
2025-08-27 00:21:39.860 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 00:21:39.861 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:21:39.906 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:21:39.907 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:21:39.909 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - 500 null application/json; charset=utf-8 82371.0273ms
2025-08-27 00:21:41.834 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - null null
2025-08-27 00:21:41.843 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:21:41.844 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/schema' is valid for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:21:41.845 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:21:41.847 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:21:41.848 +03:00 [INF] Route matched with {action = "GetSchema", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.SchemaModel]] GetSchema(System.Guid, Boolean, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:21:41.849 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:21:41.851 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:21:41.852 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:21:41.853 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:21:41.854 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:21:41.855 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:21:41.866 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:21:41.868 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:21:41.869 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:21:41.870 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:21:41.871 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:21:41.873 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:21:41.874 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:21:41.875 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:21:41.876 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:21:41.877 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:21:41.878 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' using the name 'forceRefresh' in request data ...
2025-08-27 00:21:41.879 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:21:41.880 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:21:41.880 +03:00 [DBG] Attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:21:41.881 +03:00 [DBG] Done attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:21:41.882 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:21:41.882 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:21:41.883 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:21:41.884 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:21:55.437 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:21:55.438 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 00:21:55.439 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:21:55.440 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:21:55.441 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:21:55.442 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:21:55.442 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:21:55.443 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:21:55.444 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:21:55.445 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:21:55.446 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:21:55.447 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 00:21:55.448 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:21:55.449 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:21:57.938 +03:00 [INF] Fetching connection string for profile "68c67fe8-408e-41fb-bedd-3d4a730c3348"
2025-08-27 00:21:57.940 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:21:57.941 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:21:57.942 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:21:57.943 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:21:57.944 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:21:57.945 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:21:57.946 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:21:57.947 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:21:57.948 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 00:21:57.949 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:21:57.949 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:21:57.950 +03:00 [DBG] Fetched secret for profile "68c67fe8-408e-41fb-bedd-3d4a730c3348"
2025-08-27 00:22:03.400 +03:00 [DBG] Fetching schema for Profile "68c67fe8-408e-41fb-bedd-3d4a730c3348", ForceRefresh=false
2025-08-27 00:22:03.402 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5//SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 00:22:03.403 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5//SQLEXPRESS, Database=ProductInventory)
2025-08-27 00:22:18.586 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api) in 36730.9893ms
2025-08-27 00:22:18.662 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:22:18.800 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.Data.SqlClient.SqlException (0x80131904): A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)
 ---> System.ComponentModel.Win32Exception (67): The network name cannot be found.
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, SqlCommand command, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, TimeoutTimer timeout, SqlConnectionString connectionOptions, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, TimeoutTimer timeout, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString connectionOptions, SqlCredential credential, TimeoutTimer timeout)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(TimeoutTimer timeout, SqlConnectionString connectionOptions, SqlCredential credential, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling, String accessToken, IDbConnectionPool pool, Func`3 accessTokenCallback)
   at Microsoft.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionPoolGroupProviderInfo poolGroupProviderInfo, IDbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(IDbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.WaitForPendingOpen()
--- End of stack trace from previous location ---
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.LoadSchemaFromDatabase(ProviderConnectionConfig config, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 366
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.GetSchemaAsync(ProviderConnectionConfig config, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 143
   at NaturalToQuery.Application.Services.ProfileDbService.GetSchemaAsync(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 48
   at NaturalToQuery.Api.Controllers.QueryController.GetSchema(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 71
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
ClientConnectionId:00000000-0000-0000-0000-000000000000
Error Number:67,State:0,Class:20
2025-08-27 00:22:18.806 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 00:22:18.807 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:22:18.808 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:22:18.809 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:22:18.810 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - 500 null application/json; charset=utf-8 36976.0437ms
2025-08-27 00:22:55.374 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - null null
2025-08-27 00:22:55.385 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:22:55.386 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/schema' is valid for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:22:55.387 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:22:55.387 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:22:55.388 +03:00 [INF] Route matched with {action = "GetSchema", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.SchemaModel]] GetSchema(System.Guid, Boolean, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:22:55.389 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:22:55.390 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:22:55.391 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:22:55.392 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:22:55.393 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:22:55.394 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:22:55.395 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:22:55.396 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:22:55.396 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:22:55.397 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:22:55.398 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:22:55.399 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:22:55.400 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:22:55.401 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:22:55.401 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:22:55.402 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:22:55.403 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' using the name 'forceRefresh' in request data ...
2025-08-27 00:22:55.404 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:22:55.404 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:22:55.405 +03:00 [DBG] Attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:22:55.406 +03:00 [DBG] Done attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:22:55.406 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:22:55.407 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:22:55.408 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:22:55.409 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:23:11.455 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:23:11.456 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 00:23:11.457 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:23:11.458 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:23:11.459 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:23:11.459 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:23:11.460 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:23:11.461 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:23:11.462 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:23:11.463 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:23:11.464 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:23:11.465 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 00:23:11.466 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:23:11.466 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:23:12.235 +03:00 [INF] Fetching connection string for profile "68c67fe8-408e-41fb-bedd-3d4a730c3348"
2025-08-27 00:23:12.237 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:23:12.238 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:23:12.241 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:23:12.242 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:23:12.243 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 00:23:12.245 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:23:12.246 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:23:12.249 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:23:12.250 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 00:23:12.251 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:23:12.252 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:23:12.254 +03:00 [DBG] Fetched secret for profile "68c67fe8-408e-41fb-bedd-3d4a730c3348"
2025-08-27 00:23:49.154 +03:00 [DBG] Fetching schema for Profile "68c67fe8-408e-41fb-bedd-3d4a730c3348", ForceRefresh=false
2025-08-27 00:24:36.888 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5//SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 00:24:47.370 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5//SQLEXPRESS, Database=ProductInventory)
2025-08-27 00:25:05.404 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api) in 130009.8146ms
2025-08-27 00:25:05.484 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:25:05.625 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.Data.SqlClient.SqlException (0x80131904): A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)
 ---> System.ComponentModel.Win32Exception (67): The network name cannot be found.
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, SqlCommand command, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, TimeoutTimer timeout, SqlConnectionString connectionOptions, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, TimeoutTimer timeout, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString connectionOptions, SqlCredential credential, TimeoutTimer timeout)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(TimeoutTimer timeout, SqlConnectionString connectionOptions, SqlCredential credential, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling, String accessToken, IDbConnectionPool pool, Func`3 accessTokenCallback)
   at Microsoft.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionPoolGroupProviderInfo poolGroupProviderInfo, IDbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(IDbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.WaitForPendingOpen()
--- End of stack trace from previous location ---
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.LoadSchemaFromDatabase(ProviderConnectionConfig config, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 366
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.GetSchemaAsync(ProviderConnectionConfig config, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 143
   at NaturalToQuery.Application.Services.ProfileDbService.GetSchemaAsync(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 48
   at NaturalToQuery.Api.Controllers.QueryController.GetSchema(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 71
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
ClientConnectionId:00000000-0000-0000-0000-000000000000
Error Number:67,State:0,Class:20
2025-08-27 00:25:05.632 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 00:25:05.633 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:25:05.634 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:25:05.635 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:25:05.636 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - 500 null application/json; charset=utf-8 130261.6651ms
2025-08-27 00:34:09.943 +03:00 [INF] This is a test log to file!
2025-08-27 00:34:10.133 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 00:34:10.143 +03:00 [INF] API configured successfully.
2025-08-27 00:34:10.144 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 00:34:10.145 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 00:34:10.206 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 00:34:10.258 +03:00 [DBG] Hosting starting
2025-08-27 00:34:10.272 +03:00 [DBG] Middleware loaded
2025-08-27 00:34:10.276 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 00:34:10.284 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 00:34:10.397 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 00:34:10.400 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 00:34:10.409 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 00:34:10.451 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 00:34:10.507 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 00:34:10.509 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 00:34:10.510 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 00:34:10.515 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 00:34:10.536 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 00:34:10.537 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 00:34:10.545 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 00:34:10.548 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 00:34:10.682 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 00:34:10.688 +03:00 [INF] Hosting environment: Development
2025-08-27 00:34:10.688 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 00:34:10.690 +03:00 [DBG] Hosting started
2025-08-27 00:34:17.255 +03:00 [DBG] Connection id "0HNF4T17MPJQC" accepted.
2025-08-27 00:34:17.258 +03:00 [DBG] Connection id "0HNF4T17MPJQC" started.
2025-08-27 00:34:17.282 +03:00 [DBG] Connection id "0HNF4T17MPJQC" received FIN.
2025-08-27 00:34:17.283 +03:00 [DBG] Connection id "0HNF4T17MPJQD" accepted.
2025-08-27 00:34:17.301 +03:00 [DBG] Connection id "0HNF4T17MPJQD" started.
2025-08-27 00:34:17.345 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.Security.Authentication.AuthenticationException: Authentication failed, see inner exception.
 ---> System.ComponentModel.Win32Exception (0x80090327): An unknown error occurred while processing the certificate.
   --- End of inner exception stack trace ---
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-08-27 00:34:17.351 +03:00 [DBG] Connection id "0HNF4T17MPJQC" stopped.
2025-08-27 00:34:17.353 +03:00 [DBG] Connection 0HNF4T17MPJQD established using the following protocol: "Tls13"
2025-08-27 00:34:17.353 +03:00 [DBG] Connection id "0HNF4T17MPJQC" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:34:17.386 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - null null
2025-08-27 00:34:17.464 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:34:17.467 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/schema' is valid for the request path '/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema'
2025-08-27 00:34:17.469 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:34:17.490 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:34:17.505 +03:00 [INF] Route matched with {action = "GetSchema", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.SchemaModel]] GetSchema(System.Guid, Boolean, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:34:17.509 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:34:17.511 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:34:17.512 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:34:17.513 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:34:17.514 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:34:17.516 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:34:17.595 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 00:34:17.995 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:34:18.002 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:34:18.003 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:34:18.014 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:34:18.016 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:34:18.018 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:34:18.019 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:34:18.019 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:34:18.021 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:34:18.023 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:34:18.024 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' using the name 'forceRefresh' in request data ...
2025-08-27 00:34:18.026 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:34:18.027 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:34:18.027 +03:00 [DBG] Attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:34:18.028 +03:00 [DBG] Done attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:34:18.029 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:34:18.031 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:34:18.032 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:34:18.033 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:34:21.217 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-08-27 00:34:21.251 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-08-27 00:34:21.443 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<Name>k__BackingField = dataReader.GetString(3);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(4));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(5);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(6) ? default(Guid?) : (Guid?)dataReader.GetGuid(6) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(6) ? default(object) : (object)dataReader.GetGuid(6) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(6) ? default(Guid) : dataReader.GetGuid(6);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(8) ? default(string) : dataReader.GetString(8);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(10) ? default(DateTime) : dataReader.GetDateTime(10);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 00:34:21.474 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:34:21.484 +03:00 [DBG] Created DbConnection. (8ms).
2025-08-27 00:34:21.487 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:34:21.497 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:34:21.500 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:34:21.505 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-08-27 00:34:21.511 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (10ms).
2025-08-27 00:34:21.517 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:34:21.534 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:34:21.564 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:34:21.588 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:34:21.594 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 53ms reading results.
2025-08-27 00:34:21.598 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:34:21.602 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (4ms).
2025-08-27 00:34:21.612 +03:00 [INF] Fetching connection string for profile "68c67fe8-408e-41fb-bedd-3d4a730c3348"
2025-08-27 00:34:21.616 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:34:21.618 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:34:21.619 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:34:21.621 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:34:21.622 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 00:34:21.624 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:34:21.627 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:34:21.630 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:34:21.631 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 00:34:21.633 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:34:21.634 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:34:21.642 +03:00 [DBG] Fetched secret for profile "68c67fe8-408e-41fb-bedd-3d4a730c3348"
2025-08-27 00:34:21.652 +03:00 [DBG] Fetching schema for Profile "68c67fe8-408e-41fb-bedd-3d4a730c3348", ForceRefresh=false
2025-08-27 00:34:21.655 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5//SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 00:34:21.664 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5//SQLEXPRESS, Database=ProductInventory)
2025-08-27 00:34:36.999 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api) in 19481.0408ms
2025-08-27 00:34:37.080 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:34:37.229 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.Data.SqlClient.SqlException (0x80131904): A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)
 ---> System.ComponentModel.Win32Exception (67): The network name cannot be found.
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, SqlCommand command, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, TimeoutTimer timeout, SqlConnectionString connectionOptions, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, TimeoutTimer timeout, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString connectionOptions, SqlCredential credential, TimeoutTimer timeout)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(TimeoutTimer timeout, SqlConnectionString connectionOptions, SqlCredential credential, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling, String accessToken, IDbConnectionPool pool, Func`3 accessTokenCallback)
   at Microsoft.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionPoolGroupProviderInfo poolGroupProviderInfo, IDbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(IDbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.SqlClient.ConnectionPool.WaitHandleDbConnectionPool.WaitForPendingOpen()
--- End of stack trace from previous location ---
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.LoadSchemaFromDatabase(ProviderConnectionConfig config, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 381
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.GetSchemaAsync(ProviderConnectionConfig config, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 143
   at NaturalToQuery.Application.Services.ProfileDbService.GetSchemaAsync(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 48
   at NaturalToQuery.Api.Controllers.QueryController.GetSchema(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 71
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
ClientConnectionId:00000000-0000-0000-0000-000000000000
Error Number:67,State:0,Class:20
2025-08-27 00:34:37.244 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 00:34:37.256 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:34:37.260 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:34:37.262 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:34:37.264 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/query/68C67FE8-408E-41FB-BEDD-3D4A730C3348/schema?forceRefresh=false - 500 null application/json; charset=utf-8 19881.682ms
2025-08-27 00:35:23.229 +03:00 [DBG] Connection id "0HNF4T17MPJQE" accepted.
2025-08-27 00:35:23.229 +03:00 [DBG] Connection id "0HNF4T17MPJQE" received FIN.
2025-08-27 00:35:23.237 +03:00 [DBG] Connection id "0HNF4T17MPJQF" accepted.
2025-08-27 00:35:23.238 +03:00 [DBG] Connection id "0HNF4T17MPJQE" started.
2025-08-27 00:35:23.246 +03:00 [DBG] Connection id "0HNF4T17MPJQF" started.
2025-08-27 00:35:23.251 +03:00 [DBG] Connection id "0HNF4T17MPJQE" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:35:23.254 +03:00 [DBG] Connection id "0HNF4T17MPJQE" disconnecting.
2025-08-27 00:35:23.256 +03:00 [DBG] Connection id "0HNF4T17MPJQE" stopped.
2025-08-27 00:35:23.257 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/setup/profile - application/json 163
2025-08-27 00:35:23.260 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:35:23.261 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:35:23.262 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:35:23.263 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-08-27 00:35:23.265 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/setup/profile'.
2025-08-27 00:35:23.267 +03:00 [DBG] Connection id "0HNF4T17MPJQF" completed keep alive response.
2025-08-27 00:35:23.268 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/setup/profile - 307 0 null 11.0362ms
2025-08-27 00:35:23.269 +03:00 [DBG] Connection id "0HNF4T17MPJQG" received FIN.
2025-08-27 00:35:23.269 +03:00 [DBG] Connection id "0HNF4T17MPJQG" accepted.
2025-08-27 00:35:23.269 +03:00 [DBG] Connection id "0HNF4T17MPJQH" accepted.
2025-08-27 00:35:23.274 +03:00 [DBG] Connection id "0HNF4T17MPJQF", Request id "0HNF4T17MPJQF:00000001": started reading request body.
2025-08-27 00:35:23.275 +03:00 [DBG] Connection id "0HNF4T17MPJQG" started.
2025-08-27 00:35:23.276 +03:00 [DBG] Connection id "0HNF4T17MPJQH" started.
2025-08-27 00:35:23.277 +03:00 [DBG] Connection id "0HNF4T17MPJQF", Request id "0HNF4T17MPJQF:00000001": done reading request body.
2025-08-27 00:35:23.278 +03:00 [DBG] Connection id "0HNF4T17MPJQG" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:35:23.280 +03:00 [DBG] Connection id "0HNF4T17MPJQG" disconnecting.
2025-08-27 00:35:23.281 +03:00 [DBG] Connection id "0HNF4T17MPJQG" stopped.
2025-08-27 00:35:23.283 +03:00 [DBG] Connection 0HNF4T17MPJQH established using the following protocol: "Tls13"
2025-08-27 00:35:23.284 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/setup/profile - application/json 163
2025-08-27 00:35:23.286 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:35:23.287 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:35:23.288 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:35:23.290 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:35:23.294 +03:00 [INF] Route matched with {action = "CreateProfile", controller = "Setup"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.UI.ProfileCreationResponse]] CreateProfile(NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api).
2025-08-27 00:35:23.296 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:35:23.297 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:35:23.298 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:35:23.299 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:35:23.300 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:35:23.301 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:35:23.341 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:35:23.344 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:35:23.346 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:35:23.347 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' using the name '' in request data ...
2025-08-27 00:35:23.349 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:35:23.362 +03:00 [DBG] Connection id "0HNF4T17MPJQH", Request id "0HNF4T17MPJQH:00000001": started reading request body.
2025-08-27 00:35:23.363 +03:00 [DBG] Connection id "0HNF4T17MPJQH", Request id "0HNF4T17MPJQH:00000001": done reading request body.
2025-08-27 00:35:23.370 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'
2025-08-27 00:35:23.371 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:35:23.372 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:35:23.372 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:35:23.379 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:35:23.380 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:35:23.381 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:35:23.382 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:35:23.383 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:35:23.386 +03:00 [INF] Creating profile for provider "SqlServer"
2025-08-27 00:35:23.388 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5//SQLEXPRESS, Database=ProductInventory)
2025-08-27 00:35:38.358 +03:00 [DBG] failed to connect ConnectionString: Data Source=DESKTOP-QCK8UI5//SQLEXPRESS;Initial Catalog=ProductInventory;Integrated Security=True;Connect Timeout=15;Trust Server Certificate=True, 
2025-08-27 00:35:38.358 +03:00 [DBG] failed to connect to the configured connection string NaturalToQuery.Infrastructure.Providers.ProviderConnectionConfig
2025-08-27 00:35:38.588 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api) in 15286.9986ms
2025-08-27 00:35:38.668 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:35:38.814 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: failed to connect to the configured connection string NaturalToQuery.Infrastructure.Providers.ProviderConnectionConfig
   at NaturalToQuery.Application.Services.ProfileService.CreateAsync(ProviderType Type, ProviderConnectionConfig config, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileService.cs:line 38
   at NaturalToQuery.Application.Services.SetupService.CreateProfileAsync(SetupRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\SetupService.cs:line 33
   at NaturalToQuery.Api.Controllers.SetupController.CreateProfile(SetupRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\SetupController.cs:line 58
   at lambda_method105(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 00:35:38.820 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 00:35:38.822 +03:00 [DBG] Connection id "0HNF4T17MPJQH" completed keep alive response.
2025-08-27 00:35:38.823 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:35:38.824 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/setup/profile - 500 null application/json; charset=utf-8 15540.1486ms
2025-08-27 00:36:40.133 +03:00 [INF] This is a test log to file!
2025-08-27 00:36:40.371 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 00:36:40.381 +03:00 [INF] API configured successfully.
2025-08-27 00:36:40.382 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 00:36:40.383 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 00:36:40.442 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 00:36:40.490 +03:00 [DBG] Hosting starting
2025-08-27 00:36:40.507 +03:00 [DBG] Middleware loaded
2025-08-27 00:36:40.509 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 00:36:40.512 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 00:36:40.585 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 00:36:40.588 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 00:36:40.595 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 00:36:40.625 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 00:36:40.691 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 00:36:40.694 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 00:36:40.695 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 00:36:40.696 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 00:36:40.696 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 00:36:40.697 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 00:36:40.702 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 00:36:40.704 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 00:36:40.787 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 00:36:40.788 +03:00 [INF] Hosting environment: Development
2025-08-27 00:36:40.789 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 00:36:40.789 +03:00 [DBG] Hosting started
2025-08-27 00:36:46.809 +03:00 [DBG] Connection id "0HNF4T2K91SQH" received FIN.
2025-08-27 00:36:46.814 +03:00 [DBG] Connection id "0HNF4T2K91SQH" accepted.
2025-08-27 00:36:46.815 +03:00 [DBG] Connection id "0HNF4T2K91SQH" started.
2025-08-27 00:36:46.816 +03:00 [DBG] Connection id "0HNF4T2K91SQI" accepted.
2025-08-27 00:36:46.817 +03:00 [DBG] Connection id "0HNF4T2K91SQI" started.
2025-08-27 00:36:46.823 +03:00 [DBG] Connection id "0HNF4T2K91SQH" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:36:46.825 +03:00 [DBG] Connection id "0HNF4T2K91SQH" disconnecting.
2025-08-27 00:36:46.827 +03:00 [DBG] Connection id "0HNF4T2K91SQH" stopped.
2025-08-27 00:36:46.840 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/setup/profile - application/json 163
2025-08-27 00:36:46.864 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:36:46.867 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:36:46.869 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:36:46.890 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-08-27 00:36:46.892 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/setup/profile'.
2025-08-27 00:36:46.899 +03:00 [DBG] Connection id "0HNF4T2K91SQI" completed keep alive response.
2025-08-27 00:36:46.901 +03:00 [DBG] Connection id "0HNF4T2K91SQJ" accepted.
2025-08-27 00:36:46.901 +03:00 [DBG] Connection id "0HNF4T2K91SQJ" received FIN.
2025-08-27 00:36:46.901 +03:00 [DBG] Connection id "0HNF4T2K91SQK" accepted.
2025-08-27 00:36:46.945 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/setup/profile - 307 0 null 65.0856ms
2025-08-27 00:36:46.945 +03:00 [DBG] Connection id "0HNF4T2K91SQJ" started.
2025-08-27 00:36:46.947 +03:00 [DBG] Connection id "0HNF4T2K91SQK" started.
2025-08-27 00:36:46.951 +03:00 [DBG] Connection id "0HNF4T2K91SQJ" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:36:46.953 +03:00 [DBG] Connection id "0HNF4T2K91SQI", Request id "0HNF4T2K91SQI:00000001": started reading request body.
2025-08-27 00:36:46.953 +03:00 [DBG] Connection id "0HNF4T2K91SQJ" disconnecting.
2025-08-27 00:36:46.957 +03:00 [DBG] Connection id "0HNF4T2K91SQI", Request id "0HNF4T2K91SQI:00000001": done reading request body.
2025-08-27 00:36:46.958 +03:00 [DBG] Connection id "0HNF4T2K91SQJ" stopped.
2025-08-27 00:36:46.983 +03:00 [DBG] Connection 0HNF4T2K91SQK established using the following protocol: "Tls13"
2025-08-27 00:36:46.986 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/setup/profile - application/json 163
2025-08-27 00:36:46.989 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:36:46.990 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:36:46.992 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:36:46.995 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:36:47.011 +03:00 [INF] Route matched with {action = "CreateProfile", controller = "Setup"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.UI.ProfileCreationResponse]] CreateProfile(NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api).
2025-08-27 00:36:47.014 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:36:47.015 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:36:47.016 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:36:47.018 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:36:47.019 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:36:47.021 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:36:47.102 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 00:36:47.537 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:36:47.541 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:36:47.545 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:36:47.547 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' using the name '' in request data ...
2025-08-27 00:36:47.549 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:36:47.563 +03:00 [DBG] Connection id "0HNF4T2K91SQK", Request id "0HNF4T2K91SQK:00000001": started reading request body.
2025-08-27 00:36:47.564 +03:00 [DBG] Connection id "0HNF4T2K91SQK", Request id "0HNF4T2K91SQK:00000001": done reading request body.
2025-08-27 00:36:47.571 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'
2025-08-27 00:36:47.572 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:36:47.573 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:36:47.574 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:36:47.582 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:36:47.584 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:36:47.585 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:36:47.586 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:36:47.587 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:36:47.599 +03:00 [INF] Creating profile for provider "SqlServer"
2025-08-27 00:36:47.606 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5//SQLEXPRESS, Database=ProductInventory)
2025-08-27 00:37:02.692 +03:00 [DBG] failed to connect ConnectionString: Data Source=DESKTOP-QCK8UI5//SQLEXPRESS;Initial Catalog=ProductInventory;Integrated Security=True;Connect Timeout=15;Trust Server Certificate=True, 
2025-08-27 00:37:02.694 +03:00 [DBG] failed to connect to the configured connection string NaturalToQuery.Infrastructure.Providers.ProviderConnectionConfig
2025-08-27 00:37:02.942 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api) in 15919.7534ms
2025-08-27 00:37:03.022 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:37:03.175 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: failed to connect to the configured connection string Data Source=DESKTOP-QCK8UI5//SQLEXPRESS;Initial Catalog=ProductInventory;Integrated Security=True;Connect Timeout=15;Trust Server Certificate=True
   at NaturalToQuery.Application.Services.ProfileService.CreateAsync(ProviderType Type, ProviderConnectionConfig config, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileService.cs:line 38
   at NaturalToQuery.Application.Services.SetupService.CreateProfileAsync(SetupRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\SetupService.cs:line 33
   at NaturalToQuery.Api.Controllers.SetupController.CreateProfile(SetupRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\SetupController.cs:line 58
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 00:37:03.189 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 00:37:03.201 +03:00 [DBG] Connection id "0HNF4T2K91SQK" completed keep alive response.
2025-08-27 00:37:03.204 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:37:03.208 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/setup/profile - 500 null application/json; charset=utf-8 16221.5408ms
2025-08-27 00:37:24.486 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/setup/profile - application/json 162
2025-08-27 00:37:24.490 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:37:24.490 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:37:24.492 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:37:24.494 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/setup/profile'.
2025-08-27 00:37:24.494 +03:00 [DBG] Connection id "0HNF4T2K91SQI" completed keep alive response.
2025-08-27 00:37:24.496 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/setup/profile - 307 0 null 9.355ms
2025-08-27 00:37:24.520 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/setup/profile - application/json 162
2025-08-27 00:37:24.522 +03:00 [DBG] Connection id "0HNF4T2K91SQI", Request id "0HNF4T2K91SQI:00000002": started reading request body.
2025-08-27 00:37:24.524 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:37:24.525 +03:00 [DBG] Connection id "0HNF4T2K91SQI", Request id "0HNF4T2K91SQI:00000002": done reading request body.
2025-08-27 00:37:24.526 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:37:24.529 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:37:24.530 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:37:24.531 +03:00 [INF] Route matched with {action = "CreateProfile", controller = "Setup"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.UI.ProfileCreationResponse]] CreateProfile(NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api).
2025-08-27 00:37:24.532 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:37:24.534 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:37:24.535 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:37:24.536 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:37:24.537 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:37:24.539 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:37:24.592 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:37:24.594 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:37:24.595 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:37:24.597 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' using the name '' in request data ...
2025-08-27 00:37:24.598 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:37:24.599 +03:00 [DBG] Connection id "0HNF4T2K91SQK", Request id "0HNF4T2K91SQK:00000002": started reading request body.
2025-08-27 00:37:24.600 +03:00 [DBG] Connection id "0HNF4T2K91SQK", Request id "0HNF4T2K91SQK:00000002": done reading request body.
2025-08-27 00:37:24.601 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'
2025-08-27 00:37:24.602 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:37:24.603 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:37:24.605 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:37:24.606 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:37:24.607 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:37:24.608 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:37:24.609 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:37:24.610 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:37:24.611 +03:00 [INF] Creating profile for provider "SqlServer"
2025-08-27 00:37:24.613 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5/SQLEXPRESS, Database=ProductInventory)
2025-08-27 00:37:39.609 +03:00 [DBG] failed to connect ConnectionString: Data Source=DESKTOP-QCK8UI5/SQLEXPRESS;Initial Catalog=ProductInventory;Integrated Security=True;Connect Timeout=15;Trust Server Certificate=True, 
2025-08-27 00:37:39.610 +03:00 [DBG] failed to connect to the configured connection string NaturalToQuery.Infrastructure.Providers.ProviderConnectionConfig
2025-08-27 00:37:39.853 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api) in 15314.0431ms
2025-08-27 00:37:39.933 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:37:40.080 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: failed to connect to the configured connection string Data Source=DESKTOP-QCK8UI5/SQLEXPRESS;Initial Catalog=ProductInventory;Integrated Security=True;Connect Timeout=15;Trust Server Certificate=True
   at NaturalToQuery.Application.Services.ProfileService.CreateAsync(ProviderType Type, ProviderConnectionConfig config, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileService.cs:line 38
   at NaturalToQuery.Application.Services.SetupService.CreateProfileAsync(SetupRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\SetupService.cs:line 33
   at NaturalToQuery.Api.Controllers.SetupController.CreateProfile(SetupRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\SetupController.cs:line 58
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 00:37:40.093 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 00:37:40.094 +03:00 [DBG] Connection id "0HNF4T2K91SQK" completed keep alive response.
2025-08-27 00:37:40.095 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:37:40.096 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/setup/profile - 500 null application/json; charset=utf-8 15575.6621ms
2025-08-27 00:37:42.769 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/setup/profile - application/json 162
2025-08-27 00:37:42.771 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:37:42.772 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:37:42.773 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:37:42.774 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/setup/profile'.
2025-08-27 00:37:42.774 +03:00 [DBG] Connection id "0HNF4T2K91SQI" completed keep alive response.
2025-08-27 00:37:42.776 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/setup/profile - 307 0 null 6.8417ms
2025-08-27 00:37:42.779 +03:00 [DBG] Connection id "0HNF4T2K91SQI", Request id "0HNF4T2K91SQI:00000003": started reading request body.
2025-08-27 00:37:42.779 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/setup/profile - application/json 162
2025-08-27 00:37:42.780 +03:00 [DBG] Connection id "0HNF4T2K91SQI", Request id "0HNF4T2K91SQI:00000003": done reading request body.
2025-08-27 00:37:42.781 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:37:42.785 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:37:42.787 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:37:42.790 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:37:42.792 +03:00 [INF] Route matched with {action = "CreateProfile", controller = "Setup"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.UI.ProfileCreationResponse]] CreateProfile(NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api).
2025-08-27 00:37:42.793 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:37:42.794 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:37:42.796 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:37:42.797 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:37:42.799 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:37:42.809 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:37:42.826 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:37:42.828 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:37:42.829 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:37:42.830 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' using the name '' in request data ...
2025-08-27 00:37:42.832 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:37:42.833 +03:00 [DBG] Connection id "0HNF4T2K91SQK", Request id "0HNF4T2K91SQK:00000003": started reading request body.
2025-08-27 00:37:42.834 +03:00 [DBG] Connection id "0HNF4T2K91SQK", Request id "0HNF4T2K91SQK:00000003": done reading request body.
2025-08-27 00:37:42.923 +03:00 [DBG] JSON input formatter threw an exception: 'S' is an invalid escapable character within a JSON string. The string should be correctly escaped. Path: $.ServerName | LineNumber: 3 | BytePositionInLine: 33.
2025-08-27 00:37:42.925 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:37:42.927 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:37:42.929 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:37:42.931 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:37:42.932 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:37:42.933 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:37:42.935 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:37:42.936 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:37:42.937 +03:00 [DBG] The request has model state errors, returning an error response.
2025-08-27 00:37:42.939 +03:00 [DBG] Request was short circuited at action filter 'Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter'.
2025-08-27 00:37:42.943 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:37:42.946 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:37:42.947 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/problem+json","application/problem+xml","application/problem+json","application/problem+xml"]'.
2025-08-27 00:37:42.950 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/problem+json' to write the response.
2025-08-27 00:37:42.951 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-08-27 00:37:42.964 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api) in 154.9432ms
2025-08-27 00:37:42.965 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:37:42.966 +03:00 [DBG] Connection id "0HNF4T2K91SQK" completed keep alive response.
2025-08-27 00:37:42.967 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:37:42.968 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/setup/profile - 400 null application/problem+json; charset=utf-8 189.102ms
2025-08-27 00:38:04.677 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/setup/profile - application/json 163
2025-08-27 00:38:04.683 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:38:04.684 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:38:04.686 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:38:04.687 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/setup/profile'.
2025-08-27 00:38:04.688 +03:00 [DBG] Connection id "0HNF4T2K91SQI" completed keep alive response.
2025-08-27 00:38:04.690 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/setup/profile - 307 0 null 15.355ms
2025-08-27 00:38:04.717 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/setup/profile - application/json 163
2025-08-27 00:38:04.719 +03:00 [DBG] Connection id "0HNF4T2K91SQI", Request id "0HNF4T2K91SQI:00000004": started reading request body.
2025-08-27 00:38:04.721 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profile'
2025-08-27 00:38:04.722 +03:00 [DBG] Connection id "0HNF4T2K91SQI", Request id "0HNF4T2K91SQI:00000004": done reading request body.
2025-08-27 00:38:04.723 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)' with route pattern 'api/Setup/profile' is valid for the request path '/api/setup/profile'
2025-08-27 00:38:04.726 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:38:04.727 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:38:04.728 +03:00 [INF] Route matched with {action = "CreateProfile", controller = "Setup"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.UI.ProfileCreationResponse]] CreateProfile(NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api).
2025-08-27 00:38:04.730 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:38:04.731 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:38:04.732 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:38:04.734 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:38:04.735 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:38:04.737 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:38:04.739 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:38:04.741 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:38:04.742 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:38:04.743 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' using the name '' in request data ...
2025-08-27 00:38:04.744 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:38:04.745 +03:00 [DBG] Connection id "0HNF4T2K91SQK", Request id "0HNF4T2K91SQK:00000004": started reading request body.
2025-08-27 00:38:04.746 +03:00 [DBG] Connection id "0HNF4T2K91SQK", Request id "0HNF4T2K91SQK:00000004": done reading request body.
2025-08-27 00:38:04.748 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'
2025-08-27 00:38:04.748 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:38:04.749 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:38:04.750 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest' ...
2025-08-27 00:38:04.751 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.SetupRequest'.
2025-08-27 00:38:04.752 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:38:04.753 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:38:04.754 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:38:04.755 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:38:04.756 +03:00 [INF] Creating profile for provider "SqlServer"
2025-08-27 00:38:04.758 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 00:38:04.868 +03:00 [DBG] Connected to database for schema extraction (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 00:38:04.882 +03:00 [DBG] Saved secret profile-8262d178-67da-4365-877d-8e8b5a2a3b21 for provider "SqlServer"
2025-08-27 00:38:04.883 +03:00 [DBG] Generated profile name SqlServer - ProductInventory with cache dir C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer
2025-08-27 00:38:04.935 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Any(p => (int)p.Provider == (int)__profile_Provider_0)'
2025-08-27 00:38:05.088 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 00:38:05.114 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:38:05.123 +03:00 [DBG] Created DbConnection. (9ms).
2025-08-27 00:38:05.126 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:38:05.136 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:38:05.138 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:38:05.144 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-08-27 00:38:05.149 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (10ms).
2025-08-27 00:38:05.155 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:38:05.178 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:38:05.188 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:38:05.195 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 11ms reading results.
2025-08-27 00:38:05.201 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:38:05.206 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (5ms).
2025-08-27 00:38:05.234 +03:00 [DBG] 'ProfilesDbContext' generated a value for the property 'Profile.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:38:05.272 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:38:05.277 +03:00 [DBG] DetectChanges starting for 'ProfilesDbContext'.
2025-08-27 00:38:05.287 +03:00 [DBG] DetectChanges completed for 'ProfilesDbContext'.
2025-08-27 00:38:05.290 +03:00 [DBG] SaveChanges starting for 'ProfilesDbContext'.
2025-08-27 00:38:05.292 +03:00 [DBG] DetectChanges starting for 'ProfilesDbContext'.
2025-08-27 00:38:05.293 +03:00 [DBG] DetectChanges completed for 'ProfilesDbContext'.
2025-08-27 00:38:05.334 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:38:05.335 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:38:05.337 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:38:05.338 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:38:05.339 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:38:05.341 +03:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 49), @p2='?' (DbType = DateTimeOffset), @p3='?' (Size = 28), @p4='?' (DbType = Int32), @p5='?' (Size = 44)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Profiles" ("Id", "CacheFile", "CreatedUtc", "Name", "Provider", "SecretRef")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-08-27 00:38:05.346 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 49), @p2='?' (DbType = DateTimeOffset), @p3='?' (Size = 28), @p4='?' (DbType = Int32), @p5='?' (Size = 44)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Profiles" ("Id", "CacheFile", "CreatedUtc", "Name", "Provider", "SecretRef")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-08-27 00:38:05.349 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:38:05.350 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 00:38:05.351 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:38:05.352 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:38:05.358 +03:00 [DBG] An entity of type 'Profile' tracked by 'ProfilesDbContext' changed state from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:38:05.360 +03:00 [DBG] SaveChanges completed for 'ProfilesDbContext' with 1 entities written to the database.
2025-08-27 00:38:05.361 +03:00 [INF] Profile created successfully with Id "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:38:05.362 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:38:05.364 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:38:05.364 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 00:38:05.365 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 00:38:05.365 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 00:38:05.366 +03:00 [INF] Executing OkObjectResult, writing value of type 'NaturalToQuery.SharedKernal.DTOs.UI.ProfileCreationResponse'.
2025-08-27 00:38:05.370 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api) in 633.7079ms
2025-08-27 00:38:05.371 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.SetupController.CreateProfile (NaturalToQuery.Api)'
2025-08-27 00:38:05.372 +03:00 [DBG] Connection id "0HNF4T2K91SQK" completed keep alive response.
2025-08-27 00:38:05.373 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:38:05.375 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:38:05.377 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:38:05.378 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/setup/profile - 200 null application/json; charset=utf-8 684.7982ms
2025-08-27 00:42:20.691 +03:00 [DBG] Connection id "0HNF4T2K91SQL" accepted.
2025-08-27 00:42:20.697 +03:00 [DBG] Connection id "0HNF4T2K91SQL" started.
2025-08-27 00:42:20.700 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/schema?forceRefresh=false - null null
2025-08-27 00:42:20.764 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/schema'
2025-08-27 00:42:20.765 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/schema' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/schema'
2025-08-27 00:42:20.766 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:42:20.770 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/schema?forceRefresh=false'.
2025-08-27 00:42:20.771 +03:00 [DBG] Connection id "0HNF4T2K91SQL" completed keep alive response.
2025-08-27 00:42:20.772 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/schema?forceRefresh=false - 307 0 null 72.098ms
2025-08-27 00:42:20.773 +03:00 [DBG] Connection id "0HNF4T2K91SQM" accepted.
2025-08-27 00:42:20.774 +03:00 [DBG] Connection id "0HNF4T2K91SQM" started.
2025-08-27 00:42:20.778 +03:00 [DBG] Connection id "0HNF4T2K91SQM" received FIN.
2025-08-27 00:42:20.778 +03:00 [DBG] Connection id "0HNF4T2K91SQN" accepted.
2025-08-27 00:42:20.794 +03:00 [DBG] Connection id "0HNF4T2K91SQN" started.
2025-08-27 00:42:20.841 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.Security.Authentication.AuthenticationException: Authentication failed, see inner exception.
 ---> System.ComponentModel.Win32Exception (0x80090327): An unknown error occurred while processing the certificate.
   --- End of inner exception stack trace ---
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-08-27 00:42:20.844 +03:00 [DBG] Connection 0HNF4T2K91SQN established using the following protocol: "Tls13"
2025-08-27 00:42:20.846 +03:00 [DBG] Connection id "0HNF4T2K91SQM" stopped.
2025-08-27 00:42:20.847 +03:00 [DBG] Connection id "0HNF4T2K91SQM" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:42:20.858 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/schema?forceRefresh=false - null null
2025-08-27 00:42:20.864 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/schema'
2025-08-27 00:42:20.864 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/schema' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/schema'
2025-08-27 00:42:20.866 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:42:20.867 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:42:20.871 +03:00 [INF] Route matched with {action = "GetSchema", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.SchemaModel]] GetSchema(System.Guid, Boolean, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:42:20.872 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:42:20.873 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:42:20.874 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:42:20.875 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:42:20.876 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:42:20.877 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:42:20.878 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:42:20.884 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:42:20.886 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:42:20.888 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:42:20.889 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:42:20.891 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:42:20.892 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:42:20.892 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:42:20.893 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:42:20.894 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:42:20.895 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' using the name 'forceRefresh' in request data ...
2025-08-27 00:42:20.897 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:42:20.898 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:42:20.899 +03:00 [DBG] Attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:42:20.900 +03:00 [DBG] Done attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:42:20.900 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:42:20.901 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:42:20.902 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:42:20.903 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:42:20.911 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-08-27 00:42:20.921 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-08-27 00:42:20.987 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<Name>k__BackingField = dataReader.GetString(3);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(4));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(5);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(6) ? default(Guid?) : (Guid?)dataReader.GetGuid(6) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(6) ? default(object) : (object)dataReader.GetGuid(6) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(6) ? default(Guid) : dataReader.GetGuid(6);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(8) ? default(string) : dataReader.GetString(8);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(10) ? default(DateTime) : dataReader.GetDateTime(10);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 00:42:20.998 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:42:20.998 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 00:42:20.999 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:42:21.000 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:42:21.001 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:42:21.001 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:42:21.002 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:42:21.003 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:42:21.004 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:42:21.010 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:42:21.015 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:42:21.016 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 9ms reading results.
2025-08-27 00:42:21.016 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:42:21.017 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:42:21.020 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:42:21.022 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:42:21.023 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:42:21.024 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:42:21.024 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:42:21.025 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:42:21.026 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:42:21.027 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:42:21.028 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:42:21.029 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 00:42:21.030 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:42:21.031 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:42:21.039 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:42:21.042 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 00:42:21.043 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 00:42:21.052 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 00:42:21.054 +03:00 [DBG] Connected to database for schema extraction (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 00:42:21.193 +03:00 [INF] Loaded 3 tables
2025-08-27 00:42:21.385 +03:00 [INF] Schema loaded: 3 tables, 10 columns, 1 relations
2025-08-27 00:42:21.460 +03:00 [DBG] Saved cache file C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer\SqlServer_schemas.json
2025-08-27 00:42:21.461 +03:00 [INF] Cached schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory to C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer\SqlServer_schemas.json
2025-08-27 00:42:21.462 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:42:21.464 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:42:21.464 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 00:42:21.465 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 00:42:21.466 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 00:42:21.466 +03:00 [INF] Executing OkObjectResult, writing value of type 'NaturalToQuery.SharedKernal.DTOs.Providers.SchemaModel'.
2025-08-27 00:42:21.473 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api) in 596.6113ms
2025-08-27 00:42:21.474 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:42:21.475 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:42:21.477 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:42:21.478 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:42:21.479 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/schema?forceRefresh=false - 200 null application/json; charset=utf-8 621.215ms
2025-08-27 00:42:58.816 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/databases - null null
2025-08-27 00:42:58.820 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/databases'
2025-08-27 00:42:58.822 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetDatabases (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/databases' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/databases'
2025-08-27 00:42:58.823 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetDatabases (NaturalToQuery.Api)'
2025-08-27 00:42:58.824 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/databases'.
2025-08-27 00:42:58.824 +03:00 [DBG] Connection id "0HNF4T2K91SQL" completed keep alive response.
2025-08-27 00:42:58.825 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/databases - 307 0 null 9.2937ms
2025-08-27 00:42:58.832 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/databases - null null
2025-08-27 00:42:58.840 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/databases'
2025-08-27 00:42:58.840 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetDatabases (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/databases' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/databases'
2025-08-27 00:42:58.841 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetDatabases (NaturalToQuery.Api)'
2025-08-27 00:42:58.842 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetDatabases (NaturalToQuery.Api)'
2025-08-27 00:42:58.845 +03:00 [INF] Route matched with {action = "GetDatabases", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[NaturalToQuery.SharedKernal.DTOs.Providers.DatabaseInfo]]] GetDatabases(System.Guid, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:42:58.846 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:42:58.847 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:42:58.848 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:42:58.849 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:42:58.850 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:42:58.850 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:42:58.851 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:42:58.853 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:42:58.853 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:42:58.854 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:42:58.855 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:42:58.856 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:42:58.856 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:42:58.857 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:42:58.858 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:42:58.858 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:42:58.859 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:42:58.860 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:42:58.861 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:42:58.863 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:42:58.864 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 00:42:58.864 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:42:58.865 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:42:58.866 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:42:58.867 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:42:58.867 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:42:58.868 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:42:58.869 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:42:58.870 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:42:58.871 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:42:58.872 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 00:42:58.873 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:42:58.874 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:42:58.875 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:42:58.875 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:42:58.876 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:42:58.877 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:42:58.878 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:42:58.878 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:42:58.879 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:42:58.880 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:42:58.881 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:42:58.882 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 00:42:58.883 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:42:58.884 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:42:58.885 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:42:58.885 +03:00 [DBG] Fetching databases for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:42:58.887 +03:00 [INF] Fetching databases for server DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 00:42:58.888 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 00:42:58.889 +03:00 [DBG] Connected to server DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 00:42:58.912 +03:00 [INF] Found 8 databases on DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 00:42:58.913 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:42:58.915 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:42:58.916 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 00:42:58.916 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 00:42:58.917 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 00:42:58.917 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[NaturalToQuery.SharedKernal.DTOs.Providers.DatabaseInfo, NaturalToQuery.SharedKernal, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-27 00:42:58.919 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.GetDatabases (NaturalToQuery.Api) in 68.7206ms
2025-08-27 00:42:58.920 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetDatabases (NaturalToQuery.Api)'
2025-08-27 00:42:58.921 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:42:58.922 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:42:58.923 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:42:58.924 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/databases - 200 null application/json; charset=utf-8 91.6202ms
2025-08-27 00:44:52.388 +03:00 [DBG] Connection id "0HNF4T2K91SQO" received FIN.
2025-08-27 00:44:52.391 +03:00 [DBG] Connection id "0HNF4T2K91SQO" accepted.
2025-08-27 00:44:52.395 +03:00 [DBG] Connection id "0HNF4T2K91SQO" started.
2025-08-27 00:44:52.396 +03:00 [DBG] Connection id "0HNF4T2K91SQP" accepted.
2025-08-27 00:44:52.400 +03:00 [DBG] Connection id "0HNF4T2K91SQO" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:44:52.401 +03:00 [DBG] Connection id "0HNF4T2K91SQP" started.
2025-08-27 00:44:52.402 +03:00 [DBG] Connection id "0HNF4T2K91SQO" disconnecting.
2025-08-27 00:44:52.403 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/convert - application/json 39
2025-08-27 00:44:52.404 +03:00 [DBG] Connection id "0HNF4T2K91SQO" stopped.
2025-08-27 00:44:52.406 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/convert'
2025-08-27 00:44:52.407 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/convert' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/convert'
2025-08-27 00:44:52.408 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:44:52.409 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/convert'.
2025-08-27 00:44:52.410 +03:00 [DBG] Connection id "0HNF4T2K91SQP" completed keep alive response.
2025-08-27 00:44:52.410 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/convert - 307 0 null 7.5667ms
2025-08-27 00:44:52.411 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/convert - application/json 39
2025-08-27 00:44:52.413 +03:00 [DBG] Connection id "0HNF4T2K91SQP", Request id "0HNF4T2K91SQP:00000001": started reading request body.
2025-08-27 00:44:52.414 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/convert'
2025-08-27 00:44:52.415 +03:00 [DBG] Connection id "0HNF4T2K91SQP", Request id "0HNF4T2K91SQP:00000001": done reading request body.
2025-08-27 00:44:52.416 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/convert' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/convert'
2025-08-27 00:44:52.418 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:44:52.419 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:44:52.422 +03:00 [INF] Route matched with {action = "ConvertNaturalLanguage", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Groq.QueryConversionResult]] ConvertNaturalLanguage(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:44:52.424 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:44:52.425 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:44:52.426 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:44:52.428 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:44:52.429 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:44:52.430 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:44:52.432 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:44:52.434 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:44:52.435 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:44:52.436 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:44:52.437 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:44:52.438 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:44:52.439 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:44:52.440 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:44:52.441 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:44:52.442 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest' ...
2025-08-27 00:44:52.443 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest' using the name '' in request data ...
2025-08-27 00:44:52.444 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:44:52.445 +03:00 [DBG] Connection id "0HNF4T2K91SQK", Request id "0HNF4T2K91SQK:00000005": started reading request body.
2025-08-27 00:44:52.446 +03:00 [DBG] Connection id "0HNF4T2K91SQK", Request id "0HNF4T2K91SQK:00000005": done reading request body.
2025-08-27 00:44:52.448 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest'
2025-08-27 00:44:52.448 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest'.
2025-08-27 00:44:52.449 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest'.
2025-08-27 00:44:52.450 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest' ...
2025-08-27 00:44:52.452 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest'.
2025-08-27 00:44:52.453 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:44:52.454 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:44:52.454 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:44:52.455 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:44:52.458 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:44:52.459 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:44:52.460 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 00:44:52.461 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:44:52.461 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:44:52.462 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:44:52.463 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:44:52.464 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:44:52.465 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:44:52.466 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:44:52.468 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:44:52.469 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:44:52.470 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 00:44:52.471 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:44:52.472 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:44:52.473 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:44:52.474 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:44:52.475 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:44:52.476 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:44:52.477 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:44:52.478 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:44:52.479 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:44:52.480 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:44:52.482 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:44:52.483 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 00:44:52.484 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:44:52.485 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:44:52.486 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:44:52.487 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 00:44:52.488 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 00:44:52.509 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 00:44:52.512 +03:00 [INF] Converting natural language to SQL. User query: Show me all Products
2025-08-27 00:44:52.514 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 00:44:52.515 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 00:44:52.521 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 00:44:53.472 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 00:44:53.479 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 00:44:53.480 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:44:53.482 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:44:53.482 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 00:44:53.482 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 00:44:53.483 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 00:44:53.484 +03:00 [INF] Executing OkObjectResult, writing value of type 'NaturalToQuery.SharedKernal.DTOs.Groq.QueryConversionResult'.
2025-08-27 00:44:53.486 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api) in 1056.105ms
2025-08-27 00:44:53.487 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:44:53.488 +03:00 [DBG] Connection id "0HNF4T2K91SQK" completed keep alive response.
2025-08-27 00:44:53.489 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:44:53.490 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:44:53.491 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:44:53.492 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/convert - 200 null application/json; charset=utf-8 1081.4057ms
2025-08-27 00:45:40.981 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/convert - application/json 53
2025-08-27 00:45:40.983 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/convert'
2025-08-27 00:45:40.984 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/convert' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/convert'
2025-08-27 00:45:40.985 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:45:40.986 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/convert'.
2025-08-27 00:45:40.987 +03:00 [DBG] Connection id "0HNF4T2K91SQP" completed keep alive response.
2025-08-27 00:45:40.988 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/convert - 307 0 null 6.4386ms
2025-08-27 00:45:40.991 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/convert - application/json 53
2025-08-27 00:45:40.995 +03:00 [DBG] Connection id "0HNF4T2K91SQP", Request id "0HNF4T2K91SQP:00000002": started reading request body.
2025-08-27 00:45:40.997 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/convert'
2025-08-27 00:45:40.998 +03:00 [DBG] Connection id "0HNF4T2K91SQP", Request id "0HNF4T2K91SQP:00000002": done reading request body.
2025-08-27 00:45:40.999 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/convert' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/convert'
2025-08-27 00:45:41.000 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:45:41.001 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:45:41.002 +03:00 [INF] Route matched with {action = "ConvertNaturalLanguage", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Groq.QueryConversionResult]] ConvertNaturalLanguage(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:45:41.003 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:45:41.004 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:45:41.005 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:45:41.006 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:45:41.007 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:45:41.008 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:45:41.010 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:45:41.011 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:45:41.011 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:45:41.012 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:45:41.013 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:45:41.014 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:45:41.015 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:45:41.016 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:45:41.017 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:45:41.017 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest' ...
2025-08-27 00:45:41.018 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest' using the name '' in request data ...
2025-08-27 00:45:41.019 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:45:41.020 +03:00 [DBG] Connection id "0HNF4T2K91SQK", Request id "0HNF4T2K91SQK:00000006": started reading request body.
2025-08-27 00:45:41.021 +03:00 [DBG] Connection id "0HNF4T2K91SQK", Request id "0HNF4T2K91SQK:00000006": done reading request body.
2025-08-27 00:45:41.022 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest'
2025-08-27 00:45:41.022 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest'.
2025-08-27 00:45:41.023 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest'.
2025-08-27 00:45:41.024 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest' ...
2025-08-27 00:45:41.024 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest'.
2025-08-27 00:45:41.026 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:45:41.027 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:45:41.027 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:45:41.028 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:45:41.029 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:45:41.030 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:45:41.030 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 00:45:41.032 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:45:41.033 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:45:41.033 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:45:41.034 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:45:41.035 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:45:41.036 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:45:41.037 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:45:41.039 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:45:41.040 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:45:41.040 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 00:45:41.041 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:45:41.042 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:45:41.044 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:45:41.045 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:45:41.045 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:45:41.046 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:45:41.047 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:45:41.048 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:45:41.048 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:45:41.050 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:45:41.052 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:45:41.052 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 00:45:41.053 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:45:41.054 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:45:41.056 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:45:41.056 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 00:45:41.057 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 00:45:41.059 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 00:45:41.060 +03:00 [INF] Converting natural language to SQL. User query: Show me all categories that i have
2025-08-27 00:45:41.060 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 00:45:41.061 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 00:45:41.062 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 00:45:41.683 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 00:45:41.686 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 00:45:41.687 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:45:41.689 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:45:41.689 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 00:45:41.690 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 00:45:41.690 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 00:45:41.691 +03:00 [INF] Executing OkObjectResult, writing value of type 'NaturalToQuery.SharedKernal.DTOs.Groq.QueryConversionResult'.
2025-08-27 00:45:41.692 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api) in 683.4756ms
2025-08-27 00:45:41.693 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:45:41.693 +03:00 [DBG] Connection id "0HNF4T2K91SQK" completed keep alive response.
2025-08-27 00:45:41.694 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:45:41.695 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:45:41.696 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:45:41.697 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/convert - 200 null application/json; charset=utf-8 705.6065ms
2025-08-27 00:49:50.480 +03:00 [DBG] Connection id "0HNF4T2K91SQL" received FIN.
2025-08-27 00:49:50.484 +03:00 [DBG] Connection id "0HNF4T2K91SQN" received FIN.
2025-08-27 00:49:50.485 +03:00 [DBG] Connection id "0HNF4T2K91SQL" disconnecting.
2025-08-27 00:49:50.493 +03:00 [DBG] Connection id "0HNF4T2K91SQL" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:49:50.497 +03:00 [DBG] Connection id "0HNF4T2K91SQN" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:49:50.497 +03:00 [DBG] Connection id "0HNF4T2K91SQN" is closed. The last processed stream ID was 3.
2025-08-27 00:49:50.498 +03:00 [DBG] Connection id "0HNF4T2K91SQL" stopped.
2025-08-27 00:49:50.500 +03:00 [DBG] The connection queue processing loop for 0HNF4T2K91SQN completed.
2025-08-27 00:49:50.501 +03:00 [DBG] Connection id "0HNF4T2K91SQN" stopped.
2025-08-27 00:53:30.273 +03:00 [INF] This is a test log to file!
2025-08-27 00:53:30.440 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 00:53:30.448 +03:00 [INF] API configured successfully.
2025-08-27 00:53:30.449 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 00:53:30.450 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 00:53:30.502 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 00:53:30.552 +03:00 [DBG] Hosting starting
2025-08-27 00:53:30.566 +03:00 [DBG] Middleware loaded
2025-08-27 00:53:30.569 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 00:53:30.571 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 00:53:30.666 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 00:53:30.670 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 00:53:30.680 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 00:53:30.719 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 00:53:30.775 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 00:53:30.777 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 00:53:30.778 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 00:53:30.779 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 00:53:30.780 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 00:53:30.780 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 00:53:30.787 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 00:53:30.789 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 00:53:30.915 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 00:53:30.916 +03:00 [INF] Hosting environment: Development
2025-08-27 00:53:30.917 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 00:53:30.918 +03:00 [DBG] Hosting started
2025-08-27 00:53:51.640 +03:00 [DBG] Connection id "0HNF4TC5MJ7VM" received FIN.
2025-08-27 00:53:51.649 +03:00 [DBG] Connection id "0HNF4TC5MJ7VM" accepted.
2025-08-27 00:53:51.674 +03:00 [DBG] Connection id "0HNF4TC5MJ7VM" started.
2025-08-27 00:53:51.676 +03:00 [DBG] Connection id "0HNF4TC5MJ7VN" accepted.
2025-08-27 00:53:51.677 +03:00 [DBG] Connection id "0HNF4TC5MJ7VN" started.
2025-08-27 00:53:51.682 +03:00 [DBG] Connection id "0HNF4TC5MJ7VM" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:53:51.685 +03:00 [DBG] Connection id "0HNF4TC5MJ7VM" disconnecting.
2025-08-27 00:53:51.687 +03:00 [DBG] Connection id "0HNF4TC5MJ7VM" stopped.
2025-08-27 00:53:51.704 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/550e8400-e29b-41d4-a716-446655440000/execute - application/json 70
2025-08-27 00:53:51.741 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/execute'
2025-08-27 00:53:51.743 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/execute'
2025-08-27 00:53:51.746 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:53:51.768 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-08-27 00:53:51.771 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/550e8400-e29b-41d4-a716-446655440000/execute'.
2025-08-27 00:53:51.778 +03:00 [DBG] Connection id "0HNF4TC5MJ7VN" completed keep alive response.
2025-08-27 00:53:51.781 +03:00 [DBG] Connection id "0HNF4TC5MJ7VO" accepted.
2025-08-27 00:53:51.781 +03:00 [DBG] Connection id "0HNF4TC5MJ7VO" received FIN.
2025-08-27 00:53:51.781 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/550e8400-e29b-41d4-a716-446655440000/execute - 307 0 null 81.4141ms
2025-08-27 00:53:51.781 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP" accepted.
2025-08-27 00:53:51.787 +03:00 [DBG] Connection id "0HNF4TC5MJ7VO" started.
2025-08-27 00:53:51.794 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP" started.
2025-08-27 00:53:51.794 +03:00 [DBG] Connection id "0HNF4TC5MJ7VN", Request id "0HNF4TC5MJ7VN:00000001": started reading request body.
2025-08-27 00:53:51.795 +03:00 [DBG] Connection id "0HNF4TC5MJ7VO" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:53:51.797 +03:00 [DBG] Connection id "0HNF4TC5MJ7VN", Request id "0HNF4TC5MJ7VN:00000001": done reading request body.
2025-08-27 00:53:51.801 +03:00 [DBG] Connection id "0HNF4TC5MJ7VO" disconnecting.
2025-08-27 00:53:51.804 +03:00 [DBG] Connection id "0HNF4TC5MJ7VO" stopped.
2025-08-27 00:53:51.828 +03:00 [DBG] Connection 0HNF4TC5MJ7VP established using the following protocol: "Tls13"
2025-08-27 00:53:51.832 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/550e8400-e29b-41d4-a716-446655440000/execute - application/json 70
2025-08-27 00:53:51.835 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/execute'
2025-08-27 00:53:51.837 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/execute'
2025-08-27 00:53:51.839 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:53:51.842 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:53:51.860 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:53:51.864 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:53:51.866 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:53:51.868 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:53:51.870 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:53:51.872 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:53:51.875 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:53:51.969 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 00:53:52.452 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:53:52.462 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:53:52.464 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:53:52.469 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:53:52.472 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:53:52.475 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:53:52.476 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:53:52.478 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:53:52.481 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:53:52.484 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 00:53:52.485 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 00:53:52.488 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:53:52.499 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:00000001": started reading request body.
2025-08-27 00:53:52.501 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:00000001": done reading request body.
2025-08-27 00:53:52.616 +03:00 [DBG] JSON input formatter threw an exception: The JSON value could not be converted to NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionMode. Path: $.mode | LineNumber: 1 | BytePositionInLine: 20.
2025-08-27 00:53:52.617 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 00:53:52.619 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 00:53:52.620 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 00:53:52.625 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 00:53:52.626 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:53:52.628 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:53:52.629 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:53:52.630 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:53:52.631 +03:00 [DBG] The request has model state errors, returning an error response.
2025-08-27 00:53:52.633 +03:00 [DBG] Request was short circuited at action filter 'Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter'.
2025-08-27 00:53:52.636 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:53:52.640 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:53:52.641 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/problem+json","application/problem+xml","application/problem+json","application/problem+xml"]'.
2025-08-27 00:53:52.643 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/problem+json' to write the response.
2025-08-27 00:53:52.645 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-08-27 00:53:52.668 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 792.0537ms
2025-08-27 00:53:52.670 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:53:52.672 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP" completed keep alive response.
2025-08-27 00:53:52.677 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:53:52.680 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/550e8400-e29b-41d4-a716-446655440000/execute - 400 null application/problem+json; charset=utf-8 848.3653ms
2025-08-27 00:54:35.526 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/550e8400-e29b-41d4-a716-446655440000/execute - application/json 61
2025-08-27 00:54:35.528 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/execute'
2025-08-27 00:54:35.529 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/execute'
2025-08-27 00:54:35.531 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:54:35.533 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/550e8400-e29b-41d4-a716-446655440000/execute'.
2025-08-27 00:54:35.534 +03:00 [DBG] Connection id "0HNF4TC5MJ7VN" completed keep alive response.
2025-08-27 00:54:35.535 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/550e8400-e29b-41d4-a716-446655440000/execute - 307 0 null 9.0183ms
2025-08-27 00:54:35.561 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/550e8400-e29b-41d4-a716-446655440000/execute - application/json 61
2025-08-27 00:54:35.563 +03:00 [DBG] Connection id "0HNF4TC5MJ7VN", Request id "0HNF4TC5MJ7VN:00000002": started reading request body.
2025-08-27 00:54:35.566 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/execute'
2025-08-27 00:54:35.567 +03:00 [DBG] Connection id "0HNF4TC5MJ7VN", Request id "0HNF4TC5MJ7VN:00000002": done reading request body.
2025-08-27 00:54:35.568 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/execute'
2025-08-27 00:54:35.571 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:54:35.572 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:54:35.573 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:54:35.576 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:54:35.578 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:54:35.579 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:54:35.581 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:54:35.583 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:54:35.585 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:54:35.628 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:54:35.629 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:54:35.630 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:54:35.632 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:54:35.633 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:54:35.634 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:54:35.635 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:54:35.636 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:54:35.637 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:54:35.639 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 00:54:35.640 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 00:54:35.641 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:54:35.642 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:00000002": started reading request body.
2025-08-27 00:54:35.643 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:00000002": done reading request body.
2025-08-27 00:54:35.646 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 00:54:35.647 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 00:54:35.649 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 00:54:35.650 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 00:54:35.655 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 00:54:35.656 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:54:35.657 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:54:35.658 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:54:35.660 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:54:35.671 +03:00 [INF] Converting NL to SQL for profile "550e8400-e29b-41d4-a716-446655440000"
2025-08-27 00:54:35.720 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-08-27 00:54:35.756 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-08-27 00:54:35.988 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<Name>k__BackingField = dataReader.GetString(3);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(4));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(5);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(6) ? default(Guid?) : (Guid?)dataReader.GetGuid(6) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(6) ? default(object) : (object)dataReader.GetGuid(6) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(6) ? default(Guid) : dataReader.GetGuid(6);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(8) ? default(string) : dataReader.GetString(8);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(10) ? default(DateTime) : dataReader.GetDateTime(10);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 00:54:36.015 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:54:36.024 +03:00 [DBG] Created DbConnection. (8ms).
2025-08-27 00:54:36.027 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:54:36.037 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:36.040 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:54:36.044 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-08-27 00:54:36.047 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2025-08-27 00:54:36.054 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:54:36.070 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:54:36.075 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:36.080 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 5ms reading results.
2025-08-27 00:54:36.083 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:36.086 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (3ms).
2025-08-27 00:54:36.343 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 757.8588ms
2025-08-27 00:54:36.374 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:54:36.419 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.ArgumentException: No profile found with id: 550e8400-e29b-41d4-a716-446655440000
   at NaturalToQuery.Application.Services.ProfileService.GetProviderTypeAsync(Guid profileId, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileService.cs:line 121
   at NaturalToQuery.Application.Services.ProfileDbService.CreateContext(Guid profileId, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 61
   at NaturalToQuery.Application.Services.ProfileDbService.GetSchemaAsync(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 45
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ConvertNaturalLanguageAsync(Guid profileId, String naturalLanguage, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 25
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ExecuteQueryAsync(Guid profileId, String naturalLanguage, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 43
   at NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery(Guid profileId, ExecuteQueryRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 58
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 00:54:36.434 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 00:54:36.440 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP" completed keep alive response.
2025-08-27 00:54:36.441 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:54:36.443 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:54:36.446 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-08-27 00:54:36.448 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/550e8400-e29b-41d4-a716-446655440000/execute - 500 null application/json; charset=utf-8 886.9821ms
2025-08-27 00:54:46.468 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 61
2025-08-27 00:54:46.471 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 00:54:46.473 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 00:54:46.474 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:54:46.476 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 00:54:46.477 +03:00 [DBG] Connection id "0HNF4TC5MJ7VN" completed keep alive response.
2025-08-27 00:54:46.478 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 10.1014ms
2025-08-27 00:54:46.478 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 61
2025-08-27 00:54:46.480 +03:00 [DBG] Connection id "0HNF4TC5MJ7VN", Request id "0HNF4TC5MJ7VN:00000003": started reading request body.
2025-08-27 00:54:46.482 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 00:54:46.483 +03:00 [DBG] Connection id "0HNF4TC5MJ7VN", Request id "0HNF4TC5MJ7VN:00000003": done reading request body.
2025-08-27 00:54:46.484 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 00:54:46.487 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:54:46.488 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:54:46.490 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:54:46.491 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:54:46.493 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:54:46.494 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:54:46.495 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:54:46.497 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:54:46.498 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:54:46.510 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:54:46.513 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:54:46.514 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:54:46.515 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:54:46.516 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:54:46.517 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:54:46.518 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:54:46.519 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:54:46.520 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:54:46.521 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 00:54:46.523 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 00:54:46.524 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:54:46.525 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:00000003": started reading request body.
2025-08-27 00:54:46.527 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:00000003": done reading request body.
2025-08-27 00:54:46.528 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 00:54:46.529 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 00:54:46.530 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 00:54:46.532 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 00:54:46.533 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 00:54:46.534 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:54:46.535 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:54:46.536 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:54:46.537 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:54:46.538 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:54:46.541 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:54:46.542 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 00:54:46.543 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:54:46.544 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:46.545 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:54:46.546 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:54:46.548 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 00:54:46.549 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:54:46.551 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:54:46.583 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:54:46.603 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:46.605 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 52ms reading results.
2025-08-27 00:54:46.607 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:46.608 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:54:46.616 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:54:46.617 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:54:46.618 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:46.619 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:54:46.619 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:54:46.620 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:54:46.621 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:54:46.623 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:54:46.626 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:46.627 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 00:54:46.628 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:46.629 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:54:46.639 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:54:46.650 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 00:54:46.653 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 00:54:46.778 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 00:54:46.801 +03:00 [INF] Converting natural language to SQL. User query: Show me top 5 categories
2025-08-27 00:54:46.803 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 00:54:46.804 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 00:54:46.810 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 00:54:47.529 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 00:54:47.539 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 00:54:47.541 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:54:47.543 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:47.544 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:54:47.544 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:54:47.546 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 00:54:47.547 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:54:47.549 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:54:47.552 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:47.553 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 00:54:47.555 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:47.556 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:54:47.558 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:54:47.559 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:54:47.560 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:47.561 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:54:47.562 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:54:47.563 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 00:54:47.564 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:54:47.566 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:54:47.568 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:47.568 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 00:54:47.570 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:47.571 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:54:47.572 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:54:47.573 +03:00 [INF] Executing SQL for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", Mode="ReadOnly"
2025-08-27 00:54:47.581 +03:00 [INF] Executing SQL on DESKTOP-QCK8UI5\SQLEXPRESS/ProductInventory (Mode="ReadOnly")
2025-08-27 00:54:47.582 +03:00 [DBG] SQL: SELECT TOP 5 C.Name FROM Categories C;
2025-08-27 00:54:47.584 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 00:54:47.741 +03:00 [DBG] Connection opened to DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 00:54:47.787 +03:00 [INF] Query execution finished in 203 ms, returned 5 rows
2025-08-27 00:54:47.796 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:54:47.797 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:47.798 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:54:47.798 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:54:47.799 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:54:47.800 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:54:47.802 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:54:47.803 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:47.804 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 00:54:47.805 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:47.806 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:54:47.823 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Any(p => (int)p.Provider == (int)__profile_Provider_0)'
2025-08-27 00:54:47.829 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 00:54:47.834 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:54:47.835 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:47.836 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:54:47.837 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:54:47.839 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 00:54:47.840 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:54:47.841 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:54:47.843 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:47.844 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 00:54:47.846 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:54:47.846 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:54:47.898 +03:00 [ERR] Failed to persist query to DB for userQuery=Show me top 5 categories
2025-08-27 00:54:47.901 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:54:47.903 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:54:47.903 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 00:54:47.904 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 00:54:47.904 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 00:54:47.905 +03:00 [INF] Executing OkObjectResult, writing value of type 'NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult'.
2025-08-27 00:54:47.907 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 1409.4051ms
2025-08-27 00:54:47.908 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:54:47.911 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP" completed keep alive response.
2025-08-27 00:54:47.913 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:54:47.914 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:54:47.916 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:54:47.917 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 200 null application/json; charset=utf-8 1439.2482ms
2025-08-27 00:56:10.444 +03:00 [DBG] Connection id "0HNF4TC5MJ7VQ" received FIN.
2025-08-27 00:56:10.445 +03:00 [DBG] Connection id "0HNF4TC5MJ7VQ" accepted.
2025-08-27 00:56:10.451 +03:00 [DBG] Connection id "0HNF4TC5MJ7VQ" started.
2025-08-27 00:56:10.451 +03:00 [DBG] Connection id "0HNF4TC5MJ7VR" accepted.
2025-08-27 00:56:10.457 +03:00 [DBG] Connection id "0HNF4TC5MJ7VQ" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 00:56:10.457 +03:00 [DBG] Connection id "0HNF4TC5MJ7VR" started.
2025-08-27 00:56:10.458 +03:00 [DBG] Connection id "0HNF4TC5MJ7VQ" disconnecting.
2025-08-27 00:56:10.459 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 61
2025-08-27 00:56:10.460 +03:00 [DBG] Connection id "0HNF4TC5MJ7VQ" stopped.
2025-08-27 00:56:10.461 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 00:56:10.462 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 00:56:10.463 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:56:10.464 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 00:56:10.464 +03:00 [DBG] Connection id "0HNF4TC5MJ7VR" completed keep alive response.
2025-08-27 00:56:10.465 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 6.1595ms
2025-08-27 00:56:10.465 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 61
2025-08-27 00:56:10.467 +03:00 [DBG] Connection id "0HNF4TC5MJ7VR", Request id "0HNF4TC5MJ7VR:00000001": started reading request body.
2025-08-27 00:56:10.468 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 00:56:10.469 +03:00 [DBG] Connection id "0HNF4TC5MJ7VR", Request id "0HNF4TC5MJ7VR:00000001": done reading request body.
2025-08-27 00:56:10.470 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 00:56:10.472 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:56:10.473 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:56:10.473 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:56:10.474 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:56:10.475 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:56:10.476 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:56:10.477 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:56:10.478 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:56:10.479 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:56:10.480 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:56:10.481 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:56:10.482 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:56:10.483 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:56:10.484 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:56:10.485 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:56:10.485 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:56:10.486 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:56:10.487 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:56:10.488 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 00:56:10.488 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 00:56:10.489 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:56:10.490 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:00000004": started reading request body.
2025-08-27 00:56:10.491 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:00000004": done reading request body.
2025-08-27 00:56:10.492 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 00:56:10.492 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 00:56:10.493 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 00:56:10.494 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 00:56:10.495 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 00:56:10.496 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:56:10.496 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:56:10.497 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:56:10.498 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:56:10.499 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:56:10.500 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:56:10.501 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 00:56:10.502 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:56:10.502 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:56:10.503 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:56:10.504 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:56:10.504 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:56:10.505 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:56:10.507 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:56:10.508 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:56:10.509 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:56:10.510 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 00:56:10.511 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:56:10.512 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:56:10.513 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:56:10.514 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:56:10.515 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:56:10.516 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:56:10.516 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:56:10.517 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:56:10.518 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:56:10.519 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:56:10.521 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:56:10.522 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 00:56:10.523 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:56:10.523 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:56:10.525 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:56:10.526 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 00:56:10.526 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 00:56:10.528 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 00:56:10.534 +03:00 [INF] Converting natural language to SQL. User query: Show me top 5 categories
2025-08-27 00:56:10.534 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 00:56:10.535 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 00:56:10.536 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 00:56:11.462 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 00:56:11.463 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 00:56:11.464 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:56:11.465 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:56:11.466 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:56:11.467 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:56:11.468 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:56:11.468 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:56:11.470 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:56:11.471 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:56:11.472 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 00:56:11.473 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:56:11.474 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:56:11.475 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:56:11.476 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:56:11.477 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:56:11.478 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:56:11.478 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:56:11.479 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:56:11.480 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:56:11.481 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:56:11.482 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:56:11.483 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 00:56:11.484 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:56:11.485 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:56:11.487 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:56:11.487 +03:00 [INF] Executing SQL for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", Mode="ReadOnly"
2025-08-27 00:56:11.488 +03:00 [INF] Executing SQL on DESKTOP-QCK8UI5\SQLEXPRESS/ProductInventory (Mode="ReadOnly")
2025-08-27 00:56:11.489 +03:00 [DBG] SQL: SELECT TOP 5 C.Name FROM Categories C;
2025-08-27 00:56:11.490 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 00:56:11.492 +03:00 [DBG] Connection opened to DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 00:56:53.265 +03:00 [INF] Query execution finished in 41774 ms, returned 5 rows
2025-08-27 00:56:53.296 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:56:53.297 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:56:53.298 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:56:53.298 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:56:53.299 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:56:53.301 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:56:53.302 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:56:53.303 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:56:53.304 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 00:56:53.305 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:56:53.305 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:56:53.307 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:56:53.308 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:56:53.309 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:56:53.309 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:56:53.310 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:56:53.311 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:56:53.312 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:56:53.314 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:56:53.314 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 00:56:53.315 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:56:53.316 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:56:53.351 +03:00 [ERR] Failed to persist query to DB for userQuery=Show me top 5 categories
2025-08-27 00:56:53.351 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:56:53.353 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:56:53.353 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 00:56:53.354 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 00:56:53.354 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 00:56:53.355 +03:00 [INF] Executing OkObjectResult, writing value of type 'NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult'.
2025-08-27 00:56:53.356 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 42877.0225ms
2025-08-27 00:56:53.357 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:56:53.357 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP" completed keep alive response.
2025-08-27 00:56:53.358 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:56:53.359 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:56:53.393 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (33ms).
2025-08-27 00:56:53.409 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 200 null application/json; charset=utf-8 42943.7963ms
2025-08-27 00:57:06.979 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 90
2025-08-27 00:57:06.981 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 00:57:06.982 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 00:57:06.983 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:57:06.985 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 00:57:06.986 +03:00 [DBG] Connection id "0HNF4TC5MJ7VR" completed keep alive response.
2025-08-27 00:57:06.988 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 90
2025-08-27 00:57:06.989 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 10.2945ms
2025-08-27 00:57:06.992 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 00:57:06.995 +03:00 [DBG] Connection id "0HNF4TC5MJ7VR", Request id "0HNF4TC5MJ7VR:00000002": started reading request body.
2025-08-27 00:57:06.997 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 00:57:06.998 +03:00 [DBG] Connection id "0HNF4TC5MJ7VR", Request id "0HNF4TC5MJ7VR:00000002": done reading request body.
2025-08-27 00:57:06.999 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:57:07.002 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:57:07.003 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:57:07.004 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:57:07.006 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:57:07.008 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:57:07.010 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:57:07.012 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:57:07.014 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:57:07.016 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:57:07.018 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:57:07.018 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:57:07.019 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:57:07.021 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:57:07.022 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:57:07.024 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:57:07.025 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:57:07.026 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:57:07.027 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 00:57:07.028 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 00:57:07.029 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:57:07.031 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:00000005": started reading request body.
2025-08-27 00:57:07.031 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:00000005": done reading request body.
2025-08-27 00:57:07.032 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 00:57:07.033 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 00:57:07.034 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 00:57:07.035 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 00:57:07.036 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 00:57:07.036 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:57:07.037 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:57:07.038 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:57:07.039 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:57:07.040 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:57:07.041 +03:00 [DBG] Creating DbConnection.
2025-08-27 00:57:07.041 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 00:57:07.042 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:57:07.043 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:57:07.043 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:57:07.044 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:57:07.045 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:57:07.046 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:57:07.047 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:57:07.049 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 00:57:07.050 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:57:07.050 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 00:57:07.052 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:57:07.052 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:57:07.054 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:57:07.054 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:57:07.055 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:57:07.056 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:57:07.057 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:57:07.058 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 00:57:07.059 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:57:07.061 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:57:07.062 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:57:07.063 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 00:57:07.065 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:57:07.066 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:57:07.067 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:57:07.068 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 00:57:07.068 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 00:57:07.070 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 00:57:07.071 +03:00 [INF] Converting natural language to SQL. User query: Show me top 5 categories include all the columns data
2025-08-27 00:57:07.072 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 00:57:07.072 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 00:57:07.073 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 00:57:07.917 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 00:57:07.918 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 00:57:07.919 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:57:07.920 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:57:07.921 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:57:07.922 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:57:07.922 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:57:07.923 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:57:07.925 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:57:07.926 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:57:07.927 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 00:57:07.928 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:57:07.929 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:57:07.930 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:57:07.931 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:57:07.932 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:57:07.932 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:57:07.933 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:57:07.934 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:57:07.934 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:57:07.936 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:57:07.937 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:57:07.938 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 00:57:07.939 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:57:07.940 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:57:07.941 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 00:57:07.941 +03:00 [INF] Executing SQL for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", Mode="ReadOnly"
2025-08-27 00:57:07.943 +03:00 [INF] Executing SQL on DESKTOP-QCK8UI5\SQLEXPRESS/ProductInventory (Mode="ReadOnly")
2025-08-27 00:57:07.944 +03:00 [DBG] SQL: SELECT * FROM Categories ORDER BY Id OFFSET 0 ROWS FETCH NEXT 5 ROWS ONLY;
2025-08-27 00:57:07.944 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 00:57:07.945 +03:00 [DBG] Connection opened to DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 00:57:09.320 +03:00 [INF] Query execution finished in 1376 ms, returned 5 rows
2025-08-27 00:57:09.322 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:57:09.323 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:57:09.324 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:57:09.325 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:57:09.326 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:57:09.327 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:57:09.328 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 00:57:09.330 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:57:09.331 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 00:57:09.332 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:57:09.333 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:57:09.335 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:57:09.336 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:57:09.337 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 00:57:09.338 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 00:57:09.338 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 00:57:09.339 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:57:09.340 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 00:57:09.342 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:57:09.343 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 00:57:09.344 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 00:57:09.346 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 00:57:09.393 +03:00 [ERR] Failed to persist query to DB for userQuery=Show me top 5 categories include all the columns data
2025-08-27 00:57:09.394 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:57:09.396 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:57:09.397 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 00:57:09.397 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 00:57:09.398 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 00:57:09.399 +03:00 [INF] Executing OkObjectResult, writing value of type 'NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult'.
2025-08-27 00:57:09.400 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 2385.8971ms
2025-08-27 00:57:09.400 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 00:57:09.401 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP" completed keep alive response.
2025-08-27 00:57:09.402 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:57:09.403 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 00:57:09.404 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 00:57:09.405 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 200 null application/json; charset=utf-8 2416.9144ms
2025-08-27 00:57:45.589 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/query/00000000-0000-0000-0000-000000000000/schema - null null
2025-08-27 00:57:45.590 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/00000000-0000-0000-0000-000000000000/schema'
2025-08-27 00:57:45.591 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/schema' is valid for the request path '/api/query/00000000-0000-0000-0000-000000000000/schema'
2025-08-27 00:57:45.593 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:57:45.596 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/00000000-0000-0000-0000-000000000000/schema'.
2025-08-27 00:57:45.597 +03:00 [DBG] Connection id "0HNF4TC5MJ7VR" completed keep alive response.
2025-08-27 00:57:45.598 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/query/00000000-0000-0000-0000-000000000000/schema - 307 0 null 8.8967ms
2025-08-27 00:57:45.624 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7202/api/query/00000000-0000-0000-0000-000000000000/schema - null null
2025-08-27 00:57:45.627 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/00000000-0000-0000-0000-000000000000/schema'
2025-08-27 00:57:45.628 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/schema' is valid for the request path '/api/query/00000000-0000-0000-0000-000000000000/schema'
2025-08-27 00:57:45.629 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:57:45.630 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:57:45.633 +03:00 [INF] Route matched with {action = "GetSchema", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.SchemaModel]] GetSchema(System.Guid, Boolean, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:57:45.635 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:57:45.635 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:57:45.636 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:57:45.637 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:57:45.638 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:57:45.639 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:57:45.640 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:57:45.641 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:57:45.642 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:57:45.643 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:57:45.643 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:57:45.644 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:57:45.645 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:57:45.646 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:57:45.647 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:57:45.648 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:57:45.649 +03:00 [DBG] Attempting to bind parameter 'forceRefresh' of type 'System.Boolean' using the name '' in request data ...
2025-08-27 00:57:45.650 +03:00 [DBG] Could not find a value in the request with name '' for binding parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:57:45.651 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:57:45.652 +03:00 [DBG] Done attempting to bind parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:57:45.653 +03:00 [DBG] Attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean' ...
2025-08-27 00:57:45.653 +03:00 [DBG] Done attempting to validate the bound parameter 'forceRefresh' of type 'System.Boolean'.
2025-08-27 00:57:45.654 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:57:45.655 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:57:45.656 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:57:45.656 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:57:45.658 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:57:45.659 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:57:45.660 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 00:57:45.660 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 00:57:45.661 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 00:57:45.662 +03:00 [INF] Executing BadRequestObjectResult, writing value of type '<>f__AnonymousType1`1[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-27 00:57:45.663 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api) in 24.181ms
2025-08-27 00:57:45.664 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.GetSchema (NaturalToQuery.Api)'
2025-08-27 00:57:45.665 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP" completed keep alive response.
2025-08-27 00:57:45.666 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:57:45.667 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7202/api/query/00000000-0000-0000-0000-000000000000/schema - 400 null application/json; charset=utf-8 45.1482ms
2025-08-27 00:58:15.416 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/550e8400-e29b-41d4-a716-446655440000/convert - null 0
2025-08-27 00:58:15.418 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/convert'
2025-08-27 00:58:15.419 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/convert' is valid for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/convert'
2025-08-27 00:58:15.420 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:58:15.421 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/550e8400-e29b-41d4-a716-446655440000/convert'.
2025-08-27 00:58:15.421 +03:00 [DBG] Connection id "0HNF4TC5MJ7VR" completed keep alive response.
2025-08-27 00:58:15.422 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/550e8400-e29b-41d4-a716-446655440000/convert - 307 0 null 6.5419ms
2025-08-27 00:58:15.423 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/550e8400-e29b-41d4-a716-446655440000/convert - null 0
2025-08-27 00:58:15.430 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/convert'
2025-08-27 00:58:15.430 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/convert' is valid for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/convert'
2025-08-27 00:58:15.431 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:58:15.432 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:58:15.435 +03:00 [INF] Route matched with {action = "ConvertNaturalLanguage", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Groq.QueryConversionResult]] ConvertNaturalLanguage(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:58:15.436 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:58:15.439 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:58:15.439 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:58:15.441 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:58:15.442 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:58:15.443 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:58:15.444 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:58:15.445 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:58:15.446 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:58:15.447 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:58:15.448 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:58:15.449 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:58:15.450 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:58:15.451 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:58:15.451 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:58:15.452 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest' ...
2025-08-27 00:58:15.453 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest' using the name '' in request data ...
2025-08-27 00:58:15.454 +03:00 [DBG] Rejected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'null'.
2025-08-27 00:58:15.455 +03:00 [DBG] No input formatter was found to support the content type 'null' for use with the [FromBody] attribute.
2025-08-27 00:58:15.456 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest'.
2025-08-27 00:58:15.456 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest'.
2025-08-27 00:58:15.457 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest' ...
2025-08-27 00:58:15.458 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest'.
2025-08-27 00:58:15.459 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:58:15.460 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:58:15.461 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:58:15.462 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:58:15.463 +03:00 [DBG] Request was short circuited at action filter 'Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter'.
2025-08-27 00:58:15.464 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:58:15.466 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:58:15.467 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/problem+json","application/problem+xml","application/problem+json","application/problem+xml"]'.
2025-08-27 00:58:15.468 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/problem+json' to write the response.
2025-08-27 00:58:15.469 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-08-27 00:58:15.471 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api) in 28.0718ms
2025-08-27 00:58:15.472 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:58:15.473 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP" completed keep alive response.
2025-08-27 00:58:15.473 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:58:15.474 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/550e8400-e29b-41d4-a716-446655440000/convert - 415 null application/problem+json; charset=utf-8 51.1681ms
2025-08-27 00:58:24.987 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/550e8400-e29b-41d4-a716-446655440000/convert - null 0
2025-08-27 00:58:24.989 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/convert'
2025-08-27 00:58:24.990 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/convert' is valid for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/convert'
2025-08-27 00:58:24.991 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:58:24.992 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/550e8400-e29b-41d4-a716-446655440000/convert'.
2025-08-27 00:58:24.993 +03:00 [DBG] Connection id "0HNF4TC5MJ7VR" completed keep alive response.
2025-08-27 00:58:24.994 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/550e8400-e29b-41d4-a716-446655440000/convert - 307 0 null 6.1736ms
2025-08-27 00:58:24.994 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/550e8400-e29b-41d4-a716-446655440000/convert - null 0
2025-08-27 00:58:24.998 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/convert'
2025-08-27 00:58:24.999 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/convert' is valid for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/convert'
2025-08-27 00:58:25.000 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:58:25.001 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:58:25.001 +03:00 [INF] Route matched with {action = "ConvertNaturalLanguage", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Groq.QueryConversionResult]] ConvertNaturalLanguage(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:58:25.003 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:58:25.004 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:58:25.005 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:58:25.006 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:58:25.007 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:58:25.008 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:58:25.009 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:58:25.011 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:58:25.011 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:58:25.012 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:58:25.013 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:58:25.014 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:58:25.015 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:58:25.016 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:58:25.016 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:58:25.017 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest' ...
2025-08-27 00:58:25.018 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest' using the name '' in request data ...
2025-08-27 00:58:25.019 +03:00 [DBG] Rejected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'null'.
2025-08-27 00:58:25.020 +03:00 [DBG] No input formatter was found to support the content type 'null' for use with the [FromBody] attribute.
2025-08-27 00:58:25.020 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest'.
2025-08-27 00:58:25.021 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest'.
2025-08-27 00:58:25.022 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest' ...
2025-08-27 00:58:25.023 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest'.
2025-08-27 00:58:25.024 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:58:25.025 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:58:25.026 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:58:25.027 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:58:25.028 +03:00 [DBG] Request was short circuited at action filter 'Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter'.
2025-08-27 00:58:25.029 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:58:25.030 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:58:25.030 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/problem+json","application/problem+xml","application/problem+json","application/problem+xml"]'.
2025-08-27 00:58:25.032 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/problem+json' to write the response.
2025-08-27 00:58:25.033 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-08-27 00:58:25.034 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api) in 26.0726ms
2025-08-27 00:58:25.035 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:58:25.036 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP" completed keep alive response.
2025-08-27 00:58:25.037 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:58:25.038 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/550e8400-e29b-41d4-a716-446655440000/convert - 415 null application/problem+json; charset=utf-8 44.0038ms
2025-08-27 00:58:28.901 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/550e8400-e29b-41d4-a716-446655440000/convert - application/json 2
2025-08-27 00:58:28.903 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/convert'
2025-08-27 00:58:28.904 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/convert' is valid for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/convert'
2025-08-27 00:58:28.905 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:58:28.906 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/550e8400-e29b-41d4-a716-446655440000/convert'.
2025-08-27 00:58:28.906 +03:00 [DBG] Connection id "0HNF4TC5MJ7VR" completed keep alive response.
2025-08-27 00:58:28.909 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/550e8400-e29b-41d4-a716-446655440000/convert - application/json 2
2025-08-27 00:58:28.909 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/550e8400-e29b-41d4-a716-446655440000/convert - 307 0 null 9.0167ms
2025-08-27 00:58:28.911 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/convert'
2025-08-27 00:58:28.913 +03:00 [DBG] Connection id "0HNF4TC5MJ7VR", Request id "0HNF4TC5MJ7VR:00000006": started reading request body.
2025-08-27 00:58:28.914 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/convert' is valid for the request path '/api/query/550e8400-e29b-41d4-a716-446655440000/convert'
2025-08-27 00:58:28.915 +03:00 [DBG] Connection id "0HNF4TC5MJ7VR", Request id "0HNF4TC5MJ7VR:00000006": done reading request body.
2025-08-27 00:58:28.916 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:58:28.917 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:58:28.918 +03:00 [INF] Route matched with {action = "ConvertNaturalLanguage", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Groq.QueryConversionResult]] ConvertNaturalLanguage(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 00:58:28.919 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:58:28.920 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:58:28.921 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:58:28.922 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:58:28.923 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:58:28.924 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:58:28.925 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:58:28.926 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 00:58:28.926 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 00:58:28.927 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:58:28.928 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 00:58:28.929 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:58:28.930 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:58:28.930 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 00:58:28.931 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 00:58:28.932 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest' ...
2025-08-27 00:58:28.933 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest' using the name '' in request data ...
2025-08-27 00:58:28.933 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 00:58:28.935 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:00000009": started reading request body.
2025-08-27 00:58:28.935 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:00000009": done reading request body.
2025-08-27 00:58:28.936 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest'
2025-08-27 00:58:28.937 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest'.
2025-08-27 00:58:28.938 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest'.
2025-08-27 00:58:28.939 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest' ...
2025-08-27 00:58:28.940 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.NaturalLanguageRequest'.
2025-08-27 00:58:28.941 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:58:28.941 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:58:28.942 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:58:28.943 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:58:28.944 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:58:28.945 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:58:28.946 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 00:58:28.946 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 00:58:28.947 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 00:58:28.948 +03:00 [INF] Executing BadRequestObjectResult, writing value of type '<>f__AnonymousType1`1[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-27 00:58:28.948 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api) in 24.7473ms
2025-08-27 00:58:28.949 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ConvertNaturalLanguage (NaturalToQuery.Api)'
2025-08-27 00:58:28.950 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP" completed keep alive response.
2025-08-27 00:58:28.951 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:58:28.951 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/550e8400-e29b-41d4-a716-446655440000/convert - 400 null application/json; charset=utf-8 42.3041ms
2025-08-27 00:58:53.930 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/setup/servers/InvalidProvider - null null
2025-08-27 00:58:53.937 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/servers/InvalidProvider'
2025-08-27 00:58:53.937 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.GetAvailableServers (NaturalToQuery.Api)' with route pattern 'api/Setup/servers/{type}' is valid for the request path '/api/setup/servers/InvalidProvider'
2025-08-27 00:58:53.938 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.GetAvailableServers (NaturalToQuery.Api)'
2025-08-27 00:58:53.939 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/setup/servers/InvalidProvider'.
2025-08-27 00:58:53.940 +03:00 [DBG] Connection id "0HNF4TC5MJ7VR" completed keep alive response.
2025-08-27 00:58:53.941 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/setup/servers/InvalidProvider - 307 0 null 10.9463ms
2025-08-27 00:58:53.947 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7202/api/setup/servers/InvalidProvider - null null
2025-08-27 00:58:53.951 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/servers/InvalidProvider'
2025-08-27 00:58:53.952 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.SetupController.GetAvailableServers (NaturalToQuery.Api)' with route pattern 'api/Setup/servers/{type}' is valid for the request path '/api/setup/servers/InvalidProvider'
2025-08-27 00:58:53.953 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.SetupController.GetAvailableServers (NaturalToQuery.Api)'
2025-08-27 00:58:53.954 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.SetupController.GetAvailableServers (NaturalToQuery.Api)'
2025-08-27 00:58:53.957 +03:00 [INF] Route matched with {action = "GetAvailableServers", controller = "Setup"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[NaturalToQuery.SharedKernal.DTOs.Providers.ServerInfo]]] GetAvailableServers(NaturalToQuery.Core.Contributers.Entities.ProviderType, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api).
2025-08-27 00:58:53.959 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 00:58:53.960 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 00:58:53.961 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 00:58:53.963 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 00:58:53.964 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 00:58:53.965 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:58:53.967 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 00:58:53.969 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.SetupController (NaturalToQuery.Api)
2025-08-27 00:58:53.970 +03:00 [DBG] Attempting to bind parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType' ...
2025-08-27 00:58:53.971 +03:00 [DBG] Attempting to bind parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType' using the name 'type' in request data ...
2025-08-27 00:58:54.016 +03:00 [DBG] Done attempting to bind parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType'.
2025-08-27 00:58:54.017 +03:00 [DBG] Done attempting to bind parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType'.
2025-08-27 00:58:54.018 +03:00 [DBG] Attempting to validate the bound parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType' ...
2025-08-27 00:58:54.019 +03:00 [DBG] Done attempting to validate the bound parameter 'type' of type 'NaturalToQuery.Core.Contributers.Entities.ProviderType'.
2025-08-27 00:58:54.020 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:58:54.021 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:58:54.021 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 00:58:54.022 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 00:58:54.023 +03:00 [DBG] The request has model state errors, returning an error response.
2025-08-27 00:58:54.024 +03:00 [DBG] Request was short circuited at action filter 'Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter'.
2025-08-27 00:58:54.025 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 00:58:54.026 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 00:58:54.027 +03:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/problem+json","application/problem+xml","application/problem+json","application/problem+xml"]'.
2025-08-27 00:58:54.028 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/problem+json' to write the response.
2025-08-27 00:58:54.029 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-08-27 00:58:54.030 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.SetupController.GetAvailableServers (NaturalToQuery.Api) in 65.152ms
2025-08-27 00:58:54.031 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.SetupController.GetAvailableServers (NaturalToQuery.Api)'
2025-08-27 00:58:54.032 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP" completed keep alive response.
2025-08-27 00:58:54.033 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 00:58:54.034 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7202/api/setup/servers/InvalidProvider - 400 null application/problem+json; charset=utf-8 89.5837ms
2025-08-27 01:00:41.965 +03:00 [DBG] Connection id "0HNF4TC5MJ7VS" received FIN.
2025-08-27 01:00:41.967 +03:00 [DBG] Connection id "0HNF4TC5MJ7VS" accepted.
2025-08-27 01:00:41.973 +03:00 [DBG] Connection id "0HNF4TC5MJ7VS" started.
2025-08-27 01:00:41.973 +03:00 [DBG] Connection id "0HNF4TC5MJ7VT" accepted.
2025-08-27 01:00:41.978 +03:00 [DBG] Connection id "0HNF4TC5MJ7VS" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:00:41.979 +03:00 [DBG] Connection id "0HNF4TC5MJ7VT" started.
2025-08-27 01:00:41.980 +03:00 [DBG] Connection id "0HNF4TC5MJ7VS" disconnecting.
2025-08-27 01:00:41.981 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:00:41.981 +03:00 [DBG] Connection id "0HNF4TC5MJ7VS" stopped.
2025-08-27 01:00:41.983 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:00:41.984 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:00:41.985 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:00:41.985 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:00:41.986 +03:00 [DBG] Connection id "0HNF4TC5MJ7VT" completed keep alive response.
2025-08-27 01:00:41.987 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 6.5377ms
2025-08-27 01:00:41.987 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:00:41.989 +03:00 [DBG] Connection id "0HNF4TC5MJ7VT", Request id "0HNF4TC5MJ7VT:00000001": started reading request body.
2025-08-27 01:00:41.990 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:00:41.991 +03:00 [DBG] Connection id "0HNF4TC5MJ7VT", Request id "0HNF4TC5MJ7VT:00000001": done reading request body.
2025-08-27 01:00:41.992 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:00:41.994 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:00:41.994 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:00:41.995 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:00:41.996 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:00:41.997 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:00:41.998 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:00:42.000 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:00:42.001 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:00:42.001 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:00:42.003 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:00:42.004 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:00:42.005 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:00:42.006 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:00:42.007 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:00:42.007 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:00:42.008 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:00:42.009 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:00:42.010 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:00:42.011 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:00:42.011 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:00:42.012 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:00:42.013 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:0000000B": started reading request body.
2025-08-27 01:00:42.014 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:0000000B": done reading request body.
2025-08-27 01:00:42.015 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:00:42.015 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:00:42.016 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:00:42.017 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:00:42.018 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:00:42.019 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:00:42.019 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:00:42.020 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:00:42.021 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:00:42.021 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:00:42.022 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:00:42.023 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 01:00:42.024 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:00:42.024 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:00:42.025 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:00:42.026 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:00:42.026 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:00:42.027 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:00:42.029 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:00:42.030 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:00:42.031 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:00:42.032 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:00:42.033 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:00:42.033 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:00:42.034 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:00:42.035 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:00:42.036 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:00:42.037 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:00:42.037 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:00:42.038 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:00:42.039 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:00:42.040 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:00:42.042 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:00:42.042 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:00:42.043 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:00:42.044 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:00:42.045 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:00:42.046 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:00:42.047 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:00:42.048 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:00:42.054 +03:00 [INF] Converting natural language to SQL. User query: Delete products that is in category called samsung
2025-08-27 01:00:42.054 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:00:42.055 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:00:42.056 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:00:43.134 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:00:43.136 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:00:43.394 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 1392.3334ms
2025-08-27 01:00:43.480 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:00:43.637 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Conversion produced no SQL.
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ExecuteQueryAsync(Guid profileId, String naturalLanguage, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 47
   at NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery(Guid profileId, ExecuteQueryRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 58
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 01:00:43.641 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 01:00:43.642 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP" completed keep alive response.
2025-08-27 01:00:43.643 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:00:43.644 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:00:43.644 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:00:43.645 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 500 null application/json; charset=utf-8 1658.0515ms
2025-08-27 01:01:57.463 +03:00 [DBG] Connection id "0HNF4TC5MJ7VU" accepted.
2025-08-27 01:01:57.468 +03:00 [DBG] Connection id "0HNF4TC5MJ7VU" received FIN.
2025-08-27 01:01:57.474 +03:00 [DBG] Connection id "0HNF4TC5MJ7VV" accepted.
2025-08-27 01:01:57.474 +03:00 [DBG] Connection id "0HNF4TC5MJ7VU" started.
2025-08-27 01:01:57.479 +03:00 [DBG] Connection id "0HNF4TC5MJ7VV" started.
2025-08-27 01:01:57.480 +03:00 [DBG] Connection id "0HNF4TC5MJ7VU" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:01:57.481 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:01:57.481 +03:00 [DBG] Connection id "0HNF4TC5MJ7VU" disconnecting.
2025-08-27 01:01:57.483 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:01:57.483 +03:00 [DBG] Connection id "0HNF4TC5MJ7VU" stopped.
2025-08-27 01:01:57.484 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:01:57.486 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:01:57.486 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:01:57.488 +03:00 [DBG] Connection id "0HNF4TC5MJ7VV" completed keep alive response.
2025-08-27 01:01:57.489 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 8.0629ms
2025-08-27 01:01:57.489 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:01:57.491 +03:00 [DBG] Connection id "0HNF4TC5MJ7VV", Request id "0HNF4TC5MJ7VV:00000001": started reading request body.
2025-08-27 01:01:57.493 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:01:57.493 +03:00 [DBG] Connection id "0HNF4TC5MJ7VV", Request id "0HNF4TC5MJ7VV:00000001": done reading request body.
2025-08-27 01:01:57.494 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:01:57.496 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:01:57.497 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:01:57.497 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:01:57.498 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:01:57.499 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:01:57.500 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:01:57.502 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:01:57.503 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:01:57.504 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:01:57.505 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:01:57.506 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:01:57.507 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:01:57.508 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:01:57.509 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:01:57.509 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:01:57.510 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:01:57.511 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:01:57.512 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:01:57.513 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:01:57.514 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:01:57.515 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:01:57.516 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:0000000C": started reading request body.
2025-08-27 01:01:57.517 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:0000000C": done reading request body.
2025-08-27 01:01:57.518 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:01:57.519 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:01:57.520 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:01:57.521 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:01:57.522 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:01:57.522 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:01:57.524 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:01:57.524 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:01:57.525 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:01:57.526 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:01:57.527 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:01:57.527 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 01:01:57.528 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:01:57.529 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:01:57.530 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:01:57.530 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:01:57.531 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:01:57.532 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:01:57.533 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:01:57.534 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:01:57.535 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:01:57.537 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 01:01:57.538 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:01:57.538 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:01:57.540 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:01:57.540 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:01:57.541 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:01:57.542 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:01:57.543 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:01:57.544 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:01:57.545 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:01:57.546 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:01:57.547 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:01:57.548 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:01:57.549 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:01:57.550 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:01:57.551 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:01:57.552 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:01:57.553 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:01:57.554 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:01:57.555 +03:00 [INF] Converting natural language to SQL. User query: Delete products that is in category called samsung
2025-08-27 01:01:57.556 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:01:57.556 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:01:57.557 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:01:58.545 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:01:58.547 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:01:58.800 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 1296.7378ms
2025-08-27 01:01:58.881 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:01:59.029 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Conversion produced no SQL.
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ExecuteQueryAsync(Guid profileId, String naturalLanguage, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 47
   at NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery(Guid profileId, ExecuteQueryRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 58
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 01:01:59.032 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 01:01:59.033 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP" completed keep alive response.
2025-08-27 01:01:59.034 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:01:59.035 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:01:59.037 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:01:59.038 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 500 null application/json; charset=utf-8 1548.5573ms
2025-08-27 01:02:11.390 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:02:11.392 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:02:11.394 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:02:11.395 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:02:11.396 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:02:11.396 +03:00 [DBG] Connection id "0HNF4TC5MJ7VV" completed keep alive response.
2025-08-27 01:02:11.397 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 7.4742ms
2025-08-27 01:02:11.398 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:02:11.400 +03:00 [DBG] Connection id "0HNF4TC5MJ7VV", Request id "0HNF4TC5MJ7VV:00000002": started reading request body.
2025-08-27 01:02:11.403 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:02:11.403 +03:00 [DBG] Connection id "0HNF4TC5MJ7VV", Request id "0HNF4TC5MJ7VV:00000002": done reading request body.
2025-08-27 01:02:11.404 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:02:11.408 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:02:11.410 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:02:11.411 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:02:11.412 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:02:11.414 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:02:11.416 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:02:11.417 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:02:11.418 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:02:11.420 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:02:11.422 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:02:11.424 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:02:11.424 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:02:11.425 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:02:11.427 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:02:11.429 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:02:11.430 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:02:11.431 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:02:11.432 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:02:11.434 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:02:11.435 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:02:11.436 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:02:11.437 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:0000000D": started reading request body.
2025-08-27 01:02:11.438 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:0000000D": done reading request body.
2025-08-27 01:02:11.439 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:02:11.440 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:02:11.441 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:02:11.442 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:02:11.443 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:02:11.443 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:02:11.445 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:02:11.445 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:02:11.446 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:02:11.447 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:02:11.448 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:02:11.449 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 01:02:11.450 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:02:11.451 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:02:11.451 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:02:11.452 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:02:11.453 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:02:11.454 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:02:11.455 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:02:11.457 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:02:11.458 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:02:11.459 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 01:02:11.460 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:02:11.461 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:02:11.462 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:02:11.463 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:02:11.464 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:02:11.465 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:02:11.466 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:02:11.467 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:02:11.468 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:02:11.469 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:02:11.471 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:02:11.472 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:02:11.473 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:02:11.474 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:02:11.475 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:02:11.476 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:02:11.477 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:02:11.478 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:02:11.479 +03:00 [INF] Converting natural language to SQL. User query: Delete products that is in category called samsung
2025-08-27 01:02:11.480 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:02:11.481 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:02:11.482 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:02:12.370 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:02:12.372 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:02:12.592 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 1172.5822ms
2025-08-27 01:02:12.670 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:02:12.810 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Conversion produced no SQL.
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ExecuteQueryAsync(Guid profileId, String naturalLanguage, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 47
   at NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery(Guid profileId, ExecuteQueryRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 58
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 01:02:12.814 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 01:02:12.815 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP" completed keep alive response.
2025-08-27 01:02:12.816 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:02:12.817 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:02:12.817 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:02:12.818 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 500 null application/json; charset=utf-8 1419.8553ms
2025-08-27 01:02:30.564 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:02:30.567 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:02:30.567 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:02:30.568 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:02:30.569 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:02:30.569 +03:00 [DBG] Connection id "0HNF4TC5MJ7VV" completed keep alive response.
2025-08-27 01:02:30.570 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 5.979ms
2025-08-27 01:02:30.570 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:02:30.572 +03:00 [DBG] Connection id "0HNF4TC5MJ7VV", Request id "0HNF4TC5MJ7VV:00000003": started reading request body.
2025-08-27 01:02:30.573 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:02:30.574 +03:00 [DBG] Connection id "0HNF4TC5MJ7VV", Request id "0HNF4TC5MJ7VV:00000003": done reading request body.
2025-08-27 01:02:30.575 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:02:30.576 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:02:30.577 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:02:30.578 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:02:30.579 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:02:30.580 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:02:30.581 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:02:30.582 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:02:30.583 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:02:30.584 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:02:30.585 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:02:30.586 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:02:30.586 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:02:30.587 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:02:30.588 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:02:30.589 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:02:30.590 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:02:30.591 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:02:30.591 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:02:30.592 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:02:30.593 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:02:30.594 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:02:30.594 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:0000000E": started reading request body.
2025-08-27 01:02:30.595 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP", Request id "0HNF4TC5MJ7VP:0000000E": done reading request body.
2025-08-27 01:02:30.597 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:02:30.598 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:02:30.599 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:02:30.600 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:02:30.601 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:02:30.602 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:02:30.603 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:02:30.604 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:02:30.605 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:02:48.762 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:02:48.764 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:02:48.765 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 01:02:48.766 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:02:48.767 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:02:48.769 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:02:48.770 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:02:48.771 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:02:48.772 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:02:48.773 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:02:48.775 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:02:48.776 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:02:48.776 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:02:48.780 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:02:48.781 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:02:48.783 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:02:48.784 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:02:48.785 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:02:48.786 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:02:48.787 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:02:48.788 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:02:48.789 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:02:48.790 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:02:48.792 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:02:48.793 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:02:48.794 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:02:48.795 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:02:48.796 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:02:48.797 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:02:48.798 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:02:48.800 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:02:48.842 +03:00 [INF] Converting natural language to SQL. User query: Delete products that is in category called samsung
2025-08-27 01:02:48.843 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:02:48.844 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:02:48.845 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:02:49.766 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:02:49.766 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:02:59.918 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 29334.1477ms
2025-08-27 01:02:59.998 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:03:00.147 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Conversion produced no SQL.
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ExecuteQueryAsync(Guid profileId, String naturalLanguage, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 47
   at NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery(Guid profileId, ExecuteQueryRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 58
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 01:03:00.151 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 01:03:00.151 +03:00 [DBG] Connection id "0HNF4TC5MJ7VP" completed keep alive response.
2025-08-27 01:03:00.152 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:03:00.153 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:03:00.154 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:03:00.156 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 500 null application/json; charset=utf-8 29585.259ms
2025-08-27 01:03:09.077 +03:00 [INF] This is a test log to file!
2025-08-27 01:03:09.262 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 01:03:09.272 +03:00 [INF] API configured successfully.
2025-08-27 01:03:09.275 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:03:09.276 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:03:09.340 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 01:03:09.389 +03:00 [DBG] Hosting starting
2025-08-27 01:03:09.404 +03:00 [DBG] Middleware loaded
2025-08-27 01:03:09.407 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 01:03:09.409 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 01:03:09.494 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 01:03:09.497 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 01:03:09.505 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 01:03:09.538 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 01:03:09.586 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 01:03:09.587 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 01:03:09.587 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 01:03:09.588 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 01:03:09.589 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 01:03:09.589 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 01:03:09.594 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:03:09.596 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:03:09.689 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 01:03:09.690 +03:00 [INF] Hosting environment: Development
2025-08-27 01:03:09.690 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 01:03:09.691 +03:00 [DBG] Hosting started
2025-08-27 01:03:14.459 +03:00 [DBG] Connection id "0HNF4THDE20P6" received FIN.
2025-08-27 01:03:14.463 +03:00 [DBG] Connection id "0HNF4THDE20P6" accepted.
2025-08-27 01:03:14.465 +03:00 [DBG] Connection id "0HNF4THDE20P6" started.
2025-08-27 01:03:14.466 +03:00 [DBG] Connection id "0HNF4THDE20P7" accepted.
2025-08-27 01:03:14.467 +03:00 [DBG] Connection id "0HNF4THDE20P7" started.
2025-08-27 01:03:14.472 +03:00 [DBG] Connection id "0HNF4THDE20P6" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:03:14.475 +03:00 [DBG] Connection id "0HNF4THDE20P6" disconnecting.
2025-08-27 01:03:14.477 +03:00 [DBG] Connection id "0HNF4THDE20P6" stopped.
2025-08-27 01:03:14.492 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:03:14.520 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:03:14.522 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:03:14.524 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:03:14.546 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-08-27 01:03:14.548 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:03:14.555 +03:00 [DBG] Connection id "0HNF4THDE20P7" completed keep alive response.
2025-08-27 01:03:14.557 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 69.2243ms
2025-08-27 01:03:14.558 +03:00 [DBG] Connection id "0HNF4THDE20P9" accepted.
2025-08-27 01:03:14.558 +03:00 [DBG] Connection id "0HNF4THDE20P8" received FIN.
2025-08-27 01:03:14.558 +03:00 [DBG] Connection id "0HNF4THDE20P8" accepted.
2025-08-27 01:03:14.587 +03:00 [DBG] Connection id "0HNF4THDE20P9" started.
2025-08-27 01:03:14.587 +03:00 [DBG] Connection id "0HNF4THDE20P7", Request id "0HNF4THDE20P7:00000001": started reading request body.
2025-08-27 01:03:14.588 +03:00 [DBG] Connection id "0HNF4THDE20P8" started.
2025-08-27 01:03:14.591 +03:00 [DBG] Connection id "0HNF4THDE20P7", Request id "0HNF4THDE20P7:00000001": done reading request body.
2025-08-27 01:03:14.614 +03:00 [DBG] Connection id "0HNF4THDE20P8" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:03:14.616 +03:00 [DBG] Connection id "0HNF4THDE20P8" disconnecting.
2025-08-27 01:03:14.617 +03:00 [DBG] Connection id "0HNF4THDE20P8" stopped.
2025-08-27 01:03:14.641 +03:00 [DBG] Connection 0HNF4THDE20P9 established using the following protocol: "Tls13"
2025-08-27 01:03:14.645 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:03:14.648 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:03:14.649 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:03:14.651 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:03:14.654 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:03:14.669 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:03:14.672 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:03:14.673 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:03:14.675 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:03:14.676 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:03:14.678 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:03:14.680 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:03:14.763 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 01:03:15.227 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:03:15.240 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:03:15.242 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:03:15.247 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:03:15.250 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:03:15.252 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:03:15.253 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:03:15.254 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:03:15.258 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:03:15.260 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:03:15.262 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:03:15.264 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:03:15.278 +03:00 [DBG] Connection id "0HNF4THDE20P9", Request id "0HNF4THDE20P9:00000001": started reading request body.
2025-08-27 01:03:15.280 +03:00 [DBG] Connection id "0HNF4THDE20P9", Request id "0HNF4THDE20P9:00000001": done reading request body.
2025-08-27 01:03:15.286 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:03:15.287 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:03:15.288 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:03:15.289 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:03:15.296 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:03:15.297 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:03:15.299 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:03:15.300 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:03:15.302 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:03:23.686 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:03:23.751 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-08-27 01:03:23.791 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-08-27 01:03:24.078 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<Name>k__BackingField = dataReader.GetString(3);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(4));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(5);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(6) ? default(Guid?) : (Guid?)dataReader.GetGuid(6) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(6) ? default(object) : (object)dataReader.GetGuid(6) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(6) ? default(Guid) : dataReader.GetGuid(6);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(8) ? default(string) : dataReader.GetString(8);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(10) ? default(DateTime) : dataReader.GetDateTime(10);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 01:03:24.113 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:03:24.132 +03:00 [DBG] Created DbConnection. (19ms).
2025-08-27 01:03:24.136 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:03:24.147 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:03:24.150 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:03:24.155 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:03:24.159 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-08-27 01:03:24.166 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:03:24.184 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:03:24.223 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:03:24.258 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:03:24.264 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 74ms reading results.
2025-08-27 01:03:24.267 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:03:24.270 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (3ms).
2025-08-27 01:03:24.280 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:03:24.283 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:03:24.284 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:03:24.285 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:03:24.286 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:03:24.287 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:03:24.288 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:03:24.290 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:03:24.293 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:03:24.294 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 01:03:24.295 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:03:24.296 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:03:24.306 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:03:24.317 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:03:24.319 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:03:24.419 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:03:24.436 +03:00 [INF] Converting natural language to SQL. User query: Delete products that is in category called samsung
2025-08-27 01:03:24.438 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:03:24.440 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:03:24.445 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:03:25.521 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:03:25.532 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:06:42.756 +03:00 [INF] This is a test log to file!
2025-08-27 01:06:42.958 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 01:06:42.970 +03:00 [INF] API configured successfully.
2025-08-27 01:06:42.971 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:06:42.972 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:06:43.033 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 01:06:43.089 +03:00 [DBG] Hosting starting
2025-08-27 01:06:43.105 +03:00 [DBG] Middleware loaded
2025-08-27 01:06:43.108 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 01:06:43.109 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 01:06:43.199 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 01:06:43.203 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 01:06:43.213 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 01:06:43.275 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 01:06:43.329 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 01:06:43.330 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 01:06:43.332 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 01:06:43.332 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 01:06:43.333 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 01:06:43.334 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 01:06:43.341 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:06:43.344 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:06:43.469 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 01:06:43.470 +03:00 [INF] Hosting environment: Development
2025-08-27 01:06:43.471 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 01:06:43.471 +03:00 [DBG] Hosting started
2025-08-27 01:06:51.036 +03:00 [DBG] Connection id "0HNF4TJDVG8GF" received FIN.
2025-08-27 01:06:51.041 +03:00 [DBG] Connection id "0HNF4TJDVG8GF" accepted.
2025-08-27 01:06:51.042 +03:00 [DBG] Connection id "0HNF4TJDVG8GF" started.
2025-08-27 01:06:51.043 +03:00 [DBG] Connection id "0HNF4TJDVG8GG" accepted.
2025-08-27 01:06:51.044 +03:00 [DBG] Connection id "0HNF4TJDVG8GG" started.
2025-08-27 01:06:51.049 +03:00 [DBG] Connection id "0HNF4TJDVG8GF" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:06:51.051 +03:00 [DBG] Connection id "0HNF4TJDVG8GF" disconnecting.
2025-08-27 01:06:51.053 +03:00 [DBG] Connection id "0HNF4TJDVG8GF" stopped.
2025-08-27 01:06:51.066 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:06:51.091 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:06:51.094 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:06:51.096 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:06:51.115 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-08-27 01:06:51.118 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:06:51.124 +03:00 [DBG] Connection id "0HNF4TJDVG8GG" completed keep alive response.
2025-08-27 01:06:51.126 +03:00 [DBG] Connection id "0HNF4TJDVG8GH" accepted.
2025-08-27 01:06:51.126 +03:00 [DBG] Connection id "0HNF4TJDVG8GH" received FIN.
2025-08-27 01:06:51.126 +03:00 [DBG] Connection id "0HNF4TJDVG8GI" accepted.
2025-08-27 01:06:51.126 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 63.6156ms
2025-08-27 01:06:51.131 +03:00 [DBG] Connection id "0HNF4TJDVG8GH" started.
2025-08-27 01:06:51.132 +03:00 [DBG] Connection id "0HNF4TJDVG8GI" started.
2025-08-27 01:06:51.136 +03:00 [DBG] Connection id "0HNF4TJDVG8GH" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:06:51.136 +03:00 [DBG] Connection id "0HNF4TJDVG8GG", Request id "0HNF4TJDVG8GG:00000001": started reading request body.
2025-08-27 01:06:51.138 +03:00 [DBG] Connection id "0HNF4TJDVG8GH" disconnecting.
2025-08-27 01:06:51.141 +03:00 [DBG] Connection id "0HNF4TJDVG8GG", Request id "0HNF4TJDVG8GG:00000001": done reading request body.
2025-08-27 01:06:51.141 +03:00 [DBG] Connection id "0HNF4TJDVG8GH" stopped.
2025-08-27 01:06:51.166 +03:00 [DBG] Connection 0HNF4TJDVG8GI established using the following protocol: "Tls13"
2025-08-27 01:06:51.168 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:06:51.171 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:06:51.172 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:06:51.173 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:06:51.176 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:06:51.193 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:06:51.194 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:06:51.196 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:06:51.198 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:06:51.199 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:06:51.200 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:06:51.202 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:06:51.288 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 01:06:51.733 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:06:51.741 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:06:51.743 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:06:51.748 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:06:51.751 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:06:51.753 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:06:51.754 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:06:51.755 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:06:51.758 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:06:51.760 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:06:51.761 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:06:51.763 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:06:51.774 +03:00 [DBG] Connection id "0HNF4TJDVG8GI", Request id "0HNF4TJDVG8GI:00000001": started reading request body.
2025-08-27 01:06:51.775 +03:00 [DBG] Connection id "0HNF4TJDVG8GI", Request id "0HNF4TJDVG8GI:00000001": done reading request body.
2025-08-27 01:06:51.781 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:06:51.782 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:06:51.783 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:06:51.784 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:06:51.790 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:06:51.792 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:06:51.793 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:06:51.794 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:06:51.795 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:06:57.200 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:06:57.269 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-08-27 01:06:57.307 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-08-27 01:06:57.579 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<Name>k__BackingField = dataReader.GetString(3);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(4));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(5);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(6) ? default(Guid?) : (Guid?)dataReader.GetGuid(6) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(6) ? default(object) : (object)dataReader.GetGuid(6) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(6) ? default(Guid) : dataReader.GetGuid(6);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(8) ? default(string) : dataReader.GetString(8);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(10) ? default(DateTime) : dataReader.GetDateTime(10);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 01:06:57.608 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:06:57.618 +03:00 [DBG] Created DbConnection. (9ms).
2025-08-27 01:06:57.621 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:06:57.631 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:06:57.635 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:06:57.640 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:06:57.643 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-08-27 01:06:57.649 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:06:57.666 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:06:57.702 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:06:57.730 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:06:57.737 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 65ms reading results.
2025-08-27 01:06:57.742 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:06:57.747 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (4ms).
2025-08-27 01:06:57.757 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:06:57.761 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:06:57.762 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:06:57.764 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:06:57.765 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:06:57.767 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2025-08-27 01:06:57.769 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:06:57.772 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:06:57.775 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:06:57.776 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 01:06:57.778 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:06:57.780 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:06:57.792 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:06:57.805 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:06:57.808 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:06:57.920 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:06:57.941 +03:00 [INF] Converting natural language to SQL. User query: Delete products that is in category called samsung
2025-08-27 01:06:59.409 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:09:27.417 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:10:19.612 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:10:41.457 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:30:48.489 +03:00 [INF] This is a test log to file!
2025-08-27 01:30:48.646 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 01:30:48.656 +03:00 [INF] API configured successfully.
2025-08-27 01:30:48.657 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:30:48.658 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:30:48.714 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 01:30:48.767 +03:00 [DBG] Hosting starting
2025-08-27 01:30:48.781 +03:00 [DBG] Middleware loaded
2025-08-27 01:30:48.783 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 01:30:48.785 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 01:30:48.888 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 01:30:48.890 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 01:30:48.900 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 01:30:48.935 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 01:30:49.028 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 01:30:49.030 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 01:30:49.031 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 01:30:49.032 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 01:30:49.032 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 01:30:49.033 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 01:30:49.038 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:30:49.040 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:30:49.131 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 01:30:49.132 +03:00 [INF] Hosting environment: Development
2025-08-27 01:30:49.133 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 01:30:49.133 +03:00 [DBG] Hosting started
2025-08-27 01:32:08.764 +03:00 [INF] This is a test log to file!
2025-08-27 01:32:08.939 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 01:32:08.946 +03:00 [INF] API configured successfully.
2025-08-27 01:32:08.947 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:32:08.948 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:32:08.995 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 01:32:09.041 +03:00 [DBG] Hosting starting
2025-08-27 01:32:09.053 +03:00 [DBG] Middleware loaded
2025-08-27 01:32:09.055 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 01:32:09.057 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 01:32:09.131 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 01:32:09.134 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 01:32:09.144 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 01:32:09.186 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 01:32:09.264 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 01:32:09.265 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 01:32:09.267 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 01:32:09.268 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 01:32:09.269 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 01:32:09.269 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 01:32:09.276 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:32:09.278 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:32:09.388 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 01:32:09.389 +03:00 [INF] Hosting environment: Development
2025-08-27 01:32:09.390 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 01:32:09.391 +03:00 [DBG] Hosting started
2025-08-27 01:32:23.279 +03:00 [DBG] Connection id "0HNF4U1MK3HPQ" received FIN.
2025-08-27 01:32:23.283 +03:00 [DBG] Connection id "0HNF4U1MK3HPQ" accepted.
2025-08-27 01:32:23.285 +03:00 [DBG] Connection id "0HNF4U1MK3HPQ" started.
2025-08-27 01:32:23.286 +03:00 [DBG] Connection id "0HNF4U1MK3HPR" accepted.
2025-08-27 01:32:23.288 +03:00 [DBG] Connection id "0HNF4U1MK3HPR" started.
2025-08-27 01:32:23.293 +03:00 [DBG] Connection id "0HNF4U1MK3HPQ" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:32:23.295 +03:00 [DBG] Connection id "0HNF4U1MK3HPQ" disconnecting.
2025-08-27 01:32:23.297 +03:00 [DBG] Connection id "0HNF4U1MK3HPQ" stopped.
2025-08-27 01:32:23.313 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:32:23.345 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:32:23.348 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:32:23.350 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:32:23.373 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-08-27 01:32:23.375 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:32:23.383 +03:00 [DBG] Connection id "0HNF4U1MK3HPR" completed keep alive response.
2025-08-27 01:32:23.385 +03:00 [DBG] Connection id "0HNF4U1MK3HPS" accepted.
2025-08-27 01:32:23.385 +03:00 [DBG] Connection id "0HNF4U1MK3HPS" received FIN.
2025-08-27 01:32:23.385 +03:00 [DBG] Connection id "0HNF4U1MK3HPT" accepted.
2025-08-27 01:32:23.432 +03:00 [DBG] Connection id "0HNF4U1MK3HPS" started.
2025-08-27 01:32:23.435 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 77.3023ms
2025-08-27 01:32:23.458 +03:00 [DBG] Connection id "0HNF4U1MK3HPT" started.
2025-08-27 01:32:23.459 +03:00 [DBG] Connection id "0HNF4U1MK3HPS" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:32:23.465 +03:00 [DBG] Connection id "0HNF4U1MK3HPR", Request id "0HNF4U1MK3HPR:00000001": started reading request body.
2025-08-27 01:32:23.466 +03:00 [DBG] Connection id "0HNF4U1MK3HPS" disconnecting.
2025-08-27 01:32:23.491 +03:00 [DBG] Connection id "0HNF4U1MK3HPR", Request id "0HNF4U1MK3HPR:00000001": done reading request body.
2025-08-27 01:32:23.491 +03:00 [DBG] Connection id "0HNF4U1MK3HPS" stopped.
2025-08-27 01:32:23.519 +03:00 [DBG] Connection 0HNF4U1MK3HPT established using the following protocol: "Tls13"
2025-08-27 01:32:23.523 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:32:23.526 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:32:23.527 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:32:23.529 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:32:23.532 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:32:23.549 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:32:23.552 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:32:23.554 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:32:23.556 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:32:23.558 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:32:23.559 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:32:23.562 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:32:23.649 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 01:32:24.140 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:32:24.149 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:32:24.151 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:32:24.155 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:32:24.159 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:32:24.161 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:32:24.162 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:32:24.164 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:32:24.167 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:32:24.169 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:32:24.172 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:32:24.174 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:32:24.186 +03:00 [DBG] Connection id "0HNF4U1MK3HPT", Request id "0HNF4U1MK3HPT:00000001": started reading request body.
2025-08-27 01:32:24.188 +03:00 [DBG] Connection id "0HNF4U1MK3HPT", Request id "0HNF4U1MK3HPT:00000001": done reading request body.
2025-08-27 01:32:24.194 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:32:24.195 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:32:24.196 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:32:24.197 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:32:24.205 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:32:24.207 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:32:24.208 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:32:24.210 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:32:24.212 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:32:24.221 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:32:24.269 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-08-27 01:32:24.306 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-08-27 01:32:24.549 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<Name>k__BackingField = dataReader.GetString(3);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(4));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(5);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(6) ? default(Guid?) : (Guid?)dataReader.GetGuid(6) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(6) ? default(object) : (object)dataReader.GetGuid(6) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(6) ? default(Guid) : dataReader.GetGuid(6);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(8) ? default(string) : dataReader.GetString(8);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(10) ? default(DateTime) : dataReader.GetDateTime(10);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 01:32:24.581 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:32:24.592 +03:00 [DBG] Created DbConnection. (11ms).
2025-08-27 01:32:24.596 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:32:24.609 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:24.614 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:32:24.620 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-08-27 01:32:24.624 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-08-27 01:32:24.631 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:32:24.645 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:32:24.676 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:32:24.703 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:24.710 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 58ms reading results.
2025-08-27 01:32:24.713 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:24.717 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (3ms).
2025-08-27 01:32:24.725 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:32:24.728 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:32:24.730 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:24.731 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:32:24.732 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:32:24.733 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:32:24.735 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:32:24.737 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:32:24.740 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:24.741 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 01:32:24.743 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:24.745 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:32:24.755 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:32:24.767 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:32:24.770 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:32:24.908 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:32:24.926 +03:00 [INF] Converting natural language to SQL. User query: Delete products that is in category called samsung
2025-08-27 01:32:24.928 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:32:24.930 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:32:24.939 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:32:25.887 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:32:25.897 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:32:25.899 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:32:25.901 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:25.903 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:32:25.904 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:32:25.906 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:32:25.907 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:32:25.909 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:32:25.911 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:25.912 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:32:25.914 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:25.916 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:32:25.918 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:32:25.919 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:32:25.921 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:25.923 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:32:25.924 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:32:25.925 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:32:25.927 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:32:25.929 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:32:25.931 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:25.933 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:32:25.934 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:25.935 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:32:25.937 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:32:25.939 +03:00 [INF] Executing SQL for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", Mode="Write"
2025-08-27 01:32:28.935 +03:00 [INF] Executing SQL on DESKTOP-QCK8UI5\SQLEXPRESS/ProductInventory (Mode="Write")
2025-08-27 01:32:28.942 +03:00 [DBG] SQL: DELETE FROM Products WHERE CategoryId IN (SELECT Id FROM Categories WHERE Name = @param1);
2025-08-27 01:32:28.945 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:32:29.149 +03:00 [DBG] Connection opened to DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 01:32:33.511 +03:00 [ERR] SQL execution failed after 4565 ms
2025-08-27 01:32:33.905 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 10342.2238ms
2025-08-27 01:32:34.009 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:32:34.200 +03:00 [ERR] An unhandled exception has occurred while executing the request.
NaturalToQuery.Core.Exceptions.DbExecutionException: Error executing SQL command.
 ---> System.Reflection.TargetParameterCountException: Parameter count mismatch.
   at System.Reflection.MethodBaseInvoker.ThrowTargetParameterCountException()
   at System.Reflection.RuntimeMethodInfo.Invoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.PropertyInfo.GetValue(Object obj)
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.AddParameters(DbCommand cmd, Object parameters) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 661
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.ExecuteNonQuery(DbConnection conn, String sql, Object parameters, CancellationToken ct, Stopwatch sw) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 598
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.ExecuteSqlCommand(ProviderConnectionConfig config, String sql, CancellationToken ct, Object parameters) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 538
   --- End of inner exception stack trace ---
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.ExecuteSqlCommand(ProviderConnectionConfig config, String sql, CancellationToken ct, Object parameters) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 550
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.ExecuteAsync(ProviderConnectionConfig config, String sql, String userQuery, Object parameters, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 168
   at NaturalToQuery.Application.Services.ProfileDbService.ExecuteAsync(Guid profileId, String sql, String userQuery, Object parameters, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 32
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ExecuteQueryAsync(Guid profileId, String naturalLanguage, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 73
   at NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery(Guid profileId, ExecuteQueryRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 60
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 01:32:34.217 +03:00 [ERR] Error occurred.
2025-08-27 01:32:34.231 +03:00 [DBG] Connection id "0HNF4U1MK3HPT" completed keep alive response.
2025-08-27 01:32:34.239 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:32:34.244 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:32:34.247 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-08-27 01:32:34.250 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 500 null application/json; charset=utf-8 10727.7604ms
2025-08-27 01:32:51.058 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:32:51.062 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:32:51.063 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:32:51.064 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:32:51.067 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:32:51.069 +03:00 [DBG] Connection id "0HNF4U1MK3HPR" completed keep alive response.
2025-08-27 01:32:51.071 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 59.5031ms
2025-08-27 01:32:51.072 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:32:51.073 +03:00 [DBG] Connection id "0HNF4U1MK3HPR", Request id "0HNF4U1MK3HPR:00000002": started reading request body.
2025-08-27 01:32:51.075 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:32:51.076 +03:00 [DBG] Connection id "0HNF4U1MK3HPR", Request id "0HNF4U1MK3HPR:00000002": done reading request body.
2025-08-27 01:32:51.077 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:32:51.080 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:32:51.081 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:32:51.082 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:32:51.084 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:32:51.086 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:32:51.087 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:32:51.089 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:32:51.091 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:32:51.092 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:32:51.136 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:32:51.138 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:32:51.140 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:32:51.142 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:32:51.143 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:32:51.145 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:32:51.146 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:32:51.148 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:32:51.149 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:32:51.150 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:32:51.151 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:32:51.154 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:32:51.155 +03:00 [DBG] Connection id "0HNF4U1MK3HPT", Request id "0HNF4U1MK3HPT:00000002": started reading request body.
2025-08-27 01:32:51.156 +03:00 [DBG] Connection id "0HNF4U1MK3HPT", Request id "0HNF4U1MK3HPT:00000002": done reading request body.
2025-08-27 01:32:51.158 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:32:51.159 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:32:51.160 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:32:51.162 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:32:51.164 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:32:51.165 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:32:51.166 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:32:51.167 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:32:51.169 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:32:51.170 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:32:51.172 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:32:51.174 +03:00 [DBG] Created DbConnection. (1ms).
2025-08-27 01:32:51.175 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:32:51.177 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:51.178 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:32:51.180 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:32:51.181 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:32:51.182 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:32:51.184 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:32:51.187 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:32:51.189 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:51.190 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 3ms reading results.
2025-08-27 01:32:51.191 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:51.192 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:32:51.195 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:32:51.196 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:32:51.197 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:51.198 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:32:51.199 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:32:51.200 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:32:51.201 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:32:51.203 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:32:51.205 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:51.206 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:32:51.208 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:51.209 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:32:51.211 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:32:51.212 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:32:51.213 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:32:51.215 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:32:51.216 +03:00 [INF] Converting natural language to SQL. User query: Delete products that is in category called samsung
2025-08-27 01:32:51.217 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:32:51.218 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:32:51.219 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:32:51.971 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:32:51.973 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:32:51.974 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:32:51.977 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:51.978 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:32:51.979 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:32:51.980 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:32:51.981 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:32:51.982 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:32:51.984 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:51.985 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:32:51.986 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:51.987 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:32:51.988 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:32:51.989 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:32:51.990 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:51.991 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:32:51.992 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:32:51.992 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:32:51.993 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:32:51.994 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:32:51.996 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:51.996 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:32:51.998 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:32:51.999 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:32:52.000 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:32:52.000 +03:00 [INF] Executing SQL for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", Mode="Write"
2025-08-27 01:32:52.001 +03:00 [INF] Executing SQL on DESKTOP-QCK8UI5\SQLEXPRESS/ProductInventory (Mode="Write")
2025-08-27 01:32:52.002 +03:00 [DBG] SQL: DELETE FROM Products WHERE CategoryId IN (SELECT Id FROM Categories WHERE Name = @param1);
2025-08-27 01:32:52.002 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:32:52.005 +03:00 [DBG] Connection opened to DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 01:37:22.686 +03:00 [ERR] SQL execution failed after 270683 ms
2025-08-27 01:37:23.291 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 272192.5715ms
2025-08-27 01:37:23.423 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:37:23.594 +03:00 [ERR] An unhandled exception has occurred while executing the request.
NaturalToQuery.Core.Exceptions.DbExecutionException: Error executing SQL command.
 ---> System.Reflection.TargetParameterCountException: Parameter count mismatch.
   at System.Reflection.MethodBaseInvoker.ThrowTargetParameterCountException()
   at System.Reflection.RuntimeMethodInfo.Invoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.PropertyInfo.GetValue(Object obj)
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.AddParameters(DbCommand cmd, Object parameters) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 661
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.ExecuteNonQuery(DbConnection conn, String sql, Object parameters, CancellationToken ct, Stopwatch sw) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 598
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.ExecuteSqlCommand(ProviderConnectionConfig config, String sql, CancellationToken ct, Object parameters) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 538
   --- End of inner exception stack trace ---
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.ExecuteSqlCommand(ProviderConnectionConfig config, String sql, CancellationToken ct, Object parameters) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 550
   at NaturalToQuery.Infrastructure.Providers.SqlServerDbProvider.ExecuteAsync(ProviderConnectionConfig config, String sql, String userQuery, Object parameters, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Providers\SqlServerDbProvider.cs:line 168
   at NaturalToQuery.Application.Services.ProfileDbService.ExecuteAsync(Guid profileId, String sql, String userQuery, Object parameters, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 32
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ExecuteQueryAsync(Guid profileId, String naturalLanguage, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 73
   at NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery(Guid profileId, ExecuteQueryRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 60
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 01:37:23.601 +03:00 [ERR] Error occurred.
2025-08-27 01:37:23.602 +03:00 [DBG] Connection id "0HNF4U1MK3HPT" completed keep alive response.
2025-08-27 01:37:23.603 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:37:23.608 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:37:23.609 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:37:23.611 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 500 null application/json; charset=utf-8 272538.6364ms
2025-08-27 01:37:25.015 +03:00 [DBG] Connection id "0HNF4U1MK3HPU" accepted.
2025-08-27 01:37:25.016 +03:00 [DBG] Connection id "0HNF4U1MK3HPU" received FIN.
2025-08-27 01:37:25.016 +03:00 [DBG] Connection id "0HNF4U1MK3HPU" started.
2025-08-27 01:37:25.017 +03:00 [DBG] Connection id "0HNF4U1MK3HPV" accepted.
2025-08-27 01:37:25.018 +03:00 [DBG] Connection id "0HNF4U1MK3HPU" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:37:25.019 +03:00 [DBG] Connection id "0HNF4U1MK3HPV" started.
2025-08-27 01:37:25.020 +03:00 [DBG] Connection id "0HNF4U1MK3HPU" disconnecting.
2025-08-27 01:37:25.022 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:37:25.022 +03:00 [DBG] Connection id "0HNF4U1MK3HPU" stopped.
2025-08-27 01:37:25.025 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:37:25.027 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:37:25.028 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:37:25.029 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:37:25.030 +03:00 [DBG] Connection id "0HNF4U1MK3HPV" completed keep alive response.
2025-08-27 01:37:25.031 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 9.4032ms
2025-08-27 01:37:25.031 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:37:25.033 +03:00 [DBG] Connection id "0HNF4U1MK3HPV", Request id "0HNF4U1MK3HPV:00000001": started reading request body.
2025-08-27 01:37:25.035 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:37:25.035 +03:00 [DBG] Connection id "0HNF4U1MK3HPV", Request id "0HNF4U1MK3HPV:00000001": done reading request body.
2025-08-27 01:37:25.036 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:37:25.038 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:37:25.039 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:37:25.040 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:37:25.041 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:37:25.042 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:37:25.043 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:37:25.044 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:37:25.045 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:37:25.046 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:37:25.057 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:37:25.059 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:37:25.060 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:37:25.061 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:37:25.061 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:37:25.062 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:37:25.063 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:37:25.064 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:37:25.065 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:37:25.066 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:37:25.067 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:37:25.068 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:37:25.068 +03:00 [DBG] Connection id "0HNF4U1MK3HPT", Request id "0HNF4U1MK3HPT:00000003": started reading request body.
2025-08-27 01:37:25.069 +03:00 [DBG] Connection id "0HNF4U1MK3HPT", Request id "0HNF4U1MK3HPT:00000003": done reading request body.
2025-08-27 01:37:25.070 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:37:25.071 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:37:25.072 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:37:25.073 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:37:25.074 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:37:25.075 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:37:25.076 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:37:25.077 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:37:25.078 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:37:25.079 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:37:25.081 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:37:25.081 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 01:37:25.082 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:37:25.083 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:37:25.084 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:37:25.084 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:37:25.085 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:37:25.086 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:37:25.087 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:37:25.089 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:37:25.090 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:37:25.091 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:37:25.092 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:37:25.092 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:37:25.094 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:37:25.095 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:37:25.096 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:37:25.097 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:37:25.097 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:37:25.098 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:37:25.099 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:37:25.100 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:37:25.102 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:37:25.103 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:37:25.105 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:37:25.105 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:37:25.107 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:37:25.108 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:37:25.109 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:37:25.110 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:37:25.111 +03:00 [INF] Converting natural language to SQL. User query: Delete products that is in category called samsung
2025-08-27 01:37:25.112 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:37:25.113 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:37:25.114 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:37:25.917 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:37:25.918 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:37:25.920 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:37:25.921 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:37:25.922 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:37:25.922 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:37:25.923 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:37:25.924 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:37:25.926 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:37:25.927 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:37:25.928 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:37:25.929 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:37:25.930 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:37:25.932 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:37:25.933 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:37:25.934 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:37:25.934 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:37:25.935 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:37:25.936 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:37:25.937 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:37:25.939 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:37:25.940 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:37:25.941 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:37:25.943 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:37:25.944 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:37:25.946 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:37:25.946 +03:00 [INF] Executing SQL for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", Mode="Write"
2025-08-27 01:37:25.947 +03:00 [INF] Executing SQL on DESKTOP-QCK8UI5\SQLEXPRESS/ProductInventory (Mode="Write")
2025-08-27 01:37:25.948 +03:00 [DBG] SQL: DELETE FROM Products WHERE CategoryId IN (SELECT Id FROM Categories WHERE Name = @param1);
2025-08-27 01:37:25.949 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:37:25.950 +03:00 [DBG] Connection opened to DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 01:38:36.328 +03:00 [INF] This is a test log to file!
2025-08-27 01:38:36.491 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 01:38:36.498 +03:00 [INF] API configured successfully.
2025-08-27 01:38:36.499 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:38:36.500 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:38:36.552 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 01:38:36.602 +03:00 [DBG] Hosting starting
2025-08-27 01:38:36.614 +03:00 [DBG] Middleware loaded
2025-08-27 01:38:36.616 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 01:38:36.618 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 01:38:36.689 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 01:38:36.693 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 01:38:36.702 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 01:38:36.736 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 01:38:36.787 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 01:38:36.789 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 01:38:36.790 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 01:38:36.791 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 01:38:36.792 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 01:38:36.792 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 01:38:36.798 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:38:36.799 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:38:36.890 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 01:38:36.891 +03:00 [INF] Hosting environment: Development
2025-08-27 01:38:36.892 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 01:38:36.893 +03:00 [DBG] Hosting started
2025-08-27 01:38:38.933 +03:00 [DBG] Connection id "0HNF4U56IK78O" received FIN.
2025-08-27 01:38:38.938 +03:00 [DBG] Connection id "0HNF4U56IK78O" accepted.
2025-08-27 01:38:38.940 +03:00 [DBG] Connection id "0HNF4U56IK78O" started.
2025-08-27 01:38:38.942 +03:00 [DBG] Connection id "0HNF4U56IK78P" accepted.
2025-08-27 01:38:38.943 +03:00 [DBG] Connection id "0HNF4U56IK78P" started.
2025-08-27 01:38:38.948 +03:00 [DBG] Connection id "0HNF4U56IK78O" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:38:38.951 +03:00 [DBG] Connection id "0HNF4U56IK78O" disconnecting.
2025-08-27 01:38:38.952 +03:00 [DBG] Connection id "0HNF4U56IK78O" stopped.
2025-08-27 01:38:38.968 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:38:38.993 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:38:38.996 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:38:38.999 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:38:39.019 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-08-27 01:38:39.022 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:38:39.029 +03:00 [DBG] Connection id "0HNF4U56IK78P" completed keep alive response.
2025-08-27 01:38:39.030 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 67.2432ms
2025-08-27 01:38:39.031 +03:00 [DBG] Connection id "0HNF4U56IK78Q" received FIN.
2025-08-27 01:38:39.031 +03:00 [DBG] Connection id "0HNF4U56IK78Q" accepted.
2025-08-27 01:38:39.031 +03:00 [DBG] Connection id "0HNF4U56IK78R" accepted.
2025-08-27 01:38:39.039 +03:00 [DBG] Connection id "0HNF4U56IK78P", Request id "0HNF4U56IK78P:00000001": started reading request body.
2025-08-27 01:38:39.040 +03:00 [DBG] Connection id "0HNF4U56IK78Q" started.
2025-08-27 01:38:39.040 +03:00 [DBG] Connection id "0HNF4U56IK78R" started.
2025-08-27 01:38:39.041 +03:00 [DBG] Connection id "0HNF4U56IK78P", Request id "0HNF4U56IK78P:00000001": done reading request body.
2025-08-27 01:38:39.042 +03:00 [DBG] Connection id "0HNF4U56IK78Q" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:38:39.045 +03:00 [DBG] Connection id "0HNF4U56IK78Q" disconnecting.
2025-08-27 01:38:39.046 +03:00 [DBG] Connection id "0HNF4U56IK78Q" stopped.
2025-08-27 01:38:39.075 +03:00 [DBG] Connection 0HNF4U56IK78R established using the following protocol: "Tls13"
2025-08-27 01:38:39.078 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:38:39.081 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:38:39.082 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:38:39.084 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:38:39.087 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:38:39.102 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:38:39.104 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:38:39.106 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:38:39.107 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:38:39.109 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:38:39.110 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:38:39.112 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:38:39.193 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 01:38:39.703 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:38:39.713 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:38:39.715 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:38:39.719 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:38:39.722 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:38:39.724 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:38:39.725 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:38:39.726 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:38:39.728 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:38:39.731 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:38:39.732 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:38:39.734 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:38:39.747 +03:00 [DBG] Connection id "0HNF4U56IK78R", Request id "0HNF4U56IK78R:00000001": started reading request body.
2025-08-27 01:38:39.749 +03:00 [DBG] Connection id "0HNF4U56IK78R", Request id "0HNF4U56IK78R:00000001": done reading request body.
2025-08-27 01:38:39.756 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:38:39.757 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:38:39.758 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:38:39.759 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:38:39.765 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:38:39.767 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:38:39.769 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:38:39.769 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:38:39.771 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:38:39.780 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:38:39.847 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-08-27 01:38:39.886 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-08-27 01:38:40.191 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<Name>k__BackingField = dataReader.GetString(3);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(4));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(5);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(6) ? default(Guid?) : (Guid?)dataReader.GetGuid(6) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(6) ? default(object) : (object)dataReader.GetGuid(6) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(6) ? default(Guid) : dataReader.GetGuid(6);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(8) ? default(string) : dataReader.GetString(8);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(10) ? default(DateTime) : dataReader.GetDateTime(10);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 01:38:40.230 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:38:40.243 +03:00 [DBG] Created DbConnection. (14ms).
2025-08-27 01:38:40.255 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:38:40.269 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:38:40.283 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:38:40.289 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-08-27 01:38:40.296 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (12ms).
2025-08-27 01:38:40.305 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:38:40.325 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:38:40.368 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:38:40.401 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:38:40.413 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 78ms reading results.
2025-08-27 01:38:40.417 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:38:40.421 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (3ms).
2025-08-27 01:38:40.431 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:38:40.435 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:38:40.436 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:38:40.437 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:38:40.438 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:38:40.440 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:38:40.441 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:38:40.443 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:38:40.447 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:38:40.448 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 01:38:40.449 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:38:40.451 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:38:40.460 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:38:40.475 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:38:40.478 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:38:40.596 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:38:40.615 +03:00 [INF] Converting natural language to SQL. User query: Delete products that is in category called samsung
2025-08-27 01:38:40.617 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:38:40.618 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:38:40.626 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:38:41.569 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:38:41.579 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:38:41.582 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:38:41.583 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:38:41.584 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:38:41.585 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:38:41.586 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:38:41.587 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:38:41.588 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:38:41.590 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:38:41.591 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:38:41.593 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:38:41.594 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:38:41.596 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:38:41.597 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:38:41.598 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:38:41.599 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:38:41.600 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:38:41.601 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:38:41.602 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:38:41.604 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:38:41.606 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:38:41.607 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:38:41.609 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:38:41.611 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:38:41.612 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:38:41.613 +03:00 [INF] Executing SQL for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", Mode="Write"
2025-08-27 01:38:41.615 +03:00 [INF] Executing SQL on DESKTOP-QCK8UI5\SQLEXPRESS/ProductInventory (Mode="Write")
2025-08-27 01:38:41.616 +03:00 [DBG] SQL: DELETE FROM Products WHERE CategoryId IN (SELECT Id FROM Categories WHERE Name = @param1);
2025-08-27 01:38:41.618 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:38:41.783 +03:00 [DBG] Connection opened to DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 01:38:48.915 +03:00 [INF] Non-query execution finished in 7296 ms, affected 0 rows
2025-08-27 01:38:48.922 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:38:48.923 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:38:48.924 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:38:48.926 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:38:48.927 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:38:48.929 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:38:48.931 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:38:48.933 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:38:48.934 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:38:48.936 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:38:48.937 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:38:48.954 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Any(p => (int)p.Provider == (int)__profile_Provider_0)'
2025-08-27 01:38:48.963 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 01:38:48.970 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:38:48.971 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:38:48.973 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:38:48.974 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:38:48.976 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2025-08-27 01:38:48.977 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:38:48.980 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:38:48.981 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:38:48.983 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:38:48.985 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:38:48.986 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:38:49.019 +03:00 [ERR] Failed to persist query to DB for userQuery=Delete products that is in category called samsung
2025-08-27 01:38:49.024 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 01:38:49.028 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 01:38:49.029 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 01:38:49.030 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 01:38:49.032 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 01:38:49.033 +03:00 [INF] Executing OkObjectResult, writing value of type 'NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult'.
2025-08-27 01:38:49.041 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 9927.5578ms
2025-08-27 01:38:49.043 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:38:49.046 +03:00 [DBG] Connection id "0HNF4U56IK78R" completed keep alive response.
2025-08-27 01:38:49.050 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:38:49.054 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:38:49.056 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:38:49.059 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 200 null application/json; charset=utf-8 9980.6572ms
2025-08-27 01:43:30.144 +03:00 [INF] This is a test log to file!
2025-08-27 01:43:30.333 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 01:43:30.342 +03:00 [INF] API configured successfully.
2025-08-27 01:43:30.344 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:43:30.344 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:43:30.403 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 01:43:30.453 +03:00 [DBG] Hosting starting
2025-08-27 01:43:30.463 +03:00 [DBG] Middleware loaded
2025-08-27 01:43:30.466 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 01:43:30.468 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 01:43:30.544 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 01:43:30.548 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 01:43:30.558 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 01:43:30.591 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 01:43:30.675 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 01:43:30.677 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 01:43:30.678 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 01:43:30.678 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 01:43:30.679 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 01:43:30.680 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 01:43:30.686 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:43:30.688 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:43:30.775 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 01:43:30.776 +03:00 [INF] Hosting environment: Development
2025-08-27 01:43:30.776 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 01:43:30.777 +03:00 [DBG] Hosting started
2025-08-27 01:43:46.172 +03:00 [DBG] Connection id "0HNF4U824M15T" received FIN.
2025-08-27 01:43:46.176 +03:00 [DBG] Connection id "0HNF4U824M15T" accepted.
2025-08-27 01:43:46.178 +03:00 [DBG] Connection id "0HNF4U824M15T" started.
2025-08-27 01:43:46.179 +03:00 [DBG] Connection id "0HNF4U824M15U" accepted.
2025-08-27 01:43:46.180 +03:00 [DBG] Connection id "0HNF4U824M15U" started.
2025-08-27 01:43:46.185 +03:00 [DBG] Connection id "0HNF4U824M15T" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:43:46.188 +03:00 [DBG] Connection id "0HNF4U824M15T" disconnecting.
2025-08-27 01:43:46.190 +03:00 [DBG] Connection id "0HNF4U824M15T" stopped.
2025-08-27 01:43:46.204 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:43:46.231 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:43:46.233 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:43:46.236 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:43:46.258 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-08-27 01:43:46.260 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:43:46.269 +03:00 [DBG] Connection id "0HNF4U824M15U" completed keep alive response.
2025-08-27 01:43:46.271 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 72.002ms
2025-08-27 01:43:46.272 +03:00 [DBG] Connection id "0HNF4U824M160" accepted.
2025-08-27 01:43:46.272 +03:00 [DBG] Connection id "0HNF4U824M15V" received FIN.
2025-08-27 01:43:46.272 +03:00 [DBG] Connection id "0HNF4U824M15V" accepted.
2025-08-27 01:43:46.301 +03:00 [DBG] Connection id "0HNF4U824M160" started.
2025-08-27 01:43:46.301 +03:00 [DBG] Connection id "0HNF4U824M15U", Request id "0HNF4U824M15U:00000001": started reading request body.
2025-08-27 01:43:46.302 +03:00 [DBG] Connection id "0HNF4U824M15V" started.
2025-08-27 01:43:46.304 +03:00 [DBG] Connection id "0HNF4U824M15U", Request id "0HNF4U824M15U:00000001": done reading request body.
2025-08-27 01:43:46.305 +03:00 [DBG] Connection id "0HNF4U824M15V" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:43:46.309 +03:00 [DBG] Connection id "0HNF4U824M15V" disconnecting.
2025-08-27 01:43:46.311 +03:00 [DBG] Connection id "0HNF4U824M15V" stopped.
2025-08-27 01:43:46.336 +03:00 [DBG] Connection 0HNF4U824M160 established using the following protocol: "Tls13"
2025-08-27 01:43:46.339 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 87
2025-08-27 01:43:46.343 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:43:46.344 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:43:46.345 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:43:46.350 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:43:46.366 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:43:46.369 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:43:46.371 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:43:46.373 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:43:46.375 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:43:46.376 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:43:46.379 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:43:46.465 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 01:43:46.907 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:43:46.918 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:43:46.920 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:43:46.926 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:43:46.929 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:43:46.931 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:43:46.932 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:43:46.933 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:43:46.936 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:43:46.938 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:43:46.939 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:43:46.942 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:43:46.952 +03:00 [DBG] Connection id "0HNF4U824M160", Request id "0HNF4U824M160:00000001": started reading request body.
2025-08-27 01:43:46.954 +03:00 [DBG] Connection id "0HNF4U824M160", Request id "0HNF4U824M160:00000001": done reading request body.
2025-08-27 01:43:46.960 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:43:46.962 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:43:46.963 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:43:46.964 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:43:46.970 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:43:46.971 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:43:46.973 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:43:46.974 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:43:46.975 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:43:46.984 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:43:47.043 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-08-27 01:43:47.089 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-08-27 01:43:47.309 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<Name>k__BackingField = dataReader.GetString(3);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(4));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(5);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(6) ? default(Guid?) : (Guid?)dataReader.GetGuid(6) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(6) ? default(object) : (object)dataReader.GetGuid(6) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(6) ? default(Guid) : dataReader.GetGuid(6);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(8) ? default(string) : dataReader.GetString(8);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(10) ? default(DateTime) : dataReader.GetDateTime(10);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 01:43:47.341 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:43:47.351 +03:00 [DBG] Created DbConnection. (10ms).
2025-08-27 01:43:47.355 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:43:47.364 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:43:47.367 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:43:47.372 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:43:47.376 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-08-27 01:43:47.383 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:43:47.398 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:43:47.431 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:43:47.457 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:43:47.463 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 58ms reading results.
2025-08-27 01:43:47.467 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:43:47.471 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (4ms).
2025-08-27 01:43:47.478 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:43:47.481 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:43:47.483 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:43:47.483 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:43:47.484 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:43:47.485 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:43:47.487 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:43:47.489 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:43:47.491 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:43:47.493 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 01:43:47.494 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:43:47.495 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:43:47.504 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:43:47.515 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:43:47.517 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:43:47.610 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:43:47.630 +03:00 [INF] Converting natural language to SQL. User query: Delete products that is in category called samsung
2025-08-27 01:43:47.633 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:43:47.634 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:43:47.641 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:43:48.523 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:43:48.533 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:43:48.537 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:43:48.538 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:43:48.540 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:43:48.541 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:43:48.542 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:43:48.544 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:43:48.545 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:43:48.548 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:43:48.549 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:43:48.550 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:43:48.551 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:43:48.553 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:43:48.555 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:43:48.556 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:43:48.557 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:43:48.557 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:43:48.558 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:43:48.559 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:43:48.561 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:43:48.562 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:43:48.563 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:43:48.564 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:43:48.566 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:43:48.567 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:43:48.568 +03:00 [INF] Executing SQL for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", Mode="Write"
2025-08-27 01:43:48.570 +03:00 [INF] Executing SQL on DESKTOP-QCK8UI5\SQLEXPRESS/ProductInventory (Mode="Write")
2025-08-27 01:43:48.572 +03:00 [DBG] SQL: DELETE FROM Products WHERE CategoryId IN (SELECT Id FROM Categories WHERE Name = @param1);
2025-08-27 01:43:48.574 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:43:48.740 +03:00 [DBG] Connection opened to DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 01:46:56.141 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=true)
2025-08-27 01:46:56.177 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:46:56.188 +03:00 [DBG] Connected to database for schema extraction (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:46:56.268 +03:00 [INF] Loaded 3 tables
2025-08-27 01:46:56.477 +03:00 [INF] Schema loaded: 3 tables, 10 columns, 1 relations
2025-08-27 01:46:56.489 +03:00 [DBG] Saved cache file C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer\SqlServer_schemas.json
2025-08-27 01:46:56.490 +03:00 [INF] Cached schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory to C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer\SqlServer_schemas.json
2025-08-27 01:46:56.491 +03:00 [INF] Non-query execution finished in 187540 ms, affected 0 rows
2025-08-27 01:46:56.494 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:46:56.499 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:46:56.506 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:46:56.508 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:46:56.509 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:46:56.510 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:46:56.512 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:46:56.514 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:46:56.515 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:46:56.516 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:46:56.518 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-08-27 01:46:56.541 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Any(p => (int)p.Provider == (int)__profile_Provider_0)'
2025-08-27 01:46:56.559 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 01:46:56.563 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:46:56.566 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:46:56.567 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:46:56.568 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:46:56.570 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2025-08-27 01:46:56.578 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:46:56.580 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:46:56.583 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:46:56.583 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:46:56.585 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:46:56.586 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:46:56.648 +03:00 [ERR] Failed to persist query to DB for userQuery=Delete products that is in category called samsung
2025-08-27 01:46:56.655 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 01:46:56.659 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 01:46:56.660 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 01:46:56.660 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 01:46:56.661 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 01:46:56.663 +03:00 [INF] Executing OkObjectResult, writing value of type 'NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult'.
2025-08-27 01:46:56.673 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 190290.8487ms
2025-08-27 01:46:56.674 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:46:56.677 +03:00 [DBG] Connection id "0HNF4U824M160" completed keep alive response.
2025-08-27 01:46:56.681 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:46:56.687 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:46:56.689 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-08-27 01:46:56.692 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 200 null application/json; charset=utf-8 190352.7157ms
2025-08-27 01:48:40.458 +03:00 [DBG] Connection id "0HNF4U824M161" received FIN.
2025-08-27 01:48:40.460 +03:00 [DBG] Connection id "0HNF4U824M161" accepted.
2025-08-27 01:48:40.464 +03:00 [DBG] Connection id "0HNF4U824M161" started.
2025-08-27 01:48:40.465 +03:00 [DBG] Connection id "0HNF4U824M162" accepted.
2025-08-27 01:48:40.469 +03:00 [DBG] Connection id "0HNF4U824M161" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:48:40.470 +03:00 [DBG] Connection id "0HNF4U824M162" started.
2025-08-27 01:48:40.471 +03:00 [DBG] Connection id "0HNF4U824M161" disconnecting.
2025-08-27 01:48:40.472 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 86
2025-08-27 01:48:40.472 +03:00 [DBG] Connection id "0HNF4U824M161" stopped.
2025-08-27 01:48:40.474 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:48:40.475 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:48:40.476 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:48:40.478 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:48:40.479 +03:00 [DBG] Connection id "0HNF4U824M162" completed keep alive response.
2025-08-27 01:48:40.480 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 8.2005ms
2025-08-27 01:48:40.481 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 86
2025-08-27 01:48:40.482 +03:00 [DBG] Connection id "0HNF4U824M162", Request id "0HNF4U824M162:00000001": started reading request body.
2025-08-27 01:48:40.484 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:48:40.485 +03:00 [DBG] Connection id "0HNF4U824M162", Request id "0HNF4U824M162:00000001": done reading request body.
2025-08-27 01:48:40.485 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:48:40.488 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:48:40.489 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:48:40.490 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:48:40.491 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:48:40.492 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:48:40.493 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:48:40.495 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:48:40.496 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:48:40.497 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:48:40.530 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:48:40.532 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:48:40.533 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:48:40.534 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:48:40.535 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:48:40.536 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:48:40.537 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:48:40.538 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:48:40.539 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:48:40.540 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:48:40.541 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:48:40.542 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:48:40.543 +03:00 [DBG] Connection id "0HNF4U824M160", Request id "0HNF4U824M160:00000002": started reading request body.
2025-08-27 01:48:40.544 +03:00 [DBG] Connection id "0HNF4U824M160", Request id "0HNF4U824M160:00000002": done reading request body.
2025-08-27 01:48:40.545 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:48:40.546 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:48:40.547 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:48:40.548 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:48:40.549 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:48:40.550 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:48:40.552 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:48:40.553 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:48:40.554 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:48:40.555 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:48:40.556 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:48:40.556 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 01:48:40.557 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:48:40.558 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:40.559 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:48:40.559 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:48:40.560 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:48:40.561 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:48:40.562 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:48:40.564 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:48:40.565 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:40.566 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 01:48:40.567 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:40.568 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:48:40.570 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:48:40.571 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:48:40.572 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:40.573 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:48:40.574 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:48:40.575 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:48:40.576 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:48:40.577 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:48:40.579 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:40.580 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:48:40.581 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:40.582 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:48:40.583 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:48:40.584 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:48:40.584 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:48:40.586 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:48:40.587 +03:00 [INF] Converting natural language to SQL. User query: Delete products that is in category called phones
2025-08-27 01:48:40.587 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:48:40.588 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:48:40.589 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:48:41.447 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:48:41.448 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:48:41.449 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:48:41.450 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:41.451 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:48:41.452 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:48:41.453 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:48:41.454 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:48:41.455 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:48:41.457 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:41.459 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:48:41.460 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:41.461 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:48:41.462 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:48:41.463 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:48:41.464 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:41.464 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:48:41.465 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:48:41.466 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:48:41.467 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:48:41.469 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:48:41.471 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:41.471 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:48:41.472 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:41.473 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:48:41.475 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:48:41.475 +03:00 [INF] Executing SQL for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", Mode="Write"
2025-08-27 01:48:41.476 +03:00 [INF] Executing SQL on DESKTOP-QCK8UI5\SQLEXPRESS/ProductInventory (Mode="Write")
2025-08-27 01:48:41.477 +03:00 [DBG] SQL: DELETE FROM Products WHERE CategoryId IN (SELECT Id FROM Categories WHERE Name = @param1);
2025-08-27 01:48:41.478 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:48:41.480 +03:00 [DBG] Connection opened to DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 01:48:42.455 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=true)
2025-08-27 01:48:42.456 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:48:42.457 +03:00 [DBG] Connected to database for schema extraction (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:48:42.471 +03:00 [INF] Loaded 3 tables
2025-08-27 01:48:42.621 +03:00 [INF] Schema loaded: 3 tables, 10 columns, 1 relations
2025-08-27 01:48:42.626 +03:00 [DBG] Saved cache file C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer\SqlServer_schemas.json
2025-08-27 01:48:42.627 +03:00 [INF] Cached schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory to C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer\SqlServer_schemas.json
2025-08-27 01:48:42.627 +03:00 [INF] Non-query execution finished in 976 ms, affected 3 rows
2025-08-27 01:48:42.628 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:48:42.629 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:42.630 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:48:42.631 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:48:42.632 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:48:42.633 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:48:42.634 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:48:42.636 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:42.637 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:48:42.638 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:42.639 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:48:42.640 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:48:42.641 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:42.642 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:48:42.643 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:48:42.644 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:48:42.645 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:48:42.646 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:48:42.648 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:42.648 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:48:42.650 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:42.650 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:48:42.687 +03:00 [ERR] Failed to persist query to DB for userQuery=Delete products that is in category called phones
2025-08-27 01:48:42.688 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 01:48:42.690 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 01:48:42.690 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 01:48:42.691 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 01:48:42.692 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 01:48:42.693 +03:00 [INF] Executing OkObjectResult, writing value of type 'NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult'.
2025-08-27 01:48:42.694 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 2197.3925ms
2025-08-27 01:48:42.695 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:48:42.696 +03:00 [DBG] Connection id "0HNF4U824M160" completed keep alive response.
2025-08-27 01:48:42.698 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:48:42.699 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:48:42.700 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:48:42.701 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 200 null application/json; charset=utf-8 2220.106ms
2025-08-27 01:48:59.750 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 86
2025-08-27 01:48:59.752 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:48:59.753 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:48:59.754 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:48:59.755 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:48:59.755 +03:00 [DBG] Connection id "0HNF4U824M162" completed keep alive response.
2025-08-27 01:48:59.756 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 6.1386ms
2025-08-27 01:48:59.756 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 86
2025-08-27 01:48:59.759 +03:00 [DBG] Connection id "0HNF4U824M162", Request id "0HNF4U824M162:00000002": started reading request body.
2025-08-27 01:48:59.760 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:48:59.761 +03:00 [DBG] Connection id "0HNF4U824M162", Request id "0HNF4U824M162:00000002": done reading request body.
2025-08-27 01:48:59.762 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:48:59.764 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:48:59.766 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:48:59.767 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:48:59.768 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:48:59.769 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:48:59.770 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:48:59.771 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:48:59.772 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:48:59.773 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:48:59.787 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:48:59.790 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:48:59.791 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:48:59.792 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:48:59.793 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:48:59.795 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:48:59.795 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:48:59.796 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:48:59.797 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:48:59.798 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:48:59.799 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:48:59.800 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:48:59.800 +03:00 [DBG] Connection id "0HNF4U824M160", Request id "0HNF4U824M160:00000003": started reading request body.
2025-08-27 01:48:59.801 +03:00 [DBG] Connection id "0HNF4U824M160", Request id "0HNF4U824M160:00000003": done reading request body.
2025-08-27 01:48:59.802 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:48:59.803 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:48:59.804 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:48:59.804 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:48:59.805 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:48:59.806 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:48:59.807 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:48:59.808 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:48:59.808 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:48:59.809 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:48:59.811 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:48:59.811 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 01:48:59.812 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:48:59.813 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:59.814 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:48:59.815 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:48:59.816 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:48:59.817 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:48:59.818 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:48:59.820 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:48:59.821 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:59.822 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:48:59.823 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:59.823 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:48:59.825 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:48:59.826 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:48:59.827 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:59.827 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:48:59.828 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:48:59.829 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:48:59.830 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:48:59.831 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:48:59.832 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:59.833 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:48:59.834 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:48:59.835 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:48:59.836 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:48:59.836 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:48:59.837 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:48:59.839 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:48:59.839 +03:00 [INF] Converting natural language to SQL. User query: Delete products that is in category called phones
2025-08-27 01:48:59.840 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:48:59.840 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:48:59.841 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:49:00.582 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:49:00.583 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:49:00.836 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 1063.0769ms
2025-08-27 01:49:00.921 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:49:01.080 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Conversion produced no SQL.
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ExecuteQueryAsync(Guid profileId, String naturalLanguage, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 47
   at NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery(Guid profileId, ExecuteQueryRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 60
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 01:49:01.090 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 01:49:01.096 +03:00 [DBG] Connection id "0HNF4U824M160" completed keep alive response.
2025-08-27 01:49:01.097 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:49:01.098 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:49:01.099 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:49:01.100 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 500 null application/json; charset=utf-8 1343.3527ms
2025-08-27 01:49:18.377 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 86
2025-08-27 01:49:18.379 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:49:18.380 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:49:18.381 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:49:18.382 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:49:18.383 +03:00 [DBG] Connection id "0HNF4U824M162" completed keep alive response.
2025-08-27 01:49:18.384 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 7.0618ms
2025-08-27 01:49:18.384 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 86
2025-08-27 01:49:18.386 +03:00 [DBG] Connection id "0HNF4U824M162", Request id "0HNF4U824M162:00000003": started reading request body.
2025-08-27 01:49:18.388 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:49:18.389 +03:00 [DBG] Connection id "0HNF4U824M162", Request id "0HNF4U824M162:00000003": done reading request body.
2025-08-27 01:49:18.389 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:49:18.391 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:49:18.392 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:49:18.392 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:49:18.394 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:49:18.395 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:49:18.396 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:49:18.398 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:49:18.398 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:49:18.399 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:49:18.401 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:49:18.402 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:49:18.403 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:49:18.404 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:49:18.405 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:49:18.406 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:49:18.407 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:49:18.407 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:49:18.408 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:49:18.409 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:49:18.410 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:49:18.411 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:49:18.412 +03:00 [DBG] Connection id "0HNF4U824M160", Request id "0HNF4U824M160:00000004": started reading request body.
2025-08-27 01:49:18.413 +03:00 [DBG] Connection id "0HNF4U824M160", Request id "0HNF4U824M160:00000004": done reading request body.
2025-08-27 01:49:18.414 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:49:18.415 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:49:18.416 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:49:18.417 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:49:18.417 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:49:18.419 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:49:18.420 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:49:18.421 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:49:18.422 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:49:18.422 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:49:18.423 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:49:18.424 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 01:49:18.425 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:49:18.426 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:49:18.427 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:49:18.428 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:49:18.429 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:49:18.430 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:49:18.431 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:49:18.433 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:49:18.434 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:49:18.435 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 01:49:18.436 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:49:18.437 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:49:18.439 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:49:18.440 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:49:18.441 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:49:18.441 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:49:18.442 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:49:18.443 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:49:18.444 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:49:18.445 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:49:18.447 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:49:18.448 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:49:18.449 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:49:18.450 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:49:18.452 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:49:18.453 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:49:18.453 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:49:18.455 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:49:18.460 +03:00 [INF] Converting natural language to SQL. User query: Delete products that is in category called phones
2025-08-27 01:49:18.461 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:49:18.462 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:49:18.463 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:49:19.221 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:49:19.224 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:49:19.452 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 1053.2559ms
2025-08-27 01:49:19.533 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:49:19.682 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Conversion produced no SQL.
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ExecuteQueryAsync(Guid profileId, String naturalLanguage, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 47
   at NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery(Guid profileId, ExecuteQueryRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 60
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 01:49:19.686 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 01:49:19.687 +03:00 [DBG] Connection id "0HNF4U824M160" completed keep alive response.
2025-08-27 01:49:19.688 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:49:19.689 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:49:19.690 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:49:19.691 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 500 null application/json; charset=utf-8 1307.2232ms
2025-08-27 01:50:23.243 +03:00 [INF] This is a test log to file!
2025-08-27 01:50:23.395 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 01:50:23.403 +03:00 [INF] API configured successfully.
2025-08-27 01:50:23.403 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:50:23.404 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:50:23.453 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 01:50:23.507 +03:00 [DBG] Hosting starting
2025-08-27 01:50:23.526 +03:00 [DBG] Middleware loaded
2025-08-27 01:50:23.528 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 01:50:23.530 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 01:50:23.608 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 01:50:23.611 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 01:50:23.619 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 01:50:23.649 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 01:50:23.696 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 01:50:23.698 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 01:50:23.699 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 01:50:23.700 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 01:50:23.701 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 01:50:23.702 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 01:50:23.709 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:50:23.711 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:50:23.795 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 01:50:23.797 +03:00 [INF] Hosting environment: Development
2025-08-27 01:50:23.797 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 01:50:23.799 +03:00 [DBG] Hosting started
2025-08-27 01:50:34.825 +03:00 [DBG] Connection id "0HNF4UBRTSVOJ" received FIN.
2025-08-27 01:50:34.830 +03:00 [DBG] Connection id "0HNF4UBRTSVOJ" accepted.
2025-08-27 01:50:34.832 +03:00 [DBG] Connection id "0HNF4UBRTSVOJ" started.
2025-08-27 01:50:34.832 +03:00 [DBG] Connection id "0HNF4UBRTSVOK" accepted.
2025-08-27 01:50:34.834 +03:00 [DBG] Connection id "0HNF4UBRTSVOK" started.
2025-08-27 01:50:34.839 +03:00 [DBG] Connection id "0HNF4UBRTSVOJ" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:50:34.842 +03:00 [DBG] Connection id "0HNF4UBRTSVOJ" disconnecting.
2025-08-27 01:50:34.844 +03:00 [DBG] Connection id "0HNF4UBRTSVOJ" stopped.
2025-08-27 01:50:34.858 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 86
2025-08-27 01:50:34.885 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:50:34.888 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:50:34.890 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:50:34.911 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-08-27 01:50:34.913 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:50:34.920 +03:00 [DBG] Connection id "0HNF4UBRTSVOK" completed keep alive response.
2025-08-27 01:50:34.922 +03:00 [DBG] Connection id "0HNF4UBRTSVOL" accepted.
2025-08-27 01:50:34.922 +03:00 [DBG] Connection id "0HNF4UBRTSVOM" accepted.
2025-08-27 01:50:34.922 +03:00 [DBG] Connection id "0HNF4UBRTSVOL" received FIN.
2025-08-27 01:50:34.922 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 68.2255ms
2025-08-27 01:50:34.926 +03:00 [DBG] Connection id "0HNF4UBRTSVOL" started.
2025-08-27 01:50:34.927 +03:00 [DBG] Connection id "0HNF4UBRTSVOM" started.
2025-08-27 01:50:34.933 +03:00 [DBG] Connection id "0HNF4UBRTSVOL" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:50:34.933 +03:00 [DBG] Connection id "0HNF4UBRTSVOK", Request id "0HNF4UBRTSVOK:00000001": started reading request body.
2025-08-27 01:50:34.935 +03:00 [DBG] Connection id "0HNF4UBRTSVOL" disconnecting.
2025-08-27 01:50:34.938 +03:00 [DBG] Connection id "0HNF4UBRTSVOK", Request id "0HNF4UBRTSVOK:00000001": done reading request body.
2025-08-27 01:50:34.939 +03:00 [DBG] Connection id "0HNF4UBRTSVOL" stopped.
2025-08-27 01:50:34.965 +03:00 [DBG] Connection 0HNF4UBRTSVOM established using the following protocol: "Tls13"
2025-08-27 01:50:34.968 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 86
2025-08-27 01:50:34.971 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:50:34.973 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:50:34.974 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:50:34.977 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:50:34.993 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:50:34.996 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:50:34.997 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:50:34.999 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:50:35.001 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:50:35.002 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:50:35.005 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:50:35.086 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 01:50:35.523 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:50:35.533 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:50:35.534 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:50:35.538 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:50:35.541 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:50:35.543 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:50:35.545 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:50:35.546 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:50:35.549 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:50:35.551 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:50:35.553 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:50:35.555 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:50:35.568 +03:00 [DBG] Connection id "0HNF4UBRTSVOM", Request id "0HNF4UBRTSVOM:00000001": started reading request body.
2025-08-27 01:50:35.570 +03:00 [DBG] Connection id "0HNF4UBRTSVOM", Request id "0HNF4UBRTSVOM:00000001": done reading request body.
2025-08-27 01:50:35.576 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:50:35.577 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:50:35.578 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:50:35.579 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:50:35.597 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:50:35.601 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:50:35.605 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:50:35.607 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:50:35.611 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:50:35.629 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:50:35.686 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-08-27 01:50:35.721 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-08-27 01:50:35.962 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<Name>k__BackingField = dataReader.GetString(3);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(4));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(5);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(6) ? default(Guid?) : (Guid?)dataReader.GetGuid(6) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(6) ? default(object) : (object)dataReader.GetGuid(6) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(6) ? default(Guid) : dataReader.GetGuid(6);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(8) ? default(string) : dataReader.GetString(8);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(10) ? default(DateTime) : dataReader.GetDateTime(10);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 01:50:35.993 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:50:36.002 +03:00 [DBG] Created DbConnection. (10ms).
2025-08-27 01:50:36.006 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:50:36.018 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:50:36.022 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:50:36.027 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-08-27 01:50:36.032 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (10ms).
2025-08-27 01:50:36.039 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:50:36.054 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:50:36.086 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:50:36.110 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:50:36.117 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 57ms reading results.
2025-08-27 01:50:36.120 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:50:36.124 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (3ms).
2025-08-27 01:50:36.133 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:50:36.136 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:50:36.137 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:50:36.139 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:50:36.140 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:50:36.141 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:50:36.142 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:50:36.143 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:50:36.147 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:50:36.148 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 01:50:36.149 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:50:36.150 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:50:36.159 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:50:36.171 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:50:36.173 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:50:36.263 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:50:36.281 +03:00 [INF] Converting natural language to SQL. User query: Delete products that is in category called phones
2025-08-27 01:50:36.284 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:50:36.286 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:50:36.293 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:50:37.175 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:50:37.187 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:50:37.188 +03:00 [WRN] Query conversion flagged as unsafe for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647". Intent: DELETE. Issues: Destructive operation (DELETE) not allowed.
2025-08-27 01:50:37.461 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 2455.6653ms
2025-08-27 01:50:37.545 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:50:37.704 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Converted query is not marked safe and will not be executed.
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ExecuteQueryAsync(Guid profileId, String naturalLanguage, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 50
   at NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery(Guid profileId, ExecuteQueryRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 60
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 01:50:37.714 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 01:50:37.722 +03:00 [DBG] Connection id "0HNF4UBRTSVOM" completed keep alive response.
2025-08-27 01:50:37.728 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:50:37.732 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:50:37.734 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:50:37.735 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 500 null application/json; charset=utf-8 2767.2499ms
2025-08-27 01:51:40.299 +03:00 [INF] This is a test log to file!
2025-08-27 01:51:40.436 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 01:51:40.444 +03:00 [INF] API configured successfully.
2025-08-27 01:51:40.445 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:51:40.446 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:51:40.493 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 01:51:40.538 +03:00 [DBG] Hosting starting
2025-08-27 01:51:40.553 +03:00 [DBG] Middleware loaded
2025-08-27 01:51:40.555 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 01:51:40.557 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 01:51:40.650 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 01:51:40.653 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 01:51:40.661 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 01:51:40.726 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 01:51:40.891 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 01:51:40.894 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 01:51:40.895 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 01:51:40.895 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 01:51:40.897 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 01:51:40.897 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 01:51:40.907 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:51:40.909 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:51:40.983 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 01:51:40.991 +03:00 [INF] Hosting environment: Development
2025-08-27 01:51:40.992 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 01:51:40.993 +03:00 [DBG] Hosting started
2025-08-27 01:52:08.004 +03:00 [INF] This is a test log to file!
2025-08-27 01:52:08.259 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 01:52:08.277 +03:00 [INF] API configured successfully.
2025-08-27 01:52:08.279 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:52:08.280 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:52:08.347 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 01:52:08.411 +03:00 [DBG] Hosting starting
2025-08-27 01:52:08.439 +03:00 [DBG] Middleware loaded
2025-08-27 01:52:08.442 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 01:52:08.444 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 01:52:08.539 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 01:52:08.543 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 01:52:08.553 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 01:52:08.594 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 01:52:08.672 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 01:52:08.673 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 01:52:08.674 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 01:52:08.675 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 01:52:08.676 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 01:52:08.676 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 01:52:08.683 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:52:08.685 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:52:08.796 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 01:52:08.797 +03:00 [INF] Hosting environment: Development
2025-08-27 01:52:08.798 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 01:52:08.799 +03:00 [DBG] Hosting started
2025-08-27 01:52:13.861 +03:00 [DBG] Connection id "0HNF4UCPECD90" received FIN.
2025-08-27 01:52:13.865 +03:00 [DBG] Connection id "0HNF4UCPECD90" accepted.
2025-08-27 01:52:13.866 +03:00 [DBG] Connection id "0HNF4UCPECD90" started.
2025-08-27 01:52:13.867 +03:00 [DBG] Connection id "0HNF4UCPECD91" accepted.
2025-08-27 01:52:13.868 +03:00 [DBG] Connection id "0HNF4UCPECD91" started.
2025-08-27 01:52:13.874 +03:00 [DBG] Connection id "0HNF4UCPECD90" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:52:13.877 +03:00 [DBG] Connection id "0HNF4UCPECD90" disconnecting.
2025-08-27 01:52:13.878 +03:00 [DBG] Connection id "0HNF4UCPECD90" stopped.
2025-08-27 01:52:13.894 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 86
2025-08-27 01:52:13.924 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:52:13.926 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:52:13.928 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:52:13.951 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-08-27 01:52:13.953 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:52:13.960 +03:00 [DBG] Connection id "0HNF4UCPECD91" completed keep alive response.
2025-08-27 01:52:13.962 +03:00 [DBG] Connection id "0HNF4UCPECD92" accepted.
2025-08-27 01:52:13.963 +03:00 [DBG] Connection id "0HNF4UCPECD92" received FIN.
2025-08-27 01:52:13.964 +03:00 [DBG] Connection id "0HNF4UCPECD92" started.
2025-08-27 01:52:13.963 +03:00 [DBG] Connection id "0HNF4UCPECD93" accepted.
2025-08-27 01:52:13.963 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 72.8123ms
2025-08-27 01:52:13.969 +03:00 [DBG] Connection id "0HNF4UCPECD92" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:52:13.970 +03:00 [DBG] Connection id "0HNF4UCPECD93" started.
2025-08-27 01:52:13.975 +03:00 [DBG] Connection id "0HNF4UCPECD91", Request id "0HNF4UCPECD91:00000001": started reading request body.
2025-08-27 01:52:13.975 +03:00 [DBG] Connection id "0HNF4UCPECD92" disconnecting.
2025-08-27 01:52:13.977 +03:00 [DBG] Connection id "0HNF4UCPECD91", Request id "0HNF4UCPECD91:00000001": done reading request body.
2025-08-27 01:52:13.977 +03:00 [DBG] Connection id "0HNF4UCPECD92" stopped.
2025-08-27 01:52:14.006 +03:00 [DBG] Connection 0HNF4UCPECD93 established using the following protocol: "Tls13"
2025-08-27 01:52:14.009 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 86
2025-08-27 01:52:14.012 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:52:14.013 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:52:14.014 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:52:14.018 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:52:14.036 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:52:14.038 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:52:14.039 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:52:14.041 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:52:14.042 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:52:14.043 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:52:14.045 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:52:14.129 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 01:52:14.609 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:52:14.618 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:52:14.620 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:52:14.624 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:52:14.626 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:52:14.628 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:52:14.629 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:52:14.630 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:52:14.632 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:52:14.635 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:52:14.636 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:52:14.638 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:52:14.650 +03:00 [DBG] Connection id "0HNF4UCPECD93", Request id "0HNF4UCPECD93:00000001": started reading request body.
2025-08-27 01:52:14.651 +03:00 [DBG] Connection id "0HNF4UCPECD93", Request id "0HNF4UCPECD93:00000001": done reading request body.
2025-08-27 01:52:14.658 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:52:14.659 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:52:14.660 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:52:14.661 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:52:14.668 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:52:14.669 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:52:14.671 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:52:14.672 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:52:14.672 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:52:14.681 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:52:14.728 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-08-27 01:52:14.763 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-08-27 01:52:14.993 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<Name>k__BackingField = dataReader.GetString(3);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(4));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(5);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(6) ? default(Guid?) : (Guid?)dataReader.GetGuid(6) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(6) ? default(object) : (object)dataReader.GetGuid(6) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(6) ? default(Guid) : dataReader.GetGuid(6);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(8) ? default(string) : dataReader.GetString(8);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(10) ? default(DateTime) : dataReader.GetDateTime(10);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 01:52:15.022 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:52:15.031 +03:00 [DBG] Created DbConnection. (9ms).
2025-08-27 01:52:15.035 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:52:15.043 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:52:15.048 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:52:15.053 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:52:15.056 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2025-08-27 01:52:15.062 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:52:15.079 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:52:15.110 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:52:15.133 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:52:15.139 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 54ms reading results.
2025-08-27 01:52:15.143 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:52:15.146 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-08-27 01:52:15.154 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:52:15.157 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:52:15.158 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:52:15.158 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:52:15.159 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:52:15.161 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:52:15.162 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:52:15.164 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:52:15.166 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:52:15.168 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 3ms reading results.
2025-08-27 01:52:15.169 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:52:15.170 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:52:15.180 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:52:15.191 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:52:15.194 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:52:15.346 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:52:15.372 +03:00 [INF] Converting natural language to SQL. User query: Delete products that is in category called phones
2025-08-27 01:52:15.374 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:52:15.375 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:52:15.394 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:52:16.401 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:52:16.412 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:52:16.414 +03:00 [WRN] Query conversion flagged as unsafe for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647". Intent: DELETE. Issues: Destructive operation (DELETE) not allowed.
2025-08-27 01:52:16.694 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 2647.7295ms
2025-08-27 01:52:16.792 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:52:16.957 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Converted query is not marked as safe. It may modify data. To execute it, you must explicitly allow data modifications in your profile settings.
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ExecuteQueryAsync(Guid profileId, String naturalLanguage, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 53
   at NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery(Guid profileId, ExecuteQueryRequest request, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\QueryController.cs:line 60
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 01:52:16.968 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 01:52:16.977 +03:00 [DBG] Connection id "0HNF4UCPECD93" completed keep alive response.
2025-08-27 01:52:16.982 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:52:16.985 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:52:16.987 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:52:16.989 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 500 null application/json; charset=utf-8 2979.9334ms
2025-08-27 01:52:49.471 +03:00 [INF] This is a test log to file!
2025-08-27 01:52:49.674 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 01:52:49.681 +03:00 [INF] API configured successfully.
2025-08-27 01:52:49.682 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:52:49.683 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:52:49.752 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 01:52:49.806 +03:00 [DBG] Hosting starting
2025-08-27 01:52:49.829 +03:00 [DBG] Middleware loaded
2025-08-27 01:52:49.832 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 01:52:49.834 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 01:52:49.926 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 01:52:49.929 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 01:52:49.948 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 01:52:49.979 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 01:52:50.033 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 01:52:50.034 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 01:52:50.034 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 01:52:50.035 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 01:52:50.036 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 01:52:50.037 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 01:52:50.051 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:52:50.053 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:52:50.158 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 01:52:50.159 +03:00 [INF] Hosting environment: Development
2025-08-27 01:52:50.160 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 01:52:50.161 +03:00 [DBG] Hosting started
2025-08-27 01:53:07.156 +03:00 [DBG] Connection id "0HNF4UD9AKQN5" received FIN.
2025-08-27 01:53:07.161 +03:00 [DBG] Connection id "0HNF4UD9AKQN5" accepted.
2025-08-27 01:53:07.163 +03:00 [DBG] Connection id "0HNF4UD9AKQN5" started.
2025-08-27 01:53:07.164 +03:00 [DBG] Connection id "0HNF4UD9AKQN6" accepted.
2025-08-27 01:53:07.165 +03:00 [DBG] Connection id "0HNF4UD9AKQN6" started.
2025-08-27 01:53:07.169 +03:00 [DBG] Connection id "0HNF4UD9AKQN5" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:53:07.172 +03:00 [DBG] Connection id "0HNF4UD9AKQN5" disconnecting.
2025-08-27 01:53:07.174 +03:00 [DBG] Connection id "0HNF4UD9AKQN5" stopped.
2025-08-27 01:53:07.188 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 86
2025-08-27 01:53:07.214 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:53:07.216 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:53:07.218 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:53:07.238 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-08-27 01:53:07.240 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:53:07.247 +03:00 [DBG] Connection id "0HNF4UD9AKQN6" completed keep alive response.
2025-08-27 01:53:07.249 +03:00 [DBG] Connection id "0HNF4UD9AKQN7" accepted.
2025-08-27 01:53:07.250 +03:00 [DBG] Connection id "0HNF4UD9AKQN8" accepted.
2025-08-27 01:53:07.250 +03:00 [DBG] Connection id "0HNF4UD9AKQN7" received FIN.
2025-08-27 01:53:07.254 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 65.3864ms
2025-08-27 01:53:07.254 +03:00 [DBG] Connection id "0HNF4UD9AKQN7" started.
2025-08-27 01:53:07.255 +03:00 [DBG] Connection id "0HNF4UD9AKQN8" started.
2025-08-27 01:53:07.262 +03:00 [DBG] Connection id "0HNF4UD9AKQN7" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:53:07.262 +03:00 [DBG] Connection id "0HNF4UD9AKQN6", Request id "0HNF4UD9AKQN6:00000001": started reading request body.
2025-08-27 01:53:07.264 +03:00 [DBG] Connection id "0HNF4UD9AKQN7" disconnecting.
2025-08-27 01:53:07.269 +03:00 [DBG] Connection id "0HNF4UD9AKQN6", Request id "0HNF4UD9AKQN6:00000001": done reading request body.
2025-08-27 01:53:07.270 +03:00 [DBG] Connection id "0HNF4UD9AKQN7" stopped.
2025-08-27 01:53:07.295 +03:00 [DBG] Connection 0HNF4UD9AKQN8 established using the following protocol: "Tls13"
2025-08-27 01:53:07.298 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 86
2025-08-27 01:53:07.301 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:53:07.302 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:53:07.303 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:53:07.307 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:53:07.323 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:53:07.325 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:53:07.326 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:53:07.328 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:53:07.329 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:53:07.330 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:53:07.333 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:53:07.415 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 01:53:07.885 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:53:07.896 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:53:07.898 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:53:07.902 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:53:07.904 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:53:07.907 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:53:07.908 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:53:07.909 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:53:07.911 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:53:07.913 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:53:07.915 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:53:07.917 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:53:07.928 +03:00 [DBG] Connection id "0HNF4UD9AKQN8", Request id "0HNF4UD9AKQN8:00000001": started reading request body.
2025-08-27 01:53:07.930 +03:00 [DBG] Connection id "0HNF4UD9AKQN8", Request id "0HNF4UD9AKQN8:00000001": done reading request body.
2025-08-27 01:53:07.936 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:53:07.937 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:53:07.938 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:53:07.939 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:53:07.946 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:53:07.947 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:53:07.948 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:53:07.949 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:53:07.950 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:53:07.959 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:53:08.005 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-08-27 01:53:08.042 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-08-27 01:53:08.264 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<Name>k__BackingField = dataReader.GetString(3);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(4));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(5);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(6) ? default(Guid?) : (Guid?)dataReader.GetGuid(6) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(6) ? default(object) : (object)dataReader.GetGuid(6) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(6) ? default(Guid) : dataReader.GetGuid(6);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(8) ? default(string) : dataReader.GetString(8);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(10) ? default(DateTime) : dataReader.GetDateTime(10);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 01:53:08.293 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:53:08.303 +03:00 [DBG] Created DbConnection. (9ms).
2025-08-27 01:53:08.307 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:53:08.317 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:08.321 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:53:08.327 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-08-27 01:53:08.331 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-08-27 01:53:08.337 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:08.353 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:08.384 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:53:08.408 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:08.414 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 56ms reading results.
2025-08-27 01:53:08.418 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:08.422 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (3ms).
2025-08-27 01:53:08.431 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:53:08.434 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:53:08.435 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:08.436 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:53:08.436 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:53:08.438 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:53:08.439 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:08.441 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:08.443 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:08.444 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 01:53:08.446 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:08.447 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:53:08.455 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:53:08.467 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:53:08.470 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:53:08.558 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:53:08.576 +03:00 [INF] Converting natural language to SQL. User query: Delete products that is in category called phones
2025-08-27 01:53:08.579 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:53:08.580 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:53:08.586 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:53:09.422 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:53:09.432 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:53:09.436 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:53:09.437 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:09.438 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:53:09.438 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:53:09.440 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:53:09.441 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:09.442 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:09.444 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:09.446 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:53:09.447 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:09.448 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:53:09.449 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:53:09.451 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:53:09.452 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:09.453 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:53:09.454 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:53:09.455 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:53:09.456 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:09.458 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:09.460 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:09.461 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:53:09.462 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:09.463 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:53:09.465 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:53:09.465 +03:00 [INF] Executing SQL for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", Mode="Write"
2025-08-27 01:53:09.467 +03:00 [INF] Executing SQL on DESKTOP-QCK8UI5\SQLEXPRESS/ProductInventory (Mode="Write")
2025-08-27 01:53:09.468 +03:00 [DBG] SQL: DELETE FROM Products WHERE CategoryId IN (SELECT Id FROM Categories WHERE Name = @param1);
2025-08-27 01:53:09.471 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:53:09.654 +03:00 [DBG] Connection opened to DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 01:53:09.698 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=true)
2025-08-27 01:53:09.709 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:53:09.718 +03:00 [DBG] Connected to database for schema extraction (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:53:09.780 +03:00 [INF] Loaded 3 tables
2025-08-27 01:53:09.918 +03:00 [INF] Schema loaded: 3 tables, 10 columns, 1 relations
2025-08-27 01:53:09.933 +03:00 [DBG] Saved cache file C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer\SqlServer_schemas.json
2025-08-27 01:53:09.934 +03:00 [INF] Cached schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory to C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer\SqlServer_schemas.json
2025-08-27 01:53:09.936 +03:00 [INF] Non-query execution finished in 227 ms, affected 0 rows
2025-08-27 01:53:09.938 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:53:09.939 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:09.940 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:53:09.941 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:53:09.942 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:53:09.943 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:09.945 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:09.946 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:09.948 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:53:09.949 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:09.950 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:53:09.966 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Any(p => (int)p.Provider == (int)__profile_Provider_0)'
2025-08-27 01:53:09.973 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 01:53:09.979 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:53:09.980 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:09.981 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:53:09.982 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:53:09.985 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2025-08-27 01:53:09.986 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:53:09.988 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:53:09.990 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:09.991 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:53:09.993 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:09.994 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:53:10.061 +03:00 [ERR] Failed to persist query to DB for userQuery=Delete products that is in category called phones
2025-08-27 01:53:10.066 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 01:53:10.070 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 01:53:10.071 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 01:53:10.071 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 01:53:10.073 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 01:53:10.074 +03:00 [INF] Executing OkObjectResult, writing value of type 'NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult'.
2025-08-27 01:53:10.083 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 2748.9457ms
2025-08-27 01:53:10.085 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:53:10.088 +03:00 [DBG] Connection id "0HNF4UD9AKQN8" completed keep alive response.
2025-08-27 01:53:10.092 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:53:10.097 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:53:10.100 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-08-27 01:53:10.101 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 200 null application/json; charset=utf-8 2803.1246ms
2025-08-27 01:53:25.757 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 59
2025-08-27 01:53:25.759 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:53:25.760 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:53:25.762 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:53:25.763 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:53:25.764 +03:00 [DBG] Connection id "0HNF4UD9AKQN6" completed keep alive response.
2025-08-27 01:53:25.766 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 9.0885ms
2025-08-27 01:53:25.768 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 59
2025-08-27 01:53:25.769 +03:00 [DBG] Connection id "0HNF4UD9AKQN6", Request id "0HNF4UD9AKQN6:00000002": started reading request body.
2025-08-27 01:53:25.771 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:53:25.772 +03:00 [DBG] Connection id "0HNF4UD9AKQN6", Request id "0HNF4UD9AKQN6:00000002": done reading request body.
2025-08-27 01:53:25.773 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:53:25.775 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:53:25.777 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:53:25.778 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:53:25.780 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:53:25.781 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:53:25.782 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:53:25.784 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:53:25.785 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:53:25.786 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:53:25.823 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:53:25.825 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:53:25.826 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:53:25.827 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:53:25.828 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:53:25.829 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:53:25.831 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:53:25.832 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:53:25.832 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:53:25.833 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:53:25.834 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:53:25.835 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:53:25.836 +03:00 [DBG] Connection id "0HNF4UD9AKQN8", Request id "0HNF4UD9AKQN8:00000002": started reading request body.
2025-08-27 01:53:25.837 +03:00 [DBG] Connection id "0HNF4UD9AKQN8", Request id "0HNF4UD9AKQN8:00000002": done reading request body.
2025-08-27 01:53:25.838 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:53:25.839 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:53:25.839 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:53:25.840 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:53:25.841 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:53:25.842 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:53:25.843 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:53:25.844 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:53:25.845 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:53:25.846 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:53:25.847 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:53:25.848 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 01:53:25.849 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:53:25.850 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:25.850 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:53:25.851 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:53:25.852 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:53:25.853 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:25.854 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:25.856 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:53:25.857 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:25.858 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 01:53:25.859 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:25.860 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:53:25.862 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:53:25.863 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:53:25.864 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:25.865 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:53:25.865 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:53:25.866 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:53:25.867 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:25.868 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:25.870 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:25.871 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:53:25.871 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:25.872 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:53:25.874 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:53:25.874 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:53:25.875 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:53:25.877 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:53:25.878 +03:00 [INF] Converting natural language to SQL. User query: show me all categories
2025-08-27 01:53:25.878 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:53:25.879 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:53:25.880 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:53:26.593 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:53:26.594 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:53:26.595 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:53:26.596 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:26.597 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:53:26.598 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:53:26.599 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:53:26.599 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:26.601 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:26.603 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:26.604 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:53:26.605 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:26.607 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:53:26.608 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:53:26.609 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:53:26.610 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:26.611 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:53:26.612 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:53:26.613 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:53:26.614 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:26.615 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:26.617 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:26.618 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:53:26.619 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:26.620 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:53:26.621 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:53:26.622 +03:00 [INF] Executing SQL for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", Mode="Write"
2025-08-27 01:53:26.623 +03:00 [INF] Executing SQL on DESKTOP-QCK8UI5\SQLEXPRESS/ProductInventory (Mode="Write")
2025-08-27 01:53:26.624 +03:00 [DBG] SQL: SELECT C.Id, C.Name, C.Description FROM Categories C;
2025-08-27 01:53:26.624 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:53:26.626 +03:00 [DBG] Connection opened to DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 01:53:26.632 +03:00 [INF] Query execution finished in 7 ms, returned 16 rows
2025-08-27 01:53:26.633 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:53:26.634 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:26.635 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:53:26.635 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:53:26.636 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:53:26.637 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:26.638 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:53:26.639 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:26.640 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:53:26.641 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:26.641 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:53:26.647 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:53:26.648 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:26.649 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:53:26.649 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:53:26.650 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:53:26.651 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:53:26.652 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:53:26.653 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:26.654 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:53:26.655 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:53:26.655 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:53:26.693 +03:00 [ERR] Failed to persist query to DB for userQuery=show me all categories
2025-08-27 01:53:26.694 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 01:53:26.695 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 01:53:26.695 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 01:53:26.696 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 01:53:26.696 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 01:53:26.697 +03:00 [INF] Executing OkObjectResult, writing value of type 'NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult'.
2025-08-27 01:53:26.699 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 912.5ms
2025-08-27 01:53:26.700 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:53:26.700 +03:00 [DBG] Connection id "0HNF4UD9AKQN8" completed keep alive response.
2025-08-27 01:53:26.701 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:53:26.702 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:53:26.703 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:53:26.704 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 200 null application/json; charset=utf-8 936.1604ms
2025-08-27 01:54:26.162 +03:00 [INF] This is a test log to file!
2025-08-27 01:54:26.585 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 01:54:26.597 +03:00 [INF] API configured successfully.
2025-08-27 01:54:26.598 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:54:26.599 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 01:54:26.669 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 01:54:26.722 +03:00 [DBG] Hosting starting
2025-08-27 01:54:26.740 +03:00 [DBG] Middleware loaded
2025-08-27 01:54:26.748 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 01:54:26.751 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 01:54:26.860 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 01:54:26.869 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 01:54:26.877 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 01:54:26.936 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 01:54:26.997 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 01:54:27.001 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 01:54:27.003 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 01:54:27.005 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 01:54:27.006 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 01:54:27.007 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 01:54:27.015 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:54:27.017 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 01:54:27.143 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 01:54:27.144 +03:00 [INF] Hosting environment: Development
2025-08-27 01:54:27.145 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 01:54:27.146 +03:00 [DBG] Hosting started
2025-08-27 01:54:29.064 +03:00 [DBG] Connection id "0HNF4UE1NP3N3" received FIN.
2025-08-27 01:54:29.069 +03:00 [DBG] Connection id "0HNF4UE1NP3N3" accepted.
2025-08-27 01:54:29.070 +03:00 [DBG] Connection id "0HNF4UE1NP3N3" started.
2025-08-27 01:54:29.071 +03:00 [DBG] Connection id "0HNF4UE1NP3N4" accepted.
2025-08-27 01:54:29.072 +03:00 [DBG] Connection id "0HNF4UE1NP3N4" started.
2025-08-27 01:54:29.079 +03:00 [DBG] Connection id "0HNF4UE1NP3N3" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:54:29.082 +03:00 [DBG] Connection id "0HNF4UE1NP3N3" disconnecting.
2025-08-27 01:54:29.085 +03:00 [DBG] Connection id "0HNF4UE1NP3N3" stopped.
2025-08-27 01:54:29.101 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 59
2025-08-27 01:54:29.130 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:54:29.132 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:54:29.135 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:54:29.156 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-08-27 01:54:29.158 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:54:29.165 +03:00 [DBG] Connection id "0HNF4UE1NP3N4" completed keep alive response.
2025-08-27 01:54:29.167 +03:00 [DBG] Connection id "0HNF4UE1NP3N5" accepted.
2025-08-27 01:54:29.168 +03:00 [DBG] Connection id "0HNF4UE1NP3N5" received FIN.
2025-08-27 01:54:29.168 +03:00 [DBG] Connection id "0HNF4UE1NP3N6" accepted.
2025-08-27 01:54:29.167 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 71.2654ms
2025-08-27 01:54:29.172 +03:00 [DBG] Connection id "0HNF4UE1NP3N5" started.
2025-08-27 01:54:29.174 +03:00 [DBG] Connection id "0HNF4UE1NP3N6" started.
2025-08-27 01:54:29.179 +03:00 [DBG] Connection id "0HNF4UE1NP3N5" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 01:54:29.179 +03:00 [DBG] Connection id "0HNF4UE1NP3N4", Request id "0HNF4UE1NP3N4:00000001": started reading request body.
2025-08-27 01:54:29.182 +03:00 [DBG] Connection id "0HNF4UE1NP3N5" disconnecting.
2025-08-27 01:54:29.183 +03:00 [DBG] Connection id "0HNF4UE1NP3N4", Request id "0HNF4UE1NP3N4:00000001": done reading request body.
2025-08-27 01:54:29.188 +03:00 [DBG] Connection id "0HNF4UE1NP3N5" stopped.
2025-08-27 01:54:29.216 +03:00 [DBG] Connection 0HNF4UE1NP3N6 established using the following protocol: "Tls13"
2025-08-27 01:54:29.220 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 59
2025-08-27 01:54:29.223 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:54:29.224 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:54:29.225 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:54:29.228 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:54:29.244 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:54:29.246 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:54:29.247 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:54:29.249 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:54:29.251 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:54:29.253 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:54:29.256 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:54:29.344 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 01:54:29.821 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:54:29.829 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:54:29.831 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:54:29.836 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:54:29.839 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:54:29.842 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:54:29.843 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:54:29.845 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:54:29.847 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:54:29.849 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:54:29.851 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:54:29.853 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:54:29.866 +03:00 [DBG] Connection id "0HNF4UE1NP3N6", Request id "0HNF4UE1NP3N6:00000001": started reading request body.
2025-08-27 01:54:29.868 +03:00 [DBG] Connection id "0HNF4UE1NP3N6", Request id "0HNF4UE1NP3N6:00000001": done reading request body.
2025-08-27 01:54:29.874 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:54:29.875 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:54:29.876 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:54:29.876 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:54:29.883 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:54:29.884 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:54:29.886 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:54:29.887 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:54:29.888 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:54:29.897 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:29.946 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-08-27 01:54:29.984 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-08-27 01:54:30.210 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.Name (string) Required MaxLength(200), 3], [Property: Profile.Provider (ProviderType) Required, 4], [Property: Profile.SecretRef (string) Required, 5] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 6], [Property: Query.ProfileId (Guid) Required FK Index, 7], [Property: Query.ResultJson (string) Required, 8], [Property: Query.SqlQuery (string) Required, 9], [Property: Query.TimestampUtc (DateTime) Required, 10], [Property: Query.UserQuery (string) Required, 11] }
                3 -> 6
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<Name>k__BackingField = dataReader.GetString(3);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(4));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(5);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(6) ? default(Guid?) : (Guid?)dataReader.GetGuid(6) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(6) ? default(object) : (object)dataReader.GetGuid(6) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(6) ? default(Guid) : dataReader.GetGuid(6);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(8) ? default(string) : dataReader.GetString(8);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(10) ? default(DateTime) : dataReader.GetDateTime(10);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(11) ? default(string) : dataReader.GetString(11);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 01:54:30.241 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:54:30.251 +03:00 [DBG] Created DbConnection. (10ms).
2025-08-27 01:54:30.256 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:30.268 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:30.272 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:30.278 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (3ms).
2025-08-27 01:54:30.282 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (10ms).
2025-08-27 01:54:30.292 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:30.308 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:30.340 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:54:30.363 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:30.368 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 54ms reading results.
2025-08-27 01:54:30.372 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:30.375 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (3ms).
2025-08-27 01:54:30.385 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:30.387 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:30.389 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:30.390 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:30.391 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:30.392 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:30.393 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:30.395 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:30.398 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:30.399 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:54:30.400 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:30.401 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:54:30.410 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:30.421 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:54:30.424 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:54:30.516 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:54:30.537 +03:00 [INF] Converting natural language to SQL. User query: show me all categories
2025-08-27 01:54:30.540 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:54:30.541 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:54:30.548 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:54:31.319 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:54:31.330 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:54:31.332 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:31.333 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:31.335 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:31.336 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:31.337 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:54:31.338 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:31.340 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:31.343 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:31.344 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:54:31.346 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:31.347 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:54:31.349 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:31.350 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:31.352 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:31.353 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:31.354 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:31.355 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:31.356 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:31.358 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:31.359 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:31.360 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:54:31.361 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:31.362 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:31.364 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:31.366 +03:00 [INF] Executing SQL for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", Mode="Write"
2025-08-27 01:54:31.368 +03:00 [INF] Executing SQL on DESKTOP-QCK8UI5\SQLEXPRESS/ProductInventory (Mode="Write")
2025-08-27 01:54:31.370 +03:00 [DBG] SQL: SELECT C.Id, C.Name, C.Description FROM Categories C;
2025-08-27 01:54:31.372 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:54:31.546 +03:00 [DBG] Connection opened to DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 01:54:31.585 +03:00 [INF] Query execution finished in 212 ms, returned 16 rows
2025-08-27 01:54:31.594 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:31.596 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:31.597 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:31.598 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:31.599 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:31.600 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:31.602 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:31.604 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:31.605 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:54:31.607 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:31.609 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:54:31.631 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Any(p => (int)p.Provider == (int)__profile_Provider_0)'
2025-08-27 01:54:31.638 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleAsync<bool>(
    asyncEnumerable: SingleQueryingEnumerable.Create<bool>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0)) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Projection Mapping:
                EmptyProjectionMember -> 0
            SELECT EXISTS (
                SELECT 1
                FROM Profiles AS p
                WHERE p.Provider == @__profile_Provider_0), 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            bool? value1;
            value1 = dataReader.IsDBNull(0) ? default(bool?) : (bool?)dataReader.GetBoolean(0);
            return (bool)value1;
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-08-27 01:54:31.643 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:31.644 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:31.646 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:31.647 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:31.649 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2025-08-27 01:54:31.651 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:54:31.653 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:54:31.655 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:31.657 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:54:31.658 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:31.659 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:31.702 +03:00 [ERR] Failed to persist query to DB for userQuery=show me all categories
2025-08-27 01:54:31.707 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 01:54:31.711 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 01:54:31.712 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 01:54:31.712 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 01:54:31.714 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 01:54:31.715 +03:00 [INF] Executing OkObjectResult, writing value of type 'NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult'.
2025-08-27 01:54:31.723 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 2466.2165ms
2025-08-27 01:54:31.725 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:54:31.728 +03:00 [DBG] Connection id "0HNF4UE1NP3N6" completed keep alive response.
2025-08-27 01:54:31.732 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:54:31.736 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:31.738 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:54:31.740 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 200 null application/json; charset=utf-8 2520.4098ms
2025-08-27 01:54:44.678 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 59
2025-08-27 01:54:44.680 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:54:44.681 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:54:44.682 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:54:44.684 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:54:44.685 +03:00 [DBG] Connection id "0HNF4UE1NP3N4" completed keep alive response.
2025-08-27 01:54:44.686 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 7.5579ms
2025-08-27 01:54:44.687 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 59
2025-08-27 01:54:44.688 +03:00 [DBG] Connection id "0HNF4UE1NP3N4", Request id "0HNF4UE1NP3N4:00000002": started reading request body.
2025-08-27 01:54:44.690 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:54:44.691 +03:00 [DBG] Connection id "0HNF4UE1NP3N4", Request id "0HNF4UE1NP3N4:00000002": done reading request body.
2025-08-27 01:54:44.692 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:54:44.693 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:54:44.694 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:54:44.695 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:54:44.696 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:54:44.698 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:54:44.699 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:54:44.700 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:54:44.701 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:54:44.702 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:54:44.737 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:54:44.739 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:54:44.740 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:54:44.741 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:54:44.742 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:54:44.743 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:54:44.744 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:54:44.745 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:54:44.745 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:54:44.746 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:54:44.747 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:54:44.748 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:54:44.748 +03:00 [DBG] Connection id "0HNF4UE1NP3N6", Request id "0HNF4UE1NP3N6:00000002": started reading request body.
2025-08-27 01:54:44.749 +03:00 [DBG] Connection id "0HNF4UE1NP3N6", Request id "0HNF4UE1NP3N6:00000002": done reading request body.
2025-08-27 01:54:44.750 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:54:44.751 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:54:44.752 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:54:44.752 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:54:44.753 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:54:44.754 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:54:44.755 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:54:44.755 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:54:44.756 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:54:44.757 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:44.758 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:54:44.759 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 01:54:44.759 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:44.760 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:44.761 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:44.761 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:44.762 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:44.763 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:44.764 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:44.766 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:54:44.767 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:44.767 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:54:44.768 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:44.769 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:44.771 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:44.772 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:44.773 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:44.773 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:44.774 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:44.775 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:44.775 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:44.777 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:44.778 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:44.779 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:54:44.779 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:44.780 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:44.782 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:44.782 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:54:44.783 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:54:44.785 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:54:44.785 +03:00 [INF] Converting natural language to SQL. User query: show me all categories
2025-08-27 01:54:44.786 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:54:44.786 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:54:44.788 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:54:45.426 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:54:45.428 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:54:45.430 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:45.431 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:45.432 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:45.433 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:45.433 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:45.434 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:45.435 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:45.437 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:45.438 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:54:45.439 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:45.439 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:45.440 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:45.441 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:45.442 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:45.443 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:45.443 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:45.444 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:45.445 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:45.446 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:45.447 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:45.448 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:54:45.450 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:45.451 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:45.452 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:45.452 +03:00 [INF] Executing SQL for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", Mode="Write"
2025-08-27 01:54:45.453 +03:00 [INF] Executing SQL on DESKTOP-QCK8UI5\SQLEXPRESS/ProductInventory (Mode="Write")
2025-08-27 01:54:45.454 +03:00 [DBG] SQL: SELECT C.Id, C.Name, C.Description FROM Categories C;
2025-08-27 01:54:45.455 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:54:45.456 +03:00 [DBG] Connection opened to DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 01:54:45.462 +03:00 [INF] Query execution finished in 6 ms, returned 16 rows
2025-08-27 01:54:45.463 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:45.463 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:45.464 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:45.465 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:45.465 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:45.467 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:45.468 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:45.469 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:45.470 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:54:45.470 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:45.471 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:45.473 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:45.474 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:45.474 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:45.475 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:45.476 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:45.477 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:54:45.478 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:54:45.480 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:45.481 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:54:45.482 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:45.483 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:45.517 +03:00 [ERR] Failed to persist query to DB for userQuery=show me all categories
2025-08-27 01:54:45.518 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 01:54:45.519 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 01:54:45.519 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 01:54:45.520 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 01:54:45.521 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 01:54:45.521 +03:00 [INF] Executing OkObjectResult, writing value of type 'NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult'.
2025-08-27 01:54:45.522 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 819.9217ms
2025-08-27 01:54:45.523 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:54:45.524 +03:00 [DBG] Connection id "0HNF4UE1NP3N6" completed keep alive response.
2025-08-27 01:54:45.525 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:54:45.525 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:45.527 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:54:45.528 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 200 null application/json; charset=utf-8 841.4018ms
2025-08-27 01:54:49.016 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 59
2025-08-27 01:54:49.018 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:54:49.019 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:54:49.020 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:54:49.021 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:54:49.022 +03:00 [DBG] Connection id "0HNF4UE1NP3N4" completed keep alive response.
2025-08-27 01:54:49.022 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 6.3368ms
2025-08-27 01:54:49.023 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 59
2025-08-27 01:54:49.025 +03:00 [DBG] Connection id "0HNF4UE1NP3N4", Request id "0HNF4UE1NP3N4:00000003": started reading request body.
2025-08-27 01:54:49.026 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:54:49.027 +03:00 [DBG] Connection id "0HNF4UE1NP3N4", Request id "0HNF4UE1NP3N4:00000003": done reading request body.
2025-08-27 01:54:49.028 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:54:49.030 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:54:49.031 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:54:49.032 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:54:49.033 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:54:49.034 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:54:49.034 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:54:49.036 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:54:49.037 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:54:49.038 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:54:49.049 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:54:49.051 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:54:49.052 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:54:49.053 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:54:49.054 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:54:49.055 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:54:49.055 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:54:49.056 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:54:49.057 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:54:49.057 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:54:49.058 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:54:49.059 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:54:49.060 +03:00 [DBG] Connection id "0HNF4UE1NP3N6", Request id "0HNF4UE1NP3N6:00000003": started reading request body.
2025-08-27 01:54:49.061 +03:00 [DBG] Connection id "0HNF4UE1NP3N6", Request id "0HNF4UE1NP3N6:00000003": done reading request body.
2025-08-27 01:54:49.061 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:54:49.062 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:54:49.063 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:54:49.064 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:54:49.064 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:54:49.065 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:54:49.066 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:54:49.067 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:54:49.068 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:54:49.068 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:49.070 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:54:49.070 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 01:54:49.071 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:49.072 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:49.072 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:49.073 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:49.074 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:49.075 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:49.076 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:49.077 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:54:49.078 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:49.079 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 01:54:49.080 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:49.081 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:49.082 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:49.082 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:49.083 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:49.084 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:49.085 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:49.085 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:49.086 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:49.087 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:49.088 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:49.089 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:54:49.090 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:49.091 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:49.092 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:49.092 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:54:49.093 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:54:49.094 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:54:49.095 +03:00 [INF] Converting natural language to SQL. User query: show me all categories
2025-08-27 01:54:49.096 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:54:49.097 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:54:49.098 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:54:49.734 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:54:49.736 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:54:49.737 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:49.738 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:49.739 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:49.740 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:49.741 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:49.742 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:49.744 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:49.746 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:49.748 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:54:49.749 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:49.749 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:49.751 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:49.752 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:49.753 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:49.754 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:49.754 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:49.755 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:49.756 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:49.758 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:49.759 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:49.760 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:54:49.761 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:49.762 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:54:49.764 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:49.765 +03:00 [INF] Executing SQL for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", Mode="Write"
2025-08-27 01:54:49.766 +03:00 [INF] Executing SQL on DESKTOP-QCK8UI5\SQLEXPRESS/ProductInventory (Mode="Write")
2025-08-27 01:54:49.768 +03:00 [DBG] SQL: SELECT C.Id, C.Name, C.Description FROM Categories C;
2025-08-27 01:54:49.768 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:54:49.769 +03:00 [DBG] Connection opened to DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 01:54:49.771 +03:00 [INF] Query execution finished in 2 ms, returned 16 rows
2025-08-27 01:54:49.772 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:49.773 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:49.774 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:49.775 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:49.776 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:49.777 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:49.778 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:49.780 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:49.781 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:54:49.782 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:49.783 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:49.784 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:49.785 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:49.786 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:49.787 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:49.788 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:49.789 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:54:49.790 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:54:49.792 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:49.792 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:54:49.794 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:49.795 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:54:49.831 +03:00 [ERR] Failed to persist query to DB for userQuery=show me all categories
2025-08-27 01:54:49.832 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 01:54:49.834 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 01:54:49.834 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 01:54:49.834 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 01:54:49.835 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 01:54:49.836 +03:00 [INF] Executing OkObjectResult, writing value of type 'NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult'.
2025-08-27 01:54:49.837 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 799.2196ms
2025-08-27 01:54:49.838 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:54:49.839 +03:00 [DBG] Connection id "0HNF4UE1NP3N6" completed keep alive response.
2025-08-27 01:54:49.840 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:54:49.841 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:49.842 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:49.843 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 200 null application/json; charset=utf-8 820.3478ms
2025-08-27 01:54:52.758 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 59
2025-08-27 01:54:52.761 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:54:52.762 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:54:52.763 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:54:52.764 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:54:52.765 +03:00 [DBG] Connection id "0HNF4UE1NP3N4" completed keep alive response.
2025-08-27 01:54:52.765 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 6.9836ms
2025-08-27 01:54:52.766 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 59
2025-08-27 01:54:52.767 +03:00 [DBG] Connection id "0HNF4UE1NP3N4", Request id "0HNF4UE1NP3N4:00000004": started reading request body.
2025-08-27 01:54:52.769 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:54:52.771 +03:00 [DBG] Connection id "0HNF4UE1NP3N4", Request id "0HNF4UE1NP3N4:00000004": done reading request body.
2025-08-27 01:54:52.771 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:54:52.773 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:54:52.774 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:54:52.775 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:54:52.776 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:54:52.777 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:54:52.778 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:54:52.779 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:54:52.780 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:54:52.781 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:54:52.782 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:54:52.783 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:54:52.784 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:54:52.785 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:54:52.785 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:54:52.786 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:54:52.788 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:54:52.788 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:54:52.789 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:54:52.790 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:54:52.791 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:54:52.791 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:54:52.792 +03:00 [DBG] Connection id "0HNF4UE1NP3N6", Request id "0HNF4UE1NP3N6:00000004": started reading request body.
2025-08-27 01:54:52.793 +03:00 [DBG] Connection id "0HNF4UE1NP3N6", Request id "0HNF4UE1NP3N6:00000004": done reading request body.
2025-08-27 01:54:52.794 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:54:52.795 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:54:52.795 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:54:52.796 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:54:52.797 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:54:52.798 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:54:52.799 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:54:52.800 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:54:52.801 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:54:52.801 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:52.802 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:54:52.803 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 01:54:52.803 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:52.804 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:52.805 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:52.806 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:52.807 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:52.807 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:52.808 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:52.810 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:54:52.811 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:52.812 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 01:54:52.813 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:52.813 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:52.814 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:52.815 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:52.816 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:52.817 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:52.817 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:52.818 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:52.819 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:52.820 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:52.821 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:52.822 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:54:52.823 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:52.824 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:52.825 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:52.826 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:54:52.827 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:54:52.828 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:54:52.829 +03:00 [INF] Converting natural language to SQL. User query: show me all categories
2025-08-27 01:54:52.829 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:54:52.830 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:54:52.831 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:54:53.470 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:54:53.472 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:54:53.474 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:53.474 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:53.475 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:53.476 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:53.476 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:53.477 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:53.479 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:53.480 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:53.481 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:54:53.481 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:53.482 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:53.483 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:53.484 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:53.485 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:53.485 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:53.486 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:53.487 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:53.487 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:53.488 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:53.490 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:53.491 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:54:53.492 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:53.492 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:53.493 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:54:53.494 +03:00 [INF] Executing SQL for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", Mode="Write"
2025-08-27 01:54:53.495 +03:00 [INF] Executing SQL on DESKTOP-QCK8UI5\SQLEXPRESS/ProductInventory (Mode="Write")
2025-08-27 01:54:53.496 +03:00 [DBG] SQL: SELECT C.Id, C.Name, C.Description FROM Categories C;
2025-08-27 01:54:53.496 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:54:53.497 +03:00 [DBG] Connection opened to DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 01:54:53.498 +03:00 [INF] Query execution finished in 2 ms, returned 16 rows
2025-08-27 01:54:53.499 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:53.500 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:53.500 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:53.501 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:53.502 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:53.503 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:53.504 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:54:53.505 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:53.506 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:54:53.507 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:53.507 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:53.509 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:53.510 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:53.510 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:54:53.511 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:54:53.512 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:54:53.512 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:54:53.513 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:54:53.515 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:53.516 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:54:53.517 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:54:53.517 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:54:53.547 +03:00 [ERR] Failed to persist query to DB for userQuery=show me all categories
2025-08-27 01:54:53.548 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 01:54:53.549 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 01:54:53.549 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 01:54:53.550 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 01:54:53.551 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 01:54:53.552 +03:00 [INF] Executing OkObjectResult, writing value of type 'NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult'.
2025-08-27 01:54:53.553 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 771.8829ms
2025-08-27 01:54:53.553 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:54:53.554 +03:00 [DBG] Connection id "0HNF4UE1NP3N6" completed keep alive response.
2025-08-27 01:54:53.555 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:54:53.556 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:54:53.558 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:54:53.559 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 200 null application/json; charset=utf-8 793.2508ms
2025-08-27 01:55:21.671 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 59
2025-08-27 01:55:21.675 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:55:21.676 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:55:21.678 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:55:21.680 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'.
2025-08-27 01:55:21.681 +03:00 [DBG] Connection id "0HNF4UE1NP3N4" completed keep alive response.
2025-08-27 01:55:21.682 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 307 0 null 11.0213ms
2025-08-27 01:55:21.690 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - application/json 59
2025-08-27 01:55:21.692 +03:00 [DBG] Connection id "0HNF4UE1NP3N4", Request id "0HNF4UE1NP3N4:00000005": started reading request body.
2025-08-27 01:55:21.695 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:55:21.696 +03:00 [DBG] Connection id "0HNF4UE1NP3N4", Request id "0HNF4UE1NP3N4:00000005": done reading request body.
2025-08-27 01:55:21.697 +03:00 [DBG] Endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)' with route pattern 'api/Query/{profileId}/execute' is valid for the request path '/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute'
2025-08-27 01:55:21.699 +03:00 [DBG] Request matched endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:55:21.700 +03:00 [INF] Executing endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:55:21.702 +03:00 [INF] Route matched with {action = "ExecuteQuery", controller = "Query"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult]] ExecuteQuery(System.Guid, NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest, System.Threading.CancellationToken) on controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api).
2025-08-27 01:55:21.704 +03:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2025-08-27 01:55:21.705 +03:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2025-08-27 01:55:21.707 +03:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2025-08-27 01:55:21.709 +03:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2025-08-27 01:55:21.710 +03:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2025-08-27 01:55:21.711 +03:00 [DBG] Executing controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:55:21.713 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 01:55:21.715 +03:00 [INF] Groq API key configured for HttpClient
2025-08-27 01:55:21.716 +03:00 [DBG] Executed controller factory for controller NaturalToQuery.Api.Controllers.QueryController (NaturalToQuery.Api)
2025-08-27 01:55:21.717 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:55:21.718 +03:00 [DBG] Attempting to bind parameter 'profileId' of type 'System.Guid' using the name 'profileId' in request data ...
2025-08-27 01:55:21.719 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:55:21.720 +03:00 [DBG] Done attempting to bind parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:55:21.722 +03:00 [DBG] Attempting to validate the bound parameter 'profileId' of type 'System.Guid' ...
2025-08-27 01:55:21.723 +03:00 [DBG] Done attempting to validate the bound parameter 'profileId' of type 'System.Guid'.
2025-08-27 01:55:21.723 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:55:21.724 +03:00 [DBG] Attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' using the name '' in request data ...
2025-08-27 01:55:21.726 +03:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2025-08-27 01:55:21.727 +03:00 [DBG] Connection id "0HNF4UE1NP3N6", Request id "0HNF4UE1NP3N6:00000005": started reading request body.
2025-08-27 01:55:21.728 +03:00 [DBG] Connection id "0HNF4UE1NP3N6", Request id "0HNF4UE1NP3N6:00000005": done reading request body.
2025-08-27 01:55:21.729 +03:00 [DBG] JSON input formatter succeeded, deserializing to type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'
2025-08-27 01:55:21.730 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:55:21.731 +03:00 [DBG] Done attempting to bind parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:55:21.732 +03:00 [DBG] Attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest' ...
2025-08-27 01:55:21.733 +03:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'NaturalToQuery.SharedKernal.DTOs.UI.ExecuteQueryRequest'.
2025-08-27 01:55:21.734 +03:00 [DBG] Attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:55:21.735 +03:00 [DBG] Done attempting to bind parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:55:21.736 +03:00 [DBG] Attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken' ...
2025-08-27 01:55:21.737 +03:00 [DBG] Done attempting to validate the bound parameter 'ct' of type 'System.Threading.CancellationToken'.
2025-08-27 01:55:21.738 +03:00 [INF] Converting NL to SQL for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:55:21.739 +03:00 [DBG] Creating DbConnection.
2025-08-27 01:55:21.740 +03:00 [DBG] Created DbConnection. (0ms).
2025-08-27 01:55:21.740 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:55:21.741 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:55:21.742 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:55:21.743 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:55:21.743 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:55:21.745 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:55:21.746 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:55:21.748 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-08-27 01:55:21.749 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:55:21.750 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-08-27 01:55:21.751 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:55:21.752 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:55:21.753 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:55:21.754 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:55:21.755 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:55:21.756 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:55:21.757 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:55:21.758 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-08-27 01:55:21.759 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:55:21.760 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:55:21.762 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:55:21.763 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-08-27 01:55:21.764 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:55:21.765 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:55:21.766 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:55:21.767 +03:00 [DBG] Fetching schema for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", ForceRefresh=false
2025-08-27 01:55:21.768 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-08-27 01:55:21.769 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-08-27 01:55:21.774 +03:00 [INF] Converting natural language to SQL. User query: show me all categories
2025-08-27 01:55:21.774 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-08-27 01:55:21.776 +03:00 [DBG] Generated prompt with 6 messages
2025-08-27 01:55:21.777 +03:00 [DBG] Request payload prepared for Groq API
2025-08-27 01:55:22.418 +03:00 [INF] Groq API responded with status: "OK"
2025-08-27 01:55:22.420 +03:00 [INF] Successfully converted natural language to SQL query
2025-08-27 01:55:22.421 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:55:22.422 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:55:22.423 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:55:22.424 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:55:22.425 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:55:22.425 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:55:22.427 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:55:22.428 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:55:22.429 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:55:22.430 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:55:22.431 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:55:22.432 +03:00 [INF] Fetching connection string for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:55:22.432 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:55:22.433 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:55:22.434 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:55:22.435 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:55:22.436 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:55:22.437 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:55:22.438 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:55:22.439 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:55:22.440 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:55:22.441 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:55:22.442 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:55:22.444 +03:00 [DBG] Fetched secret for profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647"
2025-08-27 01:55:22.444 +03:00 [INF] Executing SQL for Profile "7b3b3831-fc4a-4872-ad3c-df5816ac0647", Mode="Write"
2025-08-27 01:55:22.445 +03:00 [INF] Executing SQL on DESKTOP-QCK8UI5\SQLEXPRESS/ProductInventory (Mode="Write")
2025-08-27 01:55:22.446 +03:00 [DBG] SQL: SELECT C.Id, C.Name, C.Description FROM Categories C;
2025-08-27 01:55:22.446 +03:00 [INF] Creating connection (Server=DESKTOP-QCK8UI5\SQLEXPRESS, Database=ProductInventory)
2025-08-27 01:55:22.448 +03:00 [DBG] Connection opened to DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 01:55:22.449 +03:00 [INF] Query execution finished in 2 ms, returned 16 rows
2025-08-27 01:55:22.450 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:55:22.451 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:55:22.452 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:55:22.453 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:55:22.454 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:55:22.455 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:55:22.456 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-08-27 01:55:22.457 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:55:22.458 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:55:22.459 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:55:22.460 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-08-27 01:55:22.461 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:55:22.462 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:55:22.463 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-08-27 01:55:22.464 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-08-27 01:55:22.465 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-08-27 01:55:22.467 +03:00 [DBG] Executing DbCommand [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:55:22.468 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__profile_Provider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "Profiles" AS "p"
    WHERE "p"."Provider" = @__profile_Provider_0)
2025-08-27 01:55:22.469 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:55:22.470 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-08-27 01:55:22.472 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-08-27 01:55:22.472 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:55:22.502 +03:00 [ERR] Failed to persist query to DB for userQuery=show me all categories
2025-08-27 01:55:22.503 +03:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2025-08-27 01:55:22.504 +03:00 [DBG] No information found on request to perform content negotiation.
2025-08-27 01:55:22.505 +03:00 [DBG] Attempting to select an output formatter without using a content type as no explicit content types were specified for the response.
2025-08-27 01:55:22.505 +03:00 [DBG] Attempting to select the first formatter in the output formatters list which can write the result.
2025-08-27 01:55:22.506 +03:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/json' to write the response.
2025-08-27 01:55:22.507 +03:00 [INF] Executing OkObjectResult, writing value of type 'NaturalToQuery.SharedKernal.DTOs.Providers.ExecutionResult'.
2025-08-27 01:55:22.508 +03:00 [INF] Executed action NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api) in 796.4993ms
2025-08-27 01:55:22.509 +03:00 [INF] Executed endpoint 'NaturalToQuery.Api.Controllers.QueryController.ExecuteQuery (NaturalToQuery.Api)'
2025-08-27 01:55:22.510 +03:00 [DBG] Connection id "0HNF4UE1NP3N6" completed keep alive response.
2025-08-27 01:55:22.511 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 01:55:22.511 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-08-27 01:55:22.512 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-08-27 01:55:22.514 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/7b3b3831-fc4a-4872-ad3c-df5816ac0647/execute - 200 null application/json; charset=utf-8 823.3766ms
2025-08-27 22:27:34.382 +03:00 [INF] This is a test log to file!
2025-08-27 22:27:34.597 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 22:27:34.613 +03:00 [INF] API configured successfully.
2025-08-27 22:27:34.615 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 22:27:34.616 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 22:27:34.705 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 22:27:35.291 +03:00 [DBG] Hosting starting
2025-08-27 22:27:35.321 +03:00 [DBG] Middleware loaded
2025-08-27 22:27:35.329 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 22:27:35.332 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 22:27:35.649 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 22:27:35.655 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 22:27:35.697 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 22:27:35.753 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 22:27:35.840 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 22:27:35.844 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 22:27:35.847 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 22:27:35.848 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 22:27:35.849 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 22:27:35.850 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 22:27:35.861 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 22:27:35.864 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 22:27:36.012 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 22:27:36.013 +03:00 [INF] Hosting environment: Development
2025-08-27 22:27:36.014 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 22:27:36.015 +03:00 [DBG] Hosting started
2025-08-27 22:53:13.231 +03:00 [INF] This is a test log to file!
2025-08-27 22:53:13.438 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 22:53:13.445 +03:00 [INF] API configured successfully.
2025-08-27 22:53:53.673 +03:00 [INF] This is a test log to file!
2025-08-27 22:53:53.882 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 22:53:53.896 +03:00 [INF] API configured successfully.
2025-08-27 22:53:53.968 +03:00 [INF] Registered 1 endpoints in 216 milliseconds.
2025-08-27 22:53:53.973 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 22:53:53.974 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 22:53:54.008 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 22:53:54.078 +03:00 [DBG] Hosting starting
2025-08-27 22:53:54.101 +03:00 [DBG] Middleware loaded
2025-08-27 22:53:54.104 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 22:53:54.109 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 22:53:54.199 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 22:53:54.201 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 22:53:54.204 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 22:53:54.242 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 22:53:54.309 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 22:53:54.310 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 22:53:54.311 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 22:53:54.312 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 22:53:54.313 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 22:53:54.313 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 22:53:54.319 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 22:53:54.327 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 22:53:54.403 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 22:53:54.404 +03:00 [INF] Hosting environment: Development
2025-08-27 22:53:54.405 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 22:53:54.405 +03:00 [DBG] Hosting started
2025-08-27 22:53:55.525 +03:00 [DBG] Connection id "0HNF5KDQ9MSIG" accepted.
2025-08-27 22:53:55.527 +03:00 [DBG] Connection id "0HNF5KDQ9MSIG" started.
2025-08-27 22:53:55.564 +03:00 [DBG] Connection id "0HNF5KDQ9MSIG" received FIN.
2025-08-27 22:53:55.633 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.Security.Authentication.AuthenticationException: Authentication failed, see inner exception.
 ---> System.ComponentModel.Win32Exception (0x80090327): An unknown error occurred while processing the certificate.
   --- End of inner exception stack trace ---
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-08-27 22:53:55.639 +03:00 [DBG] Connection id "0HNF5KDQ9MSIG" stopped.
2025-08-27 22:53:55.642 +03:00 [DBG] Connection id "0HNF5KDQ9MSIG" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 22:53:58.819 +03:00 [DBG] Connection id "0HNF5KDQ9MSIH" accepted.
2025-08-27 22:53:58.820 +03:00 [DBG] Connection id "0HNF5KDQ9MSIH" started.
2025-08-27 22:53:58.824 +03:00 [DBG] Connection id "0HNF5KDQ9MSIH" received FIN.
2025-08-27 22:53:58.874 +03:00 [DBG] Connection id "0HNF5KDQ9MSII" accepted.
2025-08-27 22:53:58.898 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.Security.Authentication.AuthenticationException: Authentication failed, see inner exception.
 ---> System.ComponentModel.Win32Exception (0x80090327): An unknown error occurred while processing the certificate.
   --- End of inner exception stack trace ---
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-08-27 22:53:58.900 +03:00 [DBG] Connection id "0HNF5KDQ9MSII" started.
2025-08-27 22:53:58.903 +03:00 [DBG] Connection id "0HNF5KDQ9MSIH" stopped.
2025-08-27 22:53:58.904 +03:00 [DBG] Connection id "0HNF5KDQ9MSIH" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 22:53:58.910 +03:00 [DBG] Connection 0HNF5KDQ9MSII established using the following protocol: "Tls13"
2025-08-27 22:53:58.983 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/health - null null
2025-08-27 22:53:59.113 +03:00 [DBG] 1 candidate(s) found for the request path '/api/health'
2025-08-27 22:53:59.116 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/health'
2025-08-27 22:53:59.146 +03:00 [DBG] Policy authentication schemes  did not succeed
2025-08-27 22:53:59.149 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-08-27 22:53:59.246 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No authenticationScheme was specified, and there was no DefaultChallengeScheme found. The default schemes can be set using either AddAuthentication(string defaultScheme) or AddAuthentication(Action<AuthenticationOptions> configureOptions).
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 22:53:59.253 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 22:53:59.263 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/health - 500 null application/json; charset=utf-8 290.3742ms
2025-08-27 22:53:59.298 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/favicon.ico - null null
2025-08-27 22:53:59.301 +03:00 [DBG] No candidates found for the request path '/favicon.ico'
2025-08-27 22:53:59.303 +03:00 [DBG] Request did not match any endpoints
2025-08-27 22:53:59.328 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/favicon.ico - 404 0 null 30.4908ms
2025-08-27 22:53:59.332 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET https://localhost:7202/favicon.ico, Response status code: 404
2025-08-27 22:54:17.603 +03:00 [INF] This is a test log to file!
2025-08-27 22:54:17.778 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 22:54:17.786 +03:00 [INF] API configured successfully.
2025-08-27 22:54:17.834 +03:00 [INF] Registered 1 endpoints in 172 milliseconds.
2025-08-27 22:54:17.839 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 22:54:17.840 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 22:54:17.867 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 22:54:17.916 +03:00 [DBG] Hosting starting
2025-08-27 22:54:17.928 +03:00 [DBG] Middleware loaded
2025-08-27 22:54:17.931 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 22:54:17.933 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 22:54:17.994 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 22:54:17.998 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 22:54:18.000 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 22:54:18.038 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 22:54:18.081 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 22:54:18.083 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 22:54:18.083 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 22:54:18.084 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 22:54:18.085 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 22:54:18.085 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 22:54:18.091 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 22:54:18.096 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 22:54:18.184 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 22:54:18.185 +03:00 [INF] Hosting environment: Development
2025-08-27 22:54:18.186 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 22:54:18.187 +03:00 [DBG] Hosting started
2025-08-27 22:54:24.595 +03:00 [DBG] Connection id "0HNF5KE2UUD1H" accepted.
2025-08-27 22:54:24.597 +03:00 [DBG] Connection id "0HNF5KE2UUD1H" started.
2025-08-27 22:54:24.642 +03:00 [DBG] Connection id "0HNF5KE2UUD1H" received FIN.
2025-08-27 22:54:24.642 +03:00 [DBG] Connection id "0HNF5KE2UUD1I" accepted.
2025-08-27 22:54:24.649 +03:00 [DBG] Connection id "0HNF5KE2UUD1I" started.
2025-08-27 22:54:24.755 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.Security.Authentication.AuthenticationException: Authentication failed, see inner exception.
 ---> System.ComponentModel.Win32Exception (0x80090327): An unknown error occurred while processing the certificate.
   --- End of inner exception stack trace ---
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-08-27 22:54:24.760 +03:00 [DBG] Connection 0HNF5KE2UUD1I established using the following protocol: "Tls13"
2025-08-27 22:54:24.761 +03:00 [DBG] Connection id "0HNF5KE2UUD1H" stopped.
2025-08-27 22:54:24.763 +03:00 [DBG] Connection id "0HNF5KE2UUD1H" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 22:54:24.793 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/health - null null
2025-08-27 22:54:24.920 +03:00 [DBG] 1 candidate(s) found for the request path '/api/health'
2025-08-27 22:54:24.925 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/health'
2025-08-27 22:54:24.958 +03:00 [INF] Executing endpoint 'HTTP: GET api/health'
2025-08-27 22:54:24.994 +03:00 [INF] Executed endpoint 'HTTP: GET api/health'
2025-08-27 22:54:24.996 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/health - 200 null application/json; charset=utf-8 207.2019ms
2025-08-27 23:35:22.597 +03:00 [INF] This is a test log to file!
2025-08-27 23:35:22.816 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 23:35:22.823 +03:00 [INF] API configured successfully.
2025-08-27 23:35:23.009 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 23:35:23.477 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 23:35:23.489 +03:00 [INF] Registered 5 endpoints in 826 milliseconds.
2025-08-27 23:35:23.494 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 23:35:23.496 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 23:35:23.496 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 23:35:23.517 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 23:35:23.558 +03:00 [DBG] Hosting starting
2025-08-27 23:35:23.569 +03:00 [DBG] Middleware loaded
2025-08-27 23:35:23.572 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 23:35:23.573 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 23:35:23.632 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 23:35:23.635 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 23:35:23.638 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 23:35:23.666 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 23:35:23.730 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 23:35:23.732 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 23:35:23.733 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 23:35:23.734 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 23:35:23.734 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 23:35:23.735 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 23:35:23.740 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 23:35:23.744 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 23:35:23.825 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 23:35:23.826 +03:00 [INF] Hosting environment: Development
2025-08-27 23:35:23.827 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 23:35:23.828 +03:00 [DBG] Hosting started
2025-08-27 23:50:52.028 +03:00 [INF] This is a test log to file!
2025-08-27 23:50:52.202 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 23:50:52.210 +03:00 [INF] API configured successfully.
2025-08-27 23:50:52.331 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 23:50:52.782 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 23:50:52.804 +03:00 [INF] Registered 6 endpoints in 717 milliseconds.
2025-08-27 23:50:52.815 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 23:50:52.817 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 23:50:52.818 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 23:50:52.845 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 23:50:52.896 +03:00 [DBG] Hosting starting
2025-08-27 23:50:52.914 +03:00 [DBG] Middleware loaded
2025-08-27 23:50:52.916 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 23:50:52.918 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 23:50:52.982 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 23:50:52.984 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 23:50:52.986 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 23:50:53.019 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 23:50:53.062 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 23:50:53.063 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 23:50:53.063 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 23:50:53.064 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 23:50:53.065 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 23:50:53.065 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 23:50:53.071 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 23:50:53.075 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 23:50:53.101 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 23:50:53.102 +03:00 [INF] Hosting environment: Development
2025-08-27 23:50:53.102 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 23:50:53.103 +03:00 [DBG] Hosting started
2025-08-27 23:51:02.926 +03:00 [INF] This is a test log to file!
2025-08-27 23:51:03.132 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 23:51:03.141 +03:00 [INF] API configured successfully.
2025-08-27 23:51:03.272 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 23:51:03.866 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 23:51:03.890 +03:00 [INF] Registered 6 endpoints in 897 milliseconds.
2025-08-27 23:51:03.896 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 23:51:03.898 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 23:51:03.898 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 23:51:03.925 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 23:51:03.981 +03:00 [DBG] Hosting starting
2025-08-27 23:51:04.001 +03:00 [DBG] Middleware loaded
2025-08-27 23:51:04.005 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 23:51:04.007 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 23:51:04.086 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 23:51:04.089 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 23:51:04.094 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 23:51:04.145 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 23:51:04.207 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 23:51:04.209 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 23:51:04.209 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 23:51:04.210 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 23:51:04.211 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 23:51:04.211 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 23:51:04.217 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 23:51:04.235 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 23:51:04.272 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 23:51:04.273 +03:00 [INF] Hosting environment: Development
2025-08-27 23:51:04.274 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 23:51:04.275 +03:00 [DBG] Hosting started
2025-08-27 23:53:16.201 +03:00 [DBG] Connection id "0HNF5LEVEUR6D" accepted.
2025-08-27 23:53:16.228 +03:00 [DBG] Connection id "0HNF5LEVEUR6D" started.
2025-08-27 23:53:16.276 +03:00 [DBG] Connection id "0HNF5LEVEUR6D" received FIN.
2025-08-27 23:53:16.301 +03:00 [DBG] Connection id "0HNF5LEVEUR6E" accepted.
2025-08-27 23:53:16.327 +03:00 [DBG] Connection id "0HNF5LEVEUR6E" started.
2025-08-27 23:53:16.456 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.Security.Authentication.AuthenticationException: Authentication failed, see inner exception.
 ---> System.ComponentModel.Win32Exception (0x80090327): An unknown error occurred while processing the certificate.
   --- End of inner exception stack trace ---
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-08-27 23:53:16.462 +03:00 [DBG] Connection 0HNF5LEVEUR6E established using the following protocol: "Tls13"
2025-08-27 23:53:16.463 +03:00 [DBG] Connection id "0HNF5LEVEUR6D" stopped.
2025-08-27 23:53:16.466 +03:00 [DBG] Connection id "0HNF5LEVEUR6D" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 23:53:16.500 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/setup/providers - null null
2025-08-27 23:53:16.586 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/providers'
2025-08-27 23:53:16.589 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/setup/providers'
2025-08-27 23:53:16.611 +03:00 [INF] Executing endpoint 'HTTP: GET api/setup/providers'
2025-08-27 23:53:16.647 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 23:53:16.678 +03:00 [INF] Executed endpoint 'HTTP: GET api/setup/providers'
2025-08-27 23:53:16.682 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 23:53:16.686 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/setup/providers - 200 null application/json; charset=utf-8 189.2731ms
2025-08-27 23:54:08.739 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/setup/servers/0 - null null
2025-08-27 23:54:08.745 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/servers/0'
2025-08-27 23:54:08.747 +03:00 [DBG] Endpoint 'HTTP: GET api/setup/servers/{type}' with route pattern 'api/setup/servers/{type}' is valid for the request path '/api/setup/servers/0'
2025-08-27 23:54:08.748 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:08.750 +03:00 [INF] Executing endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:08.770 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 23:54:08.807 +03:00 [INF] Fetching servers (forceRefresh=true)
2025-08-27 23:54:08.809 +03:00 [DBG] Looking up servers from registry key SOFTWARE\Microsoft\Microsoft SQL Server\Instance Names\SQL
2025-08-27 23:54:08.811 +03:00 [INF] Discovered server DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 23:54:08.926 +03:00 [DBG] Saved cache file C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer\SqlServer.json
2025-08-27 23:54:08.927 +03:00 [INF] Cached 1 servers to C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer\SqlServer.json
2025-08-27 23:54:08.933 +03:00 [INF] Executed endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:08.936 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 23:54:08.937 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/setup/servers/0 - 200 null application/json; charset=utf-8 202.1421ms
2025-08-27 23:54:12.050 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/setup/servers/1 - null null
2025-08-27 23:54:12.054 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/servers/1'
2025-08-27 23:54:12.055 +03:00 [DBG] Endpoint 'HTTP: GET api/setup/servers/{type}' with route pattern 'api/setup/servers/{type}' is valid for the request path '/api/setup/servers/1'
2025-08-27 23:54:12.056 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:12.058 +03:00 [INF] Executing endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:12.060 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 23:54:12.062 +03:00 [ERR] Unsupported provider type '"1"' requested in CreateStandalone
2025-08-27 23:54:12.173 +03:00 [INF] Executed endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:12.226 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NotImplementedException: Provider type '1' is not implemented in DbProviderFactory.CreateStandalone
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.HandleUnsupportedProvider(ProviderType type, String method) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 55
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.CreateStandalone(ProviderType Type) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 48
   at NaturalToQuery.Application.Services.SetupService.GetAvailableServersAsync(ProviderType type, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\SetupService.cs:line 49
   at NaturalToQuery.Api.Controllers.Setup.GetAvailableServers.HandleAsync(GetAvailableServersRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Setup\AvailableServers.cs:line 27
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 23:54:12.245 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 23:54:12.250 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 23:54:12.257 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/setup/servers/1 - 500 null application/json; charset=utf-8 206.6963ms
2025-08-27 23:54:18.791 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/setup/servers/0 - null null
2025-08-27 23:54:18.795 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/servers/0'
2025-08-27 23:54:18.796 +03:00 [DBG] Endpoint 'HTTP: GET api/setup/servers/{type}' with route pattern 'api/setup/servers/{type}' is valid for the request path '/api/setup/servers/0'
2025-08-27 23:54:18.797 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:18.798 +03:00 [INF] Executing endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:18.799 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 23:54:18.801 +03:00 [INF] Fetching servers (forceRefresh=true)
2025-08-27 23:54:18.802 +03:00 [DBG] Looking up servers from registry key SOFTWARE\Microsoft\Microsoft SQL Server\Instance Names\SQL
2025-08-27 23:54:18.803 +03:00 [INF] Discovered server DESKTOP-QCK8UI5\SQLEXPRESS
2025-08-27 23:54:18.805 +03:00 [DBG] Saved cache file C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer\SqlServer.json
2025-08-27 23:54:18.806 +03:00 [INF] Cached 1 servers to C:\Users\Zyad\AppData\Local\MicroSqlRag\SqlServer\SqlServer.json
2025-08-27 23:54:18.807 +03:00 [INF] Executed endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:18.808 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 23:54:18.809 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/setup/servers/0 - 200 null application/json; charset=utf-8 18.09ms
2025-08-27 23:54:21.788 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/setup/servers/1 - null null
2025-08-27 23:54:21.792 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/servers/1'
2025-08-27 23:54:21.793 +03:00 [DBG] Endpoint 'HTTP: GET api/setup/servers/{type}' with route pattern 'api/setup/servers/{type}' is valid for the request path '/api/setup/servers/1'
2025-08-27 23:54:21.794 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:21.795 +03:00 [INF] Executing endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:21.796 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 23:54:21.797 +03:00 [ERR] Unsupported provider type '"1"' requested in CreateStandalone
2025-08-27 23:54:21.877 +03:00 [INF] Executed endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:21.927 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NotImplementedException: Provider type '1' is not implemented in DbProviderFactory.CreateStandalone
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.HandleUnsupportedProvider(ProviderType type, String method) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 55
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.CreateStandalone(ProviderType Type) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 48
   at NaturalToQuery.Application.Services.SetupService.GetAvailableServersAsync(ProviderType type, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\SetupService.cs:line 49
   at NaturalToQuery.Api.Controllers.Setup.GetAvailableServers.HandleAsync(GetAvailableServersRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Setup\AvailableServers.cs:line 27
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 23:54:21.930 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 23:54:21.930 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 23:54:21.931 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/setup/servers/1 - 500 null application/json; charset=utf-8 142.831ms
2025-08-27 23:54:44.454 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/setup/servers/1 - null null
2025-08-27 23:54:44.464 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/servers/1'
2025-08-27 23:54:44.465 +03:00 [DBG] Endpoint 'HTTP: GET api/setup/servers/{type}' with route pattern 'api/setup/servers/{type}' is valid for the request path '/api/setup/servers/1'
2025-08-27 23:54:44.466 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:44.467 +03:00 [INF] Executing endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:44.468 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 23:54:44.469 +03:00 [ERR] Unsupported provider type '"1"' requested in CreateStandalone
2025-08-27 23:54:44.549 +03:00 [INF] Executed endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:44.601 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NotImplementedException: Provider type '1' is not implemented in DbProviderFactory.CreateStandalone
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.HandleUnsupportedProvider(ProviderType type, String method) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 55
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.CreateStandalone(ProviderType Type) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 48
   at NaturalToQuery.Application.Services.SetupService.GetAvailableServersAsync(ProviderType type, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\SetupService.cs:line 49
   at NaturalToQuery.Api.Controllers.Setup.GetAvailableServers.HandleAsync(GetAvailableServersRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Setup\AvailableServers.cs:line 27
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 23:54:44.604 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 23:54:44.605 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 23:54:44.606 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/setup/servers/1 - 500 null application/json; charset=utf-8 151.8085ms
2025-08-27 23:54:53.776 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/setup/servers/1 - null null
2025-08-27 23:54:53.780 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/servers/1'
2025-08-27 23:54:53.781 +03:00 [DBG] Endpoint 'HTTP: GET api/setup/servers/{type}' with route pattern 'api/setup/servers/{type}' is valid for the request path '/api/setup/servers/1'
2025-08-27 23:54:53.783 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:53.784 +03:00 [INF] Executing endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:53.784 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 23:54:53.786 +03:00 [ERR] Unsupported provider type '"1"' requested in CreateStandalone
2025-08-27 23:54:53.857 +03:00 [INF] Executed endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:53.904 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NotImplementedException: Provider type '1' is not implemented in DbProviderFactory.CreateStandalone
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.HandleUnsupportedProvider(ProviderType type, String method) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 55
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.CreateStandalone(ProviderType Type) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 48
   at NaturalToQuery.Application.Services.SetupService.GetAvailableServersAsync(ProviderType type, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\SetupService.cs:line 49
   at NaturalToQuery.Api.Controllers.Setup.GetAvailableServers.HandleAsync(GetAvailableServersRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Setup\AvailableServers.cs:line 27
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 23:54:53.907 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 23:54:53.908 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 23:54:53.909 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/setup/servers/1 - 500 null application/json; charset=utf-8 132.4756ms
2025-08-27 23:54:59.883 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/setup/servers/1 - null null
2025-08-27 23:54:59.887 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/servers/1'
2025-08-27 23:54:59.888 +03:00 [DBG] Endpoint 'HTTP: GET api/setup/servers/{type}' with route pattern 'api/setup/servers/{type}' is valid for the request path '/api/setup/servers/1'
2025-08-27 23:54:59.889 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:59.890 +03:00 [INF] Executing endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:54:59.891 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 23:55:05.004 +03:00 [ERR] Unsupported provider type '"1"' requested in CreateStandalone
2025-08-27 23:55:19.133 +03:00 [INF] Executed endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:55:19.179 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NotImplementedException: Provider type '1' is not implemented in DbProviderFactory.CreateStandalone
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.HandleUnsupportedProvider(ProviderType type, String method) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 55
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.CreateStandalone(ProviderType Type) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 48
   at NaturalToQuery.Application.Services.SetupService.GetAvailableServersAsync(ProviderType type, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\SetupService.cs:line 49
   at NaturalToQuery.Api.Controllers.Setup.GetAvailableServers.HandleAsync(GetAvailableServersRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Setup\AvailableServers.cs:line 27
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 23:55:19.182 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 23:55:19.183 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 23:55:19.185 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/setup/servers/1 - 500 null application/json; charset=utf-8 19301.4409ms
2025-08-27 23:56:43.747 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/setup/servers/1 - null null
2025-08-27 23:56:43.759 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/servers/1'
2025-08-27 23:56:43.760 +03:00 [DBG] Endpoint 'HTTP: GET api/setup/servers/{type}' with route pattern 'api/setup/servers/{type}' is valid for the request path '/api/setup/servers/1'
2025-08-27 23:56:43.761 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:56:43.761 +03:00 [INF] Executing endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:56:43.763 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 23:56:43.764 +03:00 [ERR] Unsupported provider type '"1"' requested in CreateStandalone
2025-08-27 23:56:43.838 +03:00 [INF] Executed endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:56:43.884 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NotImplementedException: Provider type '1' is not implemented in DbProviderFactory.CreateStandalone
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.HandleUnsupportedProvider(ProviderType type, String method) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 55
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.CreateStandalone(ProviderType Type) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 48
   at NaturalToQuery.Application.Services.SetupService.GetAvailableServersAsync(ProviderType type, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\SetupService.cs:line 49
   at NaturalToQuery.Api.Controllers.Setup.GetAvailableServers.HandleAsync(GetAvailableServersRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Setup\AvailableServers.cs:line 27
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 23:56:43.887 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 23:56:43.888 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 23:56:43.889 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/setup/servers/1 - 500 null application/json; charset=utf-8 141.4669ms
2025-08-27 23:57:15.802 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/setup/servers/1 - null null
2025-08-27 23:57:15.810 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/servers/1'
2025-08-27 23:57:15.811 +03:00 [DBG] Endpoint 'HTTP: GET api/setup/servers/{type}' with route pattern 'api/setup/servers/{type}' is valid for the request path '/api/setup/servers/1'
2025-08-27 23:57:15.812 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:57:15.813 +03:00 [INF] Executing endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:57:15.814 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 23:57:26.664 +03:00 [ERR] Unsupported provider type '"1"' requested in CreateStandalone
2025-08-27 23:57:29.881 +03:00 [INF] Executed endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:57:29.931 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NotImplementedException: Provider type '1' is not implemented in DbProviderFactory.CreateStandalone
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.HandleUnsupportedProvider(ProviderType type, String method) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 55
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.CreateStandalone(ProviderType Type) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 48
   at NaturalToQuery.Application.Services.SetupService.GetAvailableServersAsync(ProviderType type, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\SetupService.cs:line 49
   at NaturalToQuery.Api.Controllers.Setup.GetAvailableServers.HandleAsync(GetAvailableServersRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Setup\AvailableServers.cs:line 27
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 23:57:29.935 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 23:57:29.936 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 23:57:29.937 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/setup/servers/1 - 500 null application/json; charset=utf-8 14135.2268ms
2025-08-27 23:57:32.730 +03:00 [DBG] Connection id "0HNF5LEVEUR6E" received FIN.
2025-08-27 23:57:32.733 +03:00 [DBG] The connection queue processing loop for 0HNF5LEVEUR6E completed.
2025-08-27 23:57:32.734 +03:00 [DBG] Connection id "0HNF5LEVEUR6E" is closed. The last processed stream ID was 19.
2025-08-27 23:57:32.735 +03:00 [DBG] Connection id "0HNF5LEVEUR6E" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 23:57:32.737 +03:00 [DBG] Connection id "0HNF5LEVEUR6E" stopped.
2025-08-27 23:58:37.910 +03:00 [INF] This is a test log to file!
2025-08-27 23:58:38.201 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 23:58:38.210 +03:00 [INF] API configured successfully.
2025-08-27 23:58:38.350 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 23:58:38.771 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 23:58:38.783 +03:00 [INF] Registered 6 endpoints in 742 milliseconds.
2025-08-27 23:58:38.790 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 23:58:38.792 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 23:58:38.793 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 23:58:38.816 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 23:58:38.855 +03:00 [DBG] Hosting starting
2025-08-27 23:58:38.867 +03:00 [DBG] Middleware loaded
2025-08-27 23:58:38.869 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 23:58:38.871 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 23:58:38.937 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 23:58:38.941 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 23:58:38.944 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 23:58:38.979 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 23:58:39.046 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 23:58:39.048 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 23:58:39.050 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 23:58:39.051 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 23:58:39.051 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 23:58:39.052 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 23:58:39.057 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 23:58:39.062 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 23:58:39.097 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 23:58:39.099 +03:00 [INF] Hosting environment: Development
2025-08-27 23:58:39.100 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 23:58:39.101 +03:00 [DBG] Hosting started
2025-08-27 23:58:39.199 +03:00 [DBG] Connection id "0HNF5LHVNA575" accepted.
2025-08-27 23:58:39.201 +03:00 [DBG] Connection id "0HNF5LHVNA575" started.
2025-08-27 23:58:39.223 +03:00 [DBG] Connection id "0HNF5LHVNA575" received FIN.
2025-08-27 23:58:39.224 +03:00 [DBG] Connection id "0HNF5LHVNA576" accepted.
2025-08-27 23:58:39.274 +03:00 [DBG] Connection id "0HNF5LHVNA577" accepted.
2025-08-27 23:58:39.348 +03:00 [DBG] Connection id "0HNF5LHVNA576" started.
2025-08-27 23:58:39.386 +03:00 [DBG] Connection id "0HNF5LHVNA577" started.
2025-08-27 23:58:39.387 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.Security.Authentication.AuthenticationException: Authentication failed, see inner exception.
 ---> System.ComponentModel.Win32Exception (0x80090327): An unknown error occurred while processing the certificate.
   --- End of inner exception stack trace ---
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-08-27 23:58:39.390 +03:00 [DBG] Connection id "0HNF5LHVNA577" received FIN.
2025-08-27 23:58:39.471 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.Security.Authentication.AuthenticationException: Authentication failed, see inner exception.
 ---> System.ComponentModel.Win32Exception (0x80090327): An unknown error occurred while processing the certificate.
   --- End of inner exception stack trace ---
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-08-27 23:58:39.475 +03:00 [DBG] Connection 0HNF5LHVNA576 established using the following protocol: "Tls13"
2025-08-27 23:58:39.476 +03:00 [DBG] Connection id "0HNF5LHVNA577" stopped.
2025-08-27 23:58:39.476 +03:00 [DBG] Connection id "0HNF5LHVNA575" stopped.
2025-08-27 23:58:39.479 +03:00 [DBG] Connection id "0HNF5LHVNA575" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 23:58:39.479 +03:00 [DBG] Connection id "0HNF5LHVNA577" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 23:58:39.510 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/setup/servers/1 - null null
2025-08-27 23:58:39.600 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/servers/1'
2025-08-27 23:58:39.602 +03:00 [DBG] Endpoint 'HTTP: GET api/setup/servers/{type}' with route pattern 'api/setup/servers/{type}' is valid for the request path '/api/setup/servers/1'
2025-08-27 23:58:39.604 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:58:39.626 +03:00 [INF] Executing endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:58:39.661 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 23:58:42.348 +03:00 [ERR] Unsupported provider type '"1"' requested in CreateStandalone
2025-08-27 23:58:42.438 +03:00 [INF] Executed endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:58:42.558 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NotImplementedException: Unsupported provider type '1'
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.HandleUnsupportedProvider(ProviderType type, String method) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 55
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.CreateStandalone(ProviderType Type) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 48
   at NaturalToQuery.Application.Services.SetupService.GetAvailableServersAsync(ProviderType type, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\SetupService.cs:line 49
   at NaturalToQuery.Api.Controllers.Setup.GetAvailableServers.HandleAsync(GetAvailableServersRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Setup\AvailableServers.cs:line 27
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 23:58:42.566 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 23:58:42.578 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 23:58:42.581 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/setup/servers/1 - 500 null application/json; charset=utf-8 3074.4113ms
2025-08-27 23:58:55.206 +03:00 [INF] This is a test log to file!
2025-08-27 23:58:55.387 +03:00 [INF] Shared Kernal configured successfully.
2025-08-27 23:58:55.394 +03:00 [INF] API configured successfully.
2025-08-27 23:58:55.511 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-08-27 23:58:55.972 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 23:58:55.987 +03:00 [INF] Registered 6 endpoints in 721 milliseconds.
2025-08-27 23:58:55.994 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 23:58:55.997 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 23:58:55.998 +03:00 [INF] Infrastructure configured successfully.
2025-08-27 23:58:56.044 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-08-27 23:58:56.118 +03:00 [DBG] Hosting starting
2025-08-27 23:58:56.136 +03:00 [DBG] Middleware loaded
2025-08-27 23:58:56.139 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-08-27 23:58:56.141 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-08-27 23:58:56.239 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-08-27 23:58:56.241 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-08-27 23:58:56.245 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-08-27 23:58:56.284 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-08-27 23:58:56.352 +03:00 [INF] Now listening on: https://localhost:7202
2025-08-27 23:58:56.354 +03:00 [INF] Now listening on: http://localhost:5000
2025-08-27 23:58:56.355 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-08-27 23:58:56.355 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-08-27 23:58:56.356 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-08-27 23:58:56.357 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-08-27 23:58:56.362 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 23:58:56.367 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-08-27 23:58:56.462 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-27 23:58:56.463 +03:00 [INF] Hosting environment: Development
2025-08-27 23:58:56.464 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-08-27 23:58:56.465 +03:00 [DBG] Hosting started
2025-08-27 23:59:00.920 +03:00 [DBG] Connection id "0HNF5LI66ESVT" accepted.
2025-08-27 23:59:00.923 +03:00 [DBG] Connection id "0HNF5LI66ESVT" started.
2025-08-27 23:59:00.944 +03:00 [DBG] Connection id "0HNF5LI66ESVT" received FIN.
2025-08-27 23:59:00.944 +03:00 [DBG] Connection id "0HNF5LI66ESVU" accepted.
2025-08-27 23:59:00.971 +03:00 [DBG] Connection id "0HNF5LI66ESVU" started.
2025-08-27 23:59:01.032 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.Security.Authentication.AuthenticationException: Authentication failed, see inner exception.
 ---> System.ComponentModel.Win32Exception (0x80090327): An unknown error occurred while processing the certificate.
   --- End of inner exception stack trace ---
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-08-27 23:59:01.034 +03:00 [DBG] Connection 0HNF5LI66ESVU established using the following protocol: "Tls13"
2025-08-27 23:59:01.039 +03:00 [DBG] Connection id "0HNF5LI66ESVT" stopped.
2025-08-27 23:59:01.041 +03:00 [DBG] Connection id "0HNF5LI66ESVT" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-08-27 23:59:01.071 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7202/api/setup/servers/1 - null null
2025-08-27 23:59:01.161 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/servers/1'
2025-08-27 23:59:01.163 +03:00 [DBG] Endpoint 'HTTP: GET api/setup/servers/{type}' with route pattern 'api/setup/servers/{type}' is valid for the request path '/api/setup/servers/1'
2025-08-27 23:59:01.166 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:59:01.193 +03:00 [INF] Executing endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:59:01.231 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-08-27 23:59:01.259 +03:00 [ERR] Unsupported provider type '"1"' requested in CreateStandalone
2025-08-27 23:59:01.347 +03:00 [INF] Executed endpoint 'HTTP: GET api/setup/servers/{type}'
2025-08-27 23:59:01.396 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NotImplementedException: Unsupported provider type
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.HandleUnsupportedProvider(ProviderType type, String method) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 55
   at NaturalToQuery.Infrastructure.Factory.DbProviderFactory.CreateStandalone(ProviderType Type) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\Factory\DbProviderFactory.cs:line 48
   at NaturalToQuery.Application.Services.SetupService.GetAvailableServersAsync(ProviderType type, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\SetupService.cs:line 49
   at NaturalToQuery.Api.Controllers.Setup.GetAvailableServers.HandleAsync(GetAvailableServersRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Setup\AvailableServers.cs:line 27
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-08-27 23:59:01.405 +03:00 [ERR] Unhandled exception occurred.
2025-08-27 23:59:01.416 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-08-27 23:59:01.419 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7202/api/setup/servers/1 - 500 null application/json; charset=utf-8 350.3468ms

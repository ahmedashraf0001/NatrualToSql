2025-09-03 15:49:34.117 +03:00 [INF] This is a test log to file!
2025-09-03 15:49:34.565 +03:00 [INF] Shared Kernal configured successfully.
2025-09-03 15:49:34.585 +03:00 [INF] API configured successfully.
2025-09-03 15:49:34.737 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-03 15:49:34.811 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-09-03 15:49:35.363 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 15:49:35.499 +03:00 [INF] API key configured for HttpClient
2025-09-03 15:49:35.508 +03:00 [INF] Registered 13 endpoints in 1,225 milliseconds.
2025-09-03 15:49:35.518 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 15:49:35.562 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 15:49:35.669 +03:00 [DBG] Creating DbConnection.
2025-09-03 15:49:35.685 +03:00 [DBG] Created DbConnection. (14ms).
2025-09-03 15:49:35.688 +03:00 [DBG] Migrating using database 'main' on server 'schema_cache.db'.
2025-09-03 15:49:35.699 +03:00 [DBG] Creating DbConnection.
2025-09-03 15:49:35.704 +03:00 [DBG] Created DbConnection. (5ms).
2025-09-03 15:49:35.706 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:49:35.740 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:49:35.744 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:49:35.748 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 15:49:35.749 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:49:35.752 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:49:35.755 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-03 15:49:35.766 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 15:49:35.772 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (3ms).
2025-09-03 15:49:35.774 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (7ms).
2025-09-03 15:49:35.781 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 15:49:35.803 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 15:49:35.807 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 15:49:35.808 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 15:49:35.809 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 15:49:35.811 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 12:49:35.8073775+00:00');
SELECT changes();
2025-09-03 15:49:35.818 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 12:49:35.8073775+00:00');
SELECT changes();
2025-09-03 15:49:35.868 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 15:49:35.872 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 15:49:35.875 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-09-03 15:49:35.877 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (1ms).
2025-09-03 15:49:35.879 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (3ms).
2025-09-03 15:49:35.880 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 15:49:35.882 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 15:49:35.885 +03:00 [DBG] Committing transaction.
2025-09-03 15:49:35.886 +03:00 [DBG] Committed transaction.
2025-09-03 15:49:35.888 +03:00 [DBG] Disposing transaction.
2025-09-03 15:49:35.890 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 15:49:35.891 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 15:49:35.893 +03:00 [DBG] Creating DbConnection.
2025-09-03 15:49:35.896 +03:00 [DBG] Created DbConnection. (2ms).
2025-09-03 15:49:35.897 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:49:35.898 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:49:35.899 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:49:35.900 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 15:49:35.902 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 15:49:35.902 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 15:49:35.904 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 15:49:35.914 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 15:49:35.916 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 15:49:35.919 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 15:49:35.921 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 15:49:35.934 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (15ms).
2025-09-03 15:49:35.936 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 15:49:35.938 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 15:49:35.945 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:49:35.949 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 6ms reading results.
2025-09-03 15:49:35.956 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-03 15:49:35.958 +03:00 [DBG] Committing transaction.
2025-09-03 15:49:35.959 +03:00 [DBG] Committed transaction.
2025-09-03 15:49:35.960 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 15:49:35.961 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 15:49:35.963 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 15:49:35.964 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 15:49:35.969 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 15:49:35.971 +03:00 [DBG] Disposing transaction.
2025-09-03 15:49:35.973 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:49:35.978 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (4ms).
2025-09-03 15:49:35.980 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 15:49:35.981 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:49:35.982 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 15:49:35.984 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 15:49:35.985 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 15:49:36.041 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-09-03 15:49:36.097 +03:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-09-03 15:49:36.099 +03:00 [DBG] Hosting starting
2025-09-03 15:49:36.114 +03:00 [DBG] Middleware loaded
2025-09-03 15:49:36.117 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-09-03 15:49:36.120 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-09-03 15:49:36.301 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-09-03 15:49:36.303 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-09-03 15:49:36.305 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-09-03 15:49:36.402 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-09-03 15:49:36.497 +03:00 [INF] Now listening on: https://localhost:7202
2025-09-03 15:49:36.498 +03:00 [INF] Now listening on: http://localhost:5000
2025-09-03 15:49:36.499 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-09-03 15:49:36.500 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-09-03 15:49:36.501 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-09-03 15:49:36.502 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-09-03 15:49:36.511 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 15:49:36.525 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 15:49:36.572 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-03 15:49:36.574 +03:00 [INF] Hosting environment: Development
2025-09-03 15:49:36.575 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-09-03 15:49:36.576 +03:00 [DBG] Hosting started
2025-09-03 15:49:50.814 +03:00 [DBG] Connection id "0HNFAT1FK9M88" received FIN.
2025-09-03 15:49:50.825 +03:00 [DBG] Connection id "0HNFAT1FK9M88" accepted.
2025-09-03 15:49:50.828 +03:00 [DBG] Connection id "0HNFAT1FK9M88" started.
2025-09-03 15:49:50.829 +03:00 [DBG] Connection id "0HNFAT1FK9M89" accepted.
2025-09-03 15:49:50.830 +03:00 [DBG] Connection id "0HNFAT1FK9M89" started.
2025-09-03 15:49:50.848 +03:00 [DBG] Connection id "0HNFAT1FK9M88" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 15:49:50.853 +03:00 [DBG] Connection id "0HNFAT1FK9M88" disconnecting.
2025-09-03 15:49:50.857 +03:00 [DBG] Connection id "0HNFAT1FK9M88" stopped.
2025-09-03 15:49:50.905 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/93f95c43-e775-4fa9-a782-eca1a00c9222/convert - application/json 73
2025-09-03 15:49:50.950 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/93f95c43-e775-4fa9-a782-eca1a00c9222/convert'
2025-09-03 15:49:50.952 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/93f95c43-e775-4fa9-a782-eca1a00c9222/convert'
2025-09-03 15:49:50.955 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:49:50.988 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-09-03 15:49:50.990 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/93f95c43-e775-4fa9-a782-eca1a00c9222/convert'.
2025-09-03 15:49:50.997 +03:00 [DBG] Connection id "0HNFAT1FK9M89" completed keep alive response.
2025-09-03 15:49:51.000 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/93f95c43-e775-4fa9-a782-eca1a00c9222/convert - 307 0 null 111.9309ms
2025-09-03 15:49:51.002 +03:00 [DBG] Connection id "0HNFAT1FK9M8A" received FIN.
2025-09-03 15:49:51.001 +03:00 [DBG] Connection id "0HNFAT1FK9M8A" accepted.
2025-09-03 15:49:51.002 +03:00 [DBG] Connection id "0HNFAT1FK9M8B" accepted.
2025-09-03 15:49:51.011 +03:00 [DBG] Connection id "0HNFAT1FK9M8A" started.
2025-09-03 15:49:51.012 +03:00 [DBG] Connection id "0HNFAT1FK9M89", Request id "0HNFAT1FK9M89:00000001": started reading request body.
2025-09-03 15:49:51.012 +03:00 [DBG] Connection id "0HNFAT1FK9M8B" started.
2025-09-03 15:49:51.013 +03:00 [DBG] Connection id "0HNFAT1FK9M8A" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 15:49:51.014 +03:00 [DBG] Connection id "0HNFAT1FK9M89", Request id "0HNFAT1FK9M89:00000001": done reading request body.
2025-09-03 15:49:51.016 +03:00 [DBG] Connection id "0HNFAT1FK9M8A" disconnecting.
2025-09-03 15:49:51.018 +03:00 [DBG] Connection id "0HNFAT1FK9M8A" stopped.
2025-09-03 15:49:51.062 +03:00 [DBG] Connection 0HNFAT1FK9M8B established using the following protocol: "Tls13"
2025-09-03 15:49:51.066 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/93f95c43-e775-4fa9-a782-eca1a00c9222/convert - application/json 73
2025-09-03 15:49:51.070 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/93f95c43-e775-4fa9-a782-eca1a00c9222/convert'
2025-09-03 15:49:51.071 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/93f95c43-e775-4fa9-a782-eca1a00c9222/convert'
2025-09-03 15:49:51.073 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:49:51.078 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:49:51.098 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 15:49:51.101 +03:00 [INF] API key configured for HttpClient
2025-09-03 15:49:51.143 +03:00 [DBG] Connection id "0HNFAT1FK9M8B", Request id "0HNFAT1FK9M8B:00000001": started reading request body.
2025-09-03 15:49:51.146 +03:00 [DBG] Connection id "0HNFAT1FK9M8B", Request id "0HNFAT1FK9M8B:00000001": done reading request body.
2025-09-03 15:49:51.184 +03:00 [INF] Converting NL to SQL for profile "93f95c43-e775-4fa9-a782-eca1a00c9222"
2025-09-03 15:49:51.243 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-09-03 15:49:51.281 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-09-03 15:49:51.490 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<DatabaseName>k__BackingField = dataReader.GetString(3);
                                        instance.<Name>k__BackingField = dataReader.GetString(4);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(5));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(6);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(7) ? default(Guid?) : (Guid?)dataReader.GetGuid(7) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(7) ? default(object) : (object)dataReader.GetGuid(7) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(8) ? default(Guid) : dataReader.GetGuid(8);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(10) ? default(string) : dataReader.GetString(10);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(11) ? default(DateTime) : dataReader.GetDateTime(11);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(12) ? default(string) : dataReader.GetString(12);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-09-03 15:49:51.517 +03:00 [DBG] Creating DbConnection.
2025-09-03 15:49:51.518 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 15:49:51.520 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:49:51.523 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:49:51.524 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 15:49:51.525 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 15:49:51.527 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2025-09-03 15:49:51.530 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:49:51.538 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:49:51.543 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:49:51.544 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 4ms reading results.
2025-09-03 15:49:51.546 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:49:51.548 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 15:49:51.780 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:49:51.834 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.ArgumentException: No profile found with id: 93f95c43-e775-4fa9-a782-eca1a00c9222
   at NaturalToQuery.Application.Services.ProfileService.GetProviderTypeAsync(Guid profileId, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileService.cs:line 200
   at NaturalToQuery.Application.Services.ProfileDbService.CreateContext(Guid profileId, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 61
   at NaturalToQuery.Application.Services.ProfileDbService.GetSchemaAsync(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 45
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ConvertNaturalLanguageAsync(Guid profileId, String naturalLanguage, ExecutionMode Mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 29
   at NaturalToQuery.Api.Controllers.Query.ConvertNaturalLanguage.HandleAsync(ConvertNaturalLanguageRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Query\ConvertNaturalLanguage.cs:line 45
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-09-03 15:49:51.849 +03:00 [ERR] Unhandled exception occurred.
2025-09-03 15:49:51.860 +03:00 [DBG] Connection id "0HNFAT1FK9M8B" completed keep alive response.
2025-09-03 15:49:51.862 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 15:49:51.865 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:49:51.867 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 15:49:51.869 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/93f95c43-e775-4fa9-a782-eca1a00c9222/convert - 500 null application/json; charset=utf-8 803.271ms
2025-09-03 15:49:59.981 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/setup/profiles - null null
2025-09-03 15:49:59.984 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profiles'
2025-09-03 15:49:59.985 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/setup/profiles'
2025-09-03 15:49:59.995 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/setup/profiles'.
2025-09-03 15:49:59.996 +03:00 [DBG] Connection id "0HNFAT1FK9M89" completed keep alive response.
2025-09-03 15:49:59.996 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/setup/profiles - 307 0 null 15.1315ms
2025-09-03 15:49:59.998 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7202/api/setup/profiles - null null
2025-09-03 15:50:00.002 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profiles'
2025-09-03 15:50:00.003 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/setup/profiles'
2025-09-03 15:50:00.006 +03:00 [INF] Executing endpoint 'HTTP: GET api/setup/profiles'
2025-09-03 15:50:00.008 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 15:50:00.019 +03:00 [INF] Listing all profiles
2025-09-03 15:50:00.022 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .AsNoTracking()'
2025-09-03 15:50:00.024 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-09-03 15:50:00.038 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Profile>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
            3 -> 7
        SELECT p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
        FROM Profiles AS p
        LEFT JOIN Queries AS q ON p.Id == q.ProfileId
        ORDER BY p.Id ASC) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
            3 -> 7
        SELECT p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
        FROM Profiles AS p
        LEFT JOIN Queries AS q ON p.Id == q.ProfileId
        ORDER BY p.Id ASC, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        resultContext.Values == null ? 
        {
            Profile entity;
            entity = 
            {
                MaterializationContext materializationContext1;
                IEntityType entityType1;
                Profile instance1;
                materializationContext1 = new MaterializationContext(
                    [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                    queryContext.Context
                );
                instance1 = default(Profile);
                (object)dataReader.GetGuid(0) != null ? 
                {
                    ISnapshot shadowSnapshot1;
                    shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                    entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                    instance1 = switch (entityType1)
                    {
                        case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                            {
                                return 
                                {
                                    Profile instance;
                                    instance = new Profile();
                                    instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                    instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                    instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                    instance.<DatabaseName>k__BackingField = dataReader.GetString(3);
                                    instance.<Name>k__BackingField = dataReader.GetString(4);
                                    instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(5));
                                    instance.<SecretRef>k__BackingField = dataReader.GetString(6);
                                    (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                        context: materializationContext1.Context, 
                                        entity: instance, 
                                        queryTrackingBehavior: NoTracking, 
                                        structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                    return instance;
                                }}
                        default: 
                            default(Profile)
                    }
                    ;
                    return instance1;
                } : 
                {
                    object[] keyValues1;
                    keyValues1 = new object[]{ (object)dataReader.GetGuid(0) };
                    return ShapedQueryCompilingExpressionVisitor.CreateNullKeyValueInNoTrackingQuery(
                        entityType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")], 
                        properties: [LIFTABLE Constant: List<RuntimeProperty> { Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd } | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey().Properties], 
                        keyValues: keyValues1);
                };
                return instance1;
            };
            resultContext.Values = new object[]{ entity };
            ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                entity: (Profile)(resultContext.Values[0]), 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                trackingQuery: False, 
                setLoaded: True);
        } : default(void);
        ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
            collectionId: 0, 
            queryContext: queryContext, 
            dbDataReader: dataReader, 
            resultCoordinator: resultCoordinator, 
            parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
            outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
            selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(7) ? default(Guid?) : (Guid?)dataReader.GetGuid(7) }], 
            parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
            outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
            selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
            innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
            {
                Query entity;
                entity = 
                {
                    MaterializationContext materializationContext2;
                    IEntityType entityType2;
                    Query instance2;
                    materializationContext2 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance2 = default(Query);
                    dataReader.IsDBNull(7) ? default(object) : (object)dataReader.GetGuid(7) != null ? 
                    {
                        ISnapshot shadowSnapshot2;
                        shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                        instance2 = switch (entityType2)
                        {
                            case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                {
                                    return 
                                    {
                                        Query instance;
                                        instance = new Query();
                                        instance.<Id>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                        instance.<ProfileId>k__BackingField = dataReader.IsDBNull(8) ? default(Guid) : dataReader.GetGuid(8);
                                        instance.<ResultJson>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                        instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(10) ? default(string) : dataReader.GetString(10);
                                        instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(11) ? default(DateTime) : dataReader.GetDateTime(11);
                                        instance.<UserQuery>k__BackingField = dataReader.IsDBNull(12) ? default(string) : dataReader.GetString(12);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext2.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: NoTracking, 
                                            structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Query)
                        }
                        ;
                        return instance2;
                    } : default(void);
                    return instance2;
                };
                return entity;
            }, 
            inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{10} => namelessParameter{10}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
            fixup: (namelessParameter{11}, namelessParameter{12}) => 
            {
                [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{13} => namelessParameter{13}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                    entity: namelessParameter{11}, 
                    value: namelessParameter{12}, 
                    forMaterialization: True);
                return namelessParameter{12}.<Profile>k__BackingField = namelessParameter{11};
            }, 
            trackingQuery: False);
        return IsTrue(resultCoordinator.ResultReady)
         ? (Profile)(resultContext.Values[0]) : default(Profile);
    }, 
    contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-09-03 15:50:00.043 +03:00 [DBG] Creating DbConnection.
2025-09-03 15:50:00.044 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 15:50:00.045 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:50:00.046 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:50:00.047 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 15:50:00.048 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 15:50:00.049 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 15:50:00.049 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM "Profiles" AS "p"
LEFT JOIN "Queries" AS "q" ON "p"."Id" = "q"."ProfileId"
ORDER BY "p"."Id"
2025-09-03 15:50:00.051 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM "Profiles" AS "p"
LEFT JOIN "Queries" AS "q" ON "p"."Id" = "q"."ProfileId"
ORDER BY "p"."Id"
2025-09-03 15:50:00.074 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:50:00.075 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 23ms reading results.
2025-09-03 15:50:00.077 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:50:00.078 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 15:50:00.080 +03:00 [INF] Fetching connection string for profile "3d0cdaa1-a28f-48b0-a256-e9e404e13caa"
2025-09-03 15:50:00.084 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:50:00.085 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:50:00.086 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 15:50:00.087 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 15:50:00.088 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 15:50:00.089 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:50:00.091 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:50:00.118 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:50:00.137 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:50:00.138 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 45ms reading results.
2025-09-03 15:50:00.140 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:50:00.141 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 15:50:00.155 +03:00 [DBG] Fetched secret for profile "3d0cdaa1-a28f-48b0-a256-e9e404e13caa"
2025-09-03 15:50:00.156 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 15:50:00.158 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:50:00.159 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:50:00.160 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 15:50:00.161 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 15:50:00.162 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 15:50:00.163 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:50:00.165 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:50:00.168 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:50:00.179 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:50:00.190 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:50:00.192 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:50:00.194 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:50:00.195 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:50:00.196 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:50:00.198 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 30ms reading results.
2025-09-03 15:50:00.199 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:50:00.201 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 15:50:00.203 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 15:50:00.219 +03:00 [INF] Executed endpoint 'HTTP: GET api/setup/profiles'
2025-09-03 15:50:00.220 +03:00 [DBG] Connection id "0HNFAT1FK9M8B" completed keep alive response.
2025-09-03 15:50:00.221 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 15:50:00.223 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:50:00.224 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 15:50:00.226 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7202/api/setup/profiles - 200 null application/json; charset=utf-8 228.5864ms
2025-09-03 15:55:39.682 +03:00 [DBG] Connection id "0HNFAT1FK9M8C" received FIN.
2025-09-03 15:55:39.683 +03:00 [DBG] Connection id "0HNFAT1FK9M8C" accepted.
2025-09-03 15:55:39.711 +03:00 [DBG] Connection id "0HNFAT1FK9M8C" started.
2025-09-03 15:55:39.711 +03:00 [DBG] Connection id "0HNFAT1FK9M8D" accepted.
2025-09-03 15:55:39.718 +03:00 [DBG] Connection id "0HNFAT1FK9M8C" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 15:55:39.719 +03:00 [DBG] Connection id "0HNFAT1FK9M8D" started.
2025-09-03 15:55:39.719 +03:00 [DBG] Connection id "0HNFAT1FK9M8C" disconnecting.
2025-09-03 15:55:39.720 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/3d0cdaa1-a28f-48b0-a256-e9e404e13caa/convert - application/json 73
2025-09-03 15:55:39.721 +03:00 [DBG] Connection id "0HNFAT1FK9M8C" stopped.
2025-09-03 15:55:39.723 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/3d0cdaa1-a28f-48b0-a256-e9e404e13caa/convert'
2025-09-03 15:55:39.724 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/3d0cdaa1-a28f-48b0-a256-e9e404e13caa/convert'
2025-09-03 15:55:39.725 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:55:39.726 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/3d0cdaa1-a28f-48b0-a256-e9e404e13caa/convert'.
2025-09-03 15:55:39.727 +03:00 [DBG] Connection id "0HNFAT1FK9M8D" completed keep alive response.
2025-09-03 15:55:39.728 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/3d0cdaa1-a28f-48b0-a256-e9e404e13caa/convert - 307 0 null 7.4986ms
2025-09-03 15:55:39.728 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/3d0cdaa1-a28f-48b0-a256-e9e404e13caa/convert - application/json 73
2025-09-03 15:55:39.730 +03:00 [DBG] Connection id "0HNFAT1FK9M8D", Request id "0HNFAT1FK9M8D:00000001": started reading request body.
2025-09-03 15:55:39.732 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/3d0cdaa1-a28f-48b0-a256-e9e404e13caa/convert'
2025-09-03 15:55:39.734 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/3d0cdaa1-a28f-48b0-a256-e9e404e13caa/convert'
2025-09-03 15:55:39.733 +03:00 [DBG] Connection id "0HNFAT1FK9M8D", Request id "0HNFAT1FK9M8D:00000001": done reading request body.
2025-09-03 15:55:39.734 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:55:39.738 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:55:39.740 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 15:55:39.741 +03:00 [INF] API key configured for HttpClient
2025-09-03 15:55:39.742 +03:00 [DBG] Connection id "0HNFAT1FK9M8B", Request id "0HNFAT1FK9M8B:00000003": started reading request body.
2025-09-03 15:55:39.742 +03:00 [DBG] Connection id "0HNFAT1FK9M8B", Request id "0HNFAT1FK9M8B:00000003": done reading request body.
2025-09-03 15:55:39.743 +03:00 [INF] Converting NL to SQL for profile "3d0cdaa1-a28f-48b0-a256-e9e404e13caa"
2025-09-03 15:55:39.745 +03:00 [DBG] Creating DbConnection.
2025-09-03 15:55:39.746 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 15:55:39.746 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:55:39.747 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:55:39.748 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 15:55:39.749 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 15:55:39.749 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 15:55:39.750 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:55:39.753 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:55:39.754 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:55:39.755 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:55:39.756 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 15:55:39.757 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:55:39.758 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 15:55:39.766 +03:00 [INF] Fetching connection string for profile "3d0cdaa1-a28f-48b0-a256-e9e404e13caa"
2025-09-03 15:55:39.767 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:55:39.767 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:55:39.768 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 15:55:39.769 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 15:55:39.769 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 15:55:39.770 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:55:39.772 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:55:39.773 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:55:39.774 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-09-03 15:55:39.774 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:55:39.775 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 15:55:39.777 +03:00 [DBG] Fetched secret for profile "3d0cdaa1-a28f-48b0-a256-e9e404e13caa"
2025-09-03 15:55:39.922 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:55:39.965 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No connection string for Profile 3d0cdaa1-a28f-48b0-a256-e9e404e13caa
   at NaturalToQuery.Application.Services.ProfileDbService.CreateContext(Guid profileId, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 63
   at NaturalToQuery.Application.Services.ProfileDbService.GetSchemaAsync(Guid profileId, Boolean forceRefresh, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\ProfileDbService.cs:line 45
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ConvertNaturalLanguageAsync(Guid profileId, String naturalLanguage, ExecutionMode Mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 29
   at NaturalToQuery.Api.Controllers.Query.ConvertNaturalLanguage.HandleAsync(ConvertNaturalLanguageRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Query\ConvertNaturalLanguage.cs:line 45
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-09-03 15:55:39.969 +03:00 [ERR] Unhandled exception occurred.
2025-09-03 15:55:39.970 +03:00 [DBG] Connection id "0HNFAT1FK9M8B" completed keep alive response.
2025-09-03 15:55:39.971 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 15:55:39.972 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:55:39.972 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 15:55:39.973 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/3d0cdaa1-a28f-48b0-a256-e9e404e13caa/convert - 500 null application/json; charset=utf-8 244.9452ms
2025-09-03 15:55:54.575 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 73
2025-09-03 15:55:54.577 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 15:55:54.578 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 15:55:54.579 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:55:54.580 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 15:55:54.581 +03:00 [DBG] Connection id "0HNFAT1FK9M8D" completed keep alive response.
2025-09-03 15:55:54.582 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 6.4845ms
2025-09-03 15:55:54.582 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 73
2025-09-03 15:55:54.583 +03:00 [DBG] Connection id "0HNFAT1FK9M8D", Request id "0HNFAT1FK9M8D:00000002": started reading request body.
2025-09-03 15:55:54.585 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 15:55:54.586 +03:00 [DBG] Connection id "0HNFAT1FK9M8D", Request id "0HNFAT1FK9M8D:00000002": done reading request body.
2025-09-03 15:55:54.587 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 15:55:54.588 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:55:54.589 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:55:54.590 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 15:55:54.592 +03:00 [INF] API key configured for HttpClient
2025-09-03 15:55:54.592 +03:00 [DBG] Connection id "0HNFAT1FK9M8B", Request id "0HNFAT1FK9M8B:00000004": started reading request body.
2025-09-03 15:55:54.593 +03:00 [DBG] Connection id "0HNFAT1FK9M8B", Request id "0HNFAT1FK9M8B:00000004": done reading request body.
2025-09-03 15:55:54.594 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 15:55:54.595 +03:00 [DBG] Creating DbConnection.
2025-09-03 15:55:54.595 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 15:55:54.596 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:55:54.597 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:55:54.598 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 15:55:54.598 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 15:55:54.599 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 15:55:54.600 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:55:54.601 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:55:54.603 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:55:54.604 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:55:54.605 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:55:54.605 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:55:54.606 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:55:54.607 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:55:54.608 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:55:54.609 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 6ms reading results.
2025-09-03 15:55:54.610 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:55:54.610 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 15:55:54.611 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 15:55:54.612 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:55:54.613 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:55:54.614 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 15:55:54.615 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 15:55:54.615 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 15:55:54.616 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:55:54.617 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:55:54.619 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:55:54.619 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-09-03 15:55:54.621 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:55:54.621 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 15:55:54.623 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 15:55:54.683 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 15:55:54.689 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 15:55:54.830 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 15:55:54.847 +03:00 [INF] Converting natural language to SQL. User query: Show me all products
2025-09-03 15:55:54.848 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 15:55:54.849 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 15:55:54.855 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 15:56:05.332 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 15:56:24.122 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:56:25.144 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.NullReferenceException: Object reference not set to an instance of an object.
   at NaturalToQuery.Infrastructure.LLM.LLMService.ExtractContentFromResponse(LLMApiResponse apiResponse) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 153
   at NaturalToQuery.Infrastructure.LLM.LLMService.ConvertToSqlAsync(String schema, String userQuery, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 66
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ConvertNaturalLanguageAsync(Guid profileId, String naturalLanguage, ExecutionMode Mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 41
   at NaturalToQuery.Api.Controllers.Query.ConvertNaturalLanguage.HandleAsync(ConvertNaturalLanguageRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Query\ConvertNaturalLanguage.cs:line 45
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-09-03 15:56:25.148 +03:00 [ERR] Unhandled exception occurred.
2025-09-03 15:56:25.151 +03:00 [DBG] Connection id "0HNFAT1FK9M8B" completed keep alive response.
2025-09-03 15:56:25.153 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 15:56:25.154 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:56:25.155 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 15:56:25.171 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 500 null application/json; charset=utf-8 30589.3469ms
2025-09-03 15:56:40.867 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 73
2025-09-03 15:56:40.869 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 15:56:40.871 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 15:56:40.872 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:56:40.873 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 15:56:40.874 +03:00 [DBG] Connection id "0HNFAT1FK9M8D" completed keep alive response.
2025-09-03 15:56:40.875 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 8.3699ms
2025-09-03 15:56:40.901 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 73
2025-09-03 15:56:40.903 +03:00 [DBG] Connection id "0HNFAT1FK9M8D", Request id "0HNFAT1FK9M8D:00000003": started reading request body.
2025-09-03 15:56:40.905 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 15:56:40.906 +03:00 [DBG] Connection id "0HNFAT1FK9M8D", Request id "0HNFAT1FK9M8D:00000003": done reading request body.
2025-09-03 15:56:40.907 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 15:56:40.909 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:56:40.911 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:56:40.912 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 15:56:40.914 +03:00 [INF] API key configured for HttpClient
2025-09-03 15:56:40.915 +03:00 [DBG] Connection id "0HNFAT1FK9M8B", Request id "0HNFAT1FK9M8B:00000005": started reading request body.
2025-09-03 15:56:40.916 +03:00 [DBG] Connection id "0HNFAT1FK9M8B", Request id "0HNFAT1FK9M8B:00000005": done reading request body.
2025-09-03 15:56:40.917 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 15:56:40.918 +03:00 [DBG] Creating DbConnection.
2025-09-03 15:56:40.919 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 15:56:40.919 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:56:40.920 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:56:40.921 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 15:56:40.921 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 15:56:40.922 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 15:56:40.923 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:56:40.925 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:56:40.926 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:56:40.927 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:56:40.928 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:56:40.929 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:56:40.930 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:56:40.931 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:56:40.932 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:56:40.933 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 6ms reading results.
2025-09-03 15:56:40.934 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:56:40.936 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 15:56:40.938 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 15:56:40.939 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:56:40.940 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:56:40.942 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 15:56:40.943 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 15:56:40.944 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 15:56:40.945 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:56:40.946 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:56:40.947 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:56:40.948 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-09-03 15:56:40.949 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:56:40.950 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 15:56:40.951 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 15:56:40.953 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 15:56:40.954 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 15:56:40.955 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 15:56:40.956 +03:00 [INF] Converting natural language to SQL. User query: Show me all products
2025-09-03 15:56:40.957 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 15:56:40.958 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 15:57:26.127 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 15:59:18.687 +03:00 [ERR] LLM API request timed out: The request was canceled due to the configured HttpClient.Timeout of 100 seconds elapsing.
2025-09-03 15:59:19.704 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:59:19.904 +03:00 [ERR] An unhandled exception has occurred while executing the request.
NaturalToQuery.Core.Exceptions.LLMServiceException: LLM API request timed out
 ---> System.Threading.Tasks.TaskCanceledException: The request was canceled due to the configured HttpClient.Timeout of 100 seconds elapsing.
 ---> System.TimeoutException: The operation was canceled.
 ---> System.Threading.Tasks.TaskCanceledException: The operation was canceled.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Http.HttpConnection.InitialFillAsync(Boolean async)
   at System.Net.Http.HttpConnection.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnection.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.DiagnosticsHandler.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   --- End of inner exception stack trace ---
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpClient.HandleFailure(Exception e, Boolean telemetryStarted, HttpResponseMessage response, CancellationTokenSource cts, CancellationToken cancellationToken, CancellationTokenSource pendingRequestsCts)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at NaturalToQuery.Infrastructure.LLM.LLMService.CallLlmApiAsync(PromptMessage[] messages, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 93
   --- End of inner exception stack trace ---
   at NaturalToQuery.Infrastructure.LLM.LLMService.CallLlmApiAsync(PromptMessage[] messages, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 127
   at NaturalToQuery.Infrastructure.LLM.LLMService.ConvertToSqlAsync(String schema, String userQuery, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 65
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ConvertNaturalLanguageAsync(Guid profileId, String naturalLanguage, ExecutionMode Mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 41
   at NaturalToQuery.Api.Controllers.Query.ConvertNaturalLanguage.HandleAsync(ConvertNaturalLanguageRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Query\ConvertNaturalLanguage.cs:line 45
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-09-03 15:59:19.911 +03:00 [ERR] Error occurred.
2025-09-03 15:59:20.087 +03:00 [ERR] An exception was thrown attempting to execute the error handler.
System.ArgumentNullException: Value cannot be null. (Parameter 'json')
   at System.Text.Json.ThrowHelper.ThrowArgumentNullException(String parameterName)
   at System.Text.Json.JsonDocument.Parse(String json, JsonDocumentOptions options)
   at NaturalToQuery.Api.Middlewares.ExceptionMiddlewareHelper.ParseGroqApiError(String responseBody) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Middlewares\ExceptionMiddleware.Helper.cs:line 87
   at NaturalToQuery.Api.Middlewares.ExceptionMiddlewareHelper.<>c.<.cctor>b__3_4(Exception ex) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Middlewares\ExceptionMiddleware.Helper.cs:line 58
   at NaturalToQuery.Api.Middlewares.ExceptionMiddlewareExtensions.<>c__DisplayClass0_0.<<ConfigureExceptionHandler>b__1>d.MoveNext() in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Middlewares\ExceptionMiddleware.cs:line 29
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.HandleException(HttpContext context, ExceptionDispatchInfo edi)
2025-09-03 15:59:20.476 +03:00 [ERR] An unhandled exception has occurred while executing the request.
NaturalToQuery.Core.Exceptions.LLMServiceException: LLM API request timed out
 ---> System.Threading.Tasks.TaskCanceledException: The request was canceled due to the configured HttpClient.Timeout of 100 seconds elapsing.
 ---> System.TimeoutException: The operation was canceled.
 ---> System.Threading.Tasks.TaskCanceledException: The operation was canceled.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Http.HttpConnection.InitialFillAsync(Boolean async)
   at System.Net.Http.HttpConnection.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnection.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.DiagnosticsHandler.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   --- End of inner exception stack trace ---
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpClient.HandleFailure(Exception e, Boolean telemetryStarted, HttpResponseMessage response, CancellationTokenSource cts, CancellationToken cancellationToken, CancellationTokenSource pendingRequestsCts)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at NaturalToQuery.Infrastructure.LLM.LLMService.CallLlmApiAsync(PromptMessage[] messages, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 93
   --- End of inner exception stack trace ---
   at NaturalToQuery.Infrastructure.LLM.LLMService.CallLlmApiAsync(PromptMessage[] messages, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 127
   at NaturalToQuery.Infrastructure.LLM.LLMService.ConvertToSqlAsync(String schema, String userQuery, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 65
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ConvertNaturalLanguageAsync(Guid profileId, String naturalLanguage, ExecutionMode Mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 41
   at NaturalToQuery.Api.Controllers.Query.ConvertNaturalLanguage.HandleAsync(ConvertNaturalLanguageRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Query\ConvertNaturalLanguage.cs:line 45
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.HandleException(HttpContext context, ExceptionDispatchInfo edi)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.HandleException(HttpContext context, ExceptionDispatchInfo edi)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-09-03 15:59:20.488 +03:00 [DBG] Connection id "0HNFAT1FK9M8B" completed keep alive response.
2025-09-03 15:59:20.489 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 15:59:20.490 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:59:20.491 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 15:59:20.492 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 500 null text/plain; charset=utf-8 159615.3556ms
2025-09-03 15:59:54.918 +03:00 [DBG] Connection id "0HNFAT1FK9M8E" accepted.
2025-09-03 15:59:54.923 +03:00 [DBG] Connection id "0HNFAT1FK9M8E" received FIN.
2025-09-03 15:59:54.928 +03:00 [DBG] Connection id "0HNFAT1FK9M8F" accepted.
2025-09-03 15:59:54.929 +03:00 [DBG] Connection id "0HNFAT1FK9M8E" started.
2025-09-03 15:59:54.933 +03:00 [DBG] Connection id "0HNFAT1FK9M8F" started.
2025-09-03 15:59:54.934 +03:00 [DBG] Connection id "0HNFAT1FK9M8E" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 15:59:54.934 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 73
2025-09-03 15:59:54.935 +03:00 [DBG] Connection id "0HNFAT1FK9M8E" disconnecting.
2025-09-03 15:59:54.937 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 15:59:54.937 +03:00 [DBG] Connection id "0HNFAT1FK9M8E" stopped.
2025-09-03 15:59:54.938 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 15:59:54.939 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:59:54.940 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 15:59:54.941 +03:00 [DBG] Connection id "0HNFAT1FK9M8F" completed keep alive response.
2025-09-03 15:59:54.941 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 7.2777ms
2025-09-03 15:59:54.942 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 73
2025-09-03 15:59:54.944 +03:00 [DBG] Connection id "0HNFAT1FK9M8F", Request id "0HNFAT1FK9M8F:00000001": started reading request body.
2025-09-03 15:59:54.945 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 15:59:54.946 +03:00 [DBG] Connection id "0HNFAT1FK9M8F", Request id "0HNFAT1FK9M8F:00000001": done reading request body.
2025-09-03 15:59:54.947 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 15:59:54.948 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:59:54.949 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 15:59:54.950 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 15:59:54.951 +03:00 [INF] API key configured for HttpClient
2025-09-03 15:59:54.952 +03:00 [DBG] Connection id "0HNFAT1FK9M8B", Request id "0HNFAT1FK9M8B:00000006": started reading request body.
2025-09-03 15:59:54.953 +03:00 [DBG] Connection id "0HNFAT1FK9M8B", Request id "0HNFAT1FK9M8B:00000006": done reading request body.
2025-09-03 15:59:54.954 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 15:59:54.955 +03:00 [DBG] Creating DbConnection.
2025-09-03 15:59:54.955 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 15:59:54.956 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:59:54.957 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:59:54.957 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 15:59:54.958 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 15:59:54.959 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 15:59:54.959 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:59:54.961 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:59:54.962 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:59:54.963 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:59:54.964 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:59:54.965 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:59:54.965 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:59:54.967 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 15:59:54.967 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:59:54.968 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 6ms reading results.
2025-09-03 15:59:54.969 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:59:54.970 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 15:59:54.971 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 15:59:54.972 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 15:59:54.972 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:59:54.974 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 15:59:54.974 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 15:59:54.975 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 15:59:54.976 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:59:54.978 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 15:59:54.979 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:59:54.980 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-09-03 15:59:54.981 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 15:59:54.982 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 15:59:54.983 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 15:59:54.984 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 15:59:54.985 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 15:59:54.986 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 15:59:54.987 +03:00 [INF] Converting natural language to SQL. User query: Show me all products
2025-09-03 15:59:54.988 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 15:59:54.988 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 15:59:58.223 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 16:00:28.641 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 16:10:11.629 +03:00 [INF] This is a test log to file!
2025-09-03 16:10:11.895 +03:00 [INF] Shared Kernal configured successfully.
2025-09-03 16:10:11.908 +03:00 [INF] API configured successfully.
2025-09-03 16:10:12.008 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-03 16:10:12.051 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-09-03 16:10:12.453 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 16:10:12.480 +03:00 [INF] API key configured for HttpClient
2025-09-03 16:10:12.489 +03:00 [INF] Registered 13 endpoints in 757 milliseconds.
2025-09-03 16:10:12.494 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 16:10:12.527 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 16:32:24.246 +03:00 [INF] This is a test log to file!
2025-09-03 16:32:24.713 +03:00 [INF] Shared Kernal configured successfully.
2025-09-03 16:32:24.723 +03:00 [INF] API configured successfully.
2025-09-03 16:32:24.838 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-03 16:32:24.909 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-09-03 16:32:25.530 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 16:32:25.583 +03:00 [INF] API key configured for HttpClient
2025-09-03 16:32:25.594 +03:00 [INF] Registered 13 endpoints in 1,186 milliseconds.
2025-09-03 16:32:25.601 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 16:32:25.644 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 16:32:25.777 +03:00 [DBG] Creating DbConnection.
2025-09-03 16:32:25.794 +03:00 [DBG] Created DbConnection. (13ms).
2025-09-03 16:32:25.801 +03:00 [DBG] Migrating using database 'main' on server 'schema_cache.db'.
2025-09-03 16:32:25.808 +03:00 [DBG] Creating DbConnection.
2025-09-03 16:32:25.811 +03:00 [DBG] Created DbConnection. (2ms).
2025-09-03 16:32:25.813 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:32:25.822 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:32:25.826 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:32:25.832 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:32:25.833 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:32:25.838 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:32:25.840 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-03 16:32:25.851 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 16:32:25.858 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (4ms).
2025-09-03 16:32:25.860 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (9ms).
2025-09-03 16:32:25.878 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 16:32:25.904 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 16:32:25.908 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 16:32:25.909 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 16:32:25.909 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 16:32:25.910 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 13:32:25.9080382+00:00');
SELECT changes();
2025-09-03 16:32:25.939 +03:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 13:32:25.9080382+00:00');
SELECT changes();
2025-09-03 16:32:26.000 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 16:32:26.023 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 16:32:26.074 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-09-03 16:32:26.081 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (6ms).
2025-09-03 16:32:26.109 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (34ms).
2025-09-03 16:32:26.110 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 16:32:26.112 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 16:32:26.115 +03:00 [DBG] Committing transaction.
2025-09-03 16:32:26.117 +03:00 [DBG] Committed transaction.
2025-09-03 16:32:26.119 +03:00 [DBG] Disposing transaction.
2025-09-03 16:32:26.122 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 16:32:26.123 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 16:32:26.125 +03:00 [DBG] Creating DbConnection.
2025-09-03 16:32:26.126 +03:00 [DBG] Created DbConnection. (1ms).
2025-09-03 16:32:26.127 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:32:26.129 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:32:26.130 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:32:26.132 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:32:26.134 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 16:32:26.135 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 16:32:26.142 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (7ms).
2025-09-03 16:32:26.143 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 16:32:26.144 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 16:32:26.148 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:32:26.153 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (4ms).
2025-09-03 16:32:26.157 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (9ms).
2025-09-03 16:32:26.162 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 16:32:26.165 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 16:32:26.171 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:32:26.173 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 3ms reading results.
2025-09-03 16:32:26.179 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-03 16:32:26.180 +03:00 [DBG] Committing transaction.
2025-09-03 16:32:26.181 +03:00 [DBG] Committed transaction.
2025-09-03 16:32:26.181 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 16:32:26.182 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 16:32:26.183 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 16:32:26.184 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 16:32:26.188 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 16:32:26.190 +03:00 [DBG] Disposing transaction.
2025-09-03 16:32:26.192 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:32:26.200 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (8ms).
2025-09-03 16:32:26.202 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 16:32:26.202 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:32:26.203 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 16:32:26.205 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 16:32:26.205 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 16:32:26.238 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-09-03 16:32:26.286 +03:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-09-03 16:32:26.288 +03:00 [DBG] Hosting starting
2025-09-03 16:32:26.303 +03:00 [DBG] Middleware loaded
2025-09-03 16:32:26.307 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-09-03 16:32:26.309 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-09-03 16:32:26.422 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-09-03 16:32:26.427 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-09-03 16:32:26.430 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-09-03 16:32:26.483 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-09-03 16:32:26.559 +03:00 [INF] Now listening on: https://localhost:7202
2025-09-03 16:32:26.560 +03:00 [INF] Now listening on: http://localhost:5000
2025-09-03 16:32:26.561 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-09-03 16:32:26.562 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-09-03 16:32:26.563 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-09-03 16:32:26.564 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-09-03 16:32:26.570 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 16:32:26.579 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 16:32:26.736 +03:00 [DBG] Connection id "0HNFATP9BF5F5" received FIN.
2025-09-03 16:32:26.741 +03:00 [DBG] Connection id "0HNFATP9BF5F5" accepted.
2025-09-03 16:32:26.743 +03:00 [DBG] Connection id "0HNFATP9BF5F5" started.
2025-09-03 16:32:26.745 +03:00 [DBG] Connection id "0HNFATP9BF5F6" accepted.
2025-09-03 16:32:26.746 +03:00 [DBG] Connection id "0HNFATP9BF5F6" started.
2025-09-03 16:32:26.750 +03:00 [DBG] Connection id "0HNFATP9BF5F5" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 16:32:26.754 +03:00 [DBG] Connection id "0HNFATP9BF5F5" disconnecting.
2025-09-03 16:32:26.758 +03:00 [DBG] Connection id "0HNFATP9BF5F5" stopped.
2025-09-03 16:32:26.839 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 73
2025-09-03 16:32:26.842 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-03 16:32:26.843 +03:00 [INF] Hosting environment: Development
2025-09-03 16:32:26.844 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-09-03 16:32:26.860 +03:00 [DBG] Hosting started
2025-09-03 16:32:26.892 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:32:26.894 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:32:26.897 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:32:26.921 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-09-03 16:32:26.923 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 16:32:26.932 +03:00 [DBG] Connection id "0HNFATP9BF5F6" completed keep alive response.
2025-09-03 16:32:26.934 +03:00 [DBG] Connection id "0HNFATP9BF5F7" accepted.
2025-09-03 16:32:26.935 +03:00 [DBG] Connection id "0HNFATP9BF5F8" accepted.
2025-09-03 16:32:26.935 +03:00 [DBG] Connection id "0HNFATP9BF5F7" received FIN.
2025-09-03 16:32:26.938 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 107.2676ms
2025-09-03 16:32:26.942 +03:00 [DBG] Connection id "0HNFATP9BF5F7" started.
2025-09-03 16:32:26.943 +03:00 [DBG] Connection id "0HNFATP9BF5F8" started.
2025-09-03 16:32:26.949 +03:00 [DBG] Connection id "0HNFATP9BF5F7" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 16:32:26.949 +03:00 [DBG] Connection id "0HNFATP9BF5F6", Request id "0HNFATP9BF5F6:00000001": started reading request body.
2025-09-03 16:32:26.951 +03:00 [DBG] Connection id "0HNFATP9BF5F7" disconnecting.
2025-09-03 16:32:26.953 +03:00 [DBG] Connection id "0HNFATP9BF5F6", Request id "0HNFATP9BF5F6:00000001": done reading request body.
2025-09-03 16:32:26.957 +03:00 [DBG] Connection id "0HNFATP9BF5F7" stopped.
2025-09-03 16:32:26.988 +03:00 [DBG] Connection 0HNFATP9BF5F8 established using the following protocol: "Tls13"
2025-09-03 16:32:26.990 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 73
2025-09-03 16:32:26.994 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:32:26.997 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:32:26.999 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:32:27.002 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:32:27.014 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 16:32:27.018 +03:00 [INF] API key configured for HttpClient
2025-09-03 16:32:27.050 +03:00 [DBG] Connection id "0HNFATP9BF5F8", Request id "0HNFATP9BF5F8:00000001": started reading request body.
2025-09-03 16:32:27.058 +03:00 [DBG] Connection id "0HNFATP9BF5F8", Request id "0HNFATP9BF5F8:00000001": done reading request body.
2025-09-03 16:32:27.098 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:32:27.169 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-09-03 16:32:27.223 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-09-03 16:32:27.489 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<DatabaseName>k__BackingField = dataReader.GetString(3);
                                        instance.<Name>k__BackingField = dataReader.GetString(4);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(5));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(6);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(7) ? default(Guid?) : (Guid?)dataReader.GetGuid(7) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(7) ? default(object) : (object)dataReader.GetGuid(7) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(8) ? default(Guid) : dataReader.GetGuid(8);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(10) ? default(string) : dataReader.GetString(10);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(11) ? default(DateTime) : dataReader.GetDateTime(11);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(12) ? default(string) : dataReader.GetString(12);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-09-03 16:32:27.518 +03:00 [DBG] Creating DbConnection.
2025-09-03 16:32:27.519 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 16:32:27.522 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:32:27.524 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:32:27.525 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:32:27.526 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 16:32:27.529 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2025-09-03 16:32:27.531 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:32:27.537 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:32:27.570 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:32:27.622 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:32:27.632 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:32:27.633 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:32:27.636 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:32:27.637 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:32:27.643 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:32:27.645 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 105ms reading results.
2025-09-03 16:32:27.648 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:32:27.650 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:32:27.659 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:32:27.663 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:32:27.664 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:32:27.666 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:32:27.667 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 16:32:27.670 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (4ms).
2025-09-03 16:32:27.671 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:32:27.673 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:32:27.675 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:32:27.676 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 16:32:27.678 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:32:27.679 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:32:27.688 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:32:27.710 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 16:32:27.724 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 16:32:27.865 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 16:32:27.885 +03:00 [INF] Converting natural language to SQL. User query: Show me all products
2025-09-03 16:32:27.887 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 16:32:27.888 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 16:32:31.760 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 16:34:15.348 +03:00 [ERR] LLM API request timed out: The request was canceled due to the configured HttpClient.Timeout of 100 seconds elapsing.
2025-09-03 16:34:15.755 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:34:15.955 +03:00 [ERR] An unhandled exception has occurred while executing the request.
NaturalToQuery.Core.Exceptions.LLMServiceException: LLM API request timed out
 ---> System.Threading.Tasks.TaskCanceledException: The request was canceled due to the configured HttpClient.Timeout of 100 seconds elapsing.
 ---> System.TimeoutException: The operation was canceled.
 ---> System.Threading.Tasks.TaskCanceledException: The operation was canceled.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Http.HttpConnection.InitialFillAsync(Boolean async)
   at System.Net.Http.HttpConnection.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnection.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.DiagnosticsHandler.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   --- End of inner exception stack trace ---
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpClient.HandleFailure(Exception e, Boolean telemetryStarted, HttpResponseMessage response, CancellationTokenSource cts, CancellationToken cancellationToken, CancellationTokenSource pendingRequestsCts)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at NaturalToQuery.Infrastructure.LLM.LLMService.CallLlmApiAsync(PromptMessage[] messages, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 93
   --- End of inner exception stack trace ---
   at NaturalToQuery.Infrastructure.LLM.LLMService.CallLlmApiAsync(PromptMessage[] messages, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 127
   at NaturalToQuery.Infrastructure.LLM.LLMService.ConvertToSqlAsync(String schema, String userQuery, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 65
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ConvertNaturalLanguageAsync(Guid profileId, String naturalLanguage, ExecutionMode Mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 41
   at NaturalToQuery.Api.Controllers.Query.ConvertNaturalLanguage.HandleAsync(ConvertNaturalLanguageRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Query\ConvertNaturalLanguage.cs:line 45
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-09-03 16:34:16.003 +03:00 [ERR] Error occurred.
2025-09-03 16:34:16.216 +03:00 [ERR] An exception was thrown attempting to execute the error handler.
System.ArgumentNullException: Value cannot be null. (Parameter 'json')
   at System.Text.Json.ThrowHelper.ThrowArgumentNullException(String parameterName)
   at System.Text.Json.JsonDocument.Parse(String json, JsonDocumentOptions options)
   at NaturalToQuery.Api.Middlewares.ExceptionMiddlewareHelper.ParseGroqApiError(String responseBody) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Middlewares\ExceptionMiddleware.Helper.cs:line 87
   at NaturalToQuery.Api.Middlewares.ExceptionMiddlewareHelper.<>c.<.cctor>b__3_4(Exception ex) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Middlewares\ExceptionMiddleware.Helper.cs:line 58
   at NaturalToQuery.Api.Middlewares.ExceptionMiddlewareExtensions.<>c__DisplayClass0_0.<<ConfigureExceptionHandler>b__1>d.MoveNext() in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Middlewares\ExceptionMiddleware.cs:line 29
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.HandleException(HttpContext context, ExceptionDispatchInfo edi)
2025-09-03 16:34:16.715 +03:00 [ERR] An unhandled exception has occurred while executing the request.
NaturalToQuery.Core.Exceptions.LLMServiceException: LLM API request timed out
 ---> System.Threading.Tasks.TaskCanceledException: The request was canceled due to the configured HttpClient.Timeout of 100 seconds elapsing.
 ---> System.TimeoutException: The operation was canceled.
 ---> System.Threading.Tasks.TaskCanceledException: The operation was canceled.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Http.HttpConnection.InitialFillAsync(Boolean async)
   at System.Net.Http.HttpConnection.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnection.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.DiagnosticsHandler.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   --- End of inner exception stack trace ---
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpClient.HandleFailure(Exception e, Boolean telemetryStarted, HttpResponseMessage response, CancellationTokenSource cts, CancellationToken cancellationToken, CancellationTokenSource pendingRequestsCts)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at NaturalToQuery.Infrastructure.LLM.LLMService.CallLlmApiAsync(PromptMessage[] messages, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 93
   --- End of inner exception stack trace ---
   at NaturalToQuery.Infrastructure.LLM.LLMService.CallLlmApiAsync(PromptMessage[] messages, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 127
   at NaturalToQuery.Infrastructure.LLM.LLMService.ConvertToSqlAsync(String schema, String userQuery, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 65
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ConvertNaturalLanguageAsync(Guid profileId, String naturalLanguage, ExecutionMode Mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 41
   at NaturalToQuery.Api.Controllers.Query.ConvertNaturalLanguage.HandleAsync(ConvertNaturalLanguageRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Query\ConvertNaturalLanguage.cs:line 45
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.HandleException(HttpContext context, ExceptionDispatchInfo edi)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.HandleException(HttpContext context, ExceptionDispatchInfo edi)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-09-03 16:34:16.733 +03:00 [DBG] Connection id "0HNFATP9BF5F8" completed keep alive response.
2025-09-03 16:34:16.736 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 16:34:16.739 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:34:16.740 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:34:16.742 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 500 null text/plain; charset=utf-8 109751.3564ms
2025-09-03 16:34:18.685 +03:00 [DBG] Connection id "0HNFATP9BF5F9" received FIN.
2025-09-03 16:34:18.685 +03:00 [DBG] Connection id "0HNFATP9BF5F9" accepted.
2025-09-03 16:34:18.694 +03:00 [DBG] Connection id "0HNFATP9BF5F9" started.
2025-09-03 16:34:18.694 +03:00 [DBG] Connection id "0HNFATP9BF5FA" accepted.
2025-09-03 16:34:18.695 +03:00 [DBG] Connection id "0HNFATP9BF5F9" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 16:34:18.696 +03:00 [DBG] Connection id "0HNFATP9BF5FA" started.
2025-09-03 16:34:18.697 +03:00 [DBG] Connection id "0HNFATP9BF5F9" disconnecting.
2025-09-03 16:34:18.699 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 73
2025-09-03 16:34:18.699 +03:00 [DBG] Connection id "0HNFATP9BF5F9" stopped.
2025-09-03 16:34:18.701 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:34:18.702 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:34:18.703 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:34:18.706 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 16:34:18.707 +03:00 [DBG] Connection id "0HNFATP9BF5FA" completed keep alive response.
2025-09-03 16:34:18.708 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 9.6331ms
2025-09-03 16:34:18.710 +03:00 [DBG] Connection id "0HNFATP9BF5FA", Request id "0HNFATP9BF5FA:00000001": started reading request body.
2025-09-03 16:34:18.711 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 73
2025-09-03 16:34:18.712 +03:00 [DBG] Connection id "0HNFATP9BF5FA", Request id "0HNFATP9BF5FA:00000001": done reading request body.
2025-09-03 16:34:18.713 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:34:18.715 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:34:18.717 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:34:18.718 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:34:18.721 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 16:34:18.722 +03:00 [INF] API key configured for HttpClient
2025-09-03 16:34:18.723 +03:00 [DBG] Connection id "0HNFATP9BF5F8", Request id "0HNFATP9BF5F8:00000002": started reading request body.
2025-09-03 16:34:18.724 +03:00 [DBG] Connection id "0HNFATP9BF5F8", Request id "0HNFATP9BF5F8:00000002": done reading request body.
2025-09-03 16:34:18.726 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:34:18.728 +03:00 [DBG] Creating DbConnection.
2025-09-03 16:34:18.728 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 16:34:18.729 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:34:18.730 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:34:18.732 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:34:18.732 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 16:34:18.733 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 16:34:18.735 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:34:18.737 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:34:18.739 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:34:18.740 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:34:18.741 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:34:18.743 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:34:18.744 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:34:18.745 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:34:18.746 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:34:18.748 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 9ms reading results.
2025-09-03 16:34:18.749 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:34:18.751 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:34:18.753 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:34:18.755 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:34:18.756 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:34:18.758 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:34:18.758 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 16:34:18.760 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 16:34:18.761 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:34:18.763 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:34:18.764 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:34:18.765 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 16:34:18.766 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:34:18.768 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:34:18.769 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:34:18.770 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 16:34:18.771 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 16:34:18.774 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 16:34:18.775 +03:00 [INF] Converting natural language to SQL. User query: Show me all products
2025-09-03 16:34:18.776 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 16:34:18.777 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 16:34:21.632 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 16:34:36.184 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 16:34:45.743 +03:00 [ERR] Failed to deserialize query result. Content: with price more than @param1.{ "sql": "SELECT P.Name, P.Price FROM Products P WHERE P.Price > @param1;", "intent": "SELECT+FILTER","intent_components": ["SELECT","FILTER"], "tables": ["Products"], "columns": ["Products.Id","Products.Name","Products.Cost","Products.CategoryId"], "parameters": [{ "name": "@param1", "value": "50", "source_text": "50" }], "confidence": 72, "safe": true, "issues": [], "explanation": "Show products with price more than param." }SCHEMA_JSON:\n{"Database":"SalesDB","Tables":[{"Schema":"dbo","Name":"Employees","Columns":[{"Name":"Id","DataType":"int","isNullable":false,"isPrimaryKey":true},{"Name":"Name","DataType":"nvarchar","isNullable":false}]},{"Schema":"dbo","Name":"Departments","Columns":[{"Name":"Id","DataType":"int","isNullable":false,"isPrimaryKey":true},{"Name":"Name","DataType":"nvarchar","isNullable":false}]}],"Relations":[{"FromTable":"Employees","ToTable":"Departments","ToColumn":"Id"}]}
2025-09-03 16:34:45.938 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:34:46.060 +03:00 [ERR] An unhandled exception has occurred while executing the request.
NaturalToQuery.Core.Exceptions.LLMServiceException: Failed to parse Groq API response as valid JSON - the model may have returned malformed output
 ---> System.Text.Json.JsonException: 'w' is an invalid start of a value. Path: $ | LineNumber: 0 | BytePositionInLine: 0.
 ---> System.Text.Json.JsonReaderException: 'w' is an invalid start of a value. LineNumber: 0 | BytePositionInLine: 0.
   at System.Text.Json.ThrowHelper.ThrowJsonReaderException(Utf8JsonReader& json, ExceptionResource resource, Byte nextByte, ReadOnlySpan`1 bytes)
   at System.Text.Json.Utf8JsonReader.ConsumeValue(Byte marker)
   at System.Text.Json.Utf8JsonReader.ReadFirstToken(Byte first)
   at System.Text.Json.Utf8JsonReader.ReadSingleSegment()
   at System.Text.Json.Utf8JsonReader.Read()
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, T& value, JsonSerializerOptions options, ReadStack& state)
   --- End of inner exception stack trace ---
   at System.Text.Json.ThrowHelper.ReThrowWithPath(ReadStack& state, JsonReaderException ex)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, T& value, JsonSerializerOptions options, ReadStack& state)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.Deserialize(Utf8JsonReader& reader, ReadStack& state)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo)
   at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options)
   at NaturalToQuery.Infrastructure.LLM.LLMService.DeserializeQueryResult(String content) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 185
   --- End of inner exception stack trace ---
   at NaturalToQuery.Infrastructure.LLM.LLMService.DeserializeQueryResult(String content) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 194
   at NaturalToQuery.Infrastructure.LLM.LLMService.ConvertToSqlAsync(String schema, String userQuery, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 68
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ConvertNaturalLanguageAsync(Guid profileId, String naturalLanguage, ExecutionMode Mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 41
   at NaturalToQuery.Api.Controllers.Query.ConvertNaturalLanguage.HandleAsync(ConvertNaturalLanguageRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Query\ConvertNaturalLanguage.cs:line 45
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-09-03 16:34:46.066 +03:00 [ERR] Error occurred.
2025-09-03 16:34:46.177 +03:00 [ERR] An exception was thrown attempting to execute the error handler.
System.ArgumentNullException: Value cannot be null. (Parameter 'json')
   at System.Text.Json.ThrowHelper.ThrowArgumentNullException(String parameterName)
   at System.Text.Json.JsonDocument.Parse(String json, JsonDocumentOptions options)
   at NaturalToQuery.Api.Middlewares.ExceptionMiddlewareHelper.ParseGroqApiError(String responseBody) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Middlewares\ExceptionMiddleware.Helper.cs:line 87
   at NaturalToQuery.Api.Middlewares.ExceptionMiddlewareHelper.<>c.<.cctor>b__3_4(Exception ex) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Middlewares\ExceptionMiddleware.Helper.cs:line 58
   at NaturalToQuery.Api.Middlewares.ExceptionMiddlewareExtensions.<>c__DisplayClass0_0.<<ConfigureExceptionHandler>b__1>d.MoveNext() in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Middlewares\ExceptionMiddleware.cs:line 29
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.HandleException(HttpContext context, ExceptionDispatchInfo edi)
2025-09-03 16:34:46.465 +03:00 [ERR] An unhandled exception has occurred while executing the request.
NaturalToQuery.Core.Exceptions.LLMServiceException: Failed to parse Groq API response as valid JSON - the model may have returned malformed output
 ---> System.Text.Json.JsonException: 'w' is an invalid start of a value. Path: $ | LineNumber: 0 | BytePositionInLine: 0.
 ---> System.Text.Json.JsonReaderException: 'w' is an invalid start of a value. LineNumber: 0 | BytePositionInLine: 0.
   at System.Text.Json.ThrowHelper.ThrowJsonReaderException(Utf8JsonReader& json, ExceptionResource resource, Byte nextByte, ReadOnlySpan`1 bytes)
   at System.Text.Json.Utf8JsonReader.ConsumeValue(Byte marker)
   at System.Text.Json.Utf8JsonReader.ReadFirstToken(Byte first)
   at System.Text.Json.Utf8JsonReader.ReadSingleSegment()
   at System.Text.Json.Utf8JsonReader.Read()
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, T& value, JsonSerializerOptions options, ReadStack& state)
   --- End of inner exception stack trace ---
   at System.Text.Json.ThrowHelper.ReThrowWithPath(ReadStack& state, JsonReaderException ex)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, T& value, JsonSerializerOptions options, ReadStack& state)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.Deserialize(Utf8JsonReader& reader, ReadStack& state)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo)
   at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options)
   at NaturalToQuery.Infrastructure.LLM.LLMService.DeserializeQueryResult(String content) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 185
   --- End of inner exception stack trace ---
   at NaturalToQuery.Infrastructure.LLM.LLMService.DeserializeQueryResult(String content) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 194
   at NaturalToQuery.Infrastructure.LLM.LLMService.ConvertToSqlAsync(String schema, String userQuery, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 68
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ConvertNaturalLanguageAsync(Guid profileId, String naturalLanguage, ExecutionMode Mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 41
   at NaturalToQuery.Api.Controllers.Query.ConvertNaturalLanguage.HandleAsync(ConvertNaturalLanguageRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Query\ConvertNaturalLanguage.cs:line 45
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.HandleException(HttpContext context, ExceptionDispatchInfo edi)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.HandleException(HttpContext context, ExceptionDispatchInfo edi)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-09-03 16:34:46.471 +03:00 [DBG] Connection id "0HNFATP9BF5F8" completed keep alive response.
2025-09-03 16:34:46.471 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 16:34:46.487 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:34:46.487 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 16:34:46.489 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 500 null text/plain; charset=utf-8 27778.1658ms
2025-09-03 16:34:52.957 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 73
2025-09-03 16:34:52.958 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:34:52.959 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:34:52.960 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:34:52.961 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 16:34:52.962 +03:00 [DBG] Connection id "0HNFATP9BF5FA" completed keep alive response.
2025-09-03 16:34:52.963 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 6.0899ms
2025-09-03 16:34:52.969 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 73
2025-09-03 16:34:52.971 +03:00 [DBG] Connection id "0HNFATP9BF5FA", Request id "0HNFATP9BF5FA:00000002": started reading request body.
2025-09-03 16:34:52.972 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:34:52.973 +03:00 [DBG] Connection id "0HNFATP9BF5FA", Request id "0HNFATP9BF5FA:00000002": done reading request body.
2025-09-03 16:34:52.973 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:34:52.975 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:34:52.977 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:34:52.987 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 16:34:52.988 +03:00 [INF] API key configured for HttpClient
2025-09-03 16:34:52.989 +03:00 [DBG] Connection id "0HNFATP9BF5F8", Request id "0HNFATP9BF5F8:00000003": started reading request body.
2025-09-03 16:34:52.990 +03:00 [DBG] Connection id "0HNFATP9BF5F8", Request id "0HNFATP9BF5F8:00000003": done reading request body.
2025-09-03 16:34:52.991 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:34:52.993 +03:00 [DBG] Creating DbConnection.
2025-09-03 16:34:52.993 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 16:34:52.994 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:34:52.995 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:34:52.996 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:34:52.996 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 16:34:52.997 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 16:34:52.998 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:34:52.999 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:34:53.001 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:34:53.002 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:34:53.003 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:34:53.004 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:34:53.005 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:34:53.006 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:34:53.007 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:34:53.008 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 7ms reading results.
2025-09-03 16:34:53.009 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:34:53.010 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 16:34:53.011 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:34:53.012 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:34:53.013 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:34:53.014 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:34:53.015 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 16:34:53.016 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 16:34:53.017 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:34:53.018 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:34:53.019 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:34:53.020 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-09-03 16:34:53.021 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:34:53.022 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 16:34:53.023 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:34:53.024 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 16:34:53.024 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 16:34:53.026 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 16:34:53.027 +03:00 [INF] Converting natural language to SQL. User query: Show me all products
2025-09-03 16:34:53.028 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 16:34:53.028 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 16:34:55.482 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 16:35:26.054 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 16:38:14.556 +03:00 [INF] This is a test log to file!
2025-09-03 16:38:15.007 +03:00 [INF] Shared Kernal configured successfully.
2025-09-03 16:38:15.017 +03:00 [INF] API configured successfully.
2025-09-03 16:38:15.103 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-03 16:38:15.153 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-09-03 16:38:15.674 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 16:38:15.719 +03:00 [INF] API key configured for HttpClient
2025-09-03 16:38:15.729 +03:00 [INF] Registered 13 endpoints in 946 milliseconds.
2025-09-03 16:38:15.735 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 16:38:15.784 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 16:38:15.869 +03:00 [DBG] Creating DbConnection.
2025-09-03 16:38:15.879 +03:00 [DBG] Created DbConnection. (8ms).
2025-09-03 16:38:15.883 +03:00 [DBG] Migrating using database 'main' on server 'schema_cache.db'.
2025-09-03 16:38:15.887 +03:00 [DBG] Creating DbConnection.
2025-09-03 16:38:15.890 +03:00 [DBG] Created DbConnection. (2ms).
2025-09-03 16:38:15.892 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:38:15.901 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:38:15.905 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:38:15.910 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-09-03 16:38:15.912 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:38:15.914 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:38:15.917 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-03 16:38:15.921 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 16:38:15.926 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 16:38:15.928 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (7ms).
2025-09-03 16:38:15.933 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 16:38:15.956 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 16:38:15.969 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 16:38:15.971 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 16:38:15.972 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (3ms).
2025-09-03 16:38:15.980 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 13:38:15.9688887+00:00');
SELECT changes();
2025-09-03 16:38:15.985 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 13:38:15.9688887+00:00');
SELECT changes();
2025-09-03 16:38:16.031 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 16:38:16.035 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 16:38:16.037 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-09-03 16:38:16.038 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-09-03 16:38:16.039 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (1ms).
2025-09-03 16:38:16.040 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 16:38:16.052 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 16:38:16.056 +03:00 [DBG] Committing transaction.
2025-09-03 16:38:16.057 +03:00 [DBG] Committed transaction.
2025-09-03 16:38:16.059 +03:00 [DBG] Disposing transaction.
2025-09-03 16:38:16.065 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 16:38:16.066 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 16:38:16.068 +03:00 [DBG] Creating DbConnection.
2025-09-03 16:38:16.070 +03:00 [DBG] Created DbConnection. (1ms).
2025-09-03 16:38:16.074 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:38:16.076 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:38:16.077 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:38:16.078 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:38:16.080 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 16:38:16.081 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 16:38:16.082 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 16:38:16.083 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 16:38:16.085 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 16:38:16.089 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:38:16.090 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 16:38:16.091 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 16:38:16.093 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 16:38:16.096 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 16:38:16.101 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:38:16.103 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 3ms reading results.
2025-09-03 16:38:16.107 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-03 16:38:16.109 +03:00 [DBG] Committing transaction.
2025-09-03 16:38:16.109 +03:00 [DBG] Committed transaction.
2025-09-03 16:38:16.110 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 16:38:16.111 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 16:38:16.112 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 16:38:16.113 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 16:38:16.117 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 16:38:16.118 +03:00 [DBG] Disposing transaction.
2025-09-03 16:38:16.120 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:38:16.123 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (3ms).
2025-09-03 16:38:16.125 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 16:38:16.126 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:38:16.127 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:38:16.128 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 16:38:16.129 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 16:38:16.152 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-09-03 16:38:16.179 +03:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-09-03 16:38:16.181 +03:00 [DBG] Hosting starting
2025-09-03 16:38:16.194 +03:00 [DBG] Middleware loaded
2025-09-03 16:38:16.197 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-09-03 16:38:16.200 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-09-03 16:38:16.281 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-09-03 16:38:16.283 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-09-03 16:38:16.285 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-09-03 16:38:16.316 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-09-03 16:38:16.360 +03:00 [INF] Now listening on: https://localhost:7202
2025-09-03 16:38:16.361 +03:00 [INF] Now listening on: http://localhost:5000
2025-09-03 16:38:16.362 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-09-03 16:38:16.363 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-09-03 16:38:16.363 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-09-03 16:38:16.364 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-09-03 16:38:16.372 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 16:38:16.381 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 16:38:16.488 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-03 16:38:16.490 +03:00 [INF] Hosting environment: Development
2025-09-03 16:38:16.491 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-09-03 16:38:16.492 +03:00 [DBG] Hosting started
2025-09-03 16:38:18.879 +03:00 [DBG] Connection id "0HNFATSI9OUQO" received FIN.
2025-09-03 16:38:18.885 +03:00 [DBG] Connection id "0HNFATSI9OUQO" accepted.
2025-09-03 16:38:18.887 +03:00 [DBG] Connection id "0HNFATSI9OUQO" started.
2025-09-03 16:38:18.889 +03:00 [DBG] Connection id "0HNFATSI9OUQP" accepted.
2025-09-03 16:38:18.891 +03:00 [DBG] Connection id "0HNFATSI9OUQP" started.
2025-09-03 16:38:18.895 +03:00 [DBG] Connection id "0HNFATSI9OUQO" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 16:38:18.899 +03:00 [DBG] Connection id "0HNFATSI9OUQO" disconnecting.
2025-09-03 16:38:18.901 +03:00 [DBG] Connection id "0HNFATSI9OUQO" stopped.
2025-09-03 16:38:18.918 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 73
2025-09-03 16:38:18.962 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:38:18.965 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:38:18.968 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:38:19.002 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-09-03 16:38:19.004 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 16:38:19.008 +03:00 [DBG] Connection id "0HNFATSI9OUQP" completed keep alive response.
2025-09-03 16:38:19.011 +03:00 [DBG] Connection id "0HNFATSI9OUQQ" accepted.
2025-09-03 16:38:19.012 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 98.1686ms
2025-09-03 16:38:19.012 +03:00 [DBG] Connection id "0HNFATSI9OUQR" accepted.
2025-09-03 16:38:19.013 +03:00 [DBG] Connection id "0HNFATSI9OUQQ" received FIN.
2025-09-03 16:38:19.019 +03:00 [DBG] Connection id "0HNFATSI9OUQQ" started.
2025-09-03 16:38:19.023 +03:00 [DBG] Connection id "0HNFATSI9OUQR" started.
2025-09-03 16:38:19.023 +03:00 [DBG] Connection id "0HNFATSI9OUQP", Request id "0HNFATSI9OUQP:00000001": started reading request body.
2025-09-03 16:38:19.024 +03:00 [DBG] Connection id "0HNFATSI9OUQQ" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 16:38:19.026 +03:00 [DBG] Connection id "0HNFATSI9OUQP", Request id "0HNFATSI9OUQP:00000001": done reading request body.
2025-09-03 16:38:19.027 +03:00 [DBG] Connection id "0HNFATSI9OUQQ" disconnecting.
2025-09-03 16:38:19.029 +03:00 [DBG] Connection id "0HNFATSI9OUQQ" stopped.
2025-09-03 16:38:19.074 +03:00 [DBG] Connection 0HNFATSI9OUQR established using the following protocol: "Tls13"
2025-09-03 16:38:19.078 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 73
2025-09-03 16:38:19.081 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:38:19.083 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:38:19.084 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:38:19.089 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:38:19.102 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 16:38:19.105 +03:00 [INF] API key configured for HttpClient
2025-09-03 16:38:19.135 +03:00 [DBG] Connection id "0HNFATSI9OUQR", Request id "0HNFATSI9OUQR:00000001": started reading request body.
2025-09-03 16:38:19.136 +03:00 [DBG] Connection id "0HNFATSI9OUQR", Request id "0HNFATSI9OUQR:00000001": done reading request body.
2025-09-03 16:38:19.160 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:38:19.220 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-09-03 16:38:19.256 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-09-03 16:38:19.446 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<DatabaseName>k__BackingField = dataReader.GetString(3);
                                        instance.<Name>k__BackingField = dataReader.GetString(4);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(5));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(6);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(7) ? default(Guid?) : (Guid?)dataReader.GetGuid(7) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(7) ? default(object) : (object)dataReader.GetGuid(7) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(8) ? default(Guid) : dataReader.GetGuid(8);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(10) ? default(string) : dataReader.GetString(10);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(11) ? default(DateTime) : dataReader.GetDateTime(11);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(12) ? default(string) : dataReader.GetString(12);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-09-03 16:38:19.473 +03:00 [DBG] Creating DbConnection.
2025-09-03 16:38:19.474 +03:00 [DBG] Created DbConnection. (1ms).
2025-09-03 16:38:19.477 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:38:19.479 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:38:19.481 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:38:19.482 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 16:38:19.485 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2025-09-03 16:38:19.487 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:38:19.495 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:38:19.530 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:38:19.565 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:38:19.574 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:38:19.575 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:38:19.576 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:38:19.577 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:38:19.581 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:38:19.582 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 84ms reading results.
2025-09-03 16:38:19.584 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:38:19.586 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:38:19.594 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:38:19.597 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:38:19.599 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:38:19.599 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:38:19.600 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 16:38:19.601 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 16:38:19.602 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:38:19.604 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:38:19.606 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:38:19.607 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 16:38:19.609 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:38:19.610 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:38:19.618 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:38:19.628 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 16:38:19.631 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 16:38:19.726 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 16:38:19.745 +03:00 [INF] Converting natural language to SQL. User query: Show me all products
2025-09-03 16:38:19.747 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 16:38:19.749 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 16:38:19.756 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 16:38:37.654 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 16:38:37.724 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 16:38:37.740 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:38:37.745 +03:00 [DBG] Connection id "0HNFATSI9OUQR" completed keep alive response.
2025-09-03 16:38:37.749 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 16:38:37.752 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:38:37.755 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-09-03 16:38:37.758 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 18680.0158ms
2025-09-03 16:40:55.550 +03:00 [DBG] Connection id "0HNFATSI9OUQS" received FIN.
2025-09-03 16:40:55.552 +03:00 [DBG] Connection id "0HNFATSI9OUQS" accepted.
2025-09-03 16:40:55.557 +03:00 [DBG] Connection id "0HNFATSI9OUQS" started.
2025-09-03 16:40:55.557 +03:00 [DBG] Connection id "0HNFATSI9OUQT" accepted.
2025-09-03 16:40:55.562 +03:00 [DBG] Connection id "0HNFATSI9OUQS" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 16:40:55.563 +03:00 [DBG] Connection id "0HNFATSI9OUQT" started.
2025-09-03 16:40:55.564 +03:00 [DBG] Connection id "0HNFATSI9OUQS" disconnecting.
2025-09-03 16:40:55.564 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 73
2025-09-03 16:40:55.565 +03:00 [DBG] Connection id "0HNFATSI9OUQS" stopped.
2025-09-03 16:40:55.567 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:40:55.568 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:40:55.569 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:40:55.571 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 16:40:55.572 +03:00 [DBG] Connection id "0HNFATSI9OUQT" completed keep alive response.
2025-09-03 16:40:55.573 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 8.4258ms
2025-09-03 16:40:55.574 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 73
2025-09-03 16:40:55.576 +03:00 [DBG] Connection id "0HNFATSI9OUQT", Request id "0HNFATSI9OUQT:00000001": started reading request body.
2025-09-03 16:40:55.579 +03:00 [DBG] Connection id "0HNFATSI9OUQT", Request id "0HNFATSI9OUQT:00000001": done reading request body.
2025-09-03 16:40:55.578 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:40:55.583 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:40:55.584 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:40:55.586 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:40:55.596 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 16:40:55.597 +03:00 [INF] API key configured for HttpClient
2025-09-03 16:40:55.598 +03:00 [DBG] Connection id "0HNFATSI9OUQR", Request id "0HNFATSI9OUQR:00000002": started reading request body.
2025-09-03 16:40:55.599 +03:00 [DBG] Connection id "0HNFATSI9OUQR", Request id "0HNFATSI9OUQR:00000002": done reading request body.
2025-09-03 16:40:55.600 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:40:55.602 +03:00 [DBG] Creating DbConnection.
2025-09-03 16:40:55.602 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 16:40:55.603 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:40:55.604 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:40:55.605 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:40:55.605 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 16:40:55.606 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 16:40:55.607 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:40:55.609 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:40:55.610 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:40:55.611 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:40:55.612 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:40:55.613 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:40:55.614 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:40:55.615 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:40:55.616 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:40:55.617 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 6ms reading results.
2025-09-03 16:40:55.618 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:40:55.619 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:40:55.621 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:40:55.621 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:40:55.622 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:40:55.623 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:40:55.624 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 16:40:55.625 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 16:40:55.626 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:40:55.627 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:40:55.628 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:40:55.629 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-09-03 16:40:55.630 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:40:55.632 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:40:55.633 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:40:55.634 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 16:40:55.634 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 16:40:55.636 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 16:40:59.065 +03:00 [INF] Converting natural language to SQL. User query: Show me all products
2025-09-03 16:41:00.490 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 16:42:20.538 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 16:45:11.131 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 16:45:21.034 +03:00 [ERR] Network error while calling LLM API: An error occurred while sending the request.
2025-09-03 16:45:21.420 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:45:21.612 +03:00 [ERR] An unhandled exception has occurred while executing the request.
NaturalToQuery.Core.Exceptions.LLMServiceException: Network error occurred while communicating with LLM API
 ---> System.Net.Http.HttpRequestException: An error occurred while sending the request.
 ---> System.Net.Http.HttpIOException: The response ended prematurely. (ResponseEnded)
   at System.Net.Http.HttpConnection.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnection.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.DiagnosticsHandler.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at NaturalToQuery.Infrastructure.LLM.LLMService.CallLlmApiAsync(PromptMessage[] messages, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 93
   --- End of inner exception stack trace ---
   at NaturalToQuery.Infrastructure.LLM.LLMService.CallLlmApiAsync(PromptMessage[] messages, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 122
   at NaturalToQuery.Infrastructure.LLM.LLMService.ConvertToSqlAsync(String schema, String userQuery, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 65
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ConvertNaturalLanguageAsync(Guid profileId, String naturalLanguage, ExecutionMode Mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 41
   at NaturalToQuery.Api.Controllers.Query.ConvertNaturalLanguage.HandleAsync(ConvertNaturalLanguageRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Query\ConvertNaturalLanguage.cs:line 45
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-09-03 16:45:21.628 +03:00 [ERR] Error occurred.
2025-09-03 16:45:21.797 +03:00 [ERR] An exception was thrown attempting to execute the error handler.
System.ArgumentNullException: Value cannot be null. (Parameter 'json')
   at System.Text.Json.ThrowHelper.ThrowArgumentNullException(String parameterName)
   at System.Text.Json.JsonDocument.Parse(String json, JsonDocumentOptions options)
   at NaturalToQuery.Api.Middlewares.ExceptionMiddlewareHelper.ParseGroqApiError(String responseBody) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Middlewares\ExceptionMiddleware.Helper.cs:line 87
   at NaturalToQuery.Api.Middlewares.ExceptionMiddlewareHelper.<>c.<.cctor>b__3_4(Exception ex) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Middlewares\ExceptionMiddleware.Helper.cs:line 58
   at NaturalToQuery.Api.Middlewares.ExceptionMiddlewareExtensions.<>c__DisplayClass0_0.<<ConfigureExceptionHandler>b__1>d.MoveNext() in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Middlewares\ExceptionMiddleware.cs:line 29
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.HandleException(HttpContext context, ExceptionDispatchInfo edi)
2025-09-03 16:45:22.228 +03:00 [ERR] An unhandled exception has occurred while executing the request.
NaturalToQuery.Core.Exceptions.LLMServiceException: Network error occurred while communicating with LLM API
 ---> System.Net.Http.HttpRequestException: An error occurred while sending the request.
 ---> System.Net.Http.HttpIOException: The response ended prematurely. (ResponseEnded)
   at System.Net.Http.HttpConnection.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnection.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.DiagnosticsHandler.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at NaturalToQuery.Infrastructure.LLM.LLMService.CallLlmApiAsync(PromptMessage[] messages, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 93
   --- End of inner exception stack trace ---
   at NaturalToQuery.Infrastructure.LLM.LLMService.CallLlmApiAsync(PromptMessage[] messages, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 122
   at NaturalToQuery.Infrastructure.LLM.LLMService.ConvertToSqlAsync(String schema, String userQuery, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 65
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ConvertNaturalLanguageAsync(Guid profileId, String naturalLanguage, ExecutionMode Mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 41
   at NaturalToQuery.Api.Controllers.Query.ConvertNaturalLanguage.HandleAsync(ConvertNaturalLanguageRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Query\ConvertNaturalLanguage.cs:line 45
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.HandleException(HttpContext context, ExceptionDispatchInfo edi)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.HandleException(HttpContext context, ExceptionDispatchInfo edi)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-09-03 16:45:22.238 +03:00 [DBG] Connection id "0HNFATSI9OUQR" completed keep alive response.
2025-09-03 16:45:22.239 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 16:45:22.240 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:45:22.241 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:45:22.243 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 500 null text/plain; charset=utf-8 266669.0959ms
2025-09-03 16:47:20.008 +03:00 [INF] This is a test log to file!
2025-09-03 16:47:20.336 +03:00 [INF] Shared Kernal configured successfully.
2025-09-03 16:47:20.344 +03:00 [INF] API configured successfully.
2025-09-03 16:47:20.445 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-03 16:47:20.510 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-09-03 16:47:20.963 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 16:47:20.996 +03:00 [INF] API key configured for HttpClient
2025-09-03 16:47:21.004 +03:00 [INF] Registered 13 endpoints in 868 milliseconds.
2025-09-03 16:47:21.011 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 16:47:21.046 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 16:47:21.119 +03:00 [DBG] Creating DbConnection.
2025-09-03 16:47:21.130 +03:00 [DBG] Created DbConnection. (9ms).
2025-09-03 16:47:21.133 +03:00 [DBG] Migrating using database 'main' on server 'schema_cache.db'.
2025-09-03 16:47:21.138 +03:00 [DBG] Creating DbConnection.
2025-09-03 16:47:21.141 +03:00 [DBG] Created DbConnection. (2ms).
2025-09-03 16:47:21.143 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:47:21.151 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:47:21.155 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:47:21.159 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:47:21.160 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:47:21.162 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:47:21.164 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-03 16:47:21.168 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 16:47:21.172 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 16:47:21.174 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (6ms).
2025-09-03 16:47:21.180 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 16:47:21.199 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 16:47:21.202 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 16:47:21.203 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 16:47:21.204 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 16:47:21.205 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 13:47:21.2022608+00:00');
SELECT changes();
2025-09-03 16:47:21.217 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 13:47:21.2022608+00:00');
SELECT changes();
2025-09-03 16:47:21.256 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 16:47:21.259 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 16:47:21.261 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-09-03 16:47:21.261 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-09-03 16:47:21.262 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (1ms).
2025-09-03 16:47:21.263 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 16:47:21.265 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 16:47:21.267 +03:00 [DBG] Committing transaction.
2025-09-03 16:47:21.269 +03:00 [DBG] Committed transaction.
2025-09-03 16:47:21.270 +03:00 [DBG] Disposing transaction.
2025-09-03 16:47:21.272 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 16:47:21.273 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 16:47:21.274 +03:00 [DBG] Creating DbConnection.
2025-09-03 16:47:21.275 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 16:47:21.276 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:47:21.278 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:47:21.279 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:47:21.280 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:47:21.282 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 16:47:21.283 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 16:47:21.284 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 16:47:21.285 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 16:47:21.287 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 16:47:21.290 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:47:21.291 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 16:47:21.292 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 16:47:21.294 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 16:47:21.296 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 16:47:21.300 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:47:21.302 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 3ms reading results.
2025-09-03 16:47:21.306 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-03 16:47:21.307 +03:00 [DBG] Committing transaction.
2025-09-03 16:47:21.308 +03:00 [DBG] Committed transaction.
2025-09-03 16:47:21.308 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 16:47:21.309 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 16:47:21.310 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 16:47:21.311 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 16:47:21.320 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 16:47:21.321 +03:00 [DBG] Disposing transaction.
2025-09-03 16:47:21.322 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:47:21.325 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-09-03 16:47:21.327 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 16:47:21.328 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:47:21.328 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 16:47:21.330 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 16:47:21.330 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 16:47:21.353 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-09-03 16:47:21.380 +03:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-09-03 16:47:21.381 +03:00 [DBG] Hosting starting
2025-09-03 16:47:21.393 +03:00 [DBG] Middleware loaded
2025-09-03 16:47:21.395 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-09-03 16:47:21.396 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-09-03 16:47:21.465 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-09-03 16:47:21.467 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-09-03 16:47:21.470 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-09-03 16:47:21.504 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-09-03 16:47:21.562 +03:00 [INF] Now listening on: https://localhost:7202
2025-09-03 16:47:21.563 +03:00 [INF] Now listening on: http://localhost:5000
2025-09-03 16:47:21.564 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-09-03 16:47:21.565 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-09-03 16:47:21.566 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-09-03 16:47:21.567 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-09-03 16:47:21.575 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 16:47:21.584 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 16:47:21.618 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-03 16:47:21.620 +03:00 [INF] Hosting environment: Development
2025-09-03 16:47:21.621 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-09-03 16:47:21.622 +03:00 [DBG] Hosting started
2025-09-03 16:47:28.893 +03:00 [DBG] Connection id "0HNFAU1M73L7M" received FIN.
2025-09-03 16:47:28.897 +03:00 [DBG] Connection id "0HNFAU1M73L7M" accepted.
2025-09-03 16:47:28.899 +03:00 [DBG] Connection id "0HNFAU1M73L7M" started.
2025-09-03 16:47:28.901 +03:00 [DBG] Connection id "0HNFAU1M73L7N" accepted.
2025-09-03 16:47:28.902 +03:00 [DBG] Connection id "0HNFAU1M73L7N" started.
2025-09-03 16:47:28.907 +03:00 [DBG] Connection id "0HNFAU1M73L7M" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 16:47:28.911 +03:00 [DBG] Connection id "0HNFAU1M73L7M" disconnecting.
2025-09-03 16:47:28.915 +03:00 [DBG] Connection id "0HNFAU1M73L7M" stopped.
2025-09-03 16:47:28.933 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 73
2025-09-03 16:47:28.971 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:47:28.974 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:47:28.977 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:47:29.002 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-09-03 16:47:29.004 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 16:47:29.007 +03:00 [DBG] Connection id "0HNFAU1M73L7N" completed keep alive response.
2025-09-03 16:47:29.009 +03:00 [DBG] Connection id "0HNFAU1M73L7O" accepted.
2025-09-03 16:47:29.010 +03:00 [DBG] Connection id "0HNFAU1M73L7O" received FIN.
2025-09-03 16:47:29.035 +03:00 [DBG] Connection id "0HNFAU1M73L7O" started.
2025-09-03 16:47:29.010 +03:00 [DBG] Connection id "0HNFAU1M73L7P" accepted.
2025-09-03 16:47:29.010 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 82.0956ms
2025-09-03 16:47:29.042 +03:00 [DBG] Connection id "0HNFAU1M73L7O" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 16:47:29.042 +03:00 [DBG] Connection id "0HNFAU1M73L7P" started.
2025-09-03 16:47:29.047 +03:00 [DBG] Connection id "0HNFAU1M73L7O" disconnecting.
2025-09-03 16:47:29.047 +03:00 [DBG] Connection id "0HNFAU1M73L7N", Request id "0HNFAU1M73L7N:00000001": started reading request body.
2025-09-03 16:47:29.048 +03:00 [DBG] Connection id "0HNFAU1M73L7O" stopped.
2025-09-03 16:47:29.050 +03:00 [DBG] Connection id "0HNFAU1M73L7N", Request id "0HNFAU1M73L7N:00000001": done reading request body.
2025-09-03 16:47:29.082 +03:00 [DBG] Connection 0HNFAU1M73L7P established using the following protocol: "Tls13"
2025-09-03 16:47:29.085 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 73
2025-09-03 16:47:29.089 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:47:29.090 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:47:29.091 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:47:29.095 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:47:29.110 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 16:47:29.113 +03:00 [INF] API key configured for HttpClient
2025-09-03 16:47:29.149 +03:00 [DBG] Connection id "0HNFAU1M73L7P", Request id "0HNFAU1M73L7P:00000001": started reading request body.
2025-09-03 16:47:29.151 +03:00 [DBG] Connection id "0HNFAU1M73L7P", Request id "0HNFAU1M73L7P:00000001": done reading request body.
2025-09-03 16:47:29.176 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:47:29.243 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-09-03 16:47:29.281 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-09-03 16:47:29.480 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<DatabaseName>k__BackingField = dataReader.GetString(3);
                                        instance.<Name>k__BackingField = dataReader.GetString(4);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(5));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(6);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(7) ? default(Guid?) : (Guid?)dataReader.GetGuid(7) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(7) ? default(object) : (object)dataReader.GetGuid(7) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(8) ? default(Guid) : dataReader.GetGuid(8);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(10) ? default(string) : dataReader.GetString(10);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(11) ? default(DateTime) : dataReader.GetDateTime(11);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(12) ? default(string) : dataReader.GetString(12);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-09-03 16:47:29.512 +03:00 [DBG] Creating DbConnection.
2025-09-03 16:47:29.513 +03:00 [DBG] Created DbConnection. (1ms).
2025-09-03 16:47:29.517 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:47:29.519 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:47:29.521 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:47:29.521 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 16:47:29.524 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2025-09-03 16:47:29.527 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:47:29.533 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:47:29.563 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:47:29.602 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:47:29.614 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:47:29.616 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:47:29.617 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:47:29.619 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:47:29.623 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:47:29.624 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 89ms reading results.
2025-09-03 16:47:29.626 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:47:29.628 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:47:29.637 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:47:29.639 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:47:29.641 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:47:29.641 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:47:29.642 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 16:47:29.643 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 16:47:29.644 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:47:29.645 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:47:29.647 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:47:29.648 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 16:47:29.649 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:47:29.650 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 16:47:29.660 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:47:29.671 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 16:47:29.673 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 16:47:29.775 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 16:47:31.577 +03:00 [INF] Converting natural language to SQL. User query: Show me all products
2025-09-03 16:47:31.580 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 16:47:31.581 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 16:47:31.588 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 16:47:55.750 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 16:47:55.842 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 16:47:55.860 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:47:55.864 +03:00 [DBG] Connection id "0HNFAU1M73L7P" completed keep alive response.
2025-09-03 16:47:55.866 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 16:47:55.869 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:47:55.871 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:47:55.873 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 26787.3999ms
2025-09-03 16:49:35.794 +03:00 [DBG] Connection id "0HNFAU1M73L7Q" received FIN.
2025-09-03 16:49:35.796 +03:00 [DBG] Connection id "0HNFAU1M73L7Q" accepted.
2025-09-03 16:49:35.802 +03:00 [DBG] Connection id "0HNFAU1M73L7Q" started.
2025-09-03 16:49:35.802 +03:00 [DBG] Connection id "0HNFAU1M73L7R" accepted.
2025-09-03 16:49:35.809 +03:00 [DBG] Connection id "0HNFAU1M73L7Q" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 16:49:35.810 +03:00 [DBG] Connection id "0HNFAU1M73L7R" started.
2025-09-03 16:49:35.811 +03:00 [DBG] Connection id "0HNFAU1M73L7Q" disconnecting.
2025-09-03 16:49:35.812 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 220
2025-09-03 16:49:35.812 +03:00 [DBG] Connection id "0HNFAU1M73L7Q" stopped.
2025-09-03 16:49:35.815 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:49:35.817 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:49:35.818 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:49:35.821 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 16:49:35.822 +03:00 [DBG] Connection id "0HNFAU1M73L7R" completed keep alive response.
2025-09-03 16:49:35.823 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 10.6986ms
2025-09-03 16:49:35.824 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 220
2025-09-03 16:49:35.825 +03:00 [DBG] Connection id "0HNFAU1M73L7R", Request id "0HNFAU1M73L7R:00000001": started reading request body.
2025-09-03 16:49:35.828 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:49:35.828 +03:00 [DBG] Connection id "0HNFAU1M73L7R", Request id "0HNFAU1M73L7R:00000001": done reading request body.
2025-09-03 16:49:35.829 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:49:35.831 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:49:35.832 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:49:35.843 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 16:49:35.845 +03:00 [INF] API key configured for HttpClient
2025-09-03 16:49:35.845 +03:00 [DBG] Connection id "0HNFAU1M73L7P", Request id "0HNFAU1M73L7P:00000002": started reading request body.
2025-09-03 16:49:35.847 +03:00 [DBG] Connection id "0HNFAU1M73L7P", Request id "0HNFAU1M73L7P:00000002": done reading request body.
2025-09-03 16:49:35.848 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:49:35.850 +03:00 [DBG] Creating DbConnection.
2025-09-03 16:49:35.850 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 16:49:35.851 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:49:35.852 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:49:35.853 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:49:35.854 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 16:49:35.856 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 16:49:35.857 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:49:35.858 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:49:35.860 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:49:35.861 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:49:35.862 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:49:35.863 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:49:35.865 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:49:35.866 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:49:35.867 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:49:35.868 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 7ms reading results.
2025-09-03 16:49:35.869 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:49:35.870 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 16:49:35.872 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:49:35.872 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:49:35.873 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:49:35.875 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:49:35.876 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 16:49:35.877 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 16:49:35.878 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:49:35.880 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:49:35.881 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:49:35.882 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 16:49:35.884 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:49:35.884 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 16:49:35.886 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:49:35.887 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 16:49:35.888 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 16:49:35.890 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 16:49:38.776 +03:00 [INF] Converting natural language to SQL. User query: insert a product entry id = (any uuid of your generation), name = mario, stock = 200, price = 1500, categoryId = should be the id of the first category id that you find
2025-09-03 16:49:38.777 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 16:49:38.778 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 16:49:38.780 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 16:50:09.621 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 16:50:09.666 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 16:50:09.672 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:50:09.678 +03:00 [DBG] Connection id "0HNFAU1M73L7P" completed keep alive response.
2025-09-03 16:50:09.680 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 16:50:09.681 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:50:09.683 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:50:09.684 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 33860.067ms
2025-09-03 16:51:15.239 +03:00 [DBG] Connection id "0HNFAU1M73L7S" received FIN.
2025-09-03 16:51:15.241 +03:00 [DBG] Connection id "0HNFAU1M73L7S" accepted.
2025-09-03 16:51:15.248 +03:00 [DBG] Connection id "0HNFAU1M73L7S" started.
2025-09-03 16:51:15.248 +03:00 [DBG] Connection id "0HNFAU1M73L7T" accepted.
2025-09-03 16:51:15.248 +03:00 [DBG] Connection id "0HNFAU1M73L7S" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 16:51:15.249 +03:00 [DBG] Connection id "0HNFAU1M73L7T" started.
2025-09-03 16:51:15.255 +03:00 [DBG] Connection id "0HNFAU1M73L7S" disconnecting.
2025-09-03 16:51:15.256 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 199
2025-09-03 16:51:15.257 +03:00 [DBG] Connection id "0HNFAU1M73L7S" stopped.
2025-09-03 16:51:15.259 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:51:15.260 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:51:15.261 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:51:15.262 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 16:51:15.263 +03:00 [DBG] Connection id "0HNFAU1M73L7T" completed keep alive response.
2025-09-03 16:51:15.264 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 7.6976ms
2025-09-03 16:51:15.264 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 199
2025-09-03 16:51:15.266 +03:00 [DBG] Connection id "0HNFAU1M73L7T", Request id "0HNFAU1M73L7T:00000001": started reading request body.
2025-09-03 16:51:15.269 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:51:15.269 +03:00 [DBG] Connection id "0HNFAU1M73L7T", Request id "0HNFAU1M73L7T:00000001": done reading request body.
2025-09-03 16:51:15.270 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:51:15.272 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:51:15.274 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:51:15.275 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 16:51:15.276 +03:00 [INF] API key configured for HttpClient
2025-09-03 16:51:15.277 +03:00 [DBG] Connection id "0HNFAU1M73L7P", Request id "0HNFAU1M73L7P:00000003": started reading request body.
2025-09-03 16:51:15.278 +03:00 [DBG] Connection id "0HNFAU1M73L7P", Request id "0HNFAU1M73L7P:00000003": done reading request body.
2025-09-03 16:51:15.280 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:51:15.282 +03:00 [DBG] Creating DbConnection.
2025-09-03 16:51:15.282 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 16:51:15.283 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:51:15.284 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:51:15.285 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:51:15.286 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 16:51:15.287 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 16:51:15.288 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:51:15.289 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:51:15.291 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:51:15.292 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:51:15.293 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:51:15.294 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:51:15.295 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:51:15.296 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:51:15.297 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:51:15.298 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 7ms reading results.
2025-09-03 16:51:15.299 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:51:15.300 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 16:51:15.301 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:51:15.302 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:51:15.303 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:51:15.304 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:51:15.305 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 16:51:15.306 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 16:51:15.307 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:51:15.308 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:51:15.311 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:51:15.312 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 16:51:15.313 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:51:15.314 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:51:15.317 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:51:15.318 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 16:51:15.319 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 16:51:15.321 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 16:51:23.375 +03:00 [INF] Converting natural language to SQL. User query: insert a product entry id = (generate random uuid id), name = mario, stock = 200, price = 1500, categoryId = get the id of the first category entry
2025-09-03 16:51:23.376 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 16:51:23.378 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 16:51:23.381 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 16:51:50.414 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 16:51:50.459 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 16:51:50.460 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:51:50.462 +03:00 [DBG] Connection id "0HNFAU1M73L7P" completed keep alive response.
2025-09-03 16:51:50.463 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 16:51:50.464 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:51:50.466 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:51:50.467 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 35203.0259ms
2025-09-03 16:52:46.967 +03:00 [DBG] Connection id "0HNFAU1M73L7U" received FIN.
2025-09-03 16:52:46.969 +03:00 [DBG] Connection id "0HNFAU1M73L7U" accepted.
2025-09-03 16:52:46.977 +03:00 [DBG] Connection id "0HNFAU1M73L7U" started.
2025-09-03 16:52:46.977 +03:00 [DBG] Connection id "0HNFAU1M73L7V" accepted.
2025-09-03 16:52:46.984 +03:00 [DBG] Connection id "0HNFAU1M73L7U" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 16:52:46.985 +03:00 [DBG] Connection id "0HNFAU1M73L7V" started.
2025-09-03 16:52:46.986 +03:00 [DBG] Connection id "0HNFAU1M73L7U" disconnecting.
2025-09-03 16:52:46.987 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 200
2025-09-03 16:52:46.988 +03:00 [DBG] Connection id "0HNFAU1M73L7U" stopped.
2025-09-03 16:52:46.990 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:52:46.992 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:52:46.993 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:52:46.994 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 16:52:46.995 +03:00 [DBG] Connection id "0HNFAU1M73L7V" completed keep alive response.
2025-09-03 16:52:46.996 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 9.1651ms
2025-09-03 16:52:46.996 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 200
2025-09-03 16:52:46.999 +03:00 [DBG] Connection id "0HNFAU1M73L7V", Request id "0HNFAU1M73L7V:00000001": started reading request body.
2025-09-03 16:52:47.001 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:52:47.002 +03:00 [DBG] Connection id "0HNFAU1M73L7V", Request id "0HNFAU1M73L7V:00000001": done reading request body.
2025-09-03 16:52:47.003 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 16:52:47.006 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:52:47.007 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:52:47.009 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 16:52:47.011 +03:00 [INF] API key configured for HttpClient
2025-09-03 16:52:47.011 +03:00 [DBG] Connection id "0HNFAU1M73L7P", Request id "0HNFAU1M73L7P:00000004": started reading request body.
2025-09-03 16:52:47.012 +03:00 [DBG] Connection id "0HNFAU1M73L7P", Request id "0HNFAU1M73L7P:00000004": done reading request body.
2025-09-03 16:52:47.014 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:52:47.015 +03:00 [DBG] Creating DbConnection.
2025-09-03 16:52:47.016 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 16:52:47.017 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:52:47.018 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:52:47.020 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:52:47.020 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 16:52:47.022 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 16:52:47.024 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:52:47.026 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:52:47.029 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:52:47.031 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:52:47.033 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:52:47.035 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:52:47.036 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:52:47.038 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 16:52:47.040 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:52:47.041 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 12ms reading results.
2025-09-03 16:52:47.042 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:52:47.043 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:52:47.045 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:52:47.047 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:52:47.048 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:52:47.049 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 16:52:47.051 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 16:52:47.052 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 16:52:47.054 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:52:47.056 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 16:52:47.058 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:52:47.059 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 16:52:47.061 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 16:52:47.062 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:52:47.063 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 16:52:47.064 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 16:52:47.065 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 16:52:47.067 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 16:52:48.126 +03:00 [INF] Converting natural language to SQL. User query: insert a product entry id = (generate random uuid id), name = mario, stock = 200, price = 1500, categoryId = get the id of the first category entry
2025-09-03 16:52:48.127 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 16:52:48.128 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 16:52:48.129 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 16:53:04.366 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 16:53:04.403 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 16:53:04.405 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 16:53:04.406 +03:00 [DBG] Connection id "0HNFAU1M73L7P" completed keep alive response.
2025-09-03 16:53:04.407 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 16:53:04.408 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 16:53:04.409 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 16:53:04.410 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 17414.1647ms
2025-09-03 17:14:22.837 +03:00 [INF] This is a test log to file!
2025-09-03 17:14:23.164 +03:00 [INF] Shared Kernal configured successfully.
2025-09-03 17:14:23.171 +03:00 [INF] API configured successfully.
2025-09-03 17:14:23.265 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-03 17:14:23.310 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-09-03 17:14:23.798 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 17:14:23.830 +03:00 [INF] API key configured for HttpClient
2025-09-03 17:14:23.839 +03:00 [INF] Registered 13 endpoints in 870 milliseconds.
2025-09-03 17:14:23.845 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 17:14:23.879 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 17:14:23.966 +03:00 [DBG] Creating DbConnection.
2025-09-03 17:14:23.980 +03:00 [DBG] Created DbConnection. (12ms).
2025-09-03 17:14:23.992 +03:00 [DBG] Migrating using database 'main' on server 'schema_cache.db'.
2025-09-03 17:14:23.997 +03:00 [DBG] Creating DbConnection.
2025-09-03 17:14:23.999 +03:00 [DBG] Created DbConnection. (2ms).
2025-09-03 17:14:24.002 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:14:24.020 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:14:24.024 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:14:24.032 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (5ms).
2025-09-03 17:14:24.034 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:14:24.037 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:14:24.040 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-03 17:14:24.045 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 17:14:24.051 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (3ms).
2025-09-03 17:14:24.054 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (8ms).
2025-09-03 17:14:24.060 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 17:14:24.079 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 17:14:24.082 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 17:14:24.082 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 17:14:24.083 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 17:14:24.084 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 14:14:24.0818243+00:00');
SELECT changes();
2025-09-03 17:14:24.092 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 14:14:24.0818243+00:00');
SELECT changes();
2025-09-03 17:14:24.139 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 17:14:24.142 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 17:14:24.144 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-09-03 17:14:24.145 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (1ms).
2025-09-03 17:14:24.146 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (2ms).
2025-09-03 17:14:24.148 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 17:14:24.150 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 17:14:24.153 +03:00 [DBG] Committing transaction.
2025-09-03 17:14:24.155 +03:00 [DBG] Committed transaction.
2025-09-03 17:14:24.157 +03:00 [DBG] Disposing transaction.
2025-09-03 17:14:24.159 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 17:14:24.160 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 17:14:24.162 +03:00 [DBG] Creating DbConnection.
2025-09-03 17:14:24.163 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 17:14:24.167 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:14:24.168 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:14:24.170 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:14:24.172 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 17:14:24.174 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 17:14:24.175 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 17:14:24.178 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (3ms).
2025-09-03 17:14:24.180 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 17:14:24.182 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 17:14:24.193 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 17:14:24.194 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 17:14:24.195 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 17:14:24.203 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 17:14:24.206 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 17:14:24.211 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:14:24.214 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 4ms reading results.
2025-09-03 17:14:24.222 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-03 17:14:24.223 +03:00 [DBG] Committing transaction.
2025-09-03 17:14:24.224 +03:00 [DBG] Committed transaction.
2025-09-03 17:14:24.233 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 17:14:24.234 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 17:14:24.235 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 17:14:24.236 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 17:14:24.243 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 17:14:24.246 +03:00 [DBG] Disposing transaction.
2025-09-03 17:14:24.247 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:14:24.251 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (3ms).
2025-09-03 17:14:24.252 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 17:14:24.253 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:14:24.254 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 17:14:24.255 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 17:14:24.256 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 17:14:24.278 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-09-03 17:14:24.308 +03:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-09-03 17:14:24.312 +03:00 [DBG] Hosting starting
2025-09-03 17:14:24.326 +03:00 [DBG] Middleware loaded
2025-09-03 17:14:24.333 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-09-03 17:14:24.336 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-09-03 17:14:24.428 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-09-03 17:14:24.430 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-09-03 17:14:24.439 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-09-03 17:14:24.472 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-09-03 17:14:24.542 +03:00 [INF] Now listening on: https://localhost:7202
2025-09-03 17:14:24.544 +03:00 [INF] Now listening on: http://localhost:5000
2025-09-03 17:14:24.545 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-09-03 17:14:24.546 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-09-03 17:14:24.548 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-09-03 17:14:24.549 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-09-03 17:14:24.562 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 17:14:24.574 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 17:14:24.703 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-03 17:14:24.704 +03:00 [INF] Hosting environment: Development
2025-09-03 17:14:24.705 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-09-03 17:14:24.706 +03:00 [DBG] Hosting started
2025-09-03 17:14:26.230 +03:00 [DBG] Connection id "0HNFAUGO77UKO" received FIN.
2025-09-03 17:14:26.237 +03:00 [DBG] Connection id "0HNFAUGO77UKO" accepted.
2025-09-03 17:14:26.240 +03:00 [DBG] Connection id "0HNFAUGO77UKO" started.
2025-09-03 17:14:26.241 +03:00 [DBG] Connection id "0HNFAUGO77UKP" accepted.
2025-09-03 17:14:26.242 +03:00 [DBG] Connection id "0HNFAUGO77UKP" started.
2025-09-03 17:14:26.247 +03:00 [DBG] Connection id "0HNFAUGO77UKO" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 17:14:26.251 +03:00 [DBG] Connection id "0HNFAUGO77UKO" disconnecting.
2025-09-03 17:14:26.252 +03:00 [DBG] Connection id "0HNFAUGO77UKO" stopped.
2025-09-03 17:14:26.275 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 200
2025-09-03 17:14:26.327 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 17:14:26.329 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 17:14:26.332 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 17:14:26.364 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-09-03 17:14:26.386 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 17:14:26.391 +03:00 [DBG] Connection id "0HNFAUGO77UKP" completed keep alive response.
2025-09-03 17:14:26.394 +03:00 [DBG] Connection id "0HNFAUGO77UKQ" accepted.
2025-09-03 17:14:26.395 +03:00 [DBG] Connection id "0HNFAUGO77UKQ" received FIN.
2025-09-03 17:14:26.395 +03:00 [DBG] Connection id "0HNFAUGO77UKR" accepted.
2025-09-03 17:14:26.395 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 125.3412ms
2025-09-03 17:14:26.403 +03:00 [DBG] Connection id "0HNFAUGO77UKQ" started.
2025-09-03 17:14:26.406 +03:00 [DBG] Connection id "0HNFAUGO77UKR" started.
2025-09-03 17:14:26.413 +03:00 [DBG] Connection id "0HNFAUGO77UKP", Request id "0HNFAUGO77UKP:00000001": started reading request body.
2025-09-03 17:14:26.417 +03:00 [DBG] Connection id "0HNFAUGO77UKQ" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 17:14:26.422 +03:00 [DBG] Connection id "0HNFAUGO77UKP", Request id "0HNFAUGO77UKP:00000001": done reading request body.
2025-09-03 17:14:26.423 +03:00 [DBG] Connection id "0HNFAUGO77UKQ" disconnecting.
2025-09-03 17:14:26.427 +03:00 [DBG] Connection id "0HNFAUGO77UKQ" stopped.
2025-09-03 17:14:26.463 +03:00 [DBG] Connection 0HNFAUGO77UKR established using the following protocol: "Tls13"
2025-09-03 17:14:26.467 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 200
2025-09-03 17:14:26.472 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 17:14:26.473 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 17:14:26.475 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 17:14:26.481 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 17:14:26.496 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 17:14:26.500 +03:00 [INF] API key configured for HttpClient
2025-09-03 17:14:26.533 +03:00 [DBG] Connection id "0HNFAUGO77UKR", Request id "0HNFAUGO77UKR:00000001": started reading request body.
2025-09-03 17:14:26.535 +03:00 [DBG] Connection id "0HNFAUGO77UKR", Request id "0HNFAUGO77UKR:00000001": done reading request body.
2025-09-03 17:14:26.566 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 17:14:26.634 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-09-03 17:14:26.673 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-09-03 17:14:26.871 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<DatabaseName>k__BackingField = dataReader.GetString(3);
                                        instance.<Name>k__BackingField = dataReader.GetString(4);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(5));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(6);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(7) ? default(Guid?) : (Guid?)dataReader.GetGuid(7) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(7) ? default(object) : (object)dataReader.GetGuid(7) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(8) ? default(Guid) : dataReader.GetGuid(8);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(10) ? default(string) : dataReader.GetString(10);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(11) ? default(DateTime) : dataReader.GetDateTime(11);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(12) ? default(string) : dataReader.GetString(12);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-09-03 17:14:26.899 +03:00 [DBG] Creating DbConnection.
2025-09-03 17:14:26.900 +03:00 [DBG] Created DbConnection. (1ms).
2025-09-03 17:14:26.902 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:14:26.904 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:14:26.905 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 17:14:26.906 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 17:14:26.909 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2025-09-03 17:14:26.912 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 17:14:26.919 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 17:14:26.950 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 17:14:26.984 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 17:14:26.992 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 17:14:26.993 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 17:14:26.995 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 17:14:26.997 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 17:14:27.001 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:14:27.003 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 81ms reading results.
2025-09-03 17:14:27.005 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:14:27.007 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 17:14:27.016 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 17:14:27.020 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:14:27.022 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:14:27.023 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 17:14:27.024 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 17:14:27.025 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 17:14:27.026 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 17:14:27.028 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 17:14:27.030 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:14:27.031 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 17:14:27.033 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:14:27.034 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 17:14:27.043 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 17:14:27.055 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 17:14:27.058 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 17:14:27.153 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 17:14:27.170 +03:00 [INF] Converting natural language to SQL. User query: insert a product entry id = (generate random uuid id), name = mario, stock = 200, price = 1500, categoryId = get the id of the first category entry
2025-09-03 17:14:27.173 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 17:14:27.174 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 17:14:27.181 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 17:14:29.256 +03:00 [INF] LLM API responded with status: "NotFound"
2025-09-03 17:14:29.262 +03:00 [ERR] LLM API error: "NotFound" - 404 page not found
2025-09-03 17:14:29.563 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 17:14:29.714 +03:00 [ERR] An unhandled exception has occurred while executing the request.
NaturalToQuery.Core.Exceptions.LLMServiceException: LLM API request failed with status NotFound
   at NaturalToQuery.Infrastructure.LLM.LLMService.CallLlmApiAsync(PromptMessage[] messages, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 108
   at NaturalToQuery.Infrastructure.LLM.LLMService.ConvertToSqlAsync(String schema, String userQuery, ExecutionMode mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Infrastructure\LLM\LLMService.cs:line 65
   at NaturalToQuery.Application.Services.QueryOrchestrationService.ConvertNaturalLanguageAsync(Guid profileId, String naturalLanguage, ExecutionMode Mode, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToQuery.Application\Services\QueryOrchestrationService.cs:line 41
   at NaturalToQuery.Api.Controllers.Query.ConvertNaturalLanguage.HandleAsync(ConvertNaturalLanguageRequest req, CancellationToken ct) in C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\Controllers\Query\ConvertNaturalLanguage.cs:line 45
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at FastEndpoints.Endpoint`2.ExecAsync(CancellationToken ct)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-09-03 17:14:29.740 +03:00 [ERR] Error occurred.
2025-09-03 17:14:29.974 +03:00 [DBG] Connection id "0HNFAUGO77UKR" completed keep alive response.
2025-09-03 17:14:29.988 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 17:14:29.990 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:14:29.992 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 17:14:29.994 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 404 null application/json; charset=utf-8 3526.5819ms
2025-09-03 17:15:06.881 +03:00 [INF] This is a test log to file!
2025-09-03 17:15:07.223 +03:00 [INF] Shared Kernal configured successfully.
2025-09-03 17:15:07.231 +03:00 [INF] API configured successfully.
2025-09-03 17:15:07.313 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-03 17:15:07.360 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-09-03 17:15:07.837 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 17:15:07.867 +03:00 [INF] API key configured for HttpClient
2025-09-03 17:15:07.875 +03:00 [INF] Registered 13 endpoints in 826 milliseconds.
2025-09-03 17:15:07.883 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 17:15:07.917 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 17:15:07.990 +03:00 [DBG] Creating DbConnection.
2025-09-03 17:15:08.001 +03:00 [DBG] Created DbConnection. (8ms).
2025-09-03 17:15:08.003 +03:00 [DBG] Migrating using database 'main' on server 'schema_cache.db'.
2025-09-03 17:15:08.008 +03:00 [DBG] Creating DbConnection.
2025-09-03 17:15:08.010 +03:00 [DBG] Created DbConnection. (2ms).
2025-09-03 17:15:08.012 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:15:08.019 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:15:08.022 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:15:08.026 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 17:15:08.027 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:15:08.029 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:15:08.031 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-03 17:15:08.035 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 17:15:08.040 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 17:15:08.042 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (6ms).
2025-09-03 17:15:08.047 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 17:15:08.065 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 17:15:08.068 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 17:15:08.069 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 17:15:08.070 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 17:15:08.070 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 14:15:08.0684002+00:00');
SELECT changes();
2025-09-03 17:15:08.075 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 14:15:08.0684002+00:00');
SELECT changes();
2025-09-03 17:15:08.115 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 17:15:08.119 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 17:15:08.120 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-09-03 17:15:08.121 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-09-03 17:15:08.122 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (1ms).
2025-09-03 17:15:08.123 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 17:15:08.125 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 17:15:08.127 +03:00 [DBG] Committing transaction.
2025-09-03 17:15:08.128 +03:00 [DBG] Committed transaction.
2025-09-03 17:15:08.129 +03:00 [DBG] Disposing transaction.
2025-09-03 17:15:08.131 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 17:15:08.132 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 17:15:08.133 +03:00 [DBG] Creating DbConnection.
2025-09-03 17:15:08.134 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 17:15:08.135 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:15:08.136 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:15:08.137 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:15:08.139 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 17:15:08.140 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 17:15:08.141 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 17:15:08.142 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 17:15:08.144 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 17:15:08.145 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 17:15:08.148 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 17:15:08.149 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 17:15:08.150 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 17:15:08.151 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 17:15:08.153 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 17:15:08.157 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:15:08.159 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 3ms reading results.
2025-09-03 17:15:08.163 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-03 17:15:08.164 +03:00 [DBG] Committing transaction.
2025-09-03 17:15:08.165 +03:00 [DBG] Committed transaction.
2025-09-03 17:15:08.166 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 17:15:08.167 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 17:15:08.168 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 17:15:08.169 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 17:15:08.172 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 17:15:08.174 +03:00 [DBG] Disposing transaction.
2025-09-03 17:15:08.175 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:15:08.178 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (3ms).
2025-09-03 17:15:08.180 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 17:15:08.181 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:15:08.182 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 17:15:08.183 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 17:15:08.184 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 17:15:08.209 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-09-03 17:15:08.237 +03:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-09-03 17:15:08.239 +03:00 [DBG] Hosting starting
2025-09-03 17:15:08.250 +03:00 [DBG] Middleware loaded
2025-09-03 17:15:08.252 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-09-03 17:15:08.253 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-09-03 17:15:08.315 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-09-03 17:15:08.317 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-09-03 17:15:08.319 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-09-03 17:15:08.347 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-09-03 17:15:08.407 +03:00 [INF] Now listening on: https://localhost:7202
2025-09-03 17:15:08.409 +03:00 [INF] Now listening on: http://localhost:5000
2025-09-03 17:15:08.410 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-09-03 17:15:08.411 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-09-03 17:15:08.412 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-09-03 17:15:08.412 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-09-03 17:15:08.420 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 17:15:08.426 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 17:15:08.508 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-03 17:15:08.510 +03:00 [INF] Hosting environment: Development
2025-09-03 17:15:08.511 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-09-03 17:15:08.512 +03:00 [DBG] Hosting started
2025-09-03 17:15:14.070 +03:00 [DBG] Connection id "0HNFAUH6FFI4Q" received FIN.
2025-09-03 17:15:14.076 +03:00 [DBG] Connection id "0HNFAUH6FFI4Q" accepted.
2025-09-03 17:15:14.078 +03:00 [DBG] Connection id "0HNFAUH6FFI4Q" started.
2025-09-03 17:15:14.079 +03:00 [DBG] Connection id "0HNFAUH6FFI4R" accepted.
2025-09-03 17:15:14.080 +03:00 [DBG] Connection id "0HNFAUH6FFI4R" started.
2025-09-03 17:15:14.084 +03:00 [DBG] Connection id "0HNFAUH6FFI4Q" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 17:15:14.086 +03:00 [DBG] Connection id "0HNFAUH6FFI4Q" disconnecting.
2025-09-03 17:15:14.089 +03:00 [DBG] Connection id "0HNFAUH6FFI4Q" stopped.
2025-09-03 17:15:14.106 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 200
2025-09-03 17:15:14.138 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 17:15:14.140 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 17:15:14.143 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 17:15:14.166 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-09-03 17:15:14.168 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 17:15:14.170 +03:00 [DBG] Connection id "0HNFAUH6FFI4R" completed keep alive response.
2025-09-03 17:15:14.172 +03:00 [DBG] Connection id "0HNFAUH6FFI4S" accepted.
2025-09-03 17:15:14.172 +03:00 [DBG] Connection id "0HNFAUH6FFI4T" accepted.
2025-09-03 17:15:14.172 +03:00 [DBG] Connection id "0HNFAUH6FFI4S" received FIN.
2025-09-03 17:15:14.178 +03:00 [DBG] Connection id "0HNFAUH6FFI4S" started.
2025-09-03 17:15:14.178 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 76.2735ms
2025-09-03 17:15:14.178 +03:00 [DBG] Connection id "0HNFAUH6FFI4T" started.
2025-09-03 17:15:14.180 +03:00 [DBG] Connection id "0HNFAUH6FFI4S" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 17:15:14.185 +03:00 [DBG] Connection id "0HNFAUH6FFI4R", Request id "0HNFAUH6FFI4R:00000001": started reading request body.
2025-09-03 17:15:14.186 +03:00 [DBG] Connection id "0HNFAUH6FFI4S" disconnecting.
2025-09-03 17:15:14.187 +03:00 [DBG] Connection id "0HNFAUH6FFI4R", Request id "0HNFAUH6FFI4R:00000001": done reading request body.
2025-09-03 17:15:14.188 +03:00 [DBG] Connection id "0HNFAUH6FFI4S" stopped.
2025-09-03 17:15:14.220 +03:00 [DBG] Connection 0HNFAUH6FFI4T established using the following protocol: "Tls13"
2025-09-03 17:15:14.224 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 200
2025-09-03 17:15:14.228 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 17:15:14.230 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 17:15:14.231 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 17:15:14.235 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 17:15:14.248 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 17:15:14.251 +03:00 [INF] API key configured for HttpClient
2025-09-03 17:15:14.283 +03:00 [DBG] Connection id "0HNFAUH6FFI4T", Request id "0HNFAUH6FFI4T:00000001": started reading request body.
2025-09-03 17:15:14.285 +03:00 [DBG] Connection id "0HNFAUH6FFI4T", Request id "0HNFAUH6FFI4T:00000001": done reading request body.
2025-09-03 17:15:14.309 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 17:15:14.377 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-09-03 17:15:14.415 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-09-03 17:15:14.626 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<DatabaseName>k__BackingField = dataReader.GetString(3);
                                        instance.<Name>k__BackingField = dataReader.GetString(4);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(5));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(6);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(7) ? default(Guid?) : (Guid?)dataReader.GetGuid(7) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(7) ? default(object) : (object)dataReader.GetGuid(7) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(8) ? default(Guid) : dataReader.GetGuid(8);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(10) ? default(string) : dataReader.GetString(10);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(11) ? default(DateTime) : dataReader.GetDateTime(11);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(12) ? default(string) : dataReader.GetString(12);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-09-03 17:15:14.657 +03:00 [DBG] Creating DbConnection.
2025-09-03 17:15:14.658 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 17:15:14.660 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:15:14.662 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:15:14.663 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 17:15:14.664 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 17:15:14.667 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2025-09-03 17:15:14.669 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 17:15:14.674 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 17:15:14.703 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 17:15:14.736 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 17:15:14.744 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 17:15:14.746 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 17:15:14.747 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 17:15:14.748 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 17:15:14.751 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:15:14.752 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 76ms reading results.
2025-09-03 17:15:14.755 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:15:14.756 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 17:15:14.765 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 17:15:14.768 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:15:14.769 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:15:14.770 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 17:15:14.771 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 17:15:14.772 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 17:15:14.773 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 17:15:14.774 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 17:15:14.776 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:15:14.777 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 17:15:14.779 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:15:14.780 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 17:15:14.790 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 17:15:14.801 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 17:15:14.803 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 17:15:14.936 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 17:15:14.958 +03:00 [INF] Converting natural language to SQL. User query: insert a product entry id = (generate random uuid id), name = mario, stock = 200, price = 1500, categoryId = get the id of the first category entry
2025-09-03 17:15:14.960 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 17:15:14.962 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 17:15:14.969 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 17:15:16.406 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 17:15:16.416 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 17:15:16.426 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 17:15:16.430 +03:00 [DBG] Connection id "0HNFAUH6FFI4T" completed keep alive response.
2025-09-03 17:15:16.435 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 17:15:16.441 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:15:16.444 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-09-03 17:15:16.447 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 2223.4404ms
2025-09-03 17:15:25.690 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 199
2025-09-03 17:15:25.694 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 17:15:25.695 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 17:15:25.695 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 17:15:25.697 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 17:15:25.698 +03:00 [DBG] Connection id "0HNFAUH6FFI4R" completed keep alive response.
2025-09-03 17:15:25.699 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 8.737ms
2025-09-03 17:15:25.700 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 199
2025-09-03 17:15:25.701 +03:00 [DBG] Connection id "0HNFAUH6FFI4R", Request id "0HNFAUH6FFI4R:00000002": started reading request body.
2025-09-03 17:15:25.703 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 17:15:25.704 +03:00 [DBG] Connection id "0HNFAUH6FFI4R", Request id "0HNFAUH6FFI4R:00000002": done reading request body.
2025-09-03 17:15:25.705 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 17:15:25.707 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 17:15:25.709 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 17:15:25.722 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 17:15:25.725 +03:00 [INF] API key configured for HttpClient
2025-09-03 17:15:25.725 +03:00 [DBG] Connection id "0HNFAUH6FFI4T", Request id "0HNFAUH6FFI4T:00000002": started reading request body.
2025-09-03 17:15:25.727 +03:00 [DBG] Connection id "0HNFAUH6FFI4T", Request id "0HNFAUH6FFI4T:00000002": done reading request body.
2025-09-03 17:15:25.729 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 17:15:25.731 +03:00 [DBG] Creating DbConnection.
2025-09-03 17:15:25.732 +03:00 [DBG] Created DbConnection. (1ms).
2025-09-03 17:15:25.733 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:15:25.735 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:15:25.736 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 17:15:25.737 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 17:15:25.738 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 17:15:25.739 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 17:15:25.742 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 17:15:25.744 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 17:15:25.746 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 17:15:25.748 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 17:15:25.750 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 17:15:25.752 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 17:15:25.753 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 17:15:25.755 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:15:25.756 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 12ms reading results.
2025-09-03 17:15:25.758 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:15:25.760 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 17:15:25.761 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 17:15:25.763 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:15:25.765 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:15:25.766 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 17:15:25.766 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 17:15:25.767 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 17:15:25.768 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 17:15:25.770 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 17:15:25.773 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:15:25.774 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 17:15:25.776 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 17:15:25.778 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 17:15:25.779 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 17:15:25.780 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 17:15:25.782 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 17:15:25.784 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 17:15:25.785 +03:00 [INF] Converting natural language to SQL. User query: insert a product entry id = (generate random uuid id), name = mario, stock = 200, price = 1500, categoryId = get the id of the first category entry
2025-09-03 17:15:25.786 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 17:15:25.787 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 17:15:25.788 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 17:15:27.344 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 17:15:27.347 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 17:15:27.349 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 17:15:27.352 +03:00 [DBG] Connection id "0HNFAUH6FFI4T" completed keep alive response.
2025-09-03 17:15:27.353 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 17:15:27.354 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 17:15:27.354 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 17:15:27.355 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 1655.101ms
2025-09-03 17:15:40.198 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 200
2025-09-03 17:15:40.200 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 17:15:40.201 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 17:15:40.203 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 17:15:40.204 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 17:15:40.205 +03:00 [DBG] Connection id "0HNFAUH6FFI4R" completed keep alive response.
2025-09-03 17:15:40.207 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 200
2025-09-03 17:15:40.208 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 10.7159ms
2025-09-03 17:15:40.212 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 17:15:40.216 +03:00 [DBG] Connection id "0HNFAUH6FFI4R", Request id "0HNFAUH6FFI4R:00000003": started reading request body.
2025-09-03 17:15:40.217 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 17:15:40.219 +03:00 [DBG] Connection id "0HNFAUH6FFI4R", Request id "0HNFAUH6FFI4R:00000003": done reading request body.
2025-09-03 17:15:40.221 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 17:15:40.224 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 17:15:40.226 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 17:15:40.228 +03:00 [INF] API key configured for HttpClient
2025-09-03 17:15:40.229 +03:00 [DBG] Connection id "0HNFAUH6FFI4T", Request id "0HNFAUH6FFI4T:00000003": started reading request body.
2025-09-03 17:15:40.230 +03:00 [DBG] Connection id "0HNFAUH6FFI4T", Request id "0HNFAUH6FFI4T:00000003": done reading request body.
2025-09-03 17:15:40.232 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 17:15:40.233 +03:00 [DBG] Connection id "0HNFAUH6FFI4T" completed keep alive response.
2025-09-03 17:15:40.234 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 17:15:40.235 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 27.708ms
2025-09-03 18:39:02.262 +03:00 [INF] This is a test log to file!
2025-09-03 18:39:02.910 +03:00 [INF] Shared Kernal configured successfully.
2025-09-03 18:39:02.942 +03:00 [INF] API configured successfully.
2025-09-03 18:39:03.101 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-03 18:39:03.184 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-09-03 18:39:03.845 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 18:39:03.889 +03:00 [INF] API key configured for HttpClient
2025-09-03 18:39:03.898 +03:00 [INF] Registered 13 endpoints in 1,427 milliseconds.
2025-09-03 18:39:03.905 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 18:39:03.970 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 18:39:04.126 +03:00 [DBG] Creating DbConnection.
2025-09-03 18:39:04.154 +03:00 [DBG] Created DbConnection. (23ms).
2025-09-03 18:39:04.160 +03:00 [DBG] Migrating using database 'main' on server 'schema_cache.db'.
2025-09-03 18:39:04.175 +03:00 [DBG] Creating DbConnection.
2025-09-03 18:39:04.183 +03:00 [DBG] Created DbConnection. (9ms).
2025-09-03 18:39:04.186 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:39:04.230 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:39:04.236 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:39:04.240 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:39:04.241 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:39:04.244 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:39:04.248 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-03 18:39:04.253 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 18:39:04.259 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (4ms).
2025-09-03 18:39:04.261 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (8ms).
2025-09-03 18:39:04.268 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 18:39:04.311 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 18:39:04.315 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 18:39:04.316 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 18:39:04.317 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 18:39:04.319 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 15:39:04.3157176+00:00');
SELECT changes();
2025-09-03 18:39:04.325 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 15:39:04.3157176+00:00');
SELECT changes();
2025-09-03 18:39:04.411 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 18:39:04.415 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 18:39:04.417 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-09-03 18:39:04.419 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (1ms).
2025-09-03 18:39:04.421 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (3ms).
2025-09-03 18:39:04.425 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 18:39:04.428 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 18:39:04.434 +03:00 [DBG] Committing transaction.
2025-09-03 18:39:04.436 +03:00 [DBG] Committed transaction.
2025-09-03 18:39:04.439 +03:00 [DBG] Disposing transaction.
2025-09-03 18:39:04.442 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 18:39:04.444 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 18:39:04.447 +03:00 [DBG] Creating DbConnection.
2025-09-03 18:39:04.448 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 18:39:04.448 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:39:04.450 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:39:04.451 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:39:04.452 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:39:04.454 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 18:39:04.455 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 18:39:04.457 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 18:39:04.458 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 18:39:04.460 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 18:39:04.464 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 18:39:04.465 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 18:39:04.466 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 18:39:04.468 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 18:39:04.469 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 18:39:04.473 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:39:04.486 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 13ms reading results.
2025-09-03 18:39:04.493 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-03 18:39:04.494 +03:00 [DBG] Committing transaction.
2025-09-03 18:39:04.495 +03:00 [DBG] Committed transaction.
2025-09-03 18:39:04.496 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 18:39:04.496 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 18:39:04.497 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 18:39:04.498 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 18:39:04.504 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 18:39:04.506 +03:00 [DBG] Disposing transaction.
2025-09-03 18:39:04.508 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:39:04.511 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (3ms).
2025-09-03 18:39:04.514 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 18:39:04.515 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:39:04.517 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:39:04.518 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 18:39:04.519 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 18:39:04.547 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-09-03 18:39:04.577 +03:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-09-03 18:39:04.578 +03:00 [DBG] Hosting starting
2025-09-03 18:39:04.591 +03:00 [DBG] Middleware loaded
2025-09-03 18:39:04.595 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-09-03 18:39:04.597 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-09-03 18:39:04.690 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-09-03 18:39:04.691 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-09-03 18:39:04.694 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-09-03 18:39:04.740 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-09-03 18:39:05.108 +03:00 [ERR] Hosting failed to start
System.IO.IOException: Failed to bind to address http://127.0.0.1:5000: address already in use.
 ---> Microsoft.AspNetCore.Connections.AddressInUseException: Only one usage of each socket address (protocol/network address/port) is normally permitted.
 ---> System.Net.Sockets.SocketException (10048): Only one usage of each socket address (protocol/network address/port) is normally permitted.
   at System.Net.Sockets.Socket.UpdateStatusAfterSocketErrorAndThrowException(SocketError error, Boolean disconnectOnFailure, String callerName)
   at System.Net.Sockets.Socket.DoBind(EndPoint endPointSnapshot, SocketAddress socketAddress)
   at System.Net.Sockets.Socket.Bind(EndPoint localEP)
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketTransportOptions.CreateDefaultBoundListenSocket(EndPoint endpoint)
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketConnectionListener.Bind()
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketConnectionListener.Bind()
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketTransportFactory.BindAsync(EndPoint endpoint, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Infrastructure.TransportManager.BindAsync(EndPoint endPoint, ConnectionDelegate connectionDelegate, EndpointConfig endpointConfig, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.<>c__DisplayClass28_0`1.<<StartAsync>g__OnBind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindEndpointAsync(ListenOptions endpoint, AddressBindContext context, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindEndpointAsync(ListenOptions endpoint, AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.LocalhostListenOptions.BindAsync(AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.AddressesStrategy.BindAsync(AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.BindAsync(CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.StartAsync[TContext](IHttpApplication`1 application, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Hosting.GenericWebHostService.StartAsync(CancellationToken cancellationToken)
   at Microsoft.Extensions.Hosting.Internal.Host.<StartAsync>b__14_1(IHostedService service, CancellationToken token)
   at Microsoft.Extensions.Hosting.Internal.Host.ForeachService[T](IEnumerable`1 services, CancellationToken token, Boolean concurrent, Boolean abortOnFirstException, List`1 exceptions, Func`3 operation)
2025-09-03 18:39:14.676 +03:00 [INF] This is a test log to file!
2025-09-03 18:39:15.170 +03:00 [INF] Shared Kernal configured successfully.
2025-09-03 18:39:15.182 +03:00 [INF] API configured successfully.
2025-09-03 18:39:15.279 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-03 18:39:15.332 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-09-03 18:39:15.882 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 18:39:15.915 +03:00 [INF] API key configured for HttpClient
2025-09-03 18:39:15.925 +03:00 [INF] Registered 13 endpoints in 1,047 milliseconds.
2025-09-03 18:39:15.931 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 18:39:15.964 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 18:39:16.041 +03:00 [DBG] Creating DbConnection.
2025-09-03 18:39:16.051 +03:00 [DBG] Created DbConnection. (9ms).
2025-09-03 18:39:16.054 +03:00 [DBG] Migrating using database 'main' on server 'schema_cache.db'.
2025-09-03 18:39:16.058 +03:00 [DBG] Creating DbConnection.
2025-09-03 18:39:16.060 +03:00 [DBG] Created DbConnection. (2ms).
2025-09-03 18:39:16.062 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:39:16.069 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:39:16.073 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:39:16.077 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:39:16.078 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:39:16.080 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:39:16.082 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-03 18:39:16.086 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 18:39:16.091 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 18:39:16.092 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (6ms).
2025-09-03 18:39:16.099 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 18:39:16.116 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 18:39:16.119 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 18:39:16.120 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 18:39:16.121 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 18:39:16.122 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 15:39:16.119692+00:00');
SELECT changes();
2025-09-03 18:39:16.127 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 15:39:16.119692+00:00');
SELECT changes();
2025-09-03 18:39:16.166 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 18:39:16.170 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 18:39:16.172 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-09-03 18:39:16.173 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-09-03 18:39:16.174 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (2ms).
2025-09-03 18:39:16.176 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 18:39:16.177 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 18:39:16.179 +03:00 [DBG] Committing transaction.
2025-09-03 18:39:16.181 +03:00 [DBG] Committed transaction.
2025-09-03 18:39:16.183 +03:00 [DBG] Disposing transaction.
2025-09-03 18:39:16.187 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 18:39:16.188 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 18:39:16.189 +03:00 [DBG] Creating DbConnection.
2025-09-03 18:39:16.191 +03:00 [DBG] Created DbConnection. (1ms).
2025-09-03 18:39:16.192 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:39:16.193 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:39:16.195 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:39:16.196 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:39:16.198 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 18:39:16.199 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 18:39:16.201 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 18:39:16.202 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 18:39:16.205 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 18:39:16.209 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 18:39:16.210 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 18:39:16.211 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 18:39:16.212 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 18:39:16.215 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 18:39:16.219 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:39:16.221 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 3ms reading results.
2025-09-03 18:39:16.226 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-03 18:39:16.227 +03:00 [DBG] Committing transaction.
2025-09-03 18:39:16.227 +03:00 [DBG] Committed transaction.
2025-09-03 18:39:16.229 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 18:39:16.230 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 18:39:16.231 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 18:39:16.232 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 18:39:16.235 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 18:39:16.237 +03:00 [DBG] Disposing transaction.
2025-09-03 18:39:16.238 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:39:16.242 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (3ms).
2025-09-03 18:39:16.243 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 18:39:16.244 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:39:16.245 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 18:39:16.246 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 18:39:16.247 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 18:39:16.270 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-09-03 18:39:16.297 +03:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-09-03 18:39:16.299 +03:00 [DBG] Hosting starting
2025-09-03 18:39:16.312 +03:00 [DBG] Middleware loaded
2025-09-03 18:39:16.316 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-09-03 18:39:16.319 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-09-03 18:39:16.391 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-09-03 18:39:16.394 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-09-03 18:39:16.396 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-09-03 18:39:16.427 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-09-03 18:39:16.466 +03:00 [INF] Now listening on: https://localhost:7202
2025-09-03 18:39:16.468 +03:00 [INF] Now listening on: http://localhost:5000
2025-09-03 18:39:16.469 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-09-03 18:39:16.470 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-09-03 18:39:16.471 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-09-03 18:39:16.472 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-09-03 18:39:16.478 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 18:39:16.486 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 18:39:16.512 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-03 18:39:16.514 +03:00 [INF] Hosting environment: Development
2025-09-03 18:39:16.515 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-09-03 18:39:16.516 +03:00 [DBG] Hosting started
2025-09-03 18:40:50.761 +03:00 [DBG] Connection id "0HNFB011AP30I" received FIN.
2025-09-03 18:40:50.776 +03:00 [DBG] Connection id "0HNFB011AP30I" accepted.
2025-09-03 18:40:50.784 +03:00 [DBG] Connection id "0HNFB011AP30I" started.
2025-09-03 18:40:50.785 +03:00 [DBG] Connection id "0HNFB011AP30J" accepted.
2025-09-03 18:40:50.787 +03:00 [DBG] Connection id "0HNFB011AP30J" started.
2025-09-03 18:40:50.796 +03:00 [DBG] Connection id "0HNFB011AP30I" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 18:40:50.800 +03:00 [DBG] Connection id "0HNFB011AP30I" disconnecting.
2025-09-03 18:40:50.802 +03:00 [DBG] Connection id "0HNFB011AP30I" stopped.
2025-09-03 18:40:50.824 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/setup/profiles - null null
2025-09-03 18:40:50.898 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profiles'
2025-09-03 18:40:50.901 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/setup/profiles'
2025-09-03 18:40:50.940 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-09-03 18:40:50.948 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/setup/profiles'.
2025-09-03 18:40:50.954 +03:00 [DBG] Connection id "0HNFB011AP30J" completed keep alive response.
2025-09-03 18:40:50.956 +03:00 [DBG] Connection id "0HNFB011AP30K" accepted.
2025-09-03 18:40:50.956 +03:00 [DBG] Connection id "0HNFB011AP30K" received FIN.
2025-09-03 18:40:50.956 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/setup/profiles - 307 0 null 137.3094ms
2025-09-03 18:40:50.956 +03:00 [DBG] Connection id "0HNFB011AP30L" accepted.
2025-09-03 18:40:50.963 +03:00 [DBG] Connection id "0HNFB011AP30K" started.
2025-09-03 18:40:50.969 +03:00 [DBG] Connection id "0HNFB011AP30L" started.
2025-09-03 18:40:50.970 +03:00 [DBG] Connection id "0HNFB011AP30K" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 18:40:50.972 +03:00 [DBG] Connection id "0HNFB011AP30K" disconnecting.
2025-09-03 18:40:50.973 +03:00 [DBG] Connection id "0HNFB011AP30K" stopped.
2025-09-03 18:40:51.003 +03:00 [DBG] Connection 0HNFB011AP30L established using the following protocol: "Tls13"
2025-09-03 18:40:51.007 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7202/api/setup/profiles - null null
2025-09-03 18:40:51.011 +03:00 [DBG] 1 candidate(s) found for the request path '/api/setup/profiles'
2025-09-03 18:40:51.012 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/setup/profiles'
2025-09-03 18:40:51.016 +03:00 [INF] Executing endpoint 'HTTP: GET api/setup/profiles'
2025-09-03 18:40:51.027 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 18:40:51.049 +03:00 [INF] Listing all profiles
2025-09-03 18:40:51.084 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .AsNoTracking()'
2025-09-03 18:40:51.132 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-09-03 18:40:51.328 +03:00 [DBG] Generated query execution expression: 
'queryContext => SingleQueryingEnumerable.Create<Profile>(
    relationalQueryContext: (RelationalQueryContext)queryContext, 
    relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
            3 -> 7
        SELECT p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
        FROM Profiles AS p
        LEFT JOIN Queries AS q ON p.Id == q.ProfileId
        ORDER BY p.Id ASC) | Resolver: c => new RelationalCommandCache(
        c.Dependencies.MemoryCache, 
        c.RelationalDependencies.QuerySqlGeneratorFactory, 
        c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
        Client Projections:
            0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
            1 -> 0
            2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
            3 -> 7
        SELECT p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
        FROM Profiles AS p
        LEFT JOIN Queries AS q ON p.Id == q.ProfileId
        ORDER BY p.Id ASC, 
        False, 
        new HashSet<string>(
            new string[]{ }, 
            StringComparer.Ordinal
        )
    )].GetRelationalCommandTemplate(parameters), 
    readerColumns: null, 
    shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
    {
        resultContext.Values == null ? 
        {
            Profile entity;
            entity = 
            {
                MaterializationContext materializationContext1;
                IEntityType entityType1;
                Profile instance1;
                materializationContext1 = new MaterializationContext(
                    [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                    queryContext.Context
                );
                instance1 = default(Profile);
                (object)dataReader.GetGuid(0) != null ? 
                {
                    ISnapshot shadowSnapshot1;
                    shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                    entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                    instance1 = switch (entityType1)
                    {
                        case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                            {
                                return 
                                {
                                    Profile instance;
                                    instance = new Profile();
                                    instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                    instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                    instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                    instance.<DatabaseName>k__BackingField = dataReader.GetString(3);
                                    instance.<Name>k__BackingField = dataReader.GetString(4);
                                    instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(5));
                                    instance.<SecretRef>k__BackingField = dataReader.GetString(6);
                                    (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                        context: materializationContext1.Context, 
                                        entity: instance, 
                                        queryTrackingBehavior: NoTracking, 
                                        structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                    return instance;
                                }}
                        default: 
                            default(Profile)
                    }
                    ;
                    return instance1;
                } : 
                {
                    object[] keyValues1;
                    keyValues1 = new object[]{ (object)dataReader.GetGuid(0) };
                    return ShapedQueryCompilingExpressionVisitor.CreateNullKeyValueInNoTrackingQuery(
                        entityType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")], 
                        properties: [LIFTABLE Constant: List<RuntimeProperty> { Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd } | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey().Properties], 
                        keyValues: keyValues1);
                };
                return instance1;
            };
            resultContext.Values = new object[]{ entity };
            ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                entity: (Profile)(resultContext.Values[0]), 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                trackingQuery: False, 
                setLoaded: True);
        } : default(void);
        ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
            collectionId: 0, 
            queryContext: queryContext, 
            dbDataReader: dataReader, 
            resultCoordinator: resultCoordinator, 
            parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
            outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
            selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(7) ? default(Guid?) : (Guid?)dataReader.GetGuid(7) }], 
            parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
            outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
            selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
            innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
            {
                Query entity;
                entity = 
                {
                    MaterializationContext materializationContext2;
                    IEntityType entityType2;
                    Query instance2;
                    materializationContext2 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance2 = default(Query);
                    dataReader.IsDBNull(7) ? default(object) : (object)dataReader.GetGuid(7) != null ? 
                    {
                        ISnapshot shadowSnapshot2;
                        shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                        instance2 = switch (entityType2)
                        {
                            case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                {
                                    return 
                                    {
                                        Query instance;
                                        instance = new Query();
                                        instance.<Id>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                        instance.<ProfileId>k__BackingField = dataReader.IsDBNull(8) ? default(Guid) : dataReader.GetGuid(8);
                                        instance.<ResultJson>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                        instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(10) ? default(string) : dataReader.GetString(10);
                                        instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(11) ? default(DateTime) : dataReader.GetDateTime(11);
                                        instance.<UserQuery>k__BackingField = dataReader.IsDBNull(12) ? default(string) : dataReader.GetString(12);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext2.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: NoTracking, 
                                            structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Query)
                        }
                        ;
                        return instance2;
                    } : default(void);
                    return instance2;
                };
                return entity;
            }, 
            inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{10} => namelessParameter{10}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
            fixup: (namelessParameter{11}, namelessParameter{12}) => 
            {
                [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{13} => namelessParameter{13}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                    entity: namelessParameter{11}, 
                    value: namelessParameter{12}, 
                    forMaterialization: True);
                return namelessParameter{12}.<Profile>k__BackingField = namelessParameter{11};
            }, 
            trackingQuery: False);
        return IsTrue(resultCoordinator.ResultReady)
         ? (Profile)(resultContext.Values[0]) : default(Profile);
    }, 
    contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
    standAloneStateManager: False, 
    detailedErrorsEnabled: False, 
    threadSafetyChecksEnabled: True)'
2025-09-03 18:40:51.351 +03:00 [DBG] Creating DbConnection.
2025-09-03 18:40:51.353 +03:00 [DBG] Created DbConnection. (1ms).
2025-09-03 18:40:51.355 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:40:51.357 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:40:51.359 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 18:40:51.361 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 18:40:51.362 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2025-09-03 18:40:51.364 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM "Profiles" AS "p"
LEFT JOIN "Queries" AS "q" ON "p"."Id" = "q"."ProfileId"
ORDER BY "p"."Id"
2025-09-03 18:40:51.369 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM "Profiles" AS "p"
LEFT JOIN "Queries" AS "q" ON "p"."Id" = "q"."ProfileId"
ORDER BY "p"."Id"
2025-09-03 18:40:51.384 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:40:51.386 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 14ms reading results.
2025-09-03 18:40:51.388 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:40:51.390 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:40:51.394 +03:00 [INF] Fetching connection string for profile "3d0cdaa1-a28f-48b0-a256-e9e404e13caa"
2025-09-03 18:40:51.400 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-09-03 18:40:51.405 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-09-03 18:40:51.425 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<DatabaseName>k__BackingField = dataReader.GetString(3);
                                        instance.<Name>k__BackingField = dataReader.GetString(4);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(5));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(6);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(7) ? default(Guid?) : (Guid?)dataReader.GetGuid(7) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(7) ? default(object) : (object)dataReader.GetGuid(7) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(8) ? default(Guid) : dataReader.GetGuid(8);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(10) ? default(string) : dataReader.GetString(10);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(11) ? default(DateTime) : dataReader.GetDateTime(11);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(12) ? default(string) : dataReader.GetString(12);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-09-03 18:40:51.435 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:40:51.437 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:40:51.438 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 18:40:51.439 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 18:40:51.441 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2025-09-03 18:40:51.444 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:40:51.449 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:40:51.479 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:40:51.505 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:40:51.507 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 55ms reading results.
2025-09-03 18:40:51.509 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:40:51.510 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:40:51.525 +03:00 [DBG] Fetched secret for profile "3d0cdaa1-a28f-48b0-a256-e9e404e13caa"
2025-09-03 18:40:51.527 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 18:40:51.530 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:40:51.531 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:40:51.532 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 18:40:51.533 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 18:40:51.534 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 18:40:51.536 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:40:51.538 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:40:51.540 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:40:51.552 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:40:51.560 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:40:51.562 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:40:51.563 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:40:51.564 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:40:51.566 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:40:51.567 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 26ms reading results.
2025-09-03 18:40:51.568 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:40:51.570 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:40:51.572 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 18:40:51.595 +03:00 [INF] Executed endpoint 'HTTP: GET api/setup/profiles'
2025-09-03 18:40:51.597 +03:00 [DBG] Connection id "0HNFB011AP30L" completed keep alive response.
2025-09-03 18:40:51.599 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 18:40:51.605 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:40:51.607 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-09-03 18:40:51.609 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7202/api/setup/profiles - 200 null application/json; charset=utf-8 601.7631ms
2025-09-03 18:41:30.790 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 199
2025-09-03 18:41:30.792 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 18:41:30.794 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 18:41:30.796 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 18:41:30.798 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 18:41:30.799 +03:00 [DBG] Connection id "0HNFB011AP30J" completed keep alive response.
2025-09-03 18:41:30.801 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 11.3867ms
2025-09-03 18:41:30.807 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 199
2025-09-03 18:41:30.810 +03:00 [DBG] Connection id "0HNFB011AP30J", Request id "0HNFB011AP30J:00000002": started reading request body.
2025-09-03 18:41:30.811 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 18:41:30.812 +03:00 [DBG] Connection id "0HNFB011AP30J", Request id "0HNFB011AP30J:00000002": done reading request body.
2025-09-03 18:41:30.812 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 18:41:30.814 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 18:41:30.815 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 18:41:30.826 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 18:41:30.828 +03:00 [INF] API key configured for HttpClient
2025-09-03 18:41:30.844 +03:00 [DBG] Connection id "0HNFB011AP30L", Request id "0HNFB011AP30L:00000002": started reading request body.
2025-09-03 18:41:30.846 +03:00 [DBG] Connection id "0HNFB011AP30L", Request id "0HNFB011AP30L:00000002": done reading request body.
2025-09-03 18:41:30.897 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 18:41:30.900 +03:00 [DBG] Creating DbConnection.
2025-09-03 18:41:30.901 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 18:41:30.901 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:41:30.902 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:41:30.903 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 18:41:30.904 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 18:41:30.905 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 18:41:30.906 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:41:30.908 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:41:30.909 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:41:30.911 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:41:30.912 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:41:30.913 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:41:30.914 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:41:30.915 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:41:30.915 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:41:30.916 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 7ms reading results.
2025-09-03 18:41:30.917 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:41:30.918 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:41:30.927 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 18:41:30.927 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:41:30.929 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:41:30.930 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 18:41:30.931 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 18:41:30.932 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 18:41:30.933 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:41:30.934 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:41:30.936 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:41:30.937 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 18:41:30.939 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:41:30.939 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 18:41:30.941 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 18:41:30.965 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 18:41:30.967 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 18:41:31.067 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 18:41:31.086 +03:00 [INF] Converting natural language to SQL. User query: insert a product entry id = (generate random uuid id), name = mario, stock = 200, price = 1500, categoryId = get the id of the first category entry
2025-09-03 18:41:31.089 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 18:41:31.090 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 18:41:31.098 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 18:41:51.267 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 18:41:51.280 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 18:41:51.289 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 18:41:51.293 +03:00 [DBG] Connection id "0HNFB011AP30L" completed keep alive response.
2025-09-03 18:41:51.295 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 18:41:51.296 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:41:51.297 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:41:51.299 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 20492.2488ms
2025-09-03 18:42:50.050 +03:00 [DBG] Connection id "0HNFB011AP30M" received FIN.
2025-09-03 18:42:50.051 +03:00 [DBG] Connection id "0HNFB011AP30M" accepted.
2025-09-03 18:42:50.057 +03:00 [DBG] Connection id "0HNFB011AP30M" started.
2025-09-03 18:42:50.057 +03:00 [DBG] Connection id "0HNFB011AP30N" accepted.
2025-09-03 18:42:50.061 +03:00 [DBG] Connection id "0HNFB011AP30M" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 18:42:50.062 +03:00 [DBG] Connection id "0HNFB011AP30N" started.
2025-09-03 18:42:50.063 +03:00 [DBG] Connection id "0HNFB011AP30M" disconnecting.
2025-09-03 18:42:50.064 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 208
2025-09-03 18:42:50.065 +03:00 [DBG] Connection id "0HNFB011AP30M" stopped.
2025-09-03 18:42:50.067 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 18:42:50.068 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 18:42:50.069 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 18:42:50.070 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 18:42:50.071 +03:00 [DBG] Connection id "0HNFB011AP30N" completed keep alive response.
2025-09-03 18:42:50.072 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 8.2869ms
2025-09-03 18:42:50.073 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 208
2025-09-03 18:42:50.075 +03:00 [DBG] Connection id "0HNFB011AP30N", Request id "0HNFB011AP30N:00000001": started reading request body.
2025-09-03 18:42:50.077 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 18:42:50.078 +03:00 [DBG] Connection id "0HNFB011AP30N", Request id "0HNFB011AP30N:00000001": done reading request body.
2025-09-03 18:42:50.079 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 18:42:50.081 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 18:42:50.082 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 18:42:50.084 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 18:42:50.086 +03:00 [INF] API key configured for HttpClient
2025-09-03 18:42:50.087 +03:00 [DBG] Connection id "0HNFB011AP30L", Request id "0HNFB011AP30L:00000003": started reading request body.
2025-09-03 18:42:50.088 +03:00 [DBG] Connection id "0HNFB011AP30L", Request id "0HNFB011AP30L:00000003": done reading request body.
2025-09-03 18:42:50.089 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 18:42:50.092 +03:00 [DBG] Creating DbConnection.
2025-09-03 18:42:50.092 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 18:42:50.093 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:42:50.094 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:42:50.095 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 18:42:50.096 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 18:42:50.097 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 18:42:50.098 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:42:50.100 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:42:50.102 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:42:50.103 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:42:50.104 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:42:50.105 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:42:50.107 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:42:50.108 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:42:50.109 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:42:50.110 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 8ms reading results.
2025-09-03 18:42:50.111 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:42:50.112 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:42:50.114 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 18:42:50.115 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:42:50.116 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:42:50.117 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 18:42:50.118 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 18:42:50.119 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 18:42:50.120 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:42:50.121 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:42:50.123 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:42:50.124 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 18:42:50.125 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:42:50.126 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:42:50.128 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 18:42:50.129 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 18:42:50.130 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 18:42:50.132 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 18:42:50.133 +03:00 [INF] Converting natural language to SQL. User query: insert a product entry id = (generate random uuid id of yours), name = mario, stock = 200, price = 1500, categoryId = get the id of the first category entry
2025-09-03 18:42:50.134 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 18:42:50.134 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 18:42:50.136 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 18:42:57.331 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 18:42:57.333 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 18:42:57.334 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 18:42:57.335 +03:00 [DBG] Connection id "0HNFB011AP30L" completed keep alive response.
2025-09-03 18:42:57.337 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 18:42:57.338 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:42:57.339 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:42:57.341 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 7268.0474ms
2025-09-03 18:43:15.719 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 208
2025-09-03 18:43:15.721 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 18:43:15.722 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 18:43:15.724 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 18:43:15.724 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 18:43:15.725 +03:00 [DBG] Connection id "0HNFB011AP30N" completed keep alive response.
2025-09-03 18:43:15.727 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 8.0765ms
2025-09-03 18:43:15.750 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 208
2025-09-03 18:43:15.755 +03:00 [DBG] Connection id "0HNFB011AP30N", Request id "0HNFB011AP30N:00000002": started reading request body.
2025-09-03 18:43:15.757 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 18:43:15.758 +03:00 [DBG] Connection id "0HNFB011AP30N", Request id "0HNFB011AP30N:00000002": done reading request body.
2025-09-03 18:43:15.759 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 18:43:15.762 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 18:43:15.763 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 18:43:15.764 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 18:43:15.766 +03:00 [INF] API key configured for HttpClient
2025-09-03 18:43:15.767 +03:00 [DBG] Connection id "0HNFB011AP30L", Request id "0HNFB011AP30L:00000004": started reading request body.
2025-09-03 18:43:15.768 +03:00 [DBG] Connection id "0HNFB011AP30L", Request id "0HNFB011AP30L:00000004": done reading request body.
2025-09-03 18:43:15.769 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 18:43:15.770 +03:00 [DBG] Creating DbConnection.
2025-09-03 18:43:15.771 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 18:43:15.772 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:43:15.773 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:43:15.774 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 18:43:15.776 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 18:43:15.777 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 18:43:15.778 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:43:15.780 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:43:15.782 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:43:15.783 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:43:15.785 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:43:15.786 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:43:15.787 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:43:15.788 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:43:15.790 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:43:15.791 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 8ms reading results.
2025-09-03 18:43:15.792 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:43:15.793 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:43:15.795 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 18:43:15.796 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:43:15.797 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:43:15.798 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 18:43:15.799 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 18:43:15.800 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 18:43:15.801 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:43:15.803 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:43:15.805 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:43:15.807 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 18:43:15.808 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:43:15.809 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:43:15.810 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 18:43:15.811 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 18:43:15.812 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 18:43:15.815 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 18:43:15.816 +03:00 [INF] Converting natural language to SQL. User query: insert a product entry id = 'generate random uuid id of yours', name = mario, stock = 200, price = 1500, categoryId = get the id of the first category entry
2025-09-03 18:43:15.817 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 18:43:15.818 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 18:43:15.819 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 18:43:23.851 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 18:43:23.853 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 18:43:23.854 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 18:43:23.855 +03:00 [DBG] Connection id "0HNFB011AP30L" completed keep alive response.
2025-09-03 18:43:23.856 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 18:43:23.857 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:43:23.858 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 18:43:23.859 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 8131.0896ms
2025-09-03 18:44:12.843 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 208
2025-09-03 18:44:12.845 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 18:44:12.846 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 18:44:12.848 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 18:44:12.849 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 18:44:12.850 +03:00 [DBG] Connection id "0HNFB011AP30N" completed keep alive response.
2025-09-03 18:44:12.874 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 208
2025-09-03 18:44:12.876 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 8.3969ms
2025-09-03 18:44:12.879 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 18:44:12.883 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 18:44:12.882 +03:00 [DBG] Connection id "0HNFB011AP30N", Request id "0HNFB011AP30N:00000003": started reading request body.
2025-09-03 18:44:12.885 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 18:44:12.886 +03:00 [DBG] Connection id "0HNFB011AP30N", Request id "0HNFB011AP30N:00000003": done reading request body.
2025-09-03 18:44:12.887 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 18:44:12.889 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 18:44:12.891 +03:00 [INF] API key configured for HttpClient
2025-09-03 18:44:12.892 +03:00 [DBG] Connection id "0HNFB011AP30L", Request id "0HNFB011AP30L:00000005": started reading request body.
2025-09-03 18:44:12.893 +03:00 [DBG] Connection id "0HNFB011AP30L", Request id "0HNFB011AP30L:00000005": done reading request body.
2025-09-03 18:44:12.895 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 18:44:12.896 +03:00 [DBG] Creating DbConnection.
2025-09-03 18:44:12.896 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 18:44:12.897 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:44:12.899 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:44:12.900 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 18:44:12.901 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 18:44:12.902 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 18:44:12.904 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:44:12.906 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:44:12.908 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:44:12.909 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:44:12.911 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:44:12.912 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:44:12.913 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:44:12.915 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 18:44:12.916 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:44:12.917 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 9ms reading results.
2025-09-03 18:44:12.918 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:44:12.919 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 18:44:12.921 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 18:44:12.922 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:44:12.924 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:44:12.925 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 18:44:12.925 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 18:44:12.926 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 18:44:12.928 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:44:12.929 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 18:44:12.931 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:44:12.932 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 18:44:12.933 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:44:12.935 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:44:12.937 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 18:44:12.938 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 18:44:12.939 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 18:44:12.940 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 18:44:12.942 +03:00 [INF] Converting natural language to SQL. User query: insert a product entry id = (generate random uuid id of yours), name = mario, stock = 200, price = 1500, categoryId = get the id of the first category entry
2025-09-03 18:44:12.943 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 18:44:12.944 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 18:44:12.944 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 18:44:20.817 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 18:44:20.819 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 18:44:20.822 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 18:44:20.823 +03:00 [DBG] Connection id "0HNFB011AP30L" completed keep alive response.
2025-09-03 18:44:20.825 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 18:44:20.825 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:44:20.826 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:44:20.829 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 7977.4882ms
2025-09-03 18:45:24.896 +03:00 [INF] This is a test log to file!
2025-09-03 18:45:25.271 +03:00 [INF] Shared Kernal configured successfully.
2025-09-03 18:45:25.293 +03:00 [INF] API configured successfully.
2025-09-03 18:45:25.410 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-03 18:45:25.467 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-09-03 18:45:26.149 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 18:45:26.225 +03:00 [INF] API key configured for HttpClient
2025-09-03 18:45:26.238 +03:00 [INF] Registered 13 endpoints in 1,149 milliseconds.
2025-09-03 18:45:26.247 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 18:45:26.284 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 18:45:26.376 +03:00 [DBG] Creating DbConnection.
2025-09-03 18:45:26.387 +03:00 [DBG] Created DbConnection. (8ms).
2025-09-03 18:45:26.390 +03:00 [DBG] Migrating using database 'main' on server 'schema_cache.db'.
2025-09-03 18:45:26.395 +03:00 [DBG] Creating DbConnection.
2025-09-03 18:45:26.398 +03:00 [DBG] Created DbConnection. (3ms).
2025-09-03 18:45:26.400 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:45:26.411 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:45:26.416 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:45:26.421 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-09-03 18:45:26.423 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:45:26.425 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:45:26.428 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-03 18:45:26.433 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 18:45:26.438 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (3ms).
2025-09-03 18:45:26.441 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (8ms).
2025-09-03 18:45:26.448 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 18:45:26.468 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 18:45:26.472 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 18:45:26.474 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 18:45:26.475 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 18:45:26.476 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 15:45:26.4725877+00:00');
SELECT changes();
2025-09-03 18:45:26.481 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 15:45:26.4725877+00:00');
SELECT changes();
2025-09-03 18:45:26.523 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 18:45:26.527 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 18:45:26.530 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-09-03 18:45:26.531 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (1ms).
2025-09-03 18:45:26.532 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (2ms).
2025-09-03 18:45:26.533 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 18:45:26.535 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 18:45:26.538 +03:00 [DBG] Committing transaction.
2025-09-03 18:45:26.539 +03:00 [DBG] Committed transaction.
2025-09-03 18:45:26.541 +03:00 [DBG] Disposing transaction.
2025-09-03 18:45:26.545 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 18:45:26.546 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 18:45:26.549 +03:00 [DBG] Creating DbConnection.
2025-09-03 18:45:26.549 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 18:45:26.550 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:45:26.552 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:45:26.553 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:45:26.554 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:45:26.556 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 18:45:26.557 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 18:45:26.558 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 18:45:26.559 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 18:45:26.561 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 18:45:26.564 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 18:45:26.564 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 18:45:26.566 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 18:45:26.567 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 18:45:26.569 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 18:45:26.573 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:45:26.575 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 3ms reading results.
2025-09-03 18:45:26.580 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-03 18:45:26.581 +03:00 [DBG] Committing transaction.
2025-09-03 18:45:26.582 +03:00 [DBG] Committed transaction.
2025-09-03 18:45:26.582 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 18:45:26.583 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 18:45:26.585 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 18:45:26.586 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 18:45:26.590 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 18:45:26.592 +03:00 [DBG] Disposing transaction.
2025-09-03 18:45:26.594 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:45:26.596 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-09-03 18:45:26.598 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 18:45:26.598 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:45:26.599 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 18:45:26.600 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 18:45:26.601 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 18:45:26.632 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-09-03 18:45:26.663 +03:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-09-03 18:45:26.665 +03:00 [DBG] Hosting starting
2025-09-03 18:45:26.679 +03:00 [DBG] Middleware loaded
2025-09-03 18:45:26.682 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-09-03 18:45:26.685 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-09-03 18:45:26.759 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-09-03 18:45:26.762 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-09-03 18:45:26.764 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-09-03 18:45:26.798 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-09-03 18:45:26.836 +03:00 [INF] Now listening on: https://localhost:7202
2025-09-03 18:45:26.837 +03:00 [INF] Now listening on: http://localhost:5000
2025-09-03 18:45:26.838 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-09-03 18:45:26.839 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-09-03 18:45:26.840 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-09-03 18:45:26.841 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-09-03 18:45:26.848 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 18:45:26.855 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 18:45:26.884 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-03 18:45:26.885 +03:00 [INF] Hosting environment: Development
2025-09-03 18:45:26.886 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-09-03 18:45:26.887 +03:00 [DBG] Hosting started
2025-09-03 18:48:29.929 +03:00 [INF] This is a test log to file!
2025-09-03 18:48:30.211 +03:00 [INF] Shared Kernal configured successfully.
2025-09-03 18:48:30.218 +03:00 [INF] API configured successfully.
2025-09-03 18:48:30.299 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-03 18:48:30.343 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-09-03 18:48:30.790 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 18:48:30.820 +03:00 [INF] API key configured for HttpClient
2025-09-03 18:48:30.830 +03:00 [INF] Registered 13 endpoints in 770 milliseconds.
2025-09-03 18:48:30.837 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 18:48:30.870 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 18:48:30.940 +03:00 [DBG] Creating DbConnection.
2025-09-03 18:48:30.950 +03:00 [DBG] Created DbConnection. (8ms).
2025-09-03 18:48:30.953 +03:00 [DBG] Migrating using database 'main' on server 'schema_cache.db'.
2025-09-03 18:48:30.957 +03:00 [DBG] Creating DbConnection.
2025-09-03 18:48:30.959 +03:00 [DBG] Created DbConnection. (2ms).
2025-09-03 18:48:30.961 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:48:30.969 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:48:30.972 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:48:30.975 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 18:48:30.976 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:48:30.979 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:48:30.981 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-03 18:48:30.985 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 18:48:30.989 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 18:48:30.991 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (5ms).
2025-09-03 18:48:30.996 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 18:48:31.018 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 18:48:31.021 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 18:48:31.023 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 18:48:31.024 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (3ms).
2025-09-03 18:48:31.025 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 15:48:31.0214684+00:00');
SELECT changes();
2025-09-03 18:48:31.031 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 15:48:31.0214684+00:00');
SELECT changes();
2025-09-03 18:48:31.069 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 18:48:31.072 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 18:48:31.074 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-09-03 18:48:31.074 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-09-03 18:48:31.075 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (1ms).
2025-09-03 18:48:31.076 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 18:48:31.078 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 18:48:31.080 +03:00 [DBG] Committing transaction.
2025-09-03 18:48:31.081 +03:00 [DBG] Committed transaction.
2025-09-03 18:48:31.083 +03:00 [DBG] Disposing transaction.
2025-09-03 18:48:31.085 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 18:48:31.086 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 18:48:31.088 +03:00 [DBG] Creating DbConnection.
2025-09-03 18:48:31.088 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 18:48:31.089 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:48:31.090 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:48:31.091 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:48:31.092 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 18:48:31.093 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 18:48:31.094 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 18:48:31.095 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 18:48:31.096 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 18:48:31.098 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 18:48:31.100 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 18:48:31.101 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 18:48:31.103 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 18:48:31.105 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 18:48:31.108 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 18:48:31.112 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:48:31.115 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 3ms reading results.
2025-09-03 18:48:31.119 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-03 18:48:31.120 +03:00 [DBG] Committing transaction.
2025-09-03 18:48:31.121 +03:00 [DBG] Committed transaction.
2025-09-03 18:48:31.122 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 18:48:31.124 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 18:48:31.124 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 18:48:31.126 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 18:48:31.130 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 18:48:31.132 +03:00 [DBG] Disposing transaction.
2025-09-03 18:48:31.133 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 18:48:31.136 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (3ms).
2025-09-03 18:48:31.137 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 18:48:31.138 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 18:48:31.139 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 18:48:31.140 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 18:48:31.141 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 18:48:31.161 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-09-03 18:48:31.187 +03:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-09-03 18:48:31.188 +03:00 [DBG] Hosting starting
2025-09-03 18:48:31.200 +03:00 [DBG] Middleware loaded
2025-09-03 18:48:31.203 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-09-03 18:48:31.205 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-09-03 18:48:31.270 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-09-03 18:48:31.271 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-09-03 18:48:31.274 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-09-03 18:48:31.299 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-09-03 18:48:31.357 +03:00 [INF] Now listening on: https://localhost:7202
2025-09-03 18:48:31.359 +03:00 [INF] Now listening on: http://localhost:5000
2025-09-03 18:48:31.359 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-09-03 18:48:31.360 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-09-03 18:48:31.361 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-09-03 18:48:31.362 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-09-03 18:48:31.369 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 18:48:31.377 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 18:48:31.402 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-03 18:48:31.405 +03:00 [INF] Hosting environment: Development
2025-09-03 18:48:31.405 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-09-03 18:48:31.406 +03:00 [DBG] Hosting started
2025-09-03 18:50:05.030 +03:00 [DBG] Connection id "0HNFB066GMJLM" accepted.
2025-09-03 18:50:05.057 +03:00 [DBG] Connection id "0HNFB066GMJLM" started.
2025-09-03 18:50:05.091 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/health - null null
2025-09-03 18:50:05.162 +03:00 [DBG] 1 candidate(s) found for the request path '/api/health'
2025-09-03 18:50:05.165 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/health'
2025-09-03 18:50:05.194 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-09-03 18:50:05.197 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/health'.
2025-09-03 18:50:05.201 +03:00 [DBG] Connection id "0HNFB066GMJLM" completed keep alive response.
2025-09-03 18:50:05.205 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/health - 307 0 null 118.0954ms
2025-09-03 18:50:05.228 +03:00 [DBG] Connection id "0HNFB066GMJLN" accepted.
2025-09-03 18:50:05.229 +03:00 [DBG] Connection id "0HNFB066GMJLN" started.
2025-09-03 18:50:05.262 +03:00 [DBG] Connection id "0HNFB066GMJLN" received FIN.
2025-09-03 18:50:05.359 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-09-03 18:50:05.366 +03:00 [DBG] Connection id "0HNFB066GMJLN" stopped.
2025-09-03 18:50:05.368 +03:00 [DBG] Connection id "0HNFB066GMJLN" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 18:50:07.272 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/health - null null
2025-09-03 18:50:07.275 +03:00 [DBG] 1 candidate(s) found for the request path '/api/health'
2025-09-03 18:50:07.276 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/health'
2025-09-03 18:50:07.278 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/health'.
2025-09-03 18:50:07.279 +03:00 [DBG] Connection id "0HNFB066GMJLM" completed keep alive response.
2025-09-03 18:50:07.279 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/health - 307 0 null 7.0859ms
2025-09-03 18:50:07.280 +03:00 [DBG] Connection id "0HNFB066GMJLO" accepted.
2025-09-03 18:50:07.283 +03:00 [DBG] Connection id "0HNFB066GMJLO" started.
2025-09-03 18:50:07.286 +03:00 [DBG] Connection id "0HNFB066GMJLO" received FIN.
2025-09-03 18:50:07.362 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-09-03 18:50:07.366 +03:00 [DBG] Connection id "0HNFB066GMJLO" stopped.
2025-09-03 18:50:07.368 +03:00 [DBG] Connection id "0HNFB066GMJLO" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 18:50:09.291 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/health - null null
2025-09-03 18:50:09.295 +03:00 [DBG] 1 candidate(s) found for the request path '/api/health'
2025-09-03 18:50:09.297 +03:00 [DBG] Request matched endpoint 'HTTP: GET api/health'
2025-09-03 18:50:09.298 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/health'.
2025-09-03 18:50:09.300 +03:00 [DBG] Connection id "0HNFB066GMJLM" completed keep alive response.
2025-09-03 18:50:09.301 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5000/api/health - 307 0 null 9.6886ms
2025-09-03 18:50:09.302 +03:00 [DBG] Connection id "0HNFB066GMJLP" accepted.
2025-09-03 18:50:09.305 +03:00 [DBG] Connection id "0HNFB066GMJLP" started.
2025-09-03 18:50:09.308 +03:00 [DBG] Connection id "0HNFB066GMJLP" received FIN.
2025-09-03 18:50:09.386 +03:00 [DBG] Failed to authenticate HTTPS connection.
System.IO.IOException: Received an unexpected EOF or 0 bytes from the transport stream.
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ProcessAuthenticationWithTelemetryAsync(Boolean isAsync, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Https.Internal.HttpsConnectionMiddleware.OnConnectionAsync(ConnectionContext context)
2025-09-03 18:50:09.388 +03:00 [DBG] Connection id "0HNFB066GMJLP" stopped.
2025-09-03 18:50:09.389 +03:00 [DBG] Connection id "0HNFB066GMJLP" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 22:20:19.272 +03:00 [INF] This is a test log to file!
2025-09-03 22:20:20.621 +03:00 [INF] Shared Kernal configured successfully.
2025-09-03 22:20:20.664 +03:00 [INF] API configured successfully.
2025-09-03 22:20:20.946 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-03 22:20:21.054 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-09-03 22:20:22.030 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:20:22.142 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:20:22.156 +03:00 [INF] Registered 13 endpoints in 2,366 milliseconds.
2025-09-03 22:20:22.166 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:20:22.234 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:20:22.403 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:20:22.420 +03:00 [DBG] Created DbConnection. (14ms).
2025-09-03 22:20:22.425 +03:00 [DBG] Migrating using database 'main' on server 'schema_cache.db'.
2025-09-03 22:20:22.438 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:20:22.443 +03:00 [DBG] Created DbConnection. (5ms).
2025-09-03 22:20:22.446 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:20:22.481 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:20:22.488 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:20:22.495 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-09-03 22:20:22.504 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:20:22.508 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:20:22.510 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-03 22:20:22.517 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:20:22.538 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (17ms).
2025-09-03 22:20:22.540 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (23ms).
2025-09-03 22:20:22.561 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 22:20:22.604 +03:00 [INF] Executed DbCommand (39ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 22:20:22.617 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:20:22.618 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 22:20:22.619 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 22:20:22.620 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 19:20:22.6170153+00:00');
SELECT changes();
2025-09-03 22:20:22.642 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 19:20:22.6170153+00:00');
SELECT changes();
2025-09-03 22:20:22.689 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 22:20:22.693 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 22:20:22.695 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-09-03 22:20:22.696 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (1ms).
2025-09-03 22:20:22.698 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (3ms).
2025-09-03 22:20:22.701 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 22:20:22.704 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 22:20:22.707 +03:00 [DBG] Committing transaction.
2025-09-03 22:20:22.709 +03:00 [DBG] Committed transaction.
2025-09-03 22:20:22.710 +03:00 [DBG] Disposing transaction.
2025-09-03 22:20:22.713 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 22:20:22.714 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 22:20:22.716 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:20:22.717 +03:00 [DBG] Created DbConnection. (1ms).
2025-09-03 22:20:22.719 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:20:22.720 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:20:22.722 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:20:22.723 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:20:22.725 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:20:22.726 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 22:20:22.727 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 22:20:22.729 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 22:20:22.731 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 22:20:22.734 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:20:22.735 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:20:22.737 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:20:22.739 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 22:20:22.742 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 22:20:22.748 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:20:22.751 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 5ms reading results.
2025-09-03 22:20:22.758 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-03 22:20:22.759 +03:00 [DBG] Committing transaction.
2025-09-03 22:20:22.761 +03:00 [DBG] Committed transaction.
2025-09-03 22:20:22.762 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:20:22.763 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 22:20:22.765 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 22:20:22.766 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 22:20:22.770 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 22:20:22.772 +03:00 [DBG] Disposing transaction.
2025-09-03 22:20:22.774 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:20:22.778 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (4ms).
2025-09-03 22:20:22.780 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:20:22.781 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:20:22.782 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:20:22.784 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 22:20:22.785 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 22:20:22.818 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-09-03 22:20:22.851 +03:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-09-03 22:20:22.858 +03:00 [DBG] Hosting starting
2025-09-03 22:20:22.886 +03:00 [DBG] Middleware loaded
2025-09-03 22:20:22.890 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-09-03 22:20:22.895 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-09-03 22:20:22.993 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-09-03 22:20:22.995 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-09-03 22:20:22.997 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-09-03 22:20:23.052 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-09-03 22:20:23.138 +03:00 [INF] Now listening on: https://localhost:7202
2025-09-03 22:20:23.149 +03:00 [INF] Now listening on: http://localhost:5000
2025-09-03 22:20:23.150 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-09-03 22:20:23.151 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-09-03 22:20:23.152 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-09-03 22:20:23.153 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-09-03 22:20:23.170 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 22:20:23.181 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 22:20:23.308 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-03 22:20:23.310 +03:00 [INF] Hosting environment: Development
2025-09-03 22:20:23.311 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-09-03 22:20:23.313 +03:00 [DBG] Hosting started
2025-09-03 22:20:34.842 +03:00 [DBG] Connection id "0HNFB3RQFV9HF" received FIN.
2025-09-03 22:20:34.849 +03:00 [DBG] Connection id "0HNFB3RQFV9HF" accepted.
2025-09-03 22:20:34.852 +03:00 [DBG] Connection id "0HNFB3RQFV9HF" started.
2025-09-03 22:20:34.853 +03:00 [DBG] Connection id "0HNFB3RQFV9HG" accepted.
2025-09-03 22:20:34.855 +03:00 [DBG] Connection id "0HNFB3RQFV9HG" started.
2025-09-03 22:20:34.863 +03:00 [DBG] Connection id "0HNFB3RQFV9HF" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 22:20:34.866 +03:00 [DBG] Connection id "0HNFB3RQFV9HF" disconnecting.
2025-09-03 22:20:34.868 +03:00 [DBG] Connection id "0HNFB3RQFV9HF" stopped.
2025-09-03 22:20:34.889 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 208
2025-09-03 22:20:34.947 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:20:34.951 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:20:34.954 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:20:34.997 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-09-03 22:20:35.001 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 22:20:35.011 +03:00 [DBG] Connection id "0HNFB3RQFV9HG" completed keep alive response.
2025-09-03 22:20:35.015 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 131.2348ms
2025-09-03 22:20:35.019 +03:00 [DBG] Connection id "0HNFB3RQFV9HH" accepted.
2025-09-03 22:20:35.019 +03:00 [DBG] Connection id "0HNFB3RQFV9HH" received FIN.
2025-09-03 22:20:35.026 +03:00 [DBG] Connection id "0HNFB3RQFV9HH" started.
2025-09-03 22:20:35.019 +03:00 [DBG] Connection id "0HNFB3RQFV9HI" accepted.
2025-09-03 22:20:35.033 +03:00 [DBG] Connection id "0HNFB3RQFV9HG", Request id "0HNFB3RQFV9HG:00000001": started reading request body.
2025-09-03 22:20:35.035 +03:00 [DBG] Connection id "0HNFB3RQFV9HH" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 22:20:35.035 +03:00 [DBG] Connection id "0HNFB3RQFV9HI" started.
2025-09-03 22:20:35.037 +03:00 [DBG] Connection id "0HNFB3RQFV9HG", Request id "0HNFB3RQFV9HG:00000001": done reading request body.
2025-09-03 22:20:35.038 +03:00 [DBG] Connection id "0HNFB3RQFV9HH" disconnecting.
2025-09-03 22:20:35.041 +03:00 [DBG] Connection id "0HNFB3RQFV9HH" stopped.
2025-09-03 22:20:35.084 +03:00 [DBG] Connection 0HNFB3RQFV9HI established using the following protocol: "Tls13"
2025-09-03 22:20:35.089 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 208
2025-09-03 22:20:35.094 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:20:35.095 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:20:35.097 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:20:35.101 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:20:35.121 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:20:35.125 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:20:35.172 +03:00 [DBG] Connection id "0HNFB3RQFV9HI", Request id "0HNFB3RQFV9HI:00000001": started reading request body.
2025-09-03 22:20:35.175 +03:00 [DBG] Connection id "0HNFB3RQFV9HI", Request id "0HNFB3RQFV9HI:00000001": done reading request body.
2025-09-03 22:20:35.214 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:20:35.280 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-09-03 22:20:35.336 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-09-03 22:20:35.640 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<DatabaseName>k__BackingField = dataReader.GetString(3);
                                        instance.<Name>k__BackingField = dataReader.GetString(4);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(5));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(6);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(7) ? default(Guid?) : (Guid?)dataReader.GetGuid(7) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(7) ? default(object) : (object)dataReader.GetGuid(7) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(8) ? default(Guid) : dataReader.GetGuid(8);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(10) ? default(string) : dataReader.GetString(10);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(11) ? default(DateTime) : dataReader.GetDateTime(11);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(12) ? default(string) : dataReader.GetString(12);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-09-03 22:20:35.668 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:20:35.669 +03:00 [DBG] Created DbConnection. (1ms).
2025-09-03 22:20:35.671 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:20:35.673 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:20:35.675 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:20:35.676 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:20:35.678 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:20:35.682 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:20:35.691 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:20:35.727 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:20:35.761 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:20:35.771 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:20:35.773 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:20:35.775 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:20:35.776 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:20:35.780 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:20:35.781 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 87ms reading results.
2025-09-03 22:20:35.783 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:20:35.784 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:20:35.797 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:20:35.800 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:20:35.802 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:20:35.803 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:20:35.804 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:20:35.805 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:20:35.806 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:20:35.808 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:20:35.811 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:20:35.812 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 22:20:35.813 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:20:35.815 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:20:35.829 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:20:35.855 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 22:20:35.857 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 22:20:35.973 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 22:20:35.991 +03:00 [INF] Converting natural language to SQL. User query: insert a product entry id = (generate random uuid id of yours), name = mario, stock = 200, price = 1500, categoryId = get the id of the first category entry
2025-09-03 22:20:35.994 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 22:20:35.995 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 22:20:36.004 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 22:21:07.089 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 22:21:07.315 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 22:21:07.340 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:21:07.344 +03:00 [DBG] Connection id "0HNFB3RQFV9HI" completed keep alive response.
2025-09-03 22:21:07.347 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:21:07.350 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:21:07.351 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:21:07.354 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 32264.3905ms
2025-09-03 22:21:29.106 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 69
2025-09-03 22:21:29.110 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:21:29.112 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:21:29.114 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:21:29.116 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 22:21:29.117 +03:00 [DBG] Connection id "0HNFB3RQFV9HG" completed keep alive response.
2025-09-03 22:21:29.118 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 11.8775ms
2025-09-03 22:21:29.123 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 69
2025-09-03 22:21:29.125 +03:00 [DBG] Connection id "0HNFB3RQFV9HG", Request id "0HNFB3RQFV9HG:00000002": started reading request body.
2025-09-03 22:21:29.127 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:21:29.128 +03:00 [DBG] Connection id "0HNFB3RQFV9HG", Request id "0HNFB3RQFV9HG:00000002": done reading request body.
2025-09-03 22:21:29.129 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:21:29.132 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:21:29.133 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:21:29.135 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:21:29.137 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:21:29.137 +03:00 [DBG] Connection id "0HNFB3RQFV9HI", Request id "0HNFB3RQFV9HI:00000002": started reading request body.
2025-09-03 22:21:29.139 +03:00 [DBG] Connection id "0HNFB3RQFV9HI", Request id "0HNFB3RQFV9HI:00000002": done reading request body.
2025-09-03 22:21:29.140 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:21:29.142 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:21:29.143 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 22:21:29.143 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:21:29.144 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:21:29.145 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:21:29.146 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:21:29.148 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:21:29.149 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:21:29.150 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:21:29.153 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:21:29.154 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:21:29.155 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:21:29.156 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:21:29.157 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:21:29.159 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:21:29.160 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:21:29.161 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 8ms reading results.
2025-09-03 22:21:29.163 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:21:29.164 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:21:29.165 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:21:29.166 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:21:29.167 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:21:29.169 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:21:29.169 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:21:29.170 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:21:29.171 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:21:29.173 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:21:29.175 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:21:29.176 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 22:21:29.177 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:21:29.178 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:21:29.180 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:21:29.181 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 22:21:29.182 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 22:21:29.184 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 22:21:29.186 +03:00 [INF] Converting natural language to SQL. User query: show all products
2025-09-03 22:21:29.186 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 22:21:29.187 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 22:21:29.189 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 22:21:42.116 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 22:21:42.158 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 22:21:42.160 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:21:42.161 +03:00 [DBG] Connection id "0HNFB3RQFV9HI" completed keep alive response.
2025-09-03 22:21:42.162 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:21:42.163 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:21:42.164 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:21:42.165 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 13041.5631ms
2025-09-03 22:25:47.676 +03:00 [DBG] Connection id "0HNFB3RQFV9HJ" received FIN.
2025-09-03 22:25:47.678 +03:00 [DBG] Connection id "0HNFB3RQFV9HJ" accepted.
2025-09-03 22:25:47.686 +03:00 [DBG] Connection id "0HNFB3RQFV9HJ" started.
2025-09-03 22:25:47.687 +03:00 [DBG] Connection id "0HNFB3RQFV9HK" accepted.
2025-09-03 22:25:47.694 +03:00 [DBG] Connection id "0HNFB3RQFV9HJ" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 22:25:47.695 +03:00 [DBG] Connection id "0HNFB3RQFV9HK" started.
2025-09-03 22:25:47.696 +03:00 [DBG] Connection id "0HNFB3RQFV9HJ" disconnecting.
2025-09-03 22:25:47.697 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 69
2025-09-03 22:25:47.698 +03:00 [DBG] Connection id "0HNFB3RQFV9HJ" stopped.
2025-09-03 22:25:47.700 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:25:47.702 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:25:47.703 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:25:47.705 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 22:25:47.706 +03:00 [DBG] Connection id "0HNFB3RQFV9HK" completed keep alive response.
2025-09-03 22:25:47.707 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 9.9191ms
2025-09-03 22:25:47.707 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 69
2025-09-03 22:25:47.710 +03:00 [DBG] Connection id "0HNFB3RQFV9HK", Request id "0HNFB3RQFV9HK:00000001": started reading request body.
2025-09-03 22:25:47.712 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:25:47.713 +03:00 [DBG] Connection id "0HNFB3RQFV9HK", Request id "0HNFB3RQFV9HK:00000001": done reading request body.
2025-09-03 22:25:47.714 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:25:47.717 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:25:47.719 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:25:47.720 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:25:47.722 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:25:47.722 +03:00 [DBG] Connection id "0HNFB3RQFV9HI", Request id "0HNFB3RQFV9HI:00000003": started reading request body.
2025-09-03 22:25:47.724 +03:00 [DBG] Connection id "0HNFB3RQFV9HI", Request id "0HNFB3RQFV9HI:00000003": done reading request body.
2025-09-03 22:25:47.726 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:25:47.728 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:25:47.729 +03:00 [DBG] Created DbConnection. (1ms).
2025-09-03 22:25:47.730 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:25:47.733 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:25:47.734 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:25:47.735 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:25:47.737 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:25:47.738 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:25:47.741 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:25:47.743 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:25:47.744 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:25:47.746 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:25:47.748 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:25:47.749 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:25:47.750 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:25:47.751 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:25:47.753 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 9ms reading results.
2025-09-03 22:25:47.754 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:25:47.755 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:25:47.757 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:25:47.758 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:25:47.759 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:25:47.761 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:25:47.761 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:25:47.763 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:25:47.764 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:25:47.766 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:25:47.768 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:25:47.769 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 22:25:47.770 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:25:47.772 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:25:47.774 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:25:47.775 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 22:25:47.775 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 22:25:47.778 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 22:25:47.779 +03:00 [INF] Converting natural language to SQL. User query: show all products
2025-09-03 22:25:47.780 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 22:25:47.781 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 22:25:47.784 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 22:26:20.301 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 22:26:20.347 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 22:26:20.349 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:26:20.354 +03:00 [DBG] Connection id "0HNFB3RQFV9HI" completed keep alive response.
2025-09-03 22:26:20.355 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:26:20.355 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:26:20.356 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 22:26:20.357 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 32650.2459ms
2025-09-03 22:26:45.108 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 69
2025-09-03 22:26:45.114 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:26:45.116 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:26:45.118 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:26:45.119 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 22:26:45.120 +03:00 [DBG] Connection id "0HNFB3RQFV9HK" completed keep alive response.
2025-09-03 22:26:45.121 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 13.6191ms
2025-09-03 22:26:45.146 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 69
2025-09-03 22:26:45.148 +03:00 [DBG] Connection id "0HNFB3RQFV9HK", Request id "0HNFB3RQFV9HK:00000002": started reading request body.
2025-09-03 22:26:45.150 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:26:45.151 +03:00 [DBG] Connection id "0HNFB3RQFV9HK", Request id "0HNFB3RQFV9HK:00000002": done reading request body.
2025-09-03 22:26:45.153 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:26:45.155 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:26:45.156 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:26:45.158 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:26:45.160 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:26:45.161 +03:00 [DBG] Connection id "0HNFB3RQFV9HI", Request id "0HNFB3RQFV9HI:00000004": started reading request body.
2025-09-03 22:26:45.162 +03:00 [DBG] Connection id "0HNFB3RQFV9HI", Request id "0HNFB3RQFV9HI:00000004": done reading request body.
2025-09-03 22:26:45.164 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:26:45.165 +03:00 [DBG] Connection id "0HNFB3RQFV9HI" completed keep alive response.
2025-09-03 22:26:45.166 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:26:45.168 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 44.4978ms
2025-09-03 22:26:53.025 +03:00 [INF] This is a test log to file!
2025-09-03 22:26:53.301 +03:00 [INF] Shared Kernal configured successfully.
2025-09-03 22:26:53.310 +03:00 [INF] API configured successfully.
2025-09-03 22:26:53.391 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-03 22:26:53.440 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-09-03 22:26:53.842 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:26:53.874 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:26:53.883 +03:00 [INF] Registered 13 endpoints in 751 milliseconds.
2025-09-03 22:26:53.890 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:26:53.922 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:26:53.991 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:26:54.001 +03:00 [DBG] Created DbConnection. (8ms).
2025-09-03 22:26:54.005 +03:00 [DBG] Migrating using database 'main' on server 'schema_cache.db'.
2025-09-03 22:26:54.010 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:26:54.012 +03:00 [DBG] Created DbConnection. (2ms).
2025-09-03 22:26:54.013 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:26:54.021 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:26:54.024 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:26:54.028 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:26:54.029 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:26:54.032 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:26:54.034 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-03 22:26:54.038 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:26:54.042 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 22:26:54.044 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (6ms).
2025-09-03 22:26:54.048 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 22:26:54.067 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 22:26:54.071 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:26:54.072 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 22:26:54.073 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 22:26:54.074 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 19:26:54.0709908+00:00');
SELECT changes();
2025-09-03 22:26:54.084 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 19:26:54.0709908+00:00');
SELECT changes();
2025-09-03 22:26:54.122 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 22:26:54.125 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 22:26:54.128 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-09-03 22:26:54.128 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-09-03 22:26:54.130 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (2ms).
2025-09-03 22:26:54.131 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 22:26:54.133 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 22:26:54.135 +03:00 [DBG] Committing transaction.
2025-09-03 22:26:54.136 +03:00 [DBG] Committed transaction.
2025-09-03 22:26:54.138 +03:00 [DBG] Disposing transaction.
2025-09-03 22:26:54.139 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 22:26:54.140 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 22:26:54.142 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:26:54.143 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 22:26:54.143 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:26:54.145 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:26:54.146 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:26:54.147 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:26:54.148 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:26:54.149 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 22:26:54.150 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 22:26:54.151 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 22:26:54.153 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 22:26:54.155 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:26:54.156 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:26:54.157 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:26:54.158 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 22:26:54.160 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 22:26:54.164 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:26:54.165 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-09-03 22:26:54.169 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-03 22:26:54.170 +03:00 [DBG] Committing transaction.
2025-09-03 22:26:54.171 +03:00 [DBG] Committed transaction.
2025-09-03 22:26:54.171 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:26:54.172 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 22:26:54.173 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 22:26:54.174 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 22:26:54.178 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 22:26:54.179 +03:00 [DBG] Disposing transaction.
2025-09-03 22:26:54.181 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:26:54.183 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-09-03 22:26:54.185 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:26:54.186 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:26:54.187 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 22:26:54.188 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 22:26:54.188 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 22:26:54.209 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-09-03 22:26:54.235 +03:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-09-03 22:26:54.237 +03:00 [DBG] Hosting starting
2025-09-03 22:26:54.247 +03:00 [DBG] Middleware loaded
2025-09-03 22:26:54.250 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-09-03 22:26:54.252 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-09-03 22:26:54.315 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-09-03 22:26:54.317 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-09-03 22:26:54.321 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-09-03 22:26:54.348 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-09-03 22:26:54.425 +03:00 [INF] Now listening on: https://localhost:7202
2025-09-03 22:26:54.426 +03:00 [INF] Now listening on: http://localhost:5000
2025-09-03 22:26:54.427 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-09-03 22:26:54.428 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-09-03 22:26:54.428 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-09-03 22:26:54.429 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-09-03 22:26:54.435 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 22:26:54.441 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 22:26:54.522 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-03 22:26:54.524 +03:00 [INF] Hosting environment: Development
2025-09-03 22:26:54.525 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-09-03 22:26:54.526 +03:00 [DBG] Hosting started
2025-09-03 22:26:56.316 +03:00 [DBG] Connection id "0HNFB3VC5VSAJ" received FIN.
2025-09-03 22:26:56.326 +03:00 [DBG] Connection id "0HNFB3VC5VSAJ" accepted.
2025-09-03 22:26:56.329 +03:00 [DBG] Connection id "0HNFB3VC5VSAJ" started.
2025-09-03 22:26:56.338 +03:00 [DBG] Connection id "0HNFB3VC5VSAK" accepted.
2025-09-03 22:26:56.343 +03:00 [DBG] Connection id "0HNFB3VC5VSAK" started.
2025-09-03 22:26:56.348 +03:00 [DBG] Connection id "0HNFB3VC5VSAJ" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 22:26:56.353 +03:00 [DBG] Connection id "0HNFB3VC5VSAJ" disconnecting.
2025-09-03 22:26:56.355 +03:00 [DBG] Connection id "0HNFB3VC5VSAJ" stopped.
2025-09-03 22:26:56.373 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 69
2025-09-03 22:26:56.424 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:26:56.426 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:26:56.428 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:26:56.458 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-09-03 22:26:56.461 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 22:26:56.468 +03:00 [DBG] Connection id "0HNFB3VC5VSAK" completed keep alive response.
2025-09-03 22:26:56.471 +03:00 [DBG] Connection id "0HNFB3VC5VSAL" accepted.
2025-09-03 22:26:56.472 +03:00 [DBG] Connection id "0HNFB3VC5VSAL" received FIN.
2025-09-03 22:26:56.472 +03:00 [DBG] Connection id "0HNFB3VC5VSAM" accepted.
2025-09-03 22:26:56.471 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 103.3223ms
2025-09-03 22:26:56.479 +03:00 [DBG] Connection id "0HNFB3VC5VSAL" started.
2025-09-03 22:26:56.481 +03:00 [DBG] Connection id "0HNFB3VC5VSAM" started.
2025-09-03 22:26:56.485 +03:00 [DBG] Connection id "0HNFB3VC5VSAL" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 22:26:56.486 +03:00 [DBG] Connection id "0HNFB3VC5VSAK", Request id "0HNFB3VC5VSAK:00000001": started reading request body.
2025-09-03 22:26:56.487 +03:00 [DBG] Connection id "0HNFB3VC5VSAL" disconnecting.
2025-09-03 22:26:56.488 +03:00 [DBG] Connection id "0HNFB3VC5VSAK", Request id "0HNFB3VC5VSAK:00000001": done reading request body.
2025-09-03 22:26:56.489 +03:00 [DBG] Connection id "0HNFB3VC5VSAL" stopped.
2025-09-03 22:26:56.523 +03:00 [DBG] Connection 0HNFB3VC5VSAM established using the following protocol: "Tls13"
2025-09-03 22:26:56.526 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 69
2025-09-03 22:26:56.530 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:26:56.531 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:26:56.532 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:26:56.535 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:26:56.556 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:26:56.559 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:26:56.591 +03:00 [DBG] Connection id "0HNFB3VC5VSAM", Request id "0HNFB3VC5VSAM:00000001": started reading request body.
2025-09-03 22:26:56.592 +03:00 [DBG] Connection id "0HNFB3VC5VSAM", Request id "0HNFB3VC5VSAM:00000001": done reading request body.
2025-09-03 22:26:56.622 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:26:56.698 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-09-03 22:26:56.741 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-09-03 22:26:56.976 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<DatabaseName>k__BackingField = dataReader.GetString(3);
                                        instance.<Name>k__BackingField = dataReader.GetString(4);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(5));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(6);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(7) ? default(Guid?) : (Guid?)dataReader.GetGuid(7) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(7) ? default(object) : (object)dataReader.GetGuid(7) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(8) ? default(Guid) : dataReader.GetGuid(8);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(10) ? default(string) : dataReader.GetString(10);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(11) ? default(DateTime) : dataReader.GetDateTime(11);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(12) ? default(string) : dataReader.GetString(12);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-09-03 22:26:57.012 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:26:57.018 +03:00 [DBG] Created DbConnection. (5ms).
2025-09-03 22:26:57.020 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:26:57.022 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:26:57.023 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:26:57.024 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:26:57.036 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2025-09-03 22:26:57.039 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:26:57.047 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:26:57.082 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:26:57.126 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:26:57.137 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:26:57.138 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:26:57.139 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:26:57.141 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:26:57.144 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:26:57.145 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 94ms reading results.
2025-09-03 22:26:57.148 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:26:57.150 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:26:57.165 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:26:57.168 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:26:57.169 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:26:57.172 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:26:57.173 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:26:57.175 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:26:57.176 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:26:57.178 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:26:57.181 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:26:57.182 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 22:26:57.184 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:26:57.185 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 22:26:57.195 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:26:57.206 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 22:26:57.209 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 22:26:57.320 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 22:26:57.340 +03:00 [INF] Converting natural language to SQL. User query: show all products
2025-09-03 22:26:57.343 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 22:26:57.344 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 22:26:57.353 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 22:27:15.199 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 22:27:15.267 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 22:27:15.277 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:27:15.281 +03:00 [DBG] Connection id "0HNFB3VC5VSAM" completed keep alive response.
2025-09-03 22:27:15.285 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:27:15.288 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:27:15.290 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:27:15.292 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 18765.4871ms
2025-09-03 22:27:24.545 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 71
2025-09-03 22:27:24.547 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:27:24.549 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:27:24.550 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:27:24.552 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 22:27:24.553 +03:00 [DBG] Connection id "0HNFB3VC5VSAK" completed keep alive response.
2025-09-03 22:27:24.554 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 9.5038ms
2025-09-03 22:27:24.560 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 71
2025-09-03 22:27:24.561 +03:00 [DBG] Connection id "0HNFB3VC5VSAK", Request id "0HNFB3VC5VSAK:00000002": started reading request body.
2025-09-03 22:27:24.564 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:27:24.565 +03:00 [DBG] Connection id "0HNFB3VC5VSAK", Request id "0HNFB3VC5VSAK:00000002": done reading request body.
2025-09-03 22:27:24.566 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:27:24.569 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:27:24.570 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:27:24.572 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:27:24.574 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:27:24.575 +03:00 [DBG] Connection id "0HNFB3VC5VSAM", Request id "0HNFB3VC5VSAM:00000002": started reading request body.
2025-09-03 22:27:24.577 +03:00 [DBG] Connection id "0HNFB3VC5VSAM", Request id "0HNFB3VC5VSAM:00000002": done reading request body.
2025-09-03 22:27:24.578 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:27:24.580 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:27:24.581 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 22:27:24.582 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:27:24.583 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:27:24.585 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:27:24.586 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:27:24.587 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:27:24.588 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:27:24.590 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:27:24.593 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:27:24.594 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:27:24.595 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:27:24.597 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:27:24.598 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:27:24.599 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:27:24.601 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:27:24.602 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 10ms reading results.
2025-09-03 22:27:24.604 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:27:24.605 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:27:24.607 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:27:24.608 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:27:24.610 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:27:24.611 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:27:24.612 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:27:24.614 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:27:24.615 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:27:24.617 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:27:24.619 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:27:24.620 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 22:27:24.622 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:27:24.623 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:27:24.625 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:27:24.626 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 22:27:24.628 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 22:27:24.630 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 22:27:24.631 +03:00 [INF] Converting natural language to SQL. User query: show all categories
2025-09-03 22:27:24.632 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 22:27:24.633 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 22:27:24.635 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 22:27:31.852 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 22:27:31.894 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 22:27:31.897 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:27:31.898 +03:00 [DBG] Connection id "0HNFB3VC5VSAM" completed keep alive response.
2025-09-03 22:27:31.899 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:27:31.900 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:27:31.901 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:27:31.902 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 7342.5408ms
2025-09-03 22:27:45.638 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 71
2025-09-03 22:27:45.641 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:27:45.642 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:27:45.644 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:27:45.645 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 22:27:45.646 +03:00 [DBG] Connection id "0HNFB3VC5VSAK" completed keep alive response.
2025-09-03 22:27:45.648 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 9.8375ms
2025-09-03 22:27:45.673 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 71
2025-09-03 22:27:45.675 +03:00 [DBG] Connection id "0HNFB3VC5VSAK", Request id "0HNFB3VC5VSAK:00000003": started reading request body.
2025-09-03 22:27:45.678 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:27:45.679 +03:00 [DBG] Connection id "0HNFB3VC5VSAK", Request id "0HNFB3VC5VSAK:00000003": done reading request body.
2025-09-03 22:27:45.680 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:27:45.683 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:27:45.685 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:27:45.688 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:27:45.690 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:27:45.691 +03:00 [DBG] Connection id "0HNFB3VC5VSAM", Request id "0HNFB3VC5VSAM:00000003": started reading request body.
2025-09-03 22:27:45.693 +03:00 [DBG] Connection id "0HNFB3VC5VSAM", Request id "0HNFB3VC5VSAM:00000003": done reading request body.
2025-09-03 22:27:45.695 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:27:45.696 +03:00 [DBG] Connection id "0HNFB3VC5VSAM" completed keep alive response.
2025-09-03 22:27:45.697 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:27:45.699 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 25.8553ms
2025-09-03 22:27:52.986 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 69
2025-09-03 22:27:52.988 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:27:52.989 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:27:52.991 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:27:52.992 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 22:27:52.993 +03:00 [DBG] Connection id "0HNFB3VC5VSAK" completed keep alive response.
2025-09-03 22:27:52.995 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 8.7891ms
2025-09-03 22:27:52.995 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 69
2025-09-03 22:27:52.997 +03:00 [DBG] Connection id "0HNFB3VC5VSAK", Request id "0HNFB3VC5VSAK:00000004": started reading request body.
2025-09-03 22:27:52.999 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:27:53.000 +03:00 [DBG] Connection id "0HNFB3VC5VSAK", Request id "0HNFB3VC5VSAK:00000004": done reading request body.
2025-09-03 22:27:53.001 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:27:53.003 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:27:53.004 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:27:53.005 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:27:53.007 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:27:53.008 +03:00 [DBG] Connection id "0HNFB3VC5VSAM", Request id "0HNFB3VC5VSAM:00000004": started reading request body.
2025-09-03 22:27:53.009 +03:00 [DBG] Connection id "0HNFB3VC5VSAM", Request id "0HNFB3VC5VSAM:00000004": done reading request body.
2025-09-03 22:27:53.010 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:27:53.012 +03:00 [DBG] Connection id "0HNFB3VC5VSAM" completed keep alive response.
2025-09-03 22:27:53.013 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:27:53.014 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 18.7222ms
2025-09-03 22:28:06.678 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 101
2025-09-03 22:28:06.682 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:28:06.683 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:28:06.685 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:28:06.686 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 22:28:06.687 +03:00 [DBG] Connection id "0HNFB3VC5VSAK" completed keep alive response.
2025-09-03 22:28:06.688 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 9.7529ms
2025-09-03 22:28:06.689 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 101
2025-09-03 22:28:06.692 +03:00 [DBG] Connection id "0HNFB3VC5VSAK", Request id "0HNFB3VC5VSAK:00000005": started reading request body.
2025-09-03 22:28:06.693 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:28:06.695 +03:00 [DBG] Connection id "0HNFB3VC5VSAK", Request id "0HNFB3VC5VSAK:00000005": done reading request body.
2025-09-03 22:28:06.695 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:28:06.698 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:28:06.699 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:28:06.700 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:28:06.703 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:28:06.703 +03:00 [DBG] Connection id "0HNFB3VC5VSAM", Request id "0HNFB3VC5VSAM:00000005": started reading request body.
2025-09-03 22:28:06.704 +03:00 [DBG] Connection id "0HNFB3VC5VSAM", Request id "0HNFB3VC5VSAM:00000005": done reading request body.
2025-09-03 22:28:06.705 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:28:06.707 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:28:06.707 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 22:28:06.709 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:28:06.710 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:28:06.711 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:28:06.712 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:28:06.713 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:28:06.714 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:28:06.716 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:28:06.718 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:28:06.719 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:28:06.720 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:28:06.721 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:28:06.723 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:28:06.724 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:28:06.725 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:28:06.727 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 9ms reading results.
2025-09-03 22:28:06.728 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:28:06.729 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 22:28:06.731 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:28:06.732 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:28:06.733 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:28:06.734 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:28:06.735 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:28:06.736 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:28:06.737 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:28:06.738 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:28:06.740 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:28:06.741 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 22:28:06.743 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:28:06.743 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 22:28:06.745 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:28:06.746 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 22:28:06.747 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 22:28:06.749 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 22:28:06.750 +03:00 [INF] Converting natural language to SQL. User query: show all products in the first category you fetch
2025-09-03 22:28:06.751 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 22:28:06.752 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 22:28:06.753 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 22:28:27.645 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 22:28:27.691 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 22:28:27.693 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:28:27.700 +03:00 [DBG] Connection id "0HNFB3VC5VSAM" completed keep alive response.
2025-09-03 22:28:27.702 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:28:27.703 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:28:27.704 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:28:27.705 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 21016.6895ms
2025-09-03 22:32:40.346 +03:00 [DBG] Config reload token fired. Checking for changes...
2025-09-03 22:32:40.348 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-09-03 22:32:40.349 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-09-03 22:32:40.602 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-09-03 22:32:40.603 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-09-03 22:32:40.604 +03:00 [DBG] Config reload token fired. Checking for changes...
2025-09-03 22:32:42.311 +03:00 [DBG] Connection id "0HNFB3VC5VSAN" accepted.
2025-09-03 22:32:42.311 +03:00 [DBG] Connection id "0HNFB3VC5VSAN" received FIN.
2025-09-03 22:32:42.314 +03:00 [DBG] Connection id "0HNFB3VC5VSAO" accepted.
2025-09-03 22:32:42.313 +03:00 [DBG] Connection id "0HNFB3VC5VSAN" started.
2025-09-03 22:32:42.327 +03:00 [DBG] Connection id "0HNFB3VC5VSAO" started.
2025-09-03 22:32:42.327 +03:00 [DBG] Connection id "0HNFB3VC5VSAN" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 22:32:42.328 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 101
2025-09-03 22:32:42.329 +03:00 [DBG] Connection id "0HNFB3VC5VSAN" disconnecting.
2025-09-03 22:32:42.331 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:32:42.332 +03:00 [DBG] Connection id "0HNFB3VC5VSAN" stopped.
2025-09-03 22:32:42.333 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:32:42.335 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:32:42.336 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 22:32:42.337 +03:00 [DBG] Connection id "0HNFB3VC5VSAO" completed keep alive response.
2025-09-03 22:32:42.338 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 9.5591ms
2025-09-03 22:32:42.338 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 101
2025-09-03 22:32:42.340 +03:00 [DBG] Connection id "0HNFB3VC5VSAO", Request id "0HNFB3VC5VSAO:00000001": started reading request body.
2025-09-03 22:32:42.342 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:32:42.343 +03:00 [DBG] Connection id "0HNFB3VC5VSAO", Request id "0HNFB3VC5VSAO:00000001": done reading request body.
2025-09-03 22:32:42.344 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:32:42.346 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:32:42.348 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:32:42.349 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:32:42.351 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:32:42.352 +03:00 [DBG] Connection id "0HNFB3VC5VSAM", Request id "0HNFB3VC5VSAM:00000006": started reading request body.
2025-09-03 22:32:42.353 +03:00 [DBG] Connection id "0HNFB3VC5VSAM", Request id "0HNFB3VC5VSAM:00000006": done reading request body.
2025-09-03 22:32:42.355 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:32:42.357 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:32:42.358 +03:00 [DBG] Created DbConnection. (1ms).
2025-09-03 22:32:42.359 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:32:42.360 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:32:42.361 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:32:42.363 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:32:42.364 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:32:42.365 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:32:42.368 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:32:42.371 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:32:42.372 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:32:42.373 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:32:42.375 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:32:42.376 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:32:42.377 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:32:42.379 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:32:42.380 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 9ms reading results.
2025-09-03 22:32:42.382 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:32:42.383 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:32:42.384 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:32:42.386 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:32:42.387 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:32:42.388 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:32:42.389 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:32:42.390 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:32:42.392 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:32:42.394 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:32:42.396 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:32:42.398 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 22:32:42.399 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:32:42.400 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 22:32:42.402 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:32:42.403 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 22:32:42.404 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 22:32:42.406 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 22:32:42.407 +03:00 [INF] Converting natural language to SQL. User query: show all products in the first category you fetch
2025-09-03 22:32:42.408 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 22:32:42.408 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 22:32:42.409 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 22:32:50.607 +03:00 [INF] This is a test log to file!
2025-09-03 22:32:50.861 +03:00 [INF] Shared Kernal configured successfully.
2025-09-03 22:32:50.868 +03:00 [INF] API configured successfully.
2025-09-03 22:32:50.940 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-03 22:32:50.989 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-09-03 22:32:51.407 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:32:51.439 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:32:51.446 +03:00 [INF] Registered 13 endpoints in 741 milliseconds.
2025-09-03 22:32:51.453 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:32:51.486 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:32:51.557 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:32:51.567 +03:00 [DBG] Created DbConnection. (8ms).
2025-09-03 22:32:51.571 +03:00 [DBG] Migrating using database 'main' on server 'schema_cache.db'.
2025-09-03 22:32:51.574 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:32:51.577 +03:00 [DBG] Created DbConnection. (2ms).
2025-09-03 22:32:51.579 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:32:51.586 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:32:51.589 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:32:51.592 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:32:51.594 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:32:51.596 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:32:51.598 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-03 22:32:51.601 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:32:51.605 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 22:32:51.607 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (5ms).
2025-09-03 22:32:51.612 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 22:32:51.629 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 22:32:51.633 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:32:51.635 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 22:32:51.636 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 22:32:51.638 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 19:32:51.6336776+00:00');
SELECT changes();
2025-09-03 22:32:51.646 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 19:32:51.6336776+00:00');
SELECT changes();
2025-09-03 22:32:51.688 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 22:32:51.692 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 22:32:51.693 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-09-03 22:32:51.694 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-09-03 22:32:51.695 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (1ms).
2025-09-03 22:32:51.696 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 22:32:51.698 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 22:32:51.700 +03:00 [DBG] Committing transaction.
2025-09-03 22:32:51.701 +03:00 [DBG] Committed transaction.
2025-09-03 22:32:51.703 +03:00 [DBG] Disposing transaction.
2025-09-03 22:32:51.705 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 22:32:51.706 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 22:32:51.707 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:32:51.707 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 22:32:51.708 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:32:51.710 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:32:51.711 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:32:51.712 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:32:51.713 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:32:51.714 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 22:32:51.715 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 22:32:51.716 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 22:32:51.718 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 22:32:51.722 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:32:51.723 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:32:51.724 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:32:51.725 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 22:32:51.727 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 22:32:51.730 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:32:51.732 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 2ms reading results.
2025-09-03 22:32:51.736 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-03 22:32:51.737 +03:00 [DBG] Committing transaction.
2025-09-03 22:32:51.737 +03:00 [DBG] Committed transaction.
2025-09-03 22:32:51.738 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:32:51.739 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 22:32:51.740 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 22:32:51.741 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 22:32:51.744 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 22:32:51.746 +03:00 [DBG] Disposing transaction.
2025-09-03 22:32:51.747 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:32:51.750 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-09-03 22:32:51.751 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:32:51.752 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:32:51.753 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 22:32:51.754 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 22:32:51.755 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 22:32:51.775 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-09-03 22:32:51.800 +03:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-09-03 22:32:51.801 +03:00 [DBG] Hosting starting
2025-09-03 22:32:51.811 +03:00 [DBG] Middleware loaded
2025-09-03 22:32:51.814 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-09-03 22:32:51.816 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-09-03 22:32:51.881 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-09-03 22:32:51.883 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-09-03 22:32:51.885 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-09-03 22:32:51.910 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-09-03 22:32:51.944 +03:00 [INF] Now listening on: https://localhost:7202
2025-09-03 22:32:51.945 +03:00 [INF] Now listening on: http://localhost:5000
2025-09-03 22:32:51.947 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-09-03 22:32:51.947 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-09-03 22:32:51.948 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-09-03 22:32:51.949 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-09-03 22:32:51.954 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 22:32:51.960 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 22:32:52.037 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-03 22:32:52.038 +03:00 [INF] Hosting environment: Development
2025-09-03 22:32:52.039 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-09-03 22:32:52.040 +03:00 [DBG] Hosting started
2025-09-03 22:33:06.506 +03:00 [DBG] Connection id "0HNFB42QGD18S" received FIN.
2025-09-03 22:33:06.512 +03:00 [DBG] Connection id "0HNFB42QGD18S" accepted.
2025-09-03 22:33:06.513 +03:00 [DBG] Connection id "0HNFB42QGD18S" started.
2025-09-03 22:33:06.515 +03:00 [DBG] Connection id "0HNFB42QGD18T" accepted.
2025-09-03 22:33:06.516 +03:00 [DBG] Connection id "0HNFB42QGD18T" started.
2025-09-03 22:33:06.519 +03:00 [DBG] Connection id "0HNFB42QGD18S" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 22:33:06.522 +03:00 [DBG] Connection id "0HNFB42QGD18S" disconnecting.
2025-09-03 22:33:06.524 +03:00 [DBG] Connection id "0HNFB42QGD18S" stopped.
2025-09-03 22:33:06.537 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 101
2025-09-03 22:33:06.567 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:33:06.570 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:33:06.573 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:33:06.593 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-09-03 22:33:06.595 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 22:33:06.597 +03:00 [DBG] Connection id "0HNFB42QGD18T" completed keep alive response.
2025-09-03 22:33:06.599 +03:00 [DBG] Connection id "0HNFB42QGD18U" accepted.
2025-09-03 22:33:06.600 +03:00 [DBG] Connection id "0HNFB42QGD18U" received FIN.
2025-09-03 22:33:06.600 +03:00 [DBG] Connection id "0HNFB42QGD18V" accepted.
2025-09-03 22:33:06.600 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 65.7273ms
2025-09-03 22:33:06.604 +03:00 [DBG] Connection id "0HNFB42QGD18U" started.
2025-09-03 22:33:06.606 +03:00 [DBG] Connection id "0HNFB42QGD18V" started.
2025-09-03 22:33:06.610 +03:00 [DBG] Connection id "0HNFB42QGD18U" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 22:33:06.610 +03:00 [DBG] Connection id "0HNFB42QGD18T", Request id "0HNFB42QGD18T:00000001": started reading request body.
2025-09-03 22:33:06.612 +03:00 [DBG] Connection id "0HNFB42QGD18U" disconnecting.
2025-09-03 22:33:06.613 +03:00 [DBG] Connection id "0HNFB42QGD18T", Request id "0HNFB42QGD18T:00000001": done reading request body.
2025-09-03 22:33:06.613 +03:00 [DBG] Connection id "0HNFB42QGD18U" stopped.
2025-09-03 22:33:06.642 +03:00 [DBG] Connection 0HNFB42QGD18V established using the following protocol: "Tls13"
2025-09-03 22:33:06.645 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 101
2025-09-03 22:33:06.648 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:33:06.649 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:33:06.650 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:33:06.653 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:33:06.664 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:33:06.667 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:33:06.695 +03:00 [DBG] Connection id "0HNFB42QGD18V", Request id "0HNFB42QGD18V:00000001": started reading request body.
2025-09-03 22:33:06.697 +03:00 [DBG] Connection id "0HNFB42QGD18V", Request id "0HNFB42QGD18V:00000001": done reading request body.
2025-09-03 22:33:06.722 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:33:06.785 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-09-03 22:33:06.820 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-09-03 22:33:07.006 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<DatabaseName>k__BackingField = dataReader.GetString(3);
                                        instance.<Name>k__BackingField = dataReader.GetString(4);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(5));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(6);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(7) ? default(Guid?) : (Guid?)dataReader.GetGuid(7) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(7) ? default(object) : (object)dataReader.GetGuid(7) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(8) ? default(Guid) : dataReader.GetGuid(8);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(10) ? default(string) : dataReader.GetString(10);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(11) ? default(DateTime) : dataReader.GetDateTime(11);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(12) ? default(string) : dataReader.GetString(12);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-09-03 22:33:07.031 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:33:07.032 +03:00 [DBG] Created DbConnection. (1ms).
2025-09-03 22:33:07.034 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:33:07.037 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:33:07.038 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:33:07.039 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:33:07.040 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:33:07.043 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:33:07.048 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:33:07.076 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:33:07.108 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:33:07.116 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:33:07.118 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:33:07.119 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:33:07.121 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:33:07.125 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:33:07.126 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 75ms reading results.
2025-09-03 22:33:07.129 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:33:07.130 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:33:07.139 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:33:07.142 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:33:07.143 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:33:07.144 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:33:07.145 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:33:07.146 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:33:07.147 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:33:07.150 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:33:07.152 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:33:07.153 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 22:33:07.155 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:33:07.156 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:33:07.165 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:33:07.176 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 22:33:07.178 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 22:33:07.264 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 22:33:07.283 +03:00 [INF] Converting natural language to SQL. User query: show all products in the first category you fetch
2025-09-03 22:33:07.286 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 22:33:07.287 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 22:33:07.293 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 22:33:11.834 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 22:33:11.903 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 22:33:11.916 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:33:11.919 +03:00 [DBG] Connection id "0HNFB42QGD18V" completed keep alive response.
2025-09-03 22:33:11.923 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:33:11.926 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:33:11.928 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:33:11.930 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 5284.8502ms
2025-09-03 22:34:03.713 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 208
2025-09-03 22:34:03.715 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:34:03.717 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:34:03.718 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:34:03.720 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 22:34:03.720 +03:00 [DBG] Connection id "0HNFB42QGD18T" completed keep alive response.
2025-09-03 22:34:03.721 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 8.0932ms
2025-09-03 22:34:03.728 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 208
2025-09-03 22:34:03.729 +03:00 [DBG] Connection id "0HNFB42QGD18T", Request id "0HNFB42QGD18T:00000002": started reading request body.
2025-09-03 22:34:03.731 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:34:03.732 +03:00 [DBG] Connection id "0HNFB42QGD18T", Request id "0HNFB42QGD18T:00000002": done reading request body.
2025-09-03 22:34:03.733 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:34:03.735 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:34:03.736 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:34:03.746 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:34:03.748 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:34:03.749 +03:00 [DBG] Connection id "0HNFB42QGD18V", Request id "0HNFB42QGD18V:00000002": started reading request body.
2025-09-03 22:34:03.750 +03:00 [DBG] Connection id "0HNFB42QGD18V", Request id "0HNFB42QGD18V:00000002": done reading request body.
2025-09-03 22:34:03.752 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:34:03.753 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:34:03.754 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 22:34:03.755 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:34:03.756 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:34:03.758 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:34:03.759 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:34:03.760 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:34:03.761 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:34:03.763 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:34:03.766 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:34:03.768 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:34:03.770 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:34:03.771 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:34:03.773 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:34:03.774 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:34:03.775 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:34:03.777 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 10ms reading results.
2025-09-03 22:34:03.778 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:34:03.779 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:34:03.781 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:34:03.782 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:34:03.783 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:34:03.784 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:34:03.785 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:34:03.786 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:34:03.787 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:34:03.789 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:34:03.790 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:34:03.792 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 22:34:03.793 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:34:03.794 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 22:34:03.796 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:34:03.797 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 22:34:03.798 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 22:34:03.800 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 22:34:03.801 +03:00 [INF] Converting natural language to SQL. User query: insert a product entry id = (generate random uuid id of yours), name = mario, stock = 200, price = 1500, categoryId = get the id of the first category entry
2025-09-03 22:34:03.802 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 22:34:03.803 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 22:34:03.804 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 22:34:07.121 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 22:34:07.165 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 22:34:07.166 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:34:07.168 +03:00 [DBG] Connection id "0HNFB42QGD18V" completed keep alive response.
2025-09-03 22:34:07.169 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:34:07.170 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:34:07.171 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 22:34:07.172 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 3443.7795ms
2025-09-03 22:34:33.843 +03:00 [INF] This is a test log to file!
2025-09-03 22:34:34.195 +03:00 [INF] Shared Kernal configured successfully.
2025-09-03 22:34:34.206 +03:00 [INF] API configured successfully.
2025-09-03 22:34:34.314 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-03 22:34:34.365 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-09-03 22:34:34.908 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:34:34.955 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:34:34.971 +03:00 [INF] Registered 13 endpoints in 986 milliseconds.
2025-09-03 22:34:34.977 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:34:35.023 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:34:35.110 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:34:35.120 +03:00 [DBG] Created DbConnection. (7ms).
2025-09-03 22:34:35.122 +03:00 [DBG] Migrating using database 'main' on server 'schema_cache.db'.
2025-09-03 22:34:35.127 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:34:35.130 +03:00 [DBG] Created DbConnection. (2ms).
2025-09-03 22:34:35.132 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:34:35.140 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:34:35.143 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:34:35.147 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:34:35.148 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:34:35.151 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:34:35.153 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-03 22:34:35.157 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:34:35.161 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 22:34:35.163 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (6ms).
2025-09-03 22:34:35.169 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 22:34:35.187 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 22:34:35.190 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:34:35.191 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 22:34:35.192 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 22:34:35.193 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 19:34:35.1903011+00:00');
SELECT changes();
2025-09-03 22:34:35.198 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 19:34:35.1903011+00:00');
SELECT changes();
2025-09-03 22:34:35.247 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 22:34:35.251 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 22:34:35.254 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-09-03 22:34:35.255 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-09-03 22:34:35.256 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (2ms).
2025-09-03 22:34:35.258 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 22:34:35.260 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 22:34:35.263 +03:00 [DBG] Committing transaction.
2025-09-03 22:34:35.265 +03:00 [DBG] Committed transaction.
2025-09-03 22:34:35.268 +03:00 [DBG] Disposing transaction.
2025-09-03 22:34:35.279 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 22:34:35.280 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 22:34:35.282 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:34:35.283 +03:00 [DBG] Created DbConnection. (1ms).
2025-09-03 22:34:35.284 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:34:35.285 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:34:35.287 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:34:35.288 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:34:35.289 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:34:35.290 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 22:34:35.291 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 22:34:35.292 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 22:34:35.294 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 22:34:35.314 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:34:35.316 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:34:35.317 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:34:35.318 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 22:34:35.326 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 22:34:35.332 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:34:35.335 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 5ms reading results.
2025-09-03 22:34:35.340 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-03 22:34:35.341 +03:00 [DBG] Committing transaction.
2025-09-03 22:34:35.342 +03:00 [DBG] Committed transaction.
2025-09-03 22:34:35.343 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:34:35.344 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 22:34:35.345 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 22:34:35.345 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 22:34:35.349 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 22:34:35.351 +03:00 [DBG] Disposing transaction.
2025-09-03 22:34:35.353 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:34:35.356 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (3ms).
2025-09-03 22:34:35.357 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:34:35.358 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:34:35.359 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:34:35.361 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 22:34:35.361 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 22:34:35.385 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-09-03 22:34:35.408 +03:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-09-03 22:34:35.409 +03:00 [DBG] Hosting starting
2025-09-03 22:34:35.419 +03:00 [DBG] Middleware loaded
2025-09-03 22:34:35.421 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-09-03 22:34:35.423 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-09-03 22:34:35.484 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-09-03 22:34:35.487 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-09-03 22:34:35.489 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-09-03 22:34:35.515 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-09-03 22:34:35.570 +03:00 [INF] Now listening on: https://localhost:7202
2025-09-03 22:34:35.572 +03:00 [INF] Now listening on: http://localhost:5000
2025-09-03 22:34:35.573 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-09-03 22:34:35.574 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-09-03 22:34:35.575 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-09-03 22:34:35.576 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-09-03 22:34:35.581 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 22:34:35.587 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 22:34:35.663 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-03 22:34:35.666 +03:00 [INF] Hosting environment: Development
2025-09-03 22:34:35.667 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-09-03 22:34:35.667 +03:00 [DBG] Hosting started
2025-09-03 22:34:48.927 +03:00 [DBG] Connection id "0HNFB43P15C2L" received FIN.
2025-09-03 22:34:48.931 +03:00 [DBG] Connection id "0HNFB43P15C2L" accepted.
2025-09-03 22:34:48.933 +03:00 [DBG] Connection id "0HNFB43P15C2L" started.
2025-09-03 22:34:48.934 +03:00 [DBG] Connection id "0HNFB43P15C2M" accepted.
2025-09-03 22:34:48.935 +03:00 [DBG] Connection id "0HNFB43P15C2M" started.
2025-09-03 22:34:48.938 +03:00 [DBG] Connection id "0HNFB43P15C2L" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 22:34:48.941 +03:00 [DBG] Connection id "0HNFB43P15C2L" disconnecting.
2025-09-03 22:34:48.942 +03:00 [DBG] Connection id "0HNFB43P15C2L" stopped.
2025-09-03 22:34:48.960 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 208
2025-09-03 22:34:48.993 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:34:48.996 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:34:48.998 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:34:49.020 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-09-03 22:34:49.023 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 22:34:49.025 +03:00 [DBG] Connection id "0HNFB43P15C2M" completed keep alive response.
2025-09-03 22:34:49.027 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 70.3232ms
2025-09-03 22:34:49.028 +03:00 [DBG] Connection id "0HNFB43P15C2N" received FIN.
2025-09-03 22:34:49.028 +03:00 [DBG] Connection id "0HNFB43P15C2O" accepted.
2025-09-03 22:34:49.027 +03:00 [DBG] Connection id "0HNFB43P15C2N" accepted.
2025-09-03 22:34:49.037 +03:00 [DBG] Connection id "0HNFB43P15C2M", Request id "0HNFB43P15C2M:00000001": started reading request body.
2025-09-03 22:34:49.038 +03:00 [DBG] Connection id "0HNFB43P15C2O" started.
2025-09-03 22:34:49.039 +03:00 [DBG] Connection id "0HNFB43P15C2N" started.
2025-09-03 22:34:49.040 +03:00 [DBG] Connection id "0HNFB43P15C2M", Request id "0HNFB43P15C2M:00000001": done reading request body.
2025-09-03 22:34:49.041 +03:00 [DBG] Connection id "0HNFB43P15C2N" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 22:34:49.044 +03:00 [DBG] Connection id "0HNFB43P15C2N" disconnecting.
2025-09-03 22:34:49.044 +03:00 [DBG] Connection id "0HNFB43P15C2N" stopped.
2025-09-03 22:34:49.072 +03:00 [DBG] Connection 0HNFB43P15C2O established using the following protocol: "Tls13"
2025-09-03 22:34:49.075 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 208
2025-09-03 22:34:49.079 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:34:49.080 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:34:49.081 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:34:49.084 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:34:49.096 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:34:49.098 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:34:49.128 +03:00 [DBG] Connection id "0HNFB43P15C2O", Request id "0HNFB43P15C2O:00000001": started reading request body.
2025-09-03 22:34:49.129 +03:00 [DBG] Connection id "0HNFB43P15C2O", Request id "0HNFB43P15C2O:00000001": done reading request body.
2025-09-03 22:34:49.158 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:34:49.222 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-09-03 22:34:49.256 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-09-03 22:34:49.432 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<DatabaseName>k__BackingField = dataReader.GetString(3);
                                        instance.<Name>k__BackingField = dataReader.GetString(4);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(5));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(6);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(7) ? default(Guid?) : (Guid?)dataReader.GetGuid(7) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(7) ? default(object) : (object)dataReader.GetGuid(7) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(8) ? default(Guid) : dataReader.GetGuid(8);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(10) ? default(string) : dataReader.GetString(10);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(11) ? default(DateTime) : dataReader.GetDateTime(11);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(12) ? default(string) : dataReader.GetString(12);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-09-03 22:34:49.459 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:34:49.460 +03:00 [DBG] Created DbConnection. (1ms).
2025-09-03 22:34:49.462 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:34:49.465 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:34:49.466 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:34:49.467 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:34:49.469 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:34:49.472 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:34:49.477 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:34:49.508 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:34:49.543 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:34:49.551 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:34:49.554 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:34:49.555 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:34:49.556 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:34:49.560 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:34:49.561 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 82ms reading results.
2025-09-03 22:34:49.564 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:34:49.565 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:34:49.575 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:34:49.577 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:34:49.579 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:34:49.580 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:34:49.581 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:34:49.582 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:34:49.583 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:34:49.584 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:34:49.587 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:34:49.588 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 22:34:49.589 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:34:49.590 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 22:34:49.600 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:34:49.611 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 22:34:49.613 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 22:34:49.704 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 22:34:49.721 +03:00 [INF] Converting natural language to SQL. User query: insert a product entry id = (generate random uuid id of yours), name = mario, stock = 200, price = 1500, categoryId = get the id of the first category entry
2025-09-03 22:34:49.723 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 22:34:49.725 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 22:34:49.731 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 22:35:15.515 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 22:35:15.528 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 22:35:15.549 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:35:15.554 +03:00 [DBG] Connection id "0HNFB43P15C2O" completed keep alive response.
2025-09-03 22:35:15.557 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:35:15.560 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:35:15.562 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:35:15.564 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 26488.8755ms
2025-09-03 22:35:27.231 +03:00 [INF] This is a test log to file!
2025-09-03 22:35:27.548 +03:00 [INF] Shared Kernal configured successfully.
2025-09-03 22:35:27.556 +03:00 [INF] API configured successfully.
2025-09-03 22:35:27.662 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-03 22:35:27.733 +03:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2025-09-03 22:35:28.223 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:35:28.258 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:35:28.268 +03:00 [INF] Registered 13 endpoints in 910 milliseconds.
2025-09-03 22:35:28.275 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:35:28.309 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:35:28.379 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:35:28.390 +03:00 [DBG] Created DbConnection. (9ms).
2025-09-03 22:35:28.392 +03:00 [DBG] Migrating using database 'main' on server 'schema_cache.db'.
2025-09-03 22:35:28.396 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:35:28.398 +03:00 [DBG] Created DbConnection. (2ms).
2025-09-03 22:35:28.400 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:35:28.409 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:35:28.412 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:35:28.417 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-09-03 22:35:28.418 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:35:28.421 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:35:28.423 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-03 22:35:28.426 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:35:28.431 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 22:35:28.432 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (6ms).
2025-09-03 22:35:28.437 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 22:35:28.454 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsLock' AND "type" = 'table';
2025-09-03 22:35:28.457 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:35:28.457 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 22:35:28.458 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 22:35:28.459 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 19:35:28.4570675+00:00');
SELECT changes();
2025-09-03 22:35:28.464 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT OR IGNORE INTO "__EFMigrationsLock"("Id", "Timestamp") VALUES(1, '2025-09-03 19:35:28.4570675+00:00');
SELECT changes();
2025-09-03 22:35:28.500 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 22:35:28.503 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 22:35:28.505 +03:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2025-09-03 22:35:28.506 +03:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (0ms).
2025-09-03 22:35:28.507 +03:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (1ms).
2025-09-03 22:35:28.508 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 22:35:28.509 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" TEXT NOT NULL CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY,
    "ProductVersion" TEXT NOT NULL
);
2025-09-03 22:35:28.511 +03:00 [DBG] Committing transaction.
2025-09-03 22:35:28.513 +03:00 [DBG] Committed transaction.
2025-09-03 22:35:28.514 +03:00 [DBG] Disposing transaction.
2025-09-03 22:35:28.516 +03:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2025-09-03 22:35:28.517 +03:00 [DBG] Began transaction with isolation level 'Serializable'.
2025-09-03 22:35:28.519 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:35:28.520 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 22:35:28.522 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:35:28.524 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:35:28.526 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:35:28.527 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:35:28.529 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:35:28.530 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2025-09-03 22:35:28.532 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 22:35:28.533 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 22:35:28.534 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*) FROM "sqlite_master" WHERE "name" = '__EFMigrationsHistory' AND "type" = 'table';
2025-09-03 22:35:28.537 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:35:28.538 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:35:28.539 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:35:28.540 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 22:35:28.543 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-09-03 22:35:28.548 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:35:28.550 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 4ms reading results.
2025-09-03 22:35:28.555 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-03 22:35:28.556 +03:00 [DBG] Committing transaction.
2025-09-03 22:35:28.556 +03:00 [DBG] Committed transaction.
2025-09-03 22:35:28.557 +03:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2025-09-03 22:35:28.558 +03:00 [DBG] Created DbCommand for 'ExecuteScalar' (0ms).
2025-09-03 22:35:28.559 +03:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (2ms).
2025-09-03 22:35:28.561 +03:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 22:35:28.565 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "__EFMigrationsLock";
2025-09-03 22:35:28.566 +03:00 [DBG] Disposing transaction.
2025-09-03 22:35:28.568 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:35:28.570 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-09-03 22:35:28.571 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:35:28.572 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:35:28.573 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:35:28.575 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 22:35:28.575 +03:00 [INF] Infrastructure configured successfully.
2025-09-03 22:35:28.597 +03:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2025-09-03 22:35:28.624 +03:00 [INF] No action descriptors found. This may indicate an incorrectly configured application or missing application parts. To learn more, visit https://aka.ms/aspnet/mvc/app-parts
2025-09-03 22:35:28.625 +03:00 [DBG] Hosting starting
2025-09-03 22:35:28.637 +03:00 [DBG] Middleware loaded
2025-09-03 22:35:28.640 +03:00 [DBG] Middleware loaded. Script /_framework/aspnetcore-browser-refresh.js (16521 B).
2025-09-03 22:35:28.642 +03:00 [DBG] Middleware loaded. Script /_framework/blazor-hotreload.js (799 B).
2025-09-03 22:35:28.710 +03:00 [DBG] Middleware configuration started with options: {AllowedHosts = *, AllowEmptyHosts = True, IncludeFailureMessage = True}
2025-09-03 22:35:28.713 +03:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2025-09-03 22:35:28.715 +03:00 [DBG] Middleware loaded: DOTNET_MODIFIABLE_ASSEMBLIES=debug, __ASPNETCORE_BROWSER_TOOLS=true
2025-09-03 22:35:28.743 +03:00 [WRN] The ASP.NET Core developer certificate is not trusted. For information about trusting the ASP.NET Core developer certificate, see https://aka.ms/aspnet/https-trust-dev-cert
2025-09-03 22:35:28.792 +03:00 [INF] Now listening on: https://localhost:7202
2025-09-03 22:35:28.793 +03:00 [INF] Now listening on: http://localhost:5000
2025-09-03 22:35:28.794 +03:00 [DBG] Loaded hosting startup assembly NaturalToQuery.Api
2025-09-03 22:35:28.795 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.ApiEndpointDiscovery
2025-09-03 22:35:28.796 +03:00 [DBG] Loaded hosting startup assembly Microsoft.AspNetCore.Watch.BrowserRefresh
2025-09-03 22:35:28.797 +03:00 [DBG] Loaded hosting startup assembly Microsoft.WebTools.BrowserLink.Net
2025-09-03 22:35:28.803 +03:00 [DBG] Executing API description provider 'EndpointMetadataApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 22:35:28.811 +03:00 [DBG] Executing API description provider 'DefaultApiDescriptionProvider' from assembly Microsoft.AspNetCore.Mvc.ApiExplorer v9.0.0.0.
2025-09-03 22:35:28.911 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-03 22:35:28.912 +03:00 [INF] Hosting environment: Development
2025-09-03 22:35:28.913 +03:00 [INF] Content root path: C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql
2025-09-03 22:35:28.914 +03:00 [DBG] Hosting started
2025-09-03 22:36:50.504 +03:00 [DBG] Connection id "0HNFB44T8JL93" received FIN.
2025-09-03 22:36:50.516 +03:00 [DBG] Connection id "0HNFB44T8JL93" accepted.
2025-09-03 22:36:50.525 +03:00 [DBG] Connection id "0HNFB44T8JL93" started.
2025-09-03 22:36:50.526 +03:00 [DBG] Connection id "0HNFB44T8JL94" accepted.
2025-09-03 22:36:50.527 +03:00 [DBG] Connection id "0HNFB44T8JL94" started.
2025-09-03 22:36:50.532 +03:00 [DBG] Connection id "0HNFB44T8JL93" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 22:36:50.535 +03:00 [DBG] Connection id "0HNFB44T8JL93" disconnecting.
2025-09-03 22:36:50.537 +03:00 [DBG] Connection id "0HNFB44T8JL93" stopped.
2025-09-03 22:36:50.558 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 208
2025-09-03 22:36:50.616 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:36:50.618 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:36:50.620 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:36:50.645 +03:00 [DBG] Https port '7202' loaded from configuration.
2025-09-03 22:36:50.648 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 22:36:50.652 +03:00 [DBG] Connection id "0HNFB44T8JL94" completed keep alive response.
2025-09-03 22:36:50.654 +03:00 [DBG] Connection id "0HNFB44T8JL95" accepted.
2025-09-03 22:36:50.655 +03:00 [DBG] Connection id "0HNFB44T8JL96" accepted.
2025-09-03 22:36:50.655 +03:00 [DBG] Connection id "0HNFB44T8JL95" received FIN.
2025-09-03 22:36:50.682 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 100.9545ms
2025-09-03 22:36:50.682 +03:00 [DBG] Connection id "0HNFB44T8JL95" started.
2025-09-03 22:36:50.683 +03:00 [DBG] Connection id "0HNFB44T8JL96" started.
2025-09-03 22:36:50.689 +03:00 [DBG] Connection id "0HNFB44T8JL95" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 22:36:50.690 +03:00 [DBG] Connection id "0HNFB44T8JL94", Request id "0HNFB44T8JL94:00000001": started reading request body.
2025-09-03 22:36:50.692 +03:00 [DBG] Connection id "0HNFB44T8JL95" disconnecting.
2025-09-03 22:36:50.693 +03:00 [DBG] Connection id "0HNFB44T8JL94", Request id "0HNFB44T8JL94:00000001": done reading request body.
2025-09-03 22:36:50.694 +03:00 [DBG] Connection id "0HNFB44T8JL95" stopped.
2025-09-03 22:36:50.727 +03:00 [DBG] Connection 0HNFB44T8JL96 established using the following protocol: "Tls13"
2025-09-03 22:36:50.732 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 208
2025-09-03 22:36:50.738 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:36:50.739 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:36:50.741 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:36:50.745 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:36:50.769 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:36:50.772 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:36:50.815 +03:00 [DBG] Connection id "0HNFB44T8JL96", Request id "0HNFB44T8JL96:00000001": started reading request body.
2025-09-03 22:36:50.816 +03:00 [DBG] Connection id "0HNFB44T8JL96", Request id "0HNFB44T8JL96:00000001": done reading request body.
2025-09-03 22:36:50.853 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:36:50.907 +03:00 [DBG] Compiling query expression: 
'DbSet<Profile>()
    .Include(e => e.Queries)
    .FirstOrDefault(e => e.Id.Equals(__id_0))'
2025-09-03 22:36:50.973 +03:00 [DBG] Including navigation: 'Profile.Queries'.
2025-09-03 22:36:51.223 +03:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Profile>(
    asyncEnumerable: SingleQueryingEnumerable.Create<Profile>(
        relationalQueryContext: (RelationalQueryContext)queryContext, 
        relationalCommandResolver: parameters => [LIFTABLE Constant: RelationalCommandCache.QueryExpression(
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC) | Resolver: c => new RelationalCommandCache(
            c.Dependencies.MemoryCache, 
            c.RelationalDependencies.QuerySqlGeneratorFactory, 
            c.RelationalDependencies.RelationalParameterBasedSqlProcessorFactory, 
            Client Projections:
                0 -> Dictionary<IProperty, int> { [Property: Profile.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 0], [Property: Profile.CacheFile (string) MaxLength(500), 1], [Property: Profile.CreatedUtc (DateTimeOffset) Required, 2], [Property: Profile.DatabaseName (string) Required, 3], [Property: Profile.Name (string) Required MaxLength(200), 4], [Property: Profile.Provider (ProviderType) Required, 5], [Property: Profile.SecretRef (string) Required, 6] }
                1 -> 0
                2 -> Dictionary<IProperty, int> { [Property: Query.Id (Guid) Required PK AfterSave:Throw ValueGenerated.OnAdd, 7], [Property: Query.ProfileId (Guid) Required FK Index, 8], [Property: Query.ResultJson (string) Required, 9], [Property: Query.SqlQuery (string) Required, 10], [Property: Query.TimestampUtc (DateTime) Required, 11], [Property: Query.UserQuery (string) Required, 12] }
                3 -> 7
            SELECT p0.Id, p0.CacheFile, p0.CreatedUtc, p0.DatabaseName, p0.Name, p0.Provider, p0.SecretRef, q.Id, q.ProfileId, q.ResultJson, q.SqlQuery, q.TimestampUtc, q.UserQuery
            FROM 
            (
                SELECT TOP(1) p.Id, p.CacheFile, p.CreatedUtc, p.DatabaseName, p.Name, p.Provider, p.SecretRef
                FROM Profiles AS p
                WHERE p.Id == @__id_0
            ) AS p0
            LEFT JOIN Queries AS q ON p0.Id == q.ProfileId
            ORDER BY p0.Id ASC, 
            False, 
            new HashSet<string>(
                new string[]{ }, 
                StringComparer.Ordinal
            )
        )].GetRelationalCommandTemplate(parameters), 
        readerColumns: null, 
        shaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
        {
            resultContext.Values == null ? 
            {
                Profile entity;
                entity = 
                {
                    MaterializationContext materializationContext1;
                    IEntityType entityType1;
                    Profile instance1;
                    InternalEntityEntry entry1;
                    bool hasNullKey1;
                    materializationContext1 = new MaterializationContext(
                        [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                        queryContext.Context
                    );
                    instance1 = default(Profile);
                    entry1 = queryContext.TryGetEntry(
                        key: [LIFTABLE Constant: Key: Profile.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindPrimaryKey()], 
                        keyValues: new object[]{ (object)dataReader.GetGuid(0) }, 
                        throwOnNullKey: True, 
                        hasNullKey: hasNullKey1);
                    !(hasNullKey1) ? entry1 != default(InternalEntityEntry) ? 
                    {
                        entityType1 = entry1.EntityType;
                        return instance1 = (Profile)entry1.Entity;
                    } : 
                    {
                        ISnapshot shadowSnapshot1;
                        shadowSnapshot1 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                        entityType1 = [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{0} => namelessParameter{0}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")];
                        instance1 = switch (entityType1)
                        {
                            case [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{1} => namelessParameter{1}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]: 
                                {
                                    return 
                                    {
                                        Profile instance;
                                        instance = new Profile();
                                        instance.<Id>k__BackingField = dataReader.GetGuid(0);
                                        instance.<CacheFile>k__BackingField = dataReader.IsDBNull(1) ? default(string) : dataReader.GetString(1);
                                        instance.<CreatedUtc>k__BackingField = dataReader.GetFieldValue<DateTimeOffset>(2);
                                        instance.<DatabaseName>k__BackingField = dataReader.GetString(3);
                                        instance.<Name>k__BackingField = dataReader.GetString(4);
                                        instance.<Provider>k__BackingField = Invoke(((EnumToNumberConverter<ProviderType, int>)((IReadOnlyProperty)[LIFTABLE Constant: Property: Profile.Provider (ProviderType) Required | Resolver: namelessParameter{2} => namelessParameter{2}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindProperty("Provider")]).GetTypeMapping().Converter).ConvertFromProviderTyped, dataReader.GetInt32(5));
                                        instance.<SecretRef>k__BackingField = dataReader.GetString(6);
                                        (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                            context: materializationContext1.Context, 
                                            entity: instance, 
                                            queryTrackingBehavior: TrackAll, 
                                            structuralType: [LIFTABLE Constant: EntityType: Profile | Resolver: namelessParameter{3} => namelessParameter{3}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile")]) : default(void);
                                        return instance;
                                    }}
                            default: 
                                default(Profile)
                        }
                        ;
                        entry1 = entityType1 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                            entityType: entityType1, 
                            entity: instance1, 
                            snapshot: shadowSnapshot1);
                        return instance1;
                    } : default(void);
                    return instance1;
                };
                resultContext.Values = new object[]{ entity };
                ShaperProcessingExpressionVisitor.InitializeIncludeCollection<Profile, Profile>(
                    collectionId: 0, 
                    queryContext: queryContext, 
                    dbDataReader: dataReader, 
                    resultCoordinator: resultCoordinator, 
                    entity: (Profile)(resultContext.Values[0]), 
                    parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                    navigation: [LIFTABLE Constant: Navigation: Profile.Queries (List<Query>) Collection ToDependent Query Inverse: Profile | Resolver: namelessParameter{4} => namelessParameter{4}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries")], 
                    clrCollectionAccessor: [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{5} => namelessParameter{5}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()], 
                    trackingQuery: True, 
                    setLoaded: True);
            } : default(void);
            ShaperProcessingExpressionVisitor.PopulateIncludeCollection<Profile, Query>(
                collectionId: 0, 
                queryContext: queryContext, 
                dbDataReader: dataReader, 
                resultCoordinator: resultCoordinator, 
                parentIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                outerIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)(Guid?)dataReader.GetGuid(0) }], 
                selfIdentifier: [LIFTABLE Constant: Func<QueryContext, DbDataReader, object[]> | Resolver: _ => (queryContext, dataReader) => new object[]{ (object)dataReader.IsDBNull(7) ? default(Guid?) : (Guid?)dataReader.GetGuid(7) }], 
                parentIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                outerIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                selfIdentifierValueComparers: [LIFTABLE Constant: Func<object, object, bool>[] { Func<object, object, bool> } | Resolver: _ => new Func<object, object, bool>[]{ (left, right) => left == null ? right == null : right != null && (Guid)left == (Guid)right }], 
                innerShaper: (queryContext, dataReader, resultContext, resultCoordinator) => 
                {
                    Query entity;
                    entity = 
                    {
                        MaterializationContext materializationContext2;
                        IEntityType entityType2;
                        Query instance2;
                        InternalEntityEntry entry2;
                        bool hasNullKey2;
                        materializationContext2 = new MaterializationContext(
                            [LIFTABLE Constant: ValueBuffer | Resolver: _ => (object)ValueBuffer.Empty], 
                            queryContext.Context
                        );
                        instance2 = default(Query);
                        entry2 = queryContext.TryGetEntry(
                            key: [LIFTABLE Constant: Key: Query.Id PK | Resolver: c => c.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindPrimaryKey()], 
                            keyValues: new object[]{ dataReader.IsDBNull(7) ? default(object) : (object)dataReader.GetGuid(7) }, 
                            throwOnNullKey: False, 
                            hasNullKey: hasNullKey2);
                        !(hasNullKey2) ? entry2 != default(InternalEntityEntry) ? 
                        {
                            entityType2 = entry2.EntityType;
                            return instance2 = (Query)entry2.Entity;
                        } : 
                        {
                            ISnapshot shadowSnapshot2;
                            shadowSnapshot2 = [LIFTABLE Constant: Snapshot | Resolver: _ => Snapshot.Empty];
                            entityType2 = [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{6} => namelessParameter{6}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")];
                            instance2 = switch (entityType2)
                            {
                                case [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{7} => namelessParameter{7}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]: 
                                    {
                                        return 
                                        {
                                            Query instance;
                                            instance = new Query();
                                            instance.<Id>k__BackingField = dataReader.IsDBNull(7) ? default(Guid) : dataReader.GetGuid(7);
                                            instance.<ProfileId>k__BackingField = dataReader.IsDBNull(8) ? default(Guid) : dataReader.GetGuid(8);
                                            instance.<ResultJson>k__BackingField = dataReader.IsDBNull(9) ? default(string) : dataReader.GetString(9);
                                            instance.<SqlQuery>k__BackingField = dataReader.IsDBNull(10) ? default(string) : dataReader.GetString(10);
                                            instance.<TimestampUtc>k__BackingField = dataReader.IsDBNull(11) ? default(DateTime) : dataReader.GetDateTime(11);
                                            instance.<UserQuery>k__BackingField = dataReader.IsDBNull(12) ? default(string) : dataReader.GetString(12);
                                            (instance is IInjectableService) ? ((IInjectableService)instance).Injected(
                                                context: materializationContext2.Context, 
                                                entity: instance, 
                                                queryTrackingBehavior: TrackAll, 
                                                structuralType: [LIFTABLE Constant: EntityType: Query | Resolver: namelessParameter{8} => namelessParameter{8}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query")]) : default(void);
                                            return instance;
                                        }}
                                default: 
                                    default(Query)
                            }
                            ;
                            entry2 = entityType2 == default(IEntityType) ? default(InternalEntityEntry) : queryContext.StartTracking(
                                entityType: entityType2, 
                                entity: instance2, 
                                snapshot: shadowSnapshot2);
                            return instance2;
                        } : default(void);
                        return instance2;
                    };
                    return entity;
                }, 
                inverseNavigation: [LIFTABLE Constant: Navigation: Query.Profile (Profile) ToPrincipal Profile Inverse: Queries | Resolver: namelessParameter{9} => namelessParameter{9}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Queries.Query").FindNavigation("Profile")], 
                fixup: (namelessParameter{10}, namelessParameter{11}) => 
                {
                    [LIFTABLE Constant: ClrICollectionAccessor<Profile, List<Query>, Query> | Resolver: namelessParameter{12} => namelessParameter{12}.Dependencies.Model.FindEntityType("NaturalToQuery.Core.Contributers.Entities.Profiles.Profile").FindNavigation("Queries").GetCollectionAccessor()].Add(
                        entity: namelessParameter{10}, 
                        value: namelessParameter{11}, 
                        forMaterialization: True);
                    return namelessParameter{11}.<Profile>k__BackingField = namelessParameter{10};
                }, 
                trackingQuery: True);
            return IsTrue(resultCoordinator.ResultReady)
             ? (Profile)(resultContext.Values[0]) : default(Profile);
        }, 
        contextType: NaturalToQuery.Infrastructure.Persistence.ProfilesDbContext, 
        standAloneStateManager: False, 
        detailedErrorsEnabled: False, 
        threadSafetyChecksEnabled: True), 
    cancellationToken: queryContext.CancellationToken)'
2025-09-03 22:36:51.252 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:36:51.253 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 22:36:51.256 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:36:51.258 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:36:51.259 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:36:51.260 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:36:51.263 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2025-09-03 22:36:51.266 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:36:51.273 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:36:51.306 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:36:51.340 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:36:51.348 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:36:51.349 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:36:51.350 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:36:51.352 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:36:51.356 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:36:51.357 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 81ms reading results.
2025-09-03 22:36:51.360 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:36:51.362 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:36:51.370 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:36:51.373 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:36:51.374 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:36:51.375 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:36:51.377 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:36:51.378 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:36:51.379 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:36:51.380 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:36:51.383 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:36:51.384 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 22:36:51.386 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:36:51.387 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:36:51.398 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:36:51.411 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 22:36:51.414 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 22:36:51.530 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 22:36:51.550 +03:00 [INF] Converting natural language to SQL. User query: insert a product entry id = (generate random uuid id of yours), name = mario, stock = 200, price = 1500, categoryId = get the id of the first category entry
2025-09-03 22:36:51.553 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 22:36:51.554 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 22:36:51.561 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 22:37:22.932 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 22:37:23.060 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 22:37:23.080 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:37:23.084 +03:00 [DBG] Connection id "0HNFB44T8JL96" completed keep alive response.
2025-09-03 22:37:23.087 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:37:23.090 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:37:23.093 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (2ms).
2025-09-03 22:37:23.095 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 32363.4108ms
2025-09-03 22:45:09.954 +03:00 [DBG] Connection id "0HNFB44T8JL97" received FIN.
2025-09-03 22:45:09.956 +03:00 [DBG] Connection id "0HNFB44T8JL97" accepted.
2025-09-03 22:45:09.984 +03:00 [DBG] Connection id "0HNFB44T8JL97" started.
2025-09-03 22:45:09.984 +03:00 [DBG] Connection id "0HNFB44T8JL98" accepted.
2025-09-03 22:45:09.989 +03:00 [DBG] Connection id "0HNFB44T8JL97" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 22:45:09.990 +03:00 [DBG] Connection id "0HNFB44T8JL98" started.
2025-09-03 22:45:09.991 +03:00 [DBG] Connection id "0HNFB44T8JL97" disconnecting.
2025-09-03 22:45:09.992 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 71
2025-09-03 22:45:09.992 +03:00 [DBG] Connection id "0HNFB44T8JL97" stopped.
2025-09-03 22:45:09.995 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:45:09.996 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:45:09.998 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:45:10.000 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 22:45:10.001 +03:00 [DBG] Connection id "0HNFB44T8JL98" completed keep alive response.
2025-09-03 22:45:10.002 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 10.6234ms
2025-09-03 22:45:10.004 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 71
2025-09-03 22:45:10.006 +03:00 [DBG] Connection id "0HNFB44T8JL98", Request id "0HNFB44T8JL98:00000001": started reading request body.
2025-09-03 22:45:10.007 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:45:10.008 +03:00 [DBG] Connection id "0HNFB44T8JL98", Request id "0HNFB44T8JL98:00000001": done reading request body.
2025-09-03 22:45:10.009 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:45:10.011 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:45:10.012 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:45:10.014 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:45:10.015 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:45:10.016 +03:00 [DBG] Connection id "0HNFB44T8JL96", Request id "0HNFB44T8JL96:00000002": started reading request body.
2025-09-03 22:45:10.017 +03:00 [DBG] Connection id "0HNFB44T8JL96", Request id "0HNFB44T8JL96:00000002": done reading request body.
2025-09-03 22:45:10.018 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:45:10.020 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:45:10.021 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 22:45:10.022 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:45:10.023 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:45:10.024 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:45:10.025 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:45:10.026 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:45:10.027 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:45:10.030 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:45:10.032 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:45:10.034 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:45:10.035 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:45:10.036 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:45:10.037 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:45:10.038 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:45:10.039 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:45:10.040 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 8ms reading results.
2025-09-03 22:45:10.041 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:45:10.042 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 22:45:10.043 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:45:10.044 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:45:10.045 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:45:10.046 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:45:10.047 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:45:10.048 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:45:10.049 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:45:10.050 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:45:10.052 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:45:10.053 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 22:45:10.055 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:45:10.056 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:45:10.058 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:45:10.058 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 22:45:10.059 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 22:45:10.062 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 22:45:10.063 +03:00 [INF] Converting natural language to SQL. User query: show all categories
2025-09-03 22:45:10.064 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 22:45:10.065 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 22:45:10.066 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 22:45:19.516 +03:00 [DBG] Connection id "0HNFB44T8JL96" received FIN.
2025-09-03 22:45:19.518 +03:00 [DBG] Connection id "0HNFB44T8JL96" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 22:45:19.520 +03:00 [DBG] Connection id "0HNFB44T8JL96" disconnecting.
2025-09-03 22:45:19.810 +03:00 [INF] LLM API request was cancelled
2025-09-03 22:45:20.171 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:45:20.344 +03:00 [DBG] The request was aborted by the client.
2025-09-03 22:45:20.346 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:45:20.347 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:45:20.348 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:45:20.349 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 499 null null 10345.063ms
2025-09-03 22:45:20.354 +03:00 [DBG] Connection id "0HNFB44T8JL96" stopped.
2025-09-03 22:45:21.823 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 71
2025-09-03 22:45:21.825 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:45:21.826 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:45:21.828 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:45:21.829 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 22:45:21.830 +03:00 [DBG] Connection id "0HNFB44T8JL98" completed keep alive response.
2025-09-03 22:45:21.831 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 7.7973ms
2025-09-03 22:45:21.835 +03:00 [DBG] Connection id "0HNFB44T8JL9A" accepted.
2025-09-03 22:45:21.832 +03:00 [DBG] Connection id "0HNFB44T8JL99" accepted.
2025-09-03 22:45:21.838 +03:00 [DBG] Connection id "0HNFB44T8JL98", Request id "0HNFB44T8JL98:00000002": started reading request body.
2025-09-03 22:45:21.841 +03:00 [DBG] Connection id "0HNFB44T8JL9A" started.
2025-09-03 22:45:21.837 +03:00 [DBG] Connection id "0HNFB44T8JL99" received FIN.
2025-09-03 22:45:21.843 +03:00 [DBG] Connection id "0HNFB44T8JL99" started.
2025-09-03 22:45:21.844 +03:00 [DBG] Connection id "0HNFB44T8JL98", Request id "0HNFB44T8JL98:00000002": done reading request body.
2025-09-03 22:45:21.847 +03:00 [DBG] Connection id "0HNFB44T8JL99" sending FIN because: "The Socket transport's send loop completed gracefully."
2025-09-03 22:45:21.848 +03:00 [DBG] Connection 0HNFB44T8JL9A established using the following protocol: "Tls13"
2025-09-03 22:45:21.849 +03:00 [DBG] Connection id "0HNFB44T8JL99" disconnecting.
2025-09-03 22:45:21.850 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 71
2025-09-03 22:45:21.851 +03:00 [DBG] Connection id "0HNFB44T8JL99" stopped.
2025-09-03 22:45:21.852 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:45:21.853 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:45:21.854 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:45:21.856 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:45:21.857 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:45:21.859 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:45:21.859 +03:00 [DBG] Connection id "0HNFB44T8JL9A", Request id "0HNFB44T8JL9A:00000001": started reading request body.
2025-09-03 22:45:21.860 +03:00 [DBG] Connection id "0HNFB44T8JL9A", Request id "0HNFB44T8JL9A:00000001": done reading request body.
2025-09-03 22:45:21.861 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:45:21.863 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:45:21.864 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 22:45:21.864 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:45:21.865 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:45:21.866 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:45:21.867 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:45:21.868 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:45:21.869 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:45:21.870 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:45:21.872 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:45:21.873 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:45:21.874 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:45:21.875 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:45:21.876 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:45:21.877 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:45:21.878 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:45:21.879 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 7ms reading results.
2025-09-03 22:45:21.880 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:45:21.881 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 22:45:21.882 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:45:21.883 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:45:21.884 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:45:21.885 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:45:21.885 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:45:21.886 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (1ms).
2025-09-03 22:45:21.887 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:45:21.889 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:45:21.890 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:45:21.891 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 0ms reading results.
2025-09-03 22:45:21.892 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:45:21.893 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 22:45:21.894 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:45:21.895 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 22:45:21.896 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 22:45:21.897 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 22:45:21.898 +03:00 [INF] Converting natural language to SQL. User query: show all categories
2025-09-03 22:45:21.899 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 22:45:21.900 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 22:45:21.901 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 22:45:42.524 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 22:45:42.566 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 22:45:42.568 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:45:42.574 +03:00 [DBG] Connection id "0HNFB44T8JL9A" completed keep alive response.
2025-09-03 22:45:42.575 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:45:42.576 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:45:42.577 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (0ms).
2025-09-03 22:45:42.578 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 20728.3275ms
2025-09-03 22:46:00.073 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 56
2025-09-03 22:46:00.076 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:46:00.077 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:46:00.078 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:46:00.079 +03:00 [DBG] Redirecting to 'https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'.
2025-09-03 22:46:00.080 +03:00 [DBG] Connection id "0HNFB44T8JL98" completed keep alive response.
2025-09-03 22:46:00.081 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5000/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 307 0 null 7.7084ms
2025-09-03 22:46:00.087 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - application/json 56
2025-09-03 22:46:00.088 +03:00 [DBG] Connection id "0HNFB44T8JL98", Request id "0HNFB44T8JL98:00000003": started reading request body.
2025-09-03 22:46:00.090 +03:00 [DBG] 1 candidate(s) found for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:46:00.091 +03:00 [DBG] Connection id "0HNFB44T8JL98", Request id "0HNFB44T8JL98:00000003": done reading request body.
2025-09-03 22:46:00.093 +03:00 [DBG] Endpoint 'HTTP: POST api/query/{profileId}/convert' with route pattern 'api/query/{profileId}/convert' is valid for the request path '/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert'
2025-09-03 22:46:00.095 +03:00 [DBG] Request matched endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:46:00.096 +03:00 [INF] Executing endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:46:00.097 +03:00 [DBG] Entity Framework Core 9.0.8 initialized 'ProfilesDbContext' using provider 'Microsoft.EntityFrameworkCore.Sqlite:9.0.8' with options: None
2025-09-03 22:46:00.100 +03:00 [INF] API key configured for HttpClient
2025-09-03 22:46:00.100 +03:00 [DBG] Connection id "0HNFB44T8JL9A", Request id "0HNFB44T8JL9A:00000002": started reading request body.
2025-09-03 22:46:00.101 +03:00 [DBG] Connection id "0HNFB44T8JL9A", Request id "0HNFB44T8JL9A:00000002": done reading request body.
2025-09-03 22:46:00.103 +03:00 [INF] Converting NL to SQL for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:46:00.104 +03:00 [DBG] Creating DbConnection.
2025-09-03 22:46:00.105 +03:00 [DBG] Created DbConnection. (0ms).
2025-09-03 22:46:00.106 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:46:00.107 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:46:00.109 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:46:00.110 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:46:00.111 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:46:00.112 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:46:00.114 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:46:00.116 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Profile' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:46:00.118 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:46:00.119 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:46:00.121 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:46:00.122 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:46:00.124 +03:00 [DBG] Context 'ProfilesDbContext' started tracking 'Query' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2025-09-03 22:46:00.126 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:46:00.127 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 11ms reading results.
2025-09-03 22:46:00.129 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:46:00.131 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:46:00.133 +03:00 [INF] Fetching connection string for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:46:00.134 +03:00 [DBG] Opening connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:46:00.135 +03:00 [DBG] Opened connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:46:00.137 +03:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2025-09-03 22:46:00.137 +03:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2025-09-03 22:46:00.139 +03:00 [DBG] Initialized DbCommand for 'ExecuteReader' (2ms).
2025-09-03 22:46:00.140 +03:00 [DBG] Executing DbCommand [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:46:00.142 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT "p0"."Id", "p0"."CacheFile", "p0"."CreatedUtc", "p0"."DatabaseName", "p0"."Name", "p0"."Provider", "p0"."SecretRef", "q"."Id", "q"."ProfileId", "q"."ResultJson", "q"."SqlQuery", "q"."TimestampUtc", "q"."UserQuery"
FROM (
    SELECT "p"."Id", "p"."CacheFile", "p"."CreatedUtc", "p"."DatabaseName", "p"."Name", "p"."Provider", "p"."SecretRef"
    FROM "Profiles" AS "p"
    WHERE "p"."Id" = @__id_0
    LIMIT 1
) AS "p0"
LEFT JOIN "Queries" AS "q" ON "p0"."Id" = "q"."ProfileId"
ORDER BY "p0"."Id"
2025-09-03 22:46:00.144 +03:00 [DBG] Closing data reader to 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:46:00.145 +03:00 [DBG] A data reader for 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db' is being disposed after spending 1ms reading results.
2025-09-03 22:46:00.147 +03:00 [DBG] Closing connection to database 'main' on server 'C:\Users\Zyad\Documents\NaturalToSql\NaturalToSql\schema_cache.db'.
2025-09-03 22:46:00.149 +03:00 [DBG] Closed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:46:00.150 +03:00 [DBG] Fetched secret for profile "773c7d30-609c-442f-ad98-0546699311ed"
2025-09-03 22:46:00.151 +03:00 [DBG] Fetching schema for Profile "773c7d30-609c-442f-ad98-0546699311ed", ForceRefresh=false
2025-09-03 22:46:00.153 +03:00 [INF] Fetching schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory (ForceRefresh=false)
2025-09-03 22:46:00.155 +03:00 [INF] Loaded schema for DESKTOP-QCK8UI5\SQLEXPRESS|ProductInventory from cache file
2025-09-03 22:46:00.156 +03:00 [INF] Converting natural language to SQL. User query: test
2025-09-03 22:46:00.157 +03:00 [DBG] Generated prompt with system message, 2 examples, and user query
2025-09-03 22:46:00.157 +03:00 [DBG] Generated prompt with 6 messages
2025-09-03 22:46:00.158 +03:00 [DBG] Request payload prepared for LLM API
2025-09-03 22:46:07.446 +03:00 [INF] LLM API responded with status: "OK"
2025-09-03 22:46:07.488 +03:00 [INF] Successfully converted natural language to SQL query
2025-09-03 22:46:07.489 +03:00 [INF] Executed endpoint 'HTTP: POST api/query/{profileId}/convert'
2025-09-03 22:46:07.490 +03:00 [DBG] Connection id "0HNFB44T8JL9A" completed keep alive response.
2025-09-03 22:46:07.491 +03:00 [DBG] 'ProfilesDbContext' disposed.
2025-09-03 22:46:07.492 +03:00 [DBG] Disposing connection to database 'main' on server 'schema_cache.db'.
2025-09-03 22:46:07.493 +03:00 [DBG] Disposed connection to database 'main' on server 'schema_cache.db' (1ms).
2025-09-03 22:46:07.495 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7202/api/query/773c7d30-609c-442f-ad98-0546699311ed/convert - 200 null application/json; charset=utf-8 7408.06ms

{
  "Version": "1.0.0",
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "ConnectionStrings": {
    "DefaultConnection": "Data Source=schema_cache.db"
  },
  "AllowedHosts": "*",
  "Groq": {
    "TestKey": "https://api.groq.com/openai/v1/models",
    "BaseLocalLLMUrl": "http://localhost:11434",
    "BaseGroqUrl": "https://api.groq.com",
    "GroqModel": "llama-3.3-70b-versatile",
    "LocalModel": "qwen3:8b", 
    "SystemPrompt": "You are an assistant that converts natural-language questions into SQL. ALWAYS return a single valid JSON object and NOTHING ELSE. The JSON must follow the schema below exactly.\\n\\nRules:\\n- Validate all referenced tables and columns against the provided SCHEMA_JSON.\\n- Return parameterized SQL (e.g., @param1, @startDate).\\n- Use explicit ANSI SQL (use INNER JOIN for joins).\\n- By default, destructive operations (INSERT, UPDATE, DELETE, ALTER, DROP, TRUNCATE) are NOT allowed. If the user message does not include the ALLOW_DESTRUCTIVE line immediately after the SCHEMA_JSON block (following the FinalUserTemplate), or if that line is set to false, then set \\\"sql\\\": null, \\\"safe\\\": false, add an explanation to \\\"issues\\\" and set intent accordingly.\\n- The assistant must look for the ALLOW_DESTRUCTIVE flag exactly in the position produced by the FinalUserTemplate: \\\"SCHEMA_JSON:\\\\n{schema}\\\\n\\\\nALLOW_DESTRUCTIVE: {allow}\\\\n\\\\nUSER_QUERY:\\\\n{userQuery}\\\". The placeholder {allow} must be the literal token \\\"true\\\" or \\\"false\\\" (lowercase, without quotes).\\n- When the ALLOW_DESTRUCTIVE line is present and {allow} is \\\"true\\\", the assistant MAY generate INSERT/UPDATE/DELETE/ALTER/DROP/TRUNCATE SQL statements. Even when allowed, the assistant MUST still validate referenced tables/columns, produce parameterized SQL, and include a clear rationale in \\\"explanation\\\". Set \\\"safe\\\" to true only if the assistant judges generation appropriate; otherwise set \\\"safe\\\" to false and provide reasons in \\\"issues\\\".\\n- If the flag is present but set to \\\"false\\\", destructive queries must be refused as above.\\n- Confidence must be an integer 0-100.\\n- The returned JSON MUST include these fields exactly: sql, intent, intent_components, tables, columns, parameters, confidence, safe, issues, explanation.\\n- Return only one JSON object (no code fences, no extra text).\\n\\nFormatting guidance for the user message:\\n- The ALLOW_DESTRUCTIVE line MUST appear exactly like this on its own line immediately after the SCHEMA_JSON block: \\n  ALLOW_DESTRUCTIVE: true\\n  or\\n  ALLOW_DESTRUCTIVE: false\\n- The system expects the FinalUserTemplate to be: \\n  SCHEMA_JSON:\\\\n{schema}\\\\n\\\\nALLOW_DESTRUCTIVE: {allow}\\\\n\\\\nUSER_QUERY:\\\\n{userQuery}\\n\\nFollow these rules strictly. Always validate and parameterize. If you refuse to generate destructive SQL, provide a clear explanation and set safe=false.",
    "Examples": [
      {
        "User": "SCHEMA_JSON:\\n{\"database\":\"ExampleDB\",\"tables\":[{\"schema\":\"dbo\",\"name\":\"Employees\",\"columns\":[{\"name\":\"Id\",\"dataType\":\"int\",\"isNullable\":false,\"isPrimaryKey\":true},{\"name\":\"Name\",\"dataType\":\"nvarchar\",\"isNullable\":false},{\"name\":\"DepartmentId\",\"dataType\":\"int\",\"isNullable\":false,\"isForeignKey\":true,\"referencesTable\":\"Departments\",\"referencesColumn\":\"Id\"}]},{\"schema\":\"dbo\",\"name\":\"Departments\",\"columns\":[{\"name\":\"Id\",\"dataType\":\"int\",\"isNullable\":false,\"isPrimaryKey\":true},{\"name\":\"Name\",\"dataType\":\"nvarchar\",\"isNullable\":false}]}],\"relations\":[{\"fromTable\":\"Employees\",\"fromColumn\":\"DepartmentId\",\"toTable\":\"Departments\",\"toColumn\":\"Id\"}]}\n\nUSER_QUERY:\nShow me the names of employees who work in the IT department.",
        "Assistant": "{ \"sql\": \"SELECT E.Name FROM Employees E INNER JOIN Departments D ON E.DepartmentId = D.Id WHERE D.Name = @param1;\", \"intent\": \"JOIN+FILTER\", \"intent_components\": [\"JOIN\",\"FILTER\",\"SELECT\"], \"tables\": [\"Employees\",\"Departments\"], \"columns\": [\"Employees.Name\",\"Departments.Name\",\"Employees.DepartmentId\",\"Departments.Id\"], \"parameters\": [{ \"name\": \"@param1\", \"value\": \"IT\", \"source_text\": \"IT\" }], \"confidence\": 92, \"safe\": true, \"issues\": [], \"explanation\": \"Join employees to departments and filter by department name.\" }"
      },
      {
        "User": "SCHEMA_JSON:\\n{\"database\":\"SalesDB\",\"tables\":[{\"schema\":\"dbo\",\"name\":\"Orders\",\"columns\":[{\"name\":\"Id\",\"dataType\":\"int\",\"isNullable\":false,\"isPrimaryKey\":true},{\"name\":\"CustomerId\",\"dataType\":\"int\",\"isNullable\":false,\"isForeignKey\":true,\"referencesTable\":\"Customers\",\"referencesColumn\":\"Id\"},{\"name\":\"CreatedAt\",\"dataType\":\"datetime\",\"isNullable\":false}]},{\"schema\":\"dbo\",\"name\":\"Customers\",\"columns\":[{\"name\":\"Id\",\"dataType\":\"int\",\"isNullable\":false,\"isPrimaryKey\":true},{\"name\":\"Name\",\"dataType\":\"nvarchar\",\"isNullable\":false},{\"name\":\"Country\",\"dataType\":\"nvarchar\",\"isNullable\":true}]}],\"relations\":[{\"fromTable\":\"Orders\",\"fromColumn\":\"CustomerId\",\"toTable\":\"Customers\",\"toColumn\":\"Id\"}]}\n\nUSER_QUERY:\nHow many orders were placed by customers from Germany last year, grouped by customer name?",
        "Assistant": "{ \"sql\": \"SELECT C.Name, COUNT(O.Id) AS order_count FROM Orders O INNER JOIN Customers C ON O.CustomerId = C.Id WHERE C.Country = @param1 AND O.CreatedAt >= @param2_start AND O.CreatedAt < @param2_end GROUP BY C.Name;\", \"intent\": \"AGGREGATE+GROUP_BY+FILTER\", \"intent_components\": [\"AGGREGATE\",\"GROUP_BY\",\"FILTER\",\"JOIN\"], \"tables\": [\"Orders\",\"Customers\"], \"columns\": [\"Orders.Id\",\"Orders.CustomerId\",\"Orders.CreatedAt\",\"Customers.Name\",\"Customers.Country\"], \"parameters\": [{ \"name\": \"@param1\", \"value\": \"Germany\", \"source_text\": \"Germany\" }, { \"name\": \"@param2_start\", \"value\": \"2024-01-01\", \"source_text\": \"last year start (inferred)\" }, { \"name\": \"@param2_end\", \"value\": \"2025-01-01\", \"source_text\": \"last year end (inferred)\" }], \"confidence\": 88, \"safe\": true, \"issues\": [], \"explanation\": \"Count orders grouped by customer for last calendar year and country filter.\" }"
      }
    ],
    "FinalUserTemplate": "SCHEMA_JSON:\\n{schema}\\n\\nALLOW_DESTRUCTIVE: {allow}\\n\\nUSER_QUERY:\\n{userQuery}"
  },
  "SupportDBs": [
    {
      "dbType": "SqlServer",
      "Name": "SQL Server",
      "Describtion": "Microsoft's enterprise database",
      "BaseKey": "SOFTWARE\\Microsoft\\Microsoft SQL Server\\Instance Names\\SQL"
    }
  ]
}
